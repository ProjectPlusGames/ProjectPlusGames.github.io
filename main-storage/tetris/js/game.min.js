var requirejs,require,define;!function(t){function e(t,e){return g.call(t,e)}function i(t,e){var i,n,s,r,o,a,h,l,c,u,d,A=e&&e.split("/"),p=m.map,f=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(A=A.slice(0,A.length-1),t=t.split("/"),o=t.length-1,m.nodeIdCompat&&y.test(t[o])&&(t[o]=t[o].replace(y,"")),t=A.concat(t),c=0;c<t.length;c+=1)if(d=t[c],"."===d)t.splice(c,1),c-=1;else if(".."===d){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((A||f)&&p){for(i=t.split("/"),c=i.length;c>0;c-=1){if(n=i.slice(0,c).join("/"),A)for(u=A.length;u>0;u-=1)if(s=p[A.slice(0,u).join("/")],s&&(s=s[n])){r=s,a=c;break}if(r)break;!h&&f&&f[n]&&(h=f[n],l=c)}!r&&h&&(r=h,a=l),r&&(i.splice(0,a,r),t=i.join("/"))}return t}function n(e,i){return function(){return c.apply(t,_.call(arguments,0).concat([e,i]))}}function s(t){return function(e){return i(e,t)}}function r(t){return function(e){A[t]=e}}function o(i){if(e(p,i)){var n=p[i];delete p[i],f[i]=!0,l.apply(t,n)}if(!e(A,i)&&!e(f,i))throw new Error("No "+i);return A[i]}function a(t){var e,i=t?t.indexOf("!"):-1;return i>-1&&(e=t.substring(0,i),t=t.substring(i+1,t.length)),[e,t]}function h(t){return function(){return m&&m.config&&m.config[t]||{}}}var l,c,u,d,A={},p={},m={},f={},g=Object.prototype.hasOwnProperty,_=[].slice,y=/\.js$/;u=function(t,e){var n,r=a(t),h=r[0];return t=r[1],h&&(h=i(h,e),n=o(h)),h?t=n&&n.normalize?n.normalize(t,s(e)):i(t,e):(t=i(t,e),r=a(t),h=r[0],t=r[1],h&&(n=o(h))),{f:h?h+"!"+t:t,n:t,pr:h,p:n}},d={require:function(t){return n(t)},exports:function(t){var e=A[t];return"undefined"!=typeof e?e:A[t]={}},module:function(t){return{id:t,uri:"",exports:A[t],config:h(t)}}},l=function(i,s,a,h){var l,c,m,g,_,y,v=[],T=typeof a;if(h=h||i,"undefined"===T||"function"===T){for(s=!s.length&&a.length?["require","exports","module"]:s,_=0;_<s.length;_+=1)if(g=u(s[_],h),c=g.f,"require"===c)v[_]=d.require(i);else if("exports"===c)v[_]=d.exports(i),y=!0;else if("module"===c)l=v[_]=d.module(i);else if(e(A,c)||e(p,c)||e(f,c))v[_]=o(c);else{if(!g.p)throw new Error(i+" missing "+c);g.p.load(g.n,n(h,!0),r(c),{}),v[_]=A[c]}m=a?a.apply(A[i],v):void 0,i&&(l&&l.exports!==t&&l.exports!==A[i]?A[i]=l.exports:m===t&&y||(A[i]=m))}else i&&(A[i]=a)},requirejs=require=c=function(e,i,n,s,r){if("string"==typeof e)return d[e]?d[e](i):o(u(e,i).f);if(!e.splice){if(m=e,m.deps&&c(m.deps,m.callback),!i)return;i.splice?(e=i,i=n,n=null):e=t}return i=i||function(){},"function"==typeof n&&(n=s,s=r),s?l(t,e,i,n):setTimeout(function(){l(t,e,i,n)},4),c},c.config=function(t){return c(t)},requirejs._defined=A,define=function(t,i,n){i.splice||(n=i,i=[]),e(A,t)||e(p,t)||(p[t]=[t,i,n])},define.amd={jQuery:!0}}(),define("almond",function(){}),!function(t,e){var i=!0,n="function"==typeof define&&!!define.amd,s="undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports;switch(i){case n:define("bottom_line",e);break;case s:module.exports=e();break;default:e(t)}}(this,function(t){"use strict";function e(t,e,r){var settings=r&&e||{},r=r||e,o=settings["native"],c=settings.base?s(settings["native"]):{};c.not={},c.methods={};var u=c._methods="obj"===t?{not:{}}:Object.create(l.obj._methods,{not:{value:Object.create(l.obj._methods.not)}}),d=c._chains="obj"===t?{not:{}}:Object.create(l.obj._chains,{not:{value:Object.create(l.obj._chains.not)}});return Object.defineProperty(c._methods,"chain",{get:function(){return d},enumerable:!1,configurable:!1}),Object.defineProperty(c._chains,"value",{get:function(){var t=a[--h];return t.valueOf?t.valueOf():t},enumerable:!1,configurable:!1}),o&&o.prototype&&(o.prototype.hasOwnProperty("_")||Object.defineProperty(o.prototype,"_",{enumerable:!1,configurable:!1,get:function(){return a[h++]=this,u},set:function(t){Object.defineProperty(this,"_",{value:t,enumerable:!0,configurable:!0,writable:!0})}})),settings.global!==!1&&(l[t]=c),i(c,r["static"]),n(c,r.prototype),c}function i(t,e){e&&(r(t,{enumerable:!1},e),r(t.not,{enumerable:!1,modifier:function(e){return function(){return!e.apply(t,arguments)}}},e),(t===l.obj||t===l.fnc)&&(r(l,{enumerable:!1,overwrite:!1},e),r(l.not,{enumerable:!1,overwrite:!1,modifier:function(e){return function(){return!e.apply(t,arguments)}}},e)))}function n(t,e){e&&(r(t._methods,{enumerable:!1,modifier:function(t){return function(){return t.apply(a[--h],arguments)}}},e),r(t._methods.not,{enumerable:!1,modifier:function(t){return function(){return!t.apply(a[--h],arguments)}}},e),r(t._chains,{enumerable:!1,modifier:function(t){return function(){return t.apply(a[--h],arguments)._.chain}}},e),r(t._chains.not,{enumerable:!1,modifier:function(t){return function(){return(!t.apply(a[--h],arguments))._.chain}}},e),r(t.methods,{enumerable:!1},e))}function s(t){var e=Object.create(Object.getPrototypeOf(t));return Object.getOwnPropertyNames(t).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))}),e}function r(t,e,i){var settings=i&&e||{},i=i||e;settings.override=settings.override!==!1,settings.overwrite=settings.overwrite!==!1,settings.overwriteaction=settings.overwriteaction||"warn",settings.overrideaction=settings.overrideaction||"warn",settings.exclude=settings.exclude||[],settings.shim===!0&&(settings.overwrite=!1,settings.overwriteaction="ignore");for(var n in i)if(!(!i.hasOwnProperty(n)||settings.exclude.length&&~settings.exclude.indexOf(n))){var r=Object.getOwnPropertyDescriptor(i,n),a=!(!r.get&&!r.set),h={};!a&&i[n].hasOwnProperty("value")&&(h=i[n],r.value=h.value,h.clone&&(r.value=s(h.value)),h.exec&&(r.value=h.value(t)),h.wrap&&(t.hasOwnProperty(n)&&t[n].hasOwnProperty("add")?r.value.add():r.value=o(t[n],r.value)),h.constant&&(h.configurable=!1,h.writable=!1));var l=s(settings);for(var c in h)h.hasOwnProperty(c)&&(l[c]=h[c]);r.enumerable=void 0!==l.enumerable?l.enumerable:r.enumerable,r.configurable=void 0!==l.configurable?l.configurable:r.configurable,r.writable=void 0!==l.writable?l.writable:r.writable,a&&delete r.writable,l.modifier&&"function"==typeof r.value&&(r.value=l.modifier(r.value));var u=(h.aliases||[]).concat(n);u.forEach(function(e){var i=function(t,i,n){var s,r=l[t+"action"],o="override"===t&&i===!0&&("function"!=typeof n||/\b_super\b/.test(n)),a="override"===t&&i===!0&&"function"==typeof n&&!/\b_super\b/.test(n);if("ignore"!==r&&!o&&!l.wrap){if(i===!0?(s=("override"===t?"overriding":"overwriting")+" property: "+e+".",a&&(s+=" But not calling super method.")):s="redundant "+t+" defined in module for property "+e+". "+t+"s are set to false in settings/config","throw"===r)throw s;console[r](s)}};if(t.hasOwnProperty(e)){if(i("overwrite",l.overwrite,r.value),!l.overwrite)return}else if(e in t&&(i("override",l.override,r.value),!l.override))return;Object.defineProperty(t,e,r)})}return t}function o(t){var e=Array.isArray(t)?t:[];if("function"==typeof t)for(var i=0;i<arguments.length;i++)e.push(arguments[i]);var n=function(){for(var t,i=0,n=e.length;n>i;i++)t=e[i].apply(this,arguments);return t};return n._callbacks=e,n.add=function(t,i){return t=i?t.bind(i):t,e.push(t),this},n.addOnce=function(t,i){t=i?t.bind(i):t;var s=function(){return n.remove(s),t.apply(this,arguments)};return e.push(s),this},n.remove=function(t){var i=e.indexOf(t);return~i?e.splice(i,1):console.warn("trying to remove function from wrapper that is not registered as a callback"),this},n.removeAll=function(){return e=[],this},n}var a=[],h=0,l={version:"0.0.5",not:{}};if(t){if(t.hasOwnProperty("_"))return void console.error("_ is already defined on root object");t._=l}var c=Object.prototype.toString;return r(l,{inject:function(t,e,s){var r={};r[e]=s,s["static"]?i(t,r):n(t,r)},isArguments:function(t){return"[object Arguments]"===c.call(t)},isArray:Array.isArray,isEmpty:function(t){var e;for(e in t)return!1;return!0},isFunction:function(t){return"function"==typeof t},isInteger:function(t){return"number"===l.typeOf(t)&&t===(0|t)},isNull:function(t){return null===t},isNumber:function(t){return"number"===l.typeOf(t)},isObject:function(t){return"object"===l.typeOf(t)},isPrimitive:function(t){var e=typeof t;switch(e){case"object":case"function":return null===t;default:return!0}},isString:function(t){return"string"===l.typeOf(t)},isUndefined:function(t){return void 0===t},isDefined:function(t){return void 0!==t},toArray:function(t){var e=l.typeOf(t);switch(e){case"arguments":for(var i=arguments.length,n=new Array(i),s=0;i>s;s++)n[s]=arguments[s];return n;case"object":return t._.values();case"array":return t;default:return[]}},toInteger:function(t){switch(l.typeOf(t)){case"number":return 0|t;case"string":return parseInt(t);default:return NaN}},toNumber:function(t){switch(l.typeOf(t)){case"number":return t;case"string":return parseFloat(t);default:return NaN}},toString:{overrideaction:"ignore",value:function(t){return t?t._.toString():t+""}}}),r(Function.prototype,{shim:!0},{name:function(){return this.toString().match(/^function\s?([^\s(]*)/)[1]},bind:function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s}}),r(Math,{shim:!0},{log10:function(t){return Math.log(t)/Math.LN10}}),r(Number,{shim:!0},{isNaN:function(t){return"number"==typeof t&&t!==t}}),e("obj",{"native":Object},{"static":{clone:function u(t){if(l.isPrimitive(t))return t;if(l.isArray(t))return t.slice();var u=l.create(t._.proto()),e=t._.names();return e._.each(function(e){Object.defineProperty(u,e,t._.descriptor(e))}),u},cloneDeep:function(t){if(l.isPrimitive(t))return t;var e=l.create(t._.proto());return t._.names()._.each(function(i){var n=t._.descriptor(i);n.value&&(n.value=l.cloneDeep(n.value)),Object.defineProperty(e,i,n)}),e},create:function(t){return t===Array.prototype?[]:Object.create(t)},extend:r,typeOf:function(t){switch(t){case null:return"null";case void 0:return"undefined";default:return Object.prototype.toString.call(t)._.between("[object ","]")._.decapitalize()}},names:function(t){return null===t||void 0===t?[]:Object.getOwnPropertyNames(t)}},prototype:{_add:function(t,e){return this[e]=t,this},count:function(t){var e=0;return this._.each(function(i){e+=i===t}),e},countFn:function(t){var e=0;return this._.each(function(i){e+=t(i)}),e},define:function(t,e,i){return i=i||{},i.value=e,Object.defineProperty(this,t,i)},constant:function(t,e){return Object.defineProperty(this,t,{value:e,enumerable:!0})},del:function(t){return arguments._.eachRight(function(t){delete this[t]},this),this},delFn:function(t,e){return this._.each(function(i,n,s){t.call(e,n,s)&&delete this[n]},this),this},Del:function(t){var e=arguments,i=l.create(this._.proto());return this._.each(function(t,n){e._.not.has(n)&&i._._add(t,n)},this),i},DelFn:function(t,e){var i=l.create(this._.proto());return this._.each(function(n,s,r,o){t.call(e,s,r,o)||i._._add(n,s)},this),i},descriptor:function(t){return Object.getOwnPropertyDescriptor(this,t)},each:function(t,e){if(l.isArguments(this))return l.arr.methods.each.apply(this,arguments);var i;for(var n in this)if(this.hasOwnProperty(n)&&(i=t.call(e,this[n],n,this))===!1)break;return i},eachRight:function(t,e,i){return l.isArguments(this)?l.arr.methods.eachRight.apply(this,arguments):this._.keys()._.eachRight(function(t){return e.call(i,this[t],t,this)},this)},filter:function(t,e){var i=[];return this._.each(function(n){t.call(e,n)&&i.push(n)}),i},find:function(t,e){var i;return this._.each(function(n){return t.call(e,n)?(i=n,!1):void 0}),i},findRight:function(t,e){var i;return this._.eachRight(function(n){return t.call(e,n)?(i=n,!1):void 0}),i},has:{aliases:["contains"],value:function(t){var e=!1;return this._.each(function(i){return t===i?!(e=!0):void 0}),e}},hasFn:{aliases:["containsFn"],value:function(t,e){return!!this._.find(t,e)}},keyOf:{aliases:["indexOf"],value:function(t){var e=-1;return this._.each(function(i,n){return t===i?(e=n,!1):void 0}),e}},keyOfFn:{aliases:["indexOfFn"],value:function(t,e){var i=-1;return this._.each(function(n,s){return t.call(e,n)?(i=s,!1):void 0}),i}},keys:function(){return Object.keys(this)},remove:function(t){var e,i=arguments,n=arguments.length;return this._.each(function(t,s){return e=i._.indexOf(t),~e?(this._.del(s),delete i[e],--n>0):void 0},this),this},removeFn:function(t,e){return this._.each(function(i,n,s,r){return t.call(e,i,n,s,r)?(this._.del(n),!1):void 0},this),this},Remove:function(t){var e,i=l.create(this._.proto()),n=arguments;return this._.each(function(t,s){e=n._.indexOf(t),~e?delete n[e]:i._._add(t,s)},this),i},RemoveFn:function(t,e){var i=l.create(this._.proto()),n=!1;return this._.each(function(s,r,o,a){!n&&t.call(e,s,r,o,a)?n=!0:i._._add(s,r)},this),i},remove$:function(t){var e=arguments;return this._.each(function(t,i){e._.has(t)&&delete this[i]},this),this},remove$Fn:function(t,e){return this._.each(function(i,n,s){t.call(e,i,n,s)&&delete this[n]},this),this},Remove$:function(t){var e=l.create(this._.proto()),i=arguments;return this._.each(function(t,n){i._.not.has(t)&&e._._add(t,n)},this),e},Remove$Fn:function(t,e){var i=l.create(this._.proto());return this._.each(function(n,s,r,o){t.call(e,n,s,r,o)||i._._add(n,s)},this),i},select:function(t){var e=arguments;return this._.remove$Fn(function(t){var i=e._.indexOf(t);return~i&&delete e[i],!~i})},selectFn:function(t,e){var i=!1;return this._.remove$Fn(function(){return t.apply(this,arguments)&&!i?!(i=!0):!0},e)},Select:function(t){var e=arguments;return this._.Remove$Fn(function(t){var i=e._.indexOf(t);return~i&&delete e[i],!~i})},SelectFn:function(t,e){var i=!1;return this._.Remove$Fn(function(){return t.apply(this,arguments)&&!i?!(i=!0):!0},e)},select$:function(t){var e=arguments;return this._.remove$Fn(function(t){return!~e._.indexOf(t)})},select$Fn:function(t,e){return this._.remove$Fn(l.fnc.negate(t),e)},Select$:function(t){var e=arguments;return this._.Remove$Fn(function(t){return!~e._.indexOf(t)})},Select$Fn:{aliases:["find$"],value:function(t,e){return this._.Remove$Fn(l.fnc.negate(t),e)}},size:{aliases:["length"],value:function(){var t=0;return this._.each(function(){t++}),t}},names:{aliases:["keys$"],value:function(){return Object.getOwnPropertyNames(this)}},owns:Object.prototype.hasOwnProperty,pairs:function(){var t=[];return this._.each(function(e,i){t.push(i,e)}),t},proto:function(t){return void 0===t?Object.getPrototypeOf(this):(this.__proto__=t,this)},toString:{overrideaction:"ignore",value:function(t){var e="";return this._.each(function(i,n){var s;l.isPrimitive(i)?s=i:(t||(t=[this]),t._.has(i)?s="[[circular ref]]":(t.push(i),s=i._.toString(t))),e+=(e?", ":"{")+n+": "+s}),e+"}"}},values:function(){var t=[];return this._.each(function(e){t.push(e)}),t}}}),e("arr",{"native":Array},{"static":{concat:function(t){return Array.prototype.concat.apply([],arguments)}},prototype:{append:function(t){var e;return arguments._.each(function(t){t&&(e=this.length,this.length+=t.length,t._.each(function(t,i,n){void 0===t&&n._.not.owns(i)||(this[e+i]=t)},this))},this),this},Append:function(t){return l.clone(this)._.append.apply(null,arguments)},avg:function(){return this.length?this._.sum()/this.length:void 0},compact:function(){return this._.remove$Fn(function(t){return!t})},Compact:function(){return this._.Remove$Fn(function(t){return!t})},del:{overrideaction:"ignore",value:function(t){return arguments._.eachRight(function(t){this.splice(t,1)},this),this}},delFn:{overrideaction:"ignore",value:function(t,e){return this._.eachRight(function(i,n,s,r){t.call(e,n,s,r)&&this.splice(n,1)},this),this}},remove$:{overrideaction:"ignore",value:function(t){var e=arguments;return this._.eachRight(function(t,i){~e._.indexOf(t)&&this.splice(i,1)},this),this}},remove$Fn:{overrideaction:"ignore",value:function(t,e){return this._.eachRight(function(i,n,s,r){t.call(e,i,n,s,r)&&this.splice(n,1)},this),this}},diff:function(t){return arguments._.each(function(t){return this._.remove.apply(this,t)},this),this},Diff:function(t){return 1===arguments.length?this._.Remove.apply(this,t):l.clone(this)._.diff.apply(null,arguments)},dimit:{aliases:["dimensionalize"],value:function(t){function e(i,n,r){for(var o=0,a=r[n];a>o;o++)i[o]=n===s?l.clone(t):new Array(r[n+1]),e(i[o],n+1,r)}var i=this,n=new Array(i[0]),s=i.length-1;return e(n,0,i),n}},each:{overrideaction:"ignore",value:function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);for(var n,s,r,o=0,a=this.length,h=a,l=0,c=o;a>c;c+=t)if(void 0!==(n=this[c])||this.hasOwnProperty(c)){if((r=e.call(i,this[c],c,this,l))===!1)break;(s=this.length-h)&&(c+=s,a+=s,h+=s,l+=s)}return r}},eachRight:{overrideaction:"ignore",value:function(t,e,i){"function"==typeof t&&(i=e,e=t,t=1);for(var n,s=this.length-1,r=-1,o=s;o>r&&(void 0===this[o]&&!this.hasOwnProperty(o)||(n=e.call(i,this[o],o,this))!==!1);o-=t);return n}},first:function(t){return void 0===t?this[0]:(this[0]=t,this)},flatten:function(){return this._.each(function(t,e){l.isArray(t)&&this.splice.apply(this,t._.insert(1)._.insert(e))},this),this},Flatten:function(){return this.concat.apply([],this)},has:{aliases:["contains"],overrideaction:"ignore",value:function(t){return this.indexOf(t)>-1}},insert:function(t,e){return this.splice(e,0,t),this},intersect:function(t){return this._.select.apply(this,t)},Intersect:function(t){return this._.Select.apply(this,t)},intersects:function(t){var e=!1;return this._.each(function(i){return t._.has(i)?!(e=!0):void 0}),e},last:function(t){return void 0===t?this[this.length-1]:(this[this.length-1]=t,this)},max:function(t){if(void 0===t)return Math.max.apply(null,this);var e=this[0];return this._.each(function(i){t(i,e)>0&&(e=i)}),e},min:function(t){if(void 0===t)return Math.min.apply(null,this);var e=this[0];return this._.each(function(i){t(i,e)<0&&(e=i)}),e},modify:function(t,e){return this._.each(function(i,n){this[n]=t.call(e,i,n,this)},this),this},Modify:function(t,e){return l.clone(this)._.modify(t,e)},push:function(t){return this.push.apply(this,arguments),this},_add:{overrideaction:"ignore",value:function(t){return this.push(t),this}},random:function(){return this[l["int"].random(0,this.length-1)]},rm:function(t){return this.splice(this.indexOf(t),1),this},shuffle:function(){for(var t,e,i=this.length;i;t=Math.floor(Math.random()*i),e=this[--i],this[i]=this[t],this[t]=e);return this},size:{overrideaction:"ignore",value:function(t){return void 0===t?this.length:(this.length=t,this)}},sum:function(){return this.length?this.reduce(function(t,e){return t+e}):void 0},toString:{overrideaction:"ignore",value:function(){for(var t="[",e=0,i=this.length;i>e;e++)t+=(e?", ":"")+this[e]._.toString();return t+"]"}},unify:function(t){return this._.append(t)._.unique()},Unify:function(t){var e=this._.Append(t);return e._.unique()},unique:function(){return this._.eachRight(function(t,e){this._.each(function(i,n){return t===i&&e>n?(this.splice(e,1),!1):e>n},this)},this),this},Unique:function(){var t=[];return this._.each(function(e){t._.not.has(e)&&t.push(e)},this),t}}}),e("str",{"native":String},{prototype:{after:function(t){var e,i=this.valueOf();return arguments._.each(function(t){e=i.indexOf(t),i=~e?i.slice(e+t.length):i}),i},afterLast:function(t){var e,i=this.valueOf();return arguments._.each(function(t){e=i.lastIndexOf(t),i=~e?i.slice(e+t.length):i}),i},before:function(t){var e,i=this.valueOf();return arguments._.each(function(t){e=i.indexOf(t),i=~e?i.slice(0,e):i}),i},beforeLast:function(t){var e,i=this.valueOf();return arguments._.each(function(t){e=i.lastIndexOf(t),i=~e?i.slice(0,e):i}),i},between:function(t,e){return this._.after(t)._.before(e)},betweenLast:function(t,e){return this._.beforeLast(e)._.afterLast(t)},capitalize:function(){return this[0]?this[0].toUpperCase()+this.slice(1):this.valueOf()},decapitalize:function(){return this[0]?this[0].toLowerCase()+this.slice(1):this.valueOf()},endsWith:function(t){return this.slice(-t.length)===t},has:{overrideaction:"ignore",value:function(t){return!!~this.indexOf(t)}},insert:function(t,e){return this._.splice(e,0,t)},isLowerCase:function(){return this==this.toLowerCase()},isUpperCase:function(){return this==this.toUpperCase()},get last(){return this[this.length-1]},splice:function(t,e,i){return this.slice(0,t)+i+this.slice(t+__math.abs(e))},startsWith:function(t){return!this.indexOf(t)},toString:{overrideaction:"ignore",value:function(){return this.toString()}}}}),e("num",{"native":Number},{"static":{isNumber:function(t){return"number"==typeof t&&!isNaN(t)},random:function(t,e){if(void 0===t)return Math.random();var i=(e||0)-t,n=i?t:0;return Math.random()*i+n},rebound:function(t){return function(e,i){return e+t%(i-e)}}},prototype:{sign:function(t){return void 0===t?this>0?1:0>this?-1:0:t*Math.abs(this)},get even(){return!(1&this)},get odd(){return!!(1&this)},get parity(){return 1&this},pow:function(t){return Math.pow(this,t)},between:function(t,e){return this>=t&&e>=this},bound:{aliases:["clamp"],value:function(t,e){return Math.min(Math.max(this,t),e)}},rebound:function(t,e){return t+this%(e-t)},toString:{overrideaction:"ignore",value:function(){return this.toString()}}}}),e("fnc",{"native":Function},{"static":{bind:function(t,e,i){if(l.isFunction(t))return t.bind(e);if(t._.not.has(void 0))return t.unshift(i),e.bind.apply(e,t);var n=t._.count(void 0),s=t.length;return function(){for(var r=arguments.length,o=s+r-n,a=o-1,h=r-1;a>=0;a--)arguments[a]=void 0!==t[a]&&s>a?t[a]:arguments[h--];return arguments.length=o,e.apply(i,arguments)}},defer:function(t,e){setTimeout(function(){t.call(e)},0)},delay:{aliases:["callAfter"],value:function(t,e,i){setTimeout(function(){e.call(i)},t)}},inherit:function(t,e,i){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t[i||"_super"]=e.prototype},mixin:function(t,e){t._mixin=function(t){return t.prototype},e._.each(function(e){l.extend(t,e),l.extend(t.prototype,e.prototype)})},negate:function(t){return function(){return!t.apply(this,arguments)}},repeat:function(t,e,i){for(var n=0;t>n;n++)e.call(i,n)},wrap:o},prototype:{toString:{overrideaction:"ignore",value:function(){return this.toString()}}}}),e("int",{"static":{length:function(t){return t?1+Math.log10(t)|0:1},leadZeros:function(t,e){var i="string"==typeof e?e.length:e;return t=l["int"].length(t)>i?Math.pow(10,i)-1:t,(t/Math.pow(10,i)).toFixed(i).substr(2)},random:function(t,e){return t+Math.random()*(e+1-t)|0},rebound:function(t){return function(e,i){var n=t%(Math.abs(i-e)+1);return(0>n?i+1:e)+n}}}}),e("math",{"native":Math,base:!0},{"static":{byProb:function(t){return Math.random()<t},deg:{convert:function(){var t=180/Math.PI;return function(e){return e*t}}(),angle:function(t,e){return l.math.deg.convert(Math.atan2(t,-e))},angleSloped:function(t,e){return 90-l.math.deg.angle(t,e)},invert:function(t){return t+180},normalize:function(t){return(t+360)%360}},rad:{convert:function(){var t=Math.PI/180;return function(e){return e*t}}()},distance:function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},distanceSquared:function(t,e,i,n){return(t-i)*(t-i)+(e-n)*(e-n)},maxm:function(){for(var t=1,e=0,i=arguments.length;i>t;t++)arguments[e]<arguments[t]&&(e=t);return arguments[e]},minm:function(){for(var t=1,e=0,i=arguments.length;i>t;t++)arguments[t]<arguments[e]&&(e=t);return arguments[e]}}}),l}),function(){var t=this,e=e||{};e.WEBGL_RENDERER=0,e.CANVAS_RENDERER=1,e.VERSION="v2.0.0",e.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},e.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},e._UID=0,"undefined"!=typeof Float32Array?(e.Float32Array=Float32Array,e.Uint16Array=Uint16Array):(e.Float32Array=Array,e.Uint16Array=Array),e.INTERACTION_FREQUENCY=30,e.AUTO_PREVENT_DEFAULT=!0,e.PI_2=2*Math.PI,e.RAD_TO_DEG=180/Math.PI,e.DEG_TO_RAD=Math.PI/180,e.RETINA_PREFIX="@2x",e.dontSayHello=!1,e.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0},e.sayHello=function(t){if(!e.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+e.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+e.VERSION+" - http://www.pixijs.com/");e.dontSayHello=!0}},e.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof e.Point){for(var i=[],n=0,s=t.length;s>n;n++)i.push(t[n].x,t[n].y);t=i}this.closed=!0,this.points=t},e.Polygon.prototype.clone=function(){var t=this.points.slice();return new e.Polygon(t)},e.Polygon.prototype.contains=function(t,e){for(var i=!1,n=this.points.length/2,s=0,r=n-1;n>s;r=s++){var o=this.points[2*s],a=this.points[2*s+1],h=this.points[2*r],l=this.points[2*r+1],c=a>e!=l>e&&(h-o)*(e-a)/(l-a)+o>t;c&&(i=!i)}return i},e.Polygon.prototype.constructor=e.Polygon,e.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},e.Matrix.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},e.Matrix.prototype.toArray=function(t){this.array||(this.array=new e.Float32Array(9));var i=this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i},e.Matrix.prototype.apply=function(t,i){return i=i||new e.Point,i.x=this.a*t.x+this.b*t.y+this.tx,i.y=this.c*t.x+this.d*t.y+this.ty,i},e.Matrix.prototype.applyInverse=function(t,i){i=i||new e.Point;var n=1/(this.a*this.d+this.c*-this.b);return i.x=this.d*n*t.x+-this.c*n*t.y+(this.ty*this.c-this.tx*this.d)*n,i.y=this.a*n*t.y+-this.b*n*t.x+(-this.ty*this.a+this.tx*this.b)*n,i},e.Matrix.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.Matrix.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},e.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,s=this.c,r=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=s*e-this.d*i,this.d=s*i+this.d*e,this.tx=r*e-this.ty*i,this.ty=r*i+this.ty*e,this},e.Matrix.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*s+this.ty,this},e.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},e.identityMatrix=new e.Matrix,e.DisplayObject=function(){this.position=new e.Point,this.scale=new e.Point(1,1),this.pivot=new e.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new e.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new e.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},e.DisplayObject.prototype.constructor=e.DisplayObject,Object.defineProperty(e.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}}),Object.defineProperty(e.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask&&(this._mask.isMask=!1),this._mask=t,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(e.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(t){if(t){for(var e=[],i=0;i<t.length;i++)for(var n=t[i].passes,s=0;s<n.length;s++)e.push(n[s]);this._filterBlock={target:this,filterPasses:e}}this._filters=t}}),Object.defineProperty(e.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap!==t&&(t?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=t)}}),e.DisplayObject.prototype.updateTransform=function(){var t,i,n,s,r,o,a=this.parent.worldTransform,h=this.worldTransform;this.rotation%e.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),t=this._cr*this.scale.x,i=this._sr*this.scale.x,n=-this._sr*this.scale.y,s=this._cr*this.scale.y,r=this.position.x,o=this.position.y,(this.pivot.x||this.pivot.y)&&(r-=this.pivot.x*t+this.pivot.y*n,o-=this.pivot.x*i+this.pivot.y*s),h.a=t*a.a+i*a.c,h.b=t*a.b+i*a.d,h.c=n*a.a+s*a.c,h.d=n*a.b+s*a.d,h.tx=r*a.a+o*a.c+a.tx,h.ty=r*a.b+o*a.d+a.ty):(t=this.scale.x,s=this.scale.y,r=this.position.x-this.pivot.x*t,o=this.position.y-this.pivot.y*s,h.a=a.a*t,h.b=a.b*s,h.c=a.c*t,h.d=a.d*s,h.tx=r*a.a+o*a.c+a.tx,h.ty=r*a.b+o*a.d+a.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.DisplayObject.prototype.getBounds=function(t){return t=t,e.EmptyRectangle},e.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(e.identityMatrix)},e.DisplayObject.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0)},e.DisplayObject.prototype.generateTexture=function(t,i,n){var s=this.getLocalBounds(),r=new e.RenderTexture(0|s.width,0|s.height,n,i,t);return e.DisplayObject._tempMatrix.tx=-s.x,e.DisplayObject._tempMatrix.ty=-s.y,r.render(this,e.DisplayObject._tempMatrix),r},e.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},e.DisplayObject.prototype.toGlobal=function(t){return this.updateTransform(),this.worldTransform.apply(t)},e.DisplayObject.prototype.toLocal=function(t,e){return e&&(t=e.toGlobal(t)),this.updateTransform(),this.worldTransform.applyInverse(t)},e.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha,t.gl?e.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):e.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)},e.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|t.width,0|t.height);else{var i=new e.RenderTexture(0|t.width,0|t.height);this._cachedSprite=new e.Sprite(i),this._cachedSprite.worldTransform=this.worldTransform}var n=this._filters;this._filters=null,this._cachedSprite.filters=n,e.DisplayObject._tempMatrix.tx=-t.x,e.DisplayObject._tempMatrix.ty=-t.y,this._cachedSprite.texture.render(this,e.DisplayObject._tempMatrix),this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._filters=n,this._cacheAsBitmap=!0},e.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},e.DisplayObject.prototype._renderWebGL=function(t){t=t},e.DisplayObject.prototype._renderCanvas=function(t){t=t},e.DisplayObject._tempMatrix=new e.Matrix,Object.defineProperty(e.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(e.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),e.DisplayObjectContainer=function(){e.DisplayObject.call(this),this.children=[]},e.DisplayObjectContainer.prototype=Object.create(e.DisplayObject.prototype),e.DisplayObjectContainer.prototype.constructor=e.DisplayObjectContainer,Object.defineProperty(e.DisplayObjectContainer.prototype,"width",{
get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var e=this.getLocalBounds().width;0!==e?this.scale.x=t/(e/this.scale.x):this.scale.x=1,this._width=t}}),Object.defineProperty(e.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var e=this.getLocalBounds().height;0!==e?this.scale.y=t/(e/this.scale.y):this.scale.y=1,this._height=t}}),e.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},e.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length)return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this.stage&&t.setStageReference(this.stage),t;throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)},e.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),n=this.getChildIndex(e);if(0>i||0>n)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[n]=t}},e.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e},e.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw new Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t)},e.DisplayObjectContainer.prototype.getChildAt=function(t){if(0>t||t>=this.children.length)throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[t]},e.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1!==e)return this.removeChildAt(e)},e.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.stage&&e.removeStageReference(),e.parent=void 0,this.children.splice(t,1),e},e.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,n="number"==typeof e?e:this.children.length,s=n-i;if(s>0&&n>=s){for(var r=this.children.splice(i,s),o=0;o<r.length;o++){var a=r[o];this.stage&&a.removeStageReference(),a.parent=void 0}return r}if(0===s&&0===this.children.length)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},e.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(e.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateTransform()},e.DisplayObjectContainer.prototype.getBounds=function(){if(0===this.children.length)return e.EmptyRectangle;for(var t,i,n,s=1/0,r=1/0,o=-(1/0),a=-(1/0),h=!1,l=0,c=this.children.length;c>l;l++){var u=this.children[l];u.visible&&(h=!0,t=this.children[l].getBounds(),s=s<t.x?s:t.x,r=r<t.y?r:t.y,i=t.width+t.x,n=t.height+t.y,o=o>i?o:i,a=a>n?a:n)}if(!h)return e.EmptyRectangle;var d=this._bounds;return d.x=s,d.y=r,d.width=o-s,d.height=a-r,d},e.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=e.identityMatrix;for(var i=0,n=this.children.length;n>i;i++)this.children[i].updateTransform();var s=this.getBounds();return this.worldTransform=t,s},e.DisplayObjectContainer.prototype.setStageReference=function(t){this.stage=t,this._interactive&&(this.stage.dirty=!0);for(var e=0,i=this.children.length;i>e;e++){var n=this.children[e];n.setStageReference(t)}},e.DisplayObjectContainer.prototype.removeStageReference=function(){for(var t=0,e=this.children.length;e>t;t++){var i=this.children[t];i.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},e.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);var e,i;if(this._mask||this._filters){for(this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),t.spriteBatch.start()}else for(e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t)}},e.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(t);this._mask&&t.maskManager.pushMask(this._mask,t);for(var e=0,i=this.children.length;i>e;e++){var n=this.children[e];n._renderCanvas(t)}this._mask&&t.maskManager.popMask(t)}},e.Sprite=function(t){e.DisplayObjectContainer.call(this),this.anchor=new e.Point,this.texture=t,this._width=0,this._height=0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL,this.shader=null,t.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.on("update",this.onTextureUpdateBind)),this.renderable=!0},e.Sprite.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Sprite.prototype.constructor=e.Sprite,Object.defineProperty(e.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Sprite.prototype.setTexture=function(t){this.texture=t,this.cachedTint=16777215},e.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},e.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width,i=this.texture.frame.height,n=e*(1-this.anchor.x),s=e*-this.anchor.x,r=i*(1-this.anchor.y),o=i*-this.anchor.y,a=t||this.worldTransform,h=a.a,l=a.c,c=a.b,u=a.d,d=a.tx,A=a.ty,p=h*s+c*o+d,m=u*o+l*s+A,f=h*n+c*o+d,g=u*o+l*n+A,_=h*n+c*r+d,y=u*r+l*n+A,v=h*s+c*r+d,T=u*r+l*s+A,b=-(1/0),w=-(1/0),x=1/0,C=1/0;x=x>p?p:x,x=x>f?f:x,x=x>_?_:x,x=x>v?v:x,C=C>m?m:C,C=C>g?g:C,C=C>y?y:C,C=C>T?T:C,b=p>b?p:b,b=f>b?f:b,b=_>b?_:b,b=v>b?v:b,w=m>w?m:w,w=g>w?g:w,w=y>w?y:w,w=T>w?T:w;var S=this._bounds;return S.x=x,S.width=b-x,S.y=C,S.height=w-C,this._currentBounds=S,S},e.Sprite.prototype._renderWebGL=function(t){if(this.visible&&!(this.alpha<=0)){var e,i;if(this._mask||this._filters){var n=t.spriteBatch;for(this._filters&&(n.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.stop(),t.maskManager.pushMask(this.mask,t),n.start()),n.render(this),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t);n.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&t.filterManager.popFilter(),n.start()}else for(t.spriteBatch.render(this),e=0,i=this.children.length;i>e;e++)this.children[e]._renderWebGL(t)}},e.Sprite.prototype._renderCanvas=function(t){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var i=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.roundPixels?t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===e.scaleModes.LINEAR);var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,s=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=e.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,n/i,s/i,this.texture.crop.width/i,this.texture.crop.height/i)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,n/i,s/i,this.texture.crop.width/i,this.texture.crop.height/i)}for(var r=0,o=this.children.length;o>r;r++)this.children[r]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},e.Sprite.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new e.Sprite(i)},e.Sprite.fromImage=function(t,i,n){var s=e.Texture.fromImage(t,i,n);return new e.Sprite(s)},e.SpriteBatch=function(t){e.DisplayObjectContainer.call(this),this.textureThing=t,this.ready=!1},e.SpriteBatch.prototype=Object.create(e.DisplayObjectContainer.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new e.WebGLFastSpriteBatch(t),this.ready=!0},e.SpriteBatch.prototype.updateTransform=function(){e.DisplayObject.prototype.updateTransform.call(this)},e.SpriteBatch.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(t.gl),t.spriteBatch.stop(),t.shaderManager.setShader(t.shaderManager.fastShader),this.fastSpriteBatch.begin(this,t),this.fastSpriteBatch.render(this),t.spriteBatch.start())},e.SpriteBatch.prototype._renderCanvas=function(t){if(this.visible&&!(this.alpha<=0)&&this.children.length){var i=t.context;i.globalAlpha=this.worldAlpha,e.DisplayObject.prototype.updateTransform.call(this);for(var n=this.worldTransform,s=!0,r=0;r<this.children.length;r++){var o=this.children[r];if(o.visible){var a=o.texture,h=a.frame;if(i.globalAlpha=this.worldAlpha*o.alpha,o.rotation%(2*Math.PI)===0)s&&(i.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),s=!1),i.drawImage(a.baseTexture.source,h.x,h.y,h.width,h.height,o.anchor.x*(-h.width*o.scale.x)+o.position.x+.5|0,o.anchor.y*(-h.height*o.scale.y)+o.position.y+.5|0,h.width*o.scale.x,h.height*o.scale.y);else{s||(s=!0),e.DisplayObject.prototype.updateTransform.call(o);var l=o.worldTransform;t.roundPixels?i.setTransform(l.a,l.b,l.c,l.d,0|l.tx,0|l.ty):i.setTransform(l.a,l.b,l.c,l.d,l.tx,l.ty),i.drawImage(a.baseTexture.source,h.x,h.y,h.width,h.height,o.anchor.x*-h.width+.5|0,o.anchor.y*-h.height+.5|0,h.width,h.height)}}}}},e.FilterBlock=function(){this.visible=!0,this.renderable=!0},e.FilterBlock.prototype.constructor=e.FilterBlock,e.Text=function(t,i){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,e.Sprite.call(this,e.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(i)},e.Text.prototype=Object.create(e.Sprite.prototype),e.Text.prototype.constructor=e.Text,Object.defineProperty(e.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(e.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),e.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black",this.style=t,this.dirty=!0},e.Text.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,s=this.determineFontProperties(this.style.font),r=0;r<e.length;r++){var o=this.context.measureText(e[r]).width;i[r]=o,n=Math.max(n,o)}var a=n+this.style.strokeThickness;this.style.dropShadow&&(a+=this.style.dropShadowDistance),this.canvas.width=(a+this.context.lineWidth)*this.resolution;var h=s.fontSize+this.style.strokeThickness,l=h*e.length;this.style.dropShadow&&(l+=this.style.dropShadowDistance),this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin="round";var c,u;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var d=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,A=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(r=0;r<e.length;r++)c=this.style.strokeThickness/2,u=this.style.strokeThickness/2+r*h+s.ascent,"right"===this.style.align?c+=n-i[r]:"center"===this.style.align&&(c+=(n-i[r])/2),this.style.fill&&this.context.fillText(e[r],c+d,u+A)}for(this.context.fillStyle=this.style.fill,r=0;r<e.length;r++)c=this.style.strokeThickness/2,u=this.style.strokeThickness/2+r*h+s.ascent,"right"===this.style.align?c+=n-i[r]:"center"===this.style.align&&(c+=(n-i[r])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[r],c,u),this.style.fill&&this.context.fillText(e[r],c,u);this.updateTexture()},e.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},e.Text.prototype._renderWebGL=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderWebGL.call(this,t)},e.Text.prototype._renderCanvas=function(t){this.dirty&&(this.resolution=t.resolution,this.updateText(),this.dirty=!1),e.Sprite.prototype._renderCanvas.call(this,t)},e.Text.prototype.determineFontProperties=function(t){var i=e.Text.fontPropertiesCache[t];if(!i){i={};var n=e.Text.fontPropertiesCanvas,s=e.Text.fontPropertiesContext;s.font=t;var r=Math.ceil(s.measureText("|Mq").width),o=Math.ceil(s.measureText("M").width),a=2*o;o=1.4*o|0,n.width=r,n.height=a,s.fillStyle="#f00",s.fillRect(0,0,r,a),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText("|Mq",0,o);var h,l,c=s.getImageData(0,0,r,a).data,u=c.length,d=4*r,A=0,p=!1;for(h=0;o>h;h++){for(l=0;d>l;l+=4)if(255!==c[A+l]){p=!0;break}if(p)break;A+=d}for(i.ascent=o-h,A=u-d,p=!1,h=a;h>o;h--){for(l=0;d>l;l+=4)if(255!==c[A+l]){p=!0;break}if(p)break;A-=d}i.descent=h-o,i.fontSize=i.ascent+i.descent,e.Text.fontPropertiesCache[t]=i}return i},e.Text.prototype.wordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var s=this.style.wordWrapWidth,r=i[n].split(" "),o=0;o<r.length;o++){var a=this.context.measureText(r[o]).width,h=a+this.context.measureText(" ").width;0===o||h>s?(o>0&&(e+="\n"),e+=r[o],s=this.style.wordWrapWidth-a):(s-=h,e+=" "+r[o])}n<i.length-1&&(e+="\n")}return e},e.Text.prototype.destroy=function(t){this.context=null,this.canvas=null,this.texture.destroy(void 0===t?!0:t)},e.Text.fontPropertiesCache={},e.Text.fontPropertiesCanvas=document.createElement("canvas"),e.Text.fontPropertiesContext=e.Text.fontPropertiesCanvas.getContext("2d"),e.BitmapText=function(t,i){e.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(t),this.setStyle(i),this.updateText(),this.dirty=!1},e.BitmapText.prototype=Object.create(e.DisplayObjectContainer.prototype),e.BitmapText.prototype.constructor=e.BitmapText,e.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},e.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1],this.fontSize=i.length>=2?parseInt(i[i.length-2],10):e.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=t.tint},e.BitmapText.prototype.updateText=function(){for(var t=e.BitmapText.fonts[this.fontName],i=new e.Point,n=null,s=[],r=0,o=[],a=0,h=this.fontSize/t.size,l=0;l<this.text.length;l++){var c=this.text.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(l)))o.push(i.x),r=Math.max(r,i.x),a++,i.x=0,i.y+=t.lineHeight,n=null;else{var u=t.chars[c];u&&(n&&u.kerning[n]&&(i.x+=u.kerning[n]),s.push({texture:u.texture,line:a,charCode:c,position:new e.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,n=c)}}o.push(i.x),r=Math.max(r,i.x);var d=[];for(l=0;a>=l;l++){var A=0;"right"===this.style.align?A=r-o[l]:"center"===this.style.align&&(A=(r-o[l])/2),d.push(A)}var p=this.children.length,m=s.length,f=this.tint||16777215;for(l=0;m>l;l++){var g=p>l?this.children[l]:this._pool.pop();g?g.setTexture(s[l].texture):g=new e.Sprite(s[l].texture),g.position.x=(s[l].position.x+d[s[l].line])*h,g.position.y=s[l].position.y*h,g.scale.x=g.scale.y=h,g.tint=f,g.parent||this.addChild(g)}for(;this.children.length>m;){var _=this.getChildAt(this.children.length-1);this._pool.push(_),this.removeChild(_)}this.textWidth=r*h,this.textHeight=(i.y+t.lineHeight)*h},e.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),e.DisplayObjectContainer.prototype.updateTransform.call(this)},e.BitmapText.fonts={},e.Stage=function(t){e.DisplayObjectContainer.call(this),this.worldTransform=new e.Matrix,this.interactive=!0,this.interactionManager=new e.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new e.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t)},e.Stage.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Stage.prototype.constructor=e.Stage,e.Stage.prototype.setInteractionDelegate=function(t){this.interactionManager.setTargetDomElement(t)},e.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},e.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=e.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},e.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(t){for(var e=0,i=["ms","moz","webkit","o"],n=0;n<i.length&&!t.requestAnimationFrame;++n)t.requestAnimationFrame=t[i[n]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[n]+"CancelAnimationFrame"]||t[i[n]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i){var n=(new Date).getTime(),s=Math.max(0,16-(n-e)),r=t.setTimeout(function(){i(n+s)},s);return e=n+s,r}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)}),t.requestAnimFrame=t.requestAnimationFrame}(this),e.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]},e.rgb2hex=function(t){return(255*t[0]<<16)+(255*t[1]<<8)+255*t[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){return function(t){function e(){for(var n=arguments.length,r=new Array(n);n--;)r[n]=arguments[n];return r=s.concat(r),i.apply(this instanceof e?this:t,r)}var i=this,n=arguments.length-1,s=[];if(n>0)for(s.length=n;n--;)s[n]=arguments[n+1];if("function"!=typeof i)throw new TypeError;return e.prototype=function r(t){return t&&(r.prototype=t),this instanceof r?void 0:new r}(i.prototype),e}}()),e.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new window.ActiveXObject(t[e])}catch(i){}},e.canUseNewCanvasBlendModes=function(){if("undefined"==typeof document)return!1;var t=document.createElement("canvas");t.width=1,t.height=1;var e=t.getContext("2d");return e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply",e.fillStyle="#fff",e.fillRect(0,0,1,1),0===e.getImageData(0,0,1,1).data[0]},e.getNextPowerOfTwo=function(t){if(t>0&&0===(t&t-1))return t;for(var e=1;t>e;)e<<=1;return e},e.EventTarget={call:function(t){t&&(t=t.prototype||t,e.EventTarget.mixin(t))},mixin:function(t){t.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},t.emit=t.dispatchEvent=function(t,i){if(this._listeners=this._listeners||{},"object"==typeof t&&(i=t,t=t.type),i&&i.__isEventObject===!0||(i=new e.Event(this,t,i)),this._listeners&&this._listeners[t]){var n,s=this._listeners[t],r=s.length,o=s[0];for(n=0;r>n;o=s[++n])if(o.call(this,i),i.stoppedImmediate)return this;if(i.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,t,i),this},t.on=t.addEventListener=function(t,e){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(e),this},t.once=function(t,e){function i(){e.apply(n.off(t,i),arguments)}this._listeners=this._listeners||{};var n=this;return i._originalHandler=e,this.on(t,i)},t.off=t.removeEventListener=function(t,e){if(this._listeners=this._listeners||{},!this._listeners[t])return this;for(var i=this._listeners[t],n=e?i.length:0;n-- >0;)(i[n]===e||i[n]._originalHandler===e)&&i.splice(n,1);return 0===i.length&&delete this._listeners[t],this},t.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},e.Event=function(t,e,i){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=t,this.type=e,this.data=i,this.content=i,this.timeStamp=Date.now()},e.Event.prototype.stopPropagation=function(){this.stopped=!0},e.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},e.PolyK={},e.PolyK.Triangulate=function(t){var i=!0,n=t.length>>1;if(3>n)return[];for(var s=[],r=[],o=0;n>o;o++)r.push(o);o=0;for(var a=n;a>3;){var h=r[(o+0)%a],l=r[(o+1)%a],c=r[(o+2)%a],u=t[2*h],d=t[2*h+1],A=t[2*l],p=t[2*l+1],m=t[2*c],f=t[2*c+1],g=!1;if(e.PolyK._convex(u,d,A,p,m,f,i)){g=!0;for(var _=0;a>_;_++){var y=r[_];if(y!==h&&y!==l&&y!==c&&e.PolyK._PointInTriangle(t[2*y],t[2*y+1],u,d,A,p,m,f)){g=!1;break}}}if(g)s.push(h,l,c),r.splice((o+1)%a,1),a--,o=0;else if(o++>3*a){if(!i)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(s=[],r=[],o=0;n>o;o++)r.push(o);o=0,a=n,i=!1}}return s.push(r[0],r[1],r[2]),s},e.PolyK._PointInTriangle=function(t,e,i,n,s,r,o,a){var h=o-i,l=a-n,c=s-i,u=r-n,d=t-i,A=e-n,p=h*h+l*l,m=h*c+l*u,f=h*d+l*A,g=c*c+u*u,_=c*d+u*A,y=1/(p*g-m*m),v=(g*f-m*_)*y,T=(p*_-m*f)*y;return v>=0&&T>=0&&1>v+T},e.PolyK._convex=function(t,e,i,n,s,r,o){return(e-n)*(s-i)+(i-t)*(r-n)>=0===o},e.initDefaultShaders=function(){},e.CompileVertexShader=function(t,i){return e._CompileShader(t,i,t.VERTEX_SHADER)},e.CompileFragmentShader=function(t,i){return e._CompileShader(t,i,t.FRAGMENT_SHADER)},e._CompileShader=function(t,e,i){var n=e.join("\n"),s=t.createShader(i);return t.shaderSource(s,n),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(window.console.log(t.getShaderInfoLog(s)),null)},e.compileProgram=function(t,i,n){var s=e.CompileFragmentShader(t,n),r=e.CompileVertexShader(t,i),o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,s),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},e.PixiShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},e.PixiShader.prototype.constructor=e.PixiShader,e.PixiShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc||e.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var n in this.uniforms)this.uniforms[n].uniformLocation=t.getUniformLocation(i,n);this.initUniforms(),this.program=i},e.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t,e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];var n=t.type;"sampler2D"===n?(t._init=!1,null!==t.value&&this.initSampler2D(t)):"mat2"===n||"mat3"===n||"mat4"===n?(t.glMatrix=!0,t.glValueLength=1,"mat2"===n?t.glFunc=e.uniformMatrix2fv:"mat3"===n?t.glFunc=e.uniformMatrix3fv:"mat4"===n&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+n],"2f"===n||"2i"===n?t.glValueLength=2:"3f"===n||"3i"===n?t.glValueLength=3:"4f"===n||"4i"===n?t.glValueLength=4:t.glValueLength=1)}},e.PixiShader.prototype.initSampler2D=function(t){if(t.value&&t.value.baseTexture&&t.value.baseTexture.hasLoaded){var e=this.gl;if(e.activeTexture(e["TEXTURE"+this.textureCount]),e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]),t.textureData){var i=t.textureData,n=i.magFilter?i.magFilter:e.LINEAR,s=i.minFilter?i.minFilter:e.LINEAR,r=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE,o=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE,a=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat&&(r=e.REPEAT,o=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var h=i.width?i.width:512,l=i.height?i.height:2,c=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,a,h,l,c,a,e.UNSIGNED_BYTE,null)}else e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o)}e.uniform1i(t.uniformLocation,this.textureCount),t._init=!0,this.textureCount++}},e.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t,i=this.gl;for(var n in this.uniforms)t=this.uniforms[n],1===t.glValueLength?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):2===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):3===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):4===t.glValueLength?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):"sampler2D"===t.type&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),t.value.baseTexture._dirty[i.id]?e.defaultRenderer.updateTexture(t.value.baseTexture):i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))},e.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],e.PixiFastShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},e.PixiFastShader.prototype.constructor=e.PixiFastShader,e.PixiFastShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.dimensions=t.getUniformLocation(i,"dimensions"),this.uMatrix=t.getUniformLocation(i,"uMatrix"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord"),this.aScale=t.getAttribLocation(i,"aScale"),this.aRotation=t.getAttribLocation(i,"aRotation"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(i,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=i},e.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.StripShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},e.StripShader.prototype.constructor=e.StripShader,e.StripShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);
t.useProgram(i),this.uSampler=t.getUniformLocation(i,"uSampler"),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.PrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},e.PrimitiveShader.prototype.constructor=e.PrimitiveShader,e.PrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.colorAttribute=t.getAttribLocation(i,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},e.ComplexPrimitiveShader=function(t){this._UID=e._UID++,this.gl=t,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},e.ComplexPrimitiveShader.prototype.constructor=e.ComplexPrimitiveShader,e.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=e.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i),this.projectionVector=t.getUniformLocation(i,"projectionVector"),this.offsetVector=t.getUniformLocation(i,"offsetVector"),this.tintColor=t.getUniformLocation(i,"tint"),this.color=t.getUniformLocation(i,"color"),this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=t.getUniformLocation(i,"translationMatrix"),this.alpha=t.getUniformLocation(i,"alpha"),this.program=i},e.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},e.WebGLGraphics=function(){},e.WebGLGraphics.renderGraphics=function(t,i){var n,s=i.gl,r=i.projection,o=i.offset,a=i.shaderManager.primitiveShader;t.dirty&&e.WebGLGraphics.updateGraphics(t,s);for(var h=t._webGL[s.id],l=0;l<h.data.length;l++)1===h.data[l].mode?(n=h.data[l],i.stencilManager.pushStencil(t,n,i),s.drawElements(s.TRIANGLE_FAN,4,s.UNSIGNED_SHORT,2*(n.indices.length-4)),i.stencilManager.popStencil(t,n,i)):(n=h.data[l],i.shaderManager.setShader(a),a=i.shaderManager.primitiveShader,s.uniformMatrix3fv(a.translationMatrix,!1,t.worldTransform.toArray(!0)),s.uniform2f(a.projectionVector,r.x,-r.y),s.uniform2f(a.offsetVector,-o.x,-o.y),s.uniform3fv(a.tintColor,e.hex2rgb(t.tint)),s.uniform1f(a.alpha,t.worldAlpha),s.bindBuffer(s.ARRAY_BUFFER,n.buffer),s.vertexAttribPointer(a.aVertexPosition,2,s.FLOAT,!1,24,0),s.vertexAttribPointer(a.colorAttribute,4,s.FLOAT,!1,24,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n.indexBuffer),s.drawElements(s.TRIANGLE_STRIP,n.indices.length,s.UNSIGNED_SHORT,0))},e.WebGLGraphics.updateGraphics=function(t,i){var n=t._webGL[i.id];n||(n=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1;var s;if(t.clearDirty){for(t.clearDirty=!1,s=0;s<n.data.length;s++){var r=n.data[s];r.reset(),e.WebGLGraphics.graphicsDataPool.push(r)}n.data=[],n.lastIndex=0}var o;for(s=n.lastIndex;s<t.graphicsData.length;s++){var a=t.graphicsData[s];a.type===e.Graphics.POLY?(a.points=a.shape.points.slice(),a.shape.closed&&a.points[0]!==a.points[a.points.length-2]&&a.points[1]!==a.points[a.points.length-1]&&a.points.push(a.points[0],a.points[1]),a.fill&&a.points.length>=6&&(a.points.length>10?(o=e.WebGLGraphics.switchMode(n,1),e.WebGLGraphics.buildComplexPoly(a,o)):(o=e.WebGLGraphics.switchMode(n,0),e.WebGLGraphics.buildPoly(a,o))),a.lineWidth>0&&(o=e.WebGLGraphics.switchMode(n,0),e.WebGLGraphics.buildLine(a,o))):(o=e.WebGLGraphics.switchMode(n,0),a.type===e.Graphics.RECT?e.WebGLGraphics.buildRectangle(a,o):a.type===e.Graphics.CIRC||a.type===e.Graphics.ELIP?e.WebGLGraphics.buildCircle(a,o):a.type===e.Graphics.RREC&&e.WebGLGraphics.buildRoundedRectangle(a,o)),n.lastIndex++}for(s=0;s<n.data.length;s++)o=n.data[s],o.dirty&&o.upload()},e.WebGLGraphics.switchMode=function(t,i){var n;return t.data.length?(n=t.data[t.data.length-1],(n.mode!==i||1===i)&&(n=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),n.mode=i,t.data.push(n))):(n=e.WebGLGraphics.graphicsDataPool.pop()||new e.WebGLGraphicsData(t.gl),n.mode=i,t.data.push(n)),n.dirty=!0,n},e.WebGLGraphics.buildRectangle=function(t,i){var n=t.shape,s=n.x,r=n.y,o=n.width,a=n.height;if(t.fill){var h=e.hex2rgb(t.fillColor),l=t.fillAlpha,c=h[0]*l,u=h[1]*l,d=h[2]*l,A=i.points,p=i.indices,m=A.length/6;A.push(s,r),A.push(c,u,d,l),A.push(s+o,r),A.push(c,u,d,l),A.push(s,r+a),A.push(c,u,d,l),A.push(s+o,r+a),A.push(c,u,d,l),p.push(m,m,m+1,m+2,m+3,m+3)}if(t.lineWidth){var f=t.points;t.points=[s,r,s+o,r,s+o,r+a,s,r+a,s,r],e.WebGLGraphics.buildLine(t,i),t.points=f}},e.WebGLGraphics.buildRoundedRectangle=function(t,i){var n=t.shape.points,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],l=[];if(l.push(s,r+h),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s,r+a-h,s,r+a,s+h,r+a)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+o-h,r+a,s+o,r+a,s+o,r+a-h)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+o,r+h,s+o,r,s+o-h,r)),l=l.concat(e.WebGLGraphics.quadraticBezierCurve(s+h,r,s,r,s,r+h)),t.fill){var c=e.hex2rgb(t.fillColor),u=t.fillAlpha,d=c[0]*u,A=c[1]*u,p=c[2]*u,m=i.points,f=i.indices,g=m.length/6,_=e.PolyK.Triangulate(l),y=0;for(y=0;y<_.length;y+=3)f.push(_[y]+g),f.push(_[y]+g),f.push(_[y+1]+g),f.push(_[y+2]+g),f.push(_[y+2]+g);for(y=0;y<l.length;y++)m.push(l[y],l[++y],d,A,p,u)}if(t.lineWidth){var v=t.points;t.points=l,e.WebGLGraphics.buildLine(t,i),t.points=v}},e.WebGLGraphics.quadraticBezierCurve=function(t,e,i,n,s,r){function o(t,e,i){var n=e-t;return t+n*i}for(var a,h,l,c,u,d,A=20,p=[],m=0,f=0;A>=f;f++)m=f/A,a=o(t,i,m),h=o(e,n,m),l=o(i,s,m),c=o(n,r,m),u=o(a,l,m),d=o(h,c,m),p.push(u,d);return p},e.WebGLGraphics.buildCircle=function(t,i){var n,s,r=t.shape,o=r.x,a=r.y;t.type===e.Graphics.CIRC?(n=r.radius,s=r.radius):(n=r.width,s=r.height);var h=40,l=2*Math.PI/h,c=0;if(t.fill){var u=e.hex2rgb(t.fillColor),d=t.fillAlpha,A=u[0]*d,p=u[1]*d,m=u[2]*d,f=i.points,g=i.indices,_=f.length/6;for(g.push(_),c=0;h+1>c;c++)f.push(o,a,A,p,m,d),f.push(o+Math.sin(l*c)*n,a+Math.cos(l*c)*s,A,p,m,d),g.push(_++,_++);g.push(_-1)}if(t.lineWidth){var y=t.points;for(t.points=[],c=0;h+1>c;c++)t.points.push(o+Math.sin(l*c)*n,a+Math.cos(l*c)*s);e.WebGLGraphics.buildLine(t,i),t.points=y}},e.WebGLGraphics.buildLine=function(t,i){var n=0,s=t.points;if(0!==s.length){if(t.lineWidth%2)for(n=0;n<s.length;n++)s[n]+=.5;var r=new e.Point(s[0],s[1]),o=new e.Point(s[s.length-2],s[s.length-1]);if(r.x===o.x&&r.y===o.y){s=s.slice(),s.pop(),s.pop(),o=new e.Point(s[s.length-2],s[s.length-1]);var a=o.x+.5*(r.x-o.x),h=o.y+.5*(r.y-o.y);s.unshift(a,h),s.push(a,h)}var l,c,u,d,A,p,m,f,g,_,y,v,T,b,w,x,C,S,P,I,M,k,B,D=i.points,E=i.indices,O=s.length/2,L=s.length,F=D.length/6,R=t.lineWidth/2,G=e.hex2rgb(t.lineColor),N=t.lineAlpha,U=G[0]*N,X=G[1]*N,H=G[2]*N;for(u=s[0],d=s[1],A=s[2],p=s[3],g=-(d-p),_=u-A,B=Math.sqrt(g*g+_*_),g/=B,_/=B,g*=R,_*=R,D.push(u-g,d-_,U,X,H,N),D.push(u+g,d+_,U,X,H,N),n=1;O-1>n;n++)u=s[2*(n-1)],d=s[2*(n-1)+1],A=s[2*n],p=s[2*n+1],m=s[2*(n+1)],f=s[2*(n+1)+1],g=-(d-p),_=u-A,B=Math.sqrt(g*g+_*_),g/=B,_/=B,g*=R,_*=R,y=-(p-f),v=A-m,B=Math.sqrt(y*y+v*v),y/=B,v/=B,y*=R,v*=R,w=-_+d-(-_+p),x=-g+A-(-g+u),C=(-g+u)*(-_+p)-(-g+A)*(-_+d),S=-v+f-(-v+p),P=-y+A-(-y+m),I=(-y+m)*(-v+p)-(-y+A)*(-v+f),M=w*P-S*x,Math.abs(M)<.1?(M+=10.1,D.push(A-g,p-_,U,X,H,N),D.push(A+g,p+_,U,X,H,N)):(l=(x*I-P*C)/M,c=(S*C-w*I)/M,k=(l-A)*(l-A)+(c-p)+(c-p),k>19600?(T=g-y,b=_-v,B=Math.sqrt(T*T+b*b),T/=B,b/=B,T*=R,b*=R,D.push(A-T,p-b),D.push(U,X,H,N),D.push(A+T,p+b),D.push(U,X,H,N),D.push(A-T,p-b),D.push(U,X,H,N),L++):(D.push(l,c),D.push(U,X,H,N),D.push(A-(l-A),p-(c-p)),D.push(U,X,H,N)));for(u=s[2*(O-2)],d=s[2*(O-2)+1],A=s[2*(O-1)],p=s[2*(O-1)+1],g=-(d-p),_=u-A,B=Math.sqrt(g*g+_*_),g/=B,_/=B,g*=R,_*=R,D.push(A-g,p-_),D.push(U,X,H,N),D.push(A+g,p+_),D.push(U,X,H,N),E.push(F),n=0;L>n;n++)E.push(F++);E.push(F-1)}},e.WebGLGraphics.buildComplexPoly=function(t,i){var n=t.points.slice();if(!(n.length<6)){var s=i.indices;i.points=n,i.alpha=t.fillAlpha,i.color=e.hex2rgb(t.fillColor);for(var r,o,a=1/0,h=-(1/0),l=1/0,c=-(1/0),u=0;u<n.length;u+=2)r=n[u],o=n[u+1],a=a>r?r:a,h=r>h?r:h,l=l>o?o:l,c=o>c?o:c;n.push(a,l,h,l,h,c,a,c);var d=n.length/2;for(u=0;d>u;u++)s.push(u)}},e.WebGLGraphics.buildPoly=function(t,i){var n=t.points;if(!(n.length<6)){var s=i.points,r=i.indices,o=n.length/2,a=e.hex2rgb(t.fillColor),h=t.fillAlpha,l=a[0]*h,c=a[1]*h,u=a[2]*h,d=e.PolyK.Triangulate(n),A=s.length/6,p=0;for(p=0;p<d.length;p+=3)r.push(d[p]+A),r.push(d[p]+A),r.push(d[p+1]+A),r.push(d[p+2]+A),r.push(d[p+2]+A);for(p=0;o>p;p++)s.push(n[2*p],n[2*p+1],l,c,u,h)}},e.WebGLGraphics.graphicsDataPool=[],e.WebGLGraphicsData=function(t){this.gl=t,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},e.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},e.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new Float32Array(this.points),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW),this.dirty=!1},e.glContexts=[],e.WebGLRenderer=function(t,i,n){if(n)for(var s in e.defaultRenderOptions)"undefined"==typeof n[s]&&(n[s]=e.defaultRenderOptions[s]);else n=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("webGL"),e.defaultRenderer=this),this.type=e.WEBGL_RENDERER,this.resolution=n.resolution,this.transparent=n.transparent,this.preserveDrawingBuffer=n.preserveDrawingBuffer,this.clearBeforeRender=n.clearBeforeRender,this.width=t||800,this.height=i||600,this.view=n.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.projection=new e.Point,this.offset=new e.Point(0,0),this.shaderManager=new e.WebGLShaderManager,this.spriteBatch=new e.WebGLSpriteBatch,this.maskManager=new e.WebGLMaskManager,this.filterManager=new e.WebGLFilterManager,this.stencilManager=new e.WebGLStencilManager,this.blendModeManager=new e.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},e.WebGLRenderer.prototype.constructor=e.WebGLRenderer,e.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=t,!t)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=t.id=e.WebGLRenderer.glContextId++,e.glContexts[this.glContextId]=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),this.shaderManager.setContext(t),this.spriteBatch.setContext(t),this.maskManager.setContext(t),this.filterManager.setContext(t),this.blendModeManager.setContext(t),this.stencilManager.setContext(t),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},e.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t),t.updateTransform();var e=this.gl;t._interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this)),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}},e.WebGLRenderer.prototype.renderDisplayObject=function(t,i,n){this.renderSession.blendModeManager.setBlendMode(e.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.projection=i,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,n),t._renderWebGL(this.renderSession),this.spriteBatch.end()},e.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},e.WebGLRenderer.prototype.updateTexture=function(t){if(t.hasLoaded){var i=this.gl;return t._glTextures[i.id]||(t._glTextures[i.id]=i.createTexture()),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===e.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1,t._glTextures[i.id]}},e.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},e.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var t in e.TextureCache){var i=e.TextureCache[t].baseTexture;i._glTextures=[]}this.contextLost=!1},e.WebGLRenderer.prototype.destroy=function(){this.view.off("webglcontextlost",this.contextLostBound),this.view.off("webglcontextrestored",this.contextRestoredBound),e.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},e.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;e.blendModesWebGL||(e.blendModesWebGL=[],e.blendModesWebGL[e.blendModes.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.ADD]=[t.SRC_ALPHA,t.DST_ALPHA],e.blendModesWebGL[e.blendModes.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SCREEN]=[t.SRC_ALPHA,t.ONE],e.blendModesWebGL[e.blendModes.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.blendModesWebGL[e.blendModes.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA])},e.WebGLRenderer.glContextId=0,e.WebGLBlendModeManager=function(){this.currentBlendMode=99999},e.WebGLBlendModeManager.prototype.constructor=e.WebGLBlendModeManager,e.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t},e.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=e.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0},e.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},e.WebGLMaskManager=function(){},e.WebGLMaskManager.prototype.constructor=e.WebGLMaskManager,e.WebGLMaskManager.prototype.setContext=function(t){this.gl=t},e.WebGLMaskManager.prototype.pushMask=function(t,i){var n=i.gl;t.dirty&&e.WebGLGraphics.updateGraphics(t,n),t._webGL[n.id].data.length&&i.stencilManager.pushStencil(t,t._webGL[n.id].data[0],i)},e.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)},e.WebGLMaskManager.prototype.destroy=function(){this.gl=null},e.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},e.WebGLStencilManager.prototype.setContext=function(t){this.gl=t},e.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var n=this.gl;this.bindGraphics(t,e,i),0===this.stencilStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(e);var s=this.count;n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),1===e.mode?(n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?(n.stencilFunc(n.EQUAL,255-s,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,s,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),this.reverse?n.stencilFunc(n.EQUAL,255-(s+1),255):n.stencilFunc(n.EQUAL,s+1,255),this.reverse=!this.reverse):(this.reverse?(n.stencilFunc(n.EQUAL,s,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,255-s,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,s+1,255):n.stencilFunc(n.EQUAL,255-(s+1),255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),this.count++},e.WebGLStencilManager.prototype.bindGraphics=function(t,i,n){this._currentGraphics=t;var s,r=this.gl,o=n.projection,a=n.offset;1===i.mode?(s=n.shaderManager.complexPrimitiveShader,n.shaderManager.setShader(s),r.uniformMatrix3fv(s.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(s.projectionVector,o.x,-o.y),r.uniform2f(s.offsetVector,-a.x,-a.y),r.uniform3fv(s.tintColor,e.hex2rgb(t.tint)),r.uniform3fv(s.color,i.color),r.uniform1f(s.alpha,t.worldAlpha*i.alpha),r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,8,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(s=n.shaderManager.primitiveShader,n.shaderManager.setShader(s),r.uniformMatrix3fv(s.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(s.projectionVector,o.x,-o.y),r.uniform2f(s.offsetVector,-a.x,-a.y),r.uniform3fv(s.tintColor,e.hex2rgb(t.tint)),r.uniform1f(s.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,i.buffer),r.vertexAttribPointer(s.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(s.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.indexBuffer))},e.WebGLStencilManager.prototype.popStencil=function(t,e,i){var n=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)n.disable(n.STENCIL_TEST);else{var s=this.count;this.bindGraphics(t,e,i),n.colorMask(!1,!1,!1,!1),1===e.mode?(this.reverse=!this.reverse,this.reverse?(n.stencilFunc(n.EQUAL,255-(s+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,s+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),n.drawElements(n.TRIANGLE_FAN,4,n.UNSIGNED_SHORT,2*(e.indices.length-4)),n.stencilFunc(n.ALWAYS,0,255),n.stencilOp(n.KEEP,n.KEEP,n.INVERT),n.drawElements(n.TRIANGLE_FAN,e.indices.length-4,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,s,255):n.stencilFunc(n.EQUAL,255-s,255)):(this.reverse?(n.stencilFunc(n.EQUAL,s+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)):(n.stencilFunc(n.EQUAL,255-(s+1),255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)),n.drawElements(n.TRIANGLE_STRIP,e.indices.length,n.UNSIGNED_SHORT,0),this.reverse?n.stencilFunc(n.EQUAL,s,255):n.stencilFunc(n.EQUAL,255-s,255)),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},e.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},e.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.stack=[]},e.WebGLShaderManager.prototype.constructor=e.WebGLShaderManager,e.WebGLShaderManager.prototype.setContext=function(t){this.gl=t,this.primitiveShader=new e.PrimitiveShader(t),this.complexPrimitiveShader=new e.ComplexPrimitiveShader(t),this.defaultShader=new e.PixiShader(t),this.fastShader=new e.PixiFastShader(t),this.stripShader=new e.StripShader(t),this.setShader(this.defaultShader)},e.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++)this.tempAttribState[e]=!1;for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=!0}var n=this.gl;for(e=0;e<this.attribState.length;e++)this.attribState[e]!==this.tempAttribState[e]&&(this.attribState[e]=this.tempAttribState[e],this.tempAttribState[e]?n.enableVertexAttribArray(e):n.disableVertexAttribArray(e))},e.WebGLShaderManager.prototype.setShader=function(t){return this._currentId===t._UID?!1:(this._currentId=t._UID,this.currentShader=t,this.gl.useProgram(t.program),this.setAttribs(t.attributes),!0)},e.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},e.WebGLSpriteBatch=function(){this.vertSize=6,this.size=2e3;var t=4*this.size*this.vertSize,i=6*this.size;this.vertices=new Float32Array(t),this.indices=new Uint16Array(i),this.lastIndexCount=0;for(var n=0,s=0;i>n;n+=6,s+=4)this.indices[n+0]=s+0,this.indices[n+1]=s+1,this.indices[n+2]=s+2,this.indices[n+3]=s+0,this.indices[n+4]=s+2,this.indices[n+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new e.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},e.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW),this.currentBlendMode=99999;var i=new e.PixiShader(t);i.fragmentSrc=this.defaultShader.fragmentSrc,i.uniforms={},i.init(),this.defaultShader.shaders[t.id]=i},e.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},e.WebGLSpriteBatch.prototype.end=function(){this.flush()},e.WebGLSpriteBatch.prototype.render=function(t){var e=t.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=e.baseTexture);var i=e._uvs;if(i){var n,s,r,o,a=t.worldAlpha,h=t.tint,l=this.vertices,c=t.anchor.x,u=t.anchor.y;if(e.trim){var d=e.trim;s=d.x-c*d.width,n=s+e.crop.width,o=d.y-u*d.height,r=o+e.crop.height}else n=e.frame.width*(1-c),s=e.frame.width*-c,r=e.frame.height*(1-u),o=e.frame.height*-u;var A=4*this.currentBatchSize*this.vertSize,p=e.baseTexture.resolution,m=t.worldTransform,f=m.a/p,g=m.b/p,_=m.c/p,y=m.d/p,v=m.tx,T=m.ty;l[A++]=f*s+_*o+v,l[A++]=y*o+g*s+T,l[A++]=i.x0,l[A++]=i.y0,l[A++]=a,l[A++]=h,l[A++]=f*n+_*o+v,l[A++]=y*o+g*n+T,l[A++]=i.x1,l[A++]=i.y1,l[A++]=a,l[A++]=h,l[A++]=f*n+_*r+v,l[A++]=y*r+g*n+T,l[A++]=i.x2,l[A++]=i.y2,l[A++]=a,l[A++]=h,l[A++]=f*s+_*r+v,l[A++]=y*r+g*s+T,l[A++]=i.x3,l[A++]=i.y3,l[A++]=a,l[A++]=h,this.sprites[this.currentBatchSize++]=t}},e.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var i=t.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=i.baseTexture),t._uvs||(t._uvs=new e.TextureUvs);var n=t._uvs;t.tilePosition.x%=i.baseTexture.width*t.tileScaleOffset.x,t.tilePosition.y%=i.baseTexture.height*t.tileScaleOffset.y;var s=t.tilePosition.x/(i.baseTexture.width*t.tileScaleOffset.x),r=t.tilePosition.y/(i.baseTexture.height*t.tileScaleOffset.y),o=t.width/i.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),a=t.height/i.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);n.x0=0-s,n.y0=0-r,n.x1=1*o-s,n.y1=0-r,n.x2=1*o-s,n.y2=1*a-r,n.x3=0-s,n.y3=1*a-r;var h=t.worldAlpha,l=t.tint,c=this.vertices,u=t.width,d=t.height,A=t.anchor.x,p=t.anchor.y,m=u*(1-A),f=u*-A,g=d*(1-p),_=d*-p,y=4*this.currentBatchSize*this.vertSize,v=i.baseTexture.resolution,T=t.worldTransform,b=T.a/v,w=T.b/v,x=T.c/v,C=T.d/v,S=T.tx,P=T.ty;c[y++]=b*f+x*_+S,c[y++]=C*_+w*f+P,c[y++]=n.x0,c[y++]=n.y0,c[y++]=h,c[y++]=l,c[y++]=b*m+x*_+S,c[y++]=C*_+w*m+P,c[y++]=n.x1,c[y++]=n.y1,c[y++]=h,c[y++]=l,c[y++]=b*m+x*g+S,c[y++]=C*g+w*m+P,c[y++]=n.x2,c[y++]=n.y2,c[y++]=h,c[y++]=l,c[y++]=b*f+x*g+S,c[y++]=C*g+w*f+P,c[y++]=n.x3,c[y++]=n.y3,c[y++]=h,c[y++]=l,this.sprites[this.currentBatchSize++]=t},e.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t,i=this.gl;if(this.dirty){this.dirty=!1,i.activeTexture(i.TEXTURE0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t=this.defaultShader.shaders[i.id];var n=4*this.vertSize;i.vertexAttribPointer(t.aVertexPosition,2,i.FLOAT,!1,n,0),i.vertexAttribPointer(t.aTextureCoord,2,i.FLOAT,!1,n,8),i.vertexAttribPointer(t.colorAttribute,2,i.FLOAT,!1,n,16)}if(this.currentBatchSize>.5*this.size)i.bufferSubData(i.ARRAY_BUFFER,0,this.vertices);else{var s=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);i.bufferSubData(i.ARRAY_BUFFER,0,s)}for(var r,o,a,h,l=0,c=0,u=null,d=this.renderSession.blendModeManager.currentBlendMode,A=null,p=!1,m=!1,f=0,g=this.currentBatchSize;g>f;f++){if(h=this.sprites[f],r=h.texture.baseTexture,o=h.blendMode,a=h.shader||this.defaultShader,p=d!==o,m=A!==a,(u!==r||p||m)&&(this.renderBatch(u,l,c),c=f,l=0,u=r,p&&(d=o,this.renderSession.blendModeManager.setBlendMode(d)),m)){A=a,t=A.shaders[i.id],t||(t=new e.PixiShader(i),t.fragmentSrc=A.fragmentSrc,t.uniforms=A.uniforms,t.init(),A.shaders[i.id]=t),this.renderSession.shaderManager.setShader(t),t.dirty&&t.syncUniforms();var _=this.renderSession.projection;i.uniform2f(t.projectionVector,_.x,_.y);var y=this.renderSession.offset;i.uniform2f(t.offsetVector,y.x,y.y)}l++}this.renderBatch(u,l,c),this.currentBatchSize=0}},e.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var n=this.gl;t._dirty[n.id]?this.renderSession.renderer.updateTexture(t):n.bindTexture(n.TEXTURE_2D,t._glTextures[n.id]),n.drawElements(n.TRIANGLES,6*e,n.UNSIGNED_SHORT,6*i*2),this.renderSession.drawCount++}},e.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},e.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},e.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},e.WebGLFastSpriteBatch=function(t){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var e=4*this.size*this.vertSize,i=6*this.maxSize;this.vertices=new Float32Array(e),this.indices=new Uint16Array(i),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var n=0,s=0;i>n;n+=6,s+=4)this.indices[n+0]=s+0,this.indices[n+1]=s+1,this.indices[n+2]=s+2,this.indices[n+3]=s+0,this.indices[n+4]=s+2,this.indices[n+5]=s+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(t)},e.WebGLFastSpriteBatch.prototype.constructor=e.WebGLFastSpriteBatch,e.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)},e.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=t.worldTransform.toArray(!0),this.start()},e.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children,i=e[0];if(i.texture._uvs){this.currentBaseTexture=i.texture.baseTexture,i.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(i.blendMode));for(var n=0,s=e.length;s>n;n++)this.renderSprite(e[n]);this.flush()}},e.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(t.visible&&(t.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=t.texture.baseTexture,t.texture._uvs))){var e,i,n,s,r,o,a,h,l=this.vertices;if(e=t.texture._uvs,i=t.texture.frame.width,n=t.texture.frame.height,t.texture.trim){var c=t.texture.trim;r=c.x-t.anchor.x*c.width,s=r+t.texture.crop.width,a=c.y-t.anchor.y*c.height,o=a+t.texture.crop.height;
}else s=t.texture.frame.width*(1-t.anchor.x),r=t.texture.frame.width*-t.anchor.x,o=t.texture.frame.height*(1-t.anchor.y),a=t.texture.frame.height*-t.anchor.y;h=4*this.currentBatchSize*this.vertSize,l[h++]=r,l[h++]=a,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x0,l[h++]=e.y1,l[h++]=t.alpha,l[h++]=s,l[h++]=a,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x1,l[h++]=e.y1,l[h++]=t.alpha,l[h++]=s,l[h++]=o,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x2,l[h++]=e.y2,l[h++]=t.alpha,l[h++]=r,l[h++]=o,l[h++]=t.position.x,l[h++]=t.position.y,l[h++]=t.scale.x,l[h++]=t.scale.y,l[h++]=t.rotation,l[h++]=e.x3,l[h++]=e.y3,l[h++]=t.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},e.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,6*this.currentBatchSize,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},e.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},e.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y),t.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var i=4*this.vertSize;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,!1,i,0),t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,!1,i,8),t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,!1,i,16),t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,!1,i,24),t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,!1,i,28),t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,!1,i,36)},e.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},e.WebGLFilterManager.prototype.constructor=e.WebGLFilterManager,e.WebGLFilterManager.prototype.setContext=function(t){this.gl=t,this.texturePool=[],this.initShaderBuffers()},e.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t,this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=2*i.x,this.height=2*-i.y,this.buffer=e},e.WebGLFilterManager.prototype.pushFilter=function(t){var i=this.gl,n=this.renderSession.projection,s=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds(),this.filterStack.push(t);var r=t.filterPasses[0];this.offsetX+=t._filterArea.x,this.offsetY+=t._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new e.FilterTexture(this.gl,this.width,this.height),i.bindTexture(i.TEXTURE_2D,o.texture);var a=t._filterArea,h=r.padding;a.x-=h,a.y-=h,a.width+=2*h,a.height+=2*h,a.x<0&&(a.x=0),a.width>this.width&&(a.width=this.width),a.y<0&&(a.y=0),a.height>this.height&&(a.height=this.height),i.bindFramebuffer(i.FRAMEBUFFER,o.frameBuffer),i.viewport(0,0,a.width,a.height),n.x=a.width/2,n.y=-a.height/2,s.x=-a.x,s.y=-a.y,i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),t._glFilterTexture=o},e.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,i=this.filterStack.pop(),n=i._filterArea,s=i._glFilterTexture,r=this.renderSession.projection,o=this.renderSession.offset;if(i.filterPasses.length>1){t.viewport(0,0,n.width,n.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=n.height,this.vertexArray[2]=n.width,this.vertexArray[3]=n.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=n.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=s,h=this.texturePool.pop();h||(h=new e.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var l=0;l<i.filterPasses.length-1;l++){var c=i.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(c,n,n.width,n.height);var u=a;a=h,h=u}t.enable(t.BLEND),s=a,this.texturePool.push(h)}var d=i.filterPasses[i.filterPasses.length-1];this.offsetX-=n.x,this.offsetY-=n.y;var A=this.width,p=this.height,m=0,f=0,g=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var _=this.filterStack[this.filterStack.length-1];n=_._filterArea,A=n.width,p=n.height,m=n.x,f=n.y,g=_._glFilterTexture.frameBuffer}r.x=A/2,r.y=-p/2,o.x=m,o.y=f,n=i._filterArea;var y=n.x-m,v=n.y-f;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=y,this.vertexArray[1]=v+n.height,this.vertexArray[2]=y+n.width,this.vertexArray[3]=v+n.height,this.vertexArray[4]=y,this.vertexArray[5]=v,this.vertexArray[6]=y+n.width,this.vertexArray[7]=v,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=n.width/this.width,this.uvArray[5]=n.height/this.height,this.uvArray[6]=n.width/this.width,this.uvArray[7]=n.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,A,p),t.bindFramebuffer(t.FRAMEBUFFER,g),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,s.texture),this.applyFilterPass(d,n,A,p),this.texturePool.push(s),i._glFilterTexture=null},e.WebGLFilterManager.prototype.applyFilterPass=function(t,i,n,s){var r=this.gl,o=t.shaders[r.id];o||(o=new e.PixiShader(r),o.fragmentSrc=t.fragmentSrc,o.uniforms=t.uniforms,o.init(),t.shaders[r.id]=o),this.renderSession.shaderManager.setShader(o),r.uniform2f(o.projectionVector,n/2,-s/2),r.uniform2f(o.offsetVector,0,0),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.vertexAttribPointer(o.aTextureCoord,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.vertexAttribPointer(o.colorAttribute,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0),this.renderSession.drawCount++},e.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},e.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var e=0;e<this.texturePool.length;e++)this.texturePool[e].destroy();this.texturePool=null,t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.uvBuffer),t.deleteBuffer(this.colorBuffer),t.deleteBuffer(this.indexBuffer)},e.FilterTexture=function(t,i,n,s){this.gl=t,this.frameBuffer=t.createFramebuffer(),this.texture=t.createTexture(),s=s||e.scaleModes.DEFAULT,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s===e.scaleModes.LINEAR?t.LINEAR:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),this.renderBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer),this.resize(i,n)},e.FilterTexture.prototype.constructor=e.FilterTexture,e.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},e.FilterTexture.prototype.resize=function(t,e){if(this.width!==t||this.height!==e){this.width=t,this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)}},e.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},e.CanvasBuffer=function(t,e){this.width=t,this.height=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e},e.CanvasBuffer.prototype.constructor=e.CanvasBuffer,e.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},e.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},e.CanvasMaskManager=function(){},e.CanvasMaskManager.prototype.constructor=e.CanvasMaskManager,e.CanvasMaskManager.prototype.pushMask=function(t,i){var n=i.context;n.save();var s=t.alpha,r=t.worldTransform,o=i.resolution;n.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*o,r.ty*o),e.CanvasGraphics.renderGraphicsMask(t,n),n.clip(),t.worldAlpha=s},e.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()},e.CanvasTinter=function(){},e.CanvasTinter.getTintedTexture=function(t,i){var n=t.texture;i=e.CanvasTinter.roundColor(i);var s="#"+("00000"+(0|i).toString(16)).substr(-6);if(n.tintCache=n.tintCache||{},n.tintCache[s])return n.tintCache[s];var r=e.CanvasTinter.canvas||document.createElement("canvas");if(e.CanvasTinter.tintMethod(n,i,r),e.CanvasTinter.convertTintToImage){var o=new Image;o.src=r.toDataURL(),n.tintCache[s]=o}else n.tintCache[s]=r,e.CanvasTinter.canvas=null;return r},e.CanvasTinter.tintWithMultiply=function(t,e,i){var n=i.getContext("2d"),s=t.crop;i.width=s.width,i.height=s.height,n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,s.width,s.height),n.globalCompositeOperation="multiply",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)},e.CanvasTinter.tintWithOverlay=function(t,e,i){var n=i.getContext("2d"),s=t.crop;i.width=s.width,i.height=s.height,n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),n.fillRect(0,0,s.width,s.height),n.globalCompositeOperation="destination-atop",n.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)},e.CanvasTinter.tintWithPerPixel=function(t,i,n){var s=n.getContext("2d"),r=t.crop;n.width=r.width,n.height=r.height,s.globalCompositeOperation="copy",s.drawImage(t.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);for(var o=e.hex2rgb(i),a=o[0],h=o[1],l=o[2],c=s.getImageData(0,0,r.width,r.height),u=c.data,d=0;d<u.length;d+=4)u[d+0]*=a,u[d+1]*=h,u[d+2]*=l;s.putImageData(c,0,0)},e.CanvasTinter.roundColor=function(t){var i=e.CanvasTinter.cacheStepsPerColorChannel,n=e.hex2rgb(t);return n[0]=Math.min(255,n[0]/i*i),n[1]=Math.min(255,n[1]/i*i),n[2]=Math.min(255,n[2]/i*i),e.rgb2hex(n)},e.CanvasTinter.cacheStepsPerColorChannel=8,e.CanvasTinter.convertTintToImage=!1,e.CanvasTinter.canUseMultiply=e.canUseNewCanvasBlendModes(),e.CanvasTinter.tintMethod=e.CanvasTinter.canUseMultiply?e.CanvasTinter.tintWithMultiply:e.CanvasTinter.tintWithPerPixel,e.CanvasRenderer=function(t,i,n){if(n)for(var s in e.defaultRenderOptions)"undefined"==typeof n[s]&&(n[s]=e.defaultRenderOptions[s]);else n=e.defaultRenderOptions;e.defaultRenderer||(e.sayHello("Canvas"),e.defaultRenderer=this),this.type=e.CANVAS_RENDERER,this.resolution=n.resolution,this.clearBeforeRender=n.clearBeforeRender,this.transparent=n.transparent,this.width=t||800,this.height=i||600,this.width*=this.resolution,this.height*=this.resolution,this.view=n.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new e.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(t,i),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},e.CanvasRenderer.prototype.constructor=e.CanvasRenderer,e.CanvasRenderer.prototype.render=function(t){t.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=e.blendModes.NORMAL,this.context.globalCompositeOperation=e.blendModesCanvas[e.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)))},e.CanvasRenderer.prototype.destroy=function(t){"undefined"==typeof t&&(t=!0),t&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},e.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution,this.height=e*this.resolution,this.view.width=this.width,this.view.height=this.height,this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"},e.CanvasRenderer.prototype.renderDisplayObject=function(t,e){this.renderSession.context=e||this.context,this.renderSession.resolution=this.resolution,t._renderCanvas(this.renderSession)},e.CanvasRenderer.prototype.mapBlendModes=function(){e.blendModesCanvas||(e.blendModesCanvas=[],e.canUseNewCanvasBlendModes()?(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="multiply",e.blendModesCanvas[e.blendModes.SCREEN]="screen",e.blendModesCanvas[e.blendModes.OVERLAY]="overlay",e.blendModesCanvas[e.blendModes.DARKEN]="darken",e.blendModesCanvas[e.blendModes.LIGHTEN]="lighten",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="color-dodge",e.blendModesCanvas[e.blendModes.COLOR_BURN]="color-burn",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="hard-light",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="soft-light",e.blendModesCanvas[e.blendModes.DIFFERENCE]="difference",e.blendModesCanvas[e.blendModes.EXCLUSION]="exclusion",e.blendModesCanvas[e.blendModes.HUE]="hue",e.blendModesCanvas[e.blendModes.SATURATION]="saturation",e.blendModesCanvas[e.blendModes.COLOR]="color",e.blendModesCanvas[e.blendModes.LUMINOSITY]="luminosity"):(e.blendModesCanvas[e.blendModes.NORMAL]="source-over",e.blendModesCanvas[e.blendModes.ADD]="lighter",e.blendModesCanvas[e.blendModes.MULTIPLY]="source-over",e.blendModesCanvas[e.blendModes.SCREEN]="source-over",e.blendModesCanvas[e.blendModes.OVERLAY]="source-over",e.blendModesCanvas[e.blendModes.DARKEN]="source-over",e.blendModesCanvas[e.blendModes.LIGHTEN]="source-over",e.blendModesCanvas[e.blendModes.COLOR_DODGE]="source-over",e.blendModesCanvas[e.blendModes.COLOR_BURN]="source-over",e.blendModesCanvas[e.blendModes.HARD_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.SOFT_LIGHT]="source-over",e.blendModesCanvas[e.blendModes.DIFFERENCE]="source-over",e.blendModesCanvas[e.blendModes.EXCLUSION]="source-over",e.blendModesCanvas[e.blendModes.HUE]="source-over",e.blendModesCanvas[e.blendModes.SATURATION]="source-over",e.blendModesCanvas[e.blendModes.COLOR]="source-over",e.blendModesCanvas[e.blendModes.LUMINOSITY]="source-over"))},e.CanvasGraphics=function(){},e.CanvasGraphics.renderGraphics=function(t,i){for(var n=t.worldAlpha,s="",r=0;r<t.graphicsData.length;r++){var o=t.graphicsData[r],a=o.shape;if(i.strokeStyle=s="#"+("00000"+(0|o.lineColor).toString(16)).substr(-6),i.lineWidth=o.lineWidth,o.type===e.Graphics.POLY){i.beginPath();var h=a.points;i.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++)i.lineTo(h[2*l],h[2*l+1]);a.closed&&i.lineTo(h[0],h[1]),h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle=s="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.stroke())}else if(o.type===e.Graphics.RECT)(o.fillColor||0===o.fillColor)&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle=s="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),i.fillRect(a.x,a.y,a.width,a.height)),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.strokeRect(a.x,a.y,a.width,a.height));else if(o.type===e.Graphics.CIRC)i.beginPath(),i.arc(a.x,a.y,a.radius,0,2*Math.PI),i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle=s="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.stroke());else if(o.type===e.Graphics.ELIP){var c=2*a.width,u=2*a.height,d=a.x-c/2,A=a.y-u/2;i.beginPath();var p=.5522848,m=c/2*p,f=u/2*p,g=d+c,_=A+u,y=d+c/2,v=A+u/2;i.moveTo(d,v),i.bezierCurveTo(d,v-f,y-m,A,y,A),i.bezierCurveTo(y+m,A,g,v-f,g,v),i.bezierCurveTo(g,v+f,y+m,_,y,_),i.bezierCurveTo(y-m,_,d,v+f,d,v),i.closePath(),o.fill&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle=s="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.stroke())}else if(o.type===e.Graphics.RREC){var T=a.points,b=T[0],w=T[1],x=T[2],C=T[3],S=T[4],P=Math.min(x,C)/2|0;S=S>P?P:S,i.beginPath(),i.moveTo(b,w+S),i.lineTo(b,w+C-S),i.quadraticCurveTo(b,w+C,b+S,w+C),i.lineTo(b+x-S,w+C),i.quadraticCurveTo(b+x,w+C,b+x,w+C-S),i.lineTo(b+x,w+S),i.quadraticCurveTo(b+x,w,b+x-S,w),i.lineTo(b+S,w),i.quadraticCurveTo(b,w,b,w+S),i.closePath(),(o.fillColor||0===o.fillColor)&&(i.globalAlpha=o.fillAlpha*n,i.fillStyle=s="#"+("00000"+(0|o.fillColor).toString(16)).substr(-6),i.fill()),o.lineWidth&&(i.globalAlpha=o.lineAlpha*n,i.stroke())}}},e.CanvasGraphics.renderGraphicsMask=function(t,i){var n=t.graphicsData.length;if(0!==n){n>1&&(n=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var s=0;1>s;s++){var r=t.graphicsData[s],o=r.shape;if(r.type===e.Graphics.POLY){i.beginPath();var a=o.points;i.moveTo(a[0],a[1]);for(var h=1;h<a.length/2;h++)i.lineTo(a[2*h],a[2*h+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&i.closePath()}else if(r.type===e.Graphics.RECT)i.beginPath(),i.rect(o.x,o.y,o.width,o.height),i.closePath();else if(r.type===e.Graphics.CIRC)i.beginPath(),i.arc(o.x,o.y,o.radius,0,2*Math.PI),i.closePath();else if(r.type===e.Graphics.ELIP){var l=2*o.width,c=2*o.height,u=o.x-l/2,d=o.y-c/2;i.beginPath();var A=.5522848,p=l/2*A,m=c/2*A,f=u+l,g=d+c,_=u+l/2,y=d+c/2;i.moveTo(u,y),i.bezierCurveTo(u,y-m,_-p,d,_,d),i.bezierCurveTo(_+p,d,f,y-m,f,y),i.bezierCurveTo(f,y+m,_+p,g,_,g),i.bezierCurveTo(_-p,g,u,y+m,u,y),i.closePath()}else if(r.type===e.Graphics.RREC){var v=o.points,T=v[0],b=v[1],w=v[2],x=v[3],C=v[4],S=Math.min(w,x)/2|0;C=C>S?S:C,i.beginPath(),i.moveTo(T,b+C),i.lineTo(T,b+x-C),i.quadraticCurveTo(T,b+x,T+C,b+x),i.lineTo(T+w-C,b+x),i.quadraticCurveTo(T+w,b+x,T+w,b+x-C),i.lineTo(T+w,b+C),i.quadraticCurveTo(T+w,b,T+w-C,b),i.lineTo(T+C,b),i.quadraticCurveTo(T,b,T,b+C),i.closePath()}}}},e.Strip=function(t){e.DisplayObjectContainer.call(this),this.texture=t,this.uvs=new e.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new e.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new e.Float32Array([1,1,1,1]),this.indices=new e.Uint16Array([0,1,2,3]),this.dirty=!0,this.padding=0},e.Strip.prototype=Object.create(e.DisplayObjectContainer.prototype),e.Strip.prototype.constructor=e.Strip,e.Strip.prototype._renderWebGL=function(t){!this.visible||this.alpha<=0||(t.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(t),t.shaderManager.setShader(t.shaderManager.stripShader),this._renderStrip(t),t.spriteBatch.start())},e.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer(),this._indexBuffer=e.createBuffer(),this._uvBuffer=e.createBuffer(),this._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)},e.Strip.prototype._renderStrip=function(t){var e=t.gl,i=t.projection,n=t.offset,s=t.shaderManager.stripShader;e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.uniformMatrix3fv(s.translationMatrix,!1,this.worldTransform.toArray(!0)),e.uniform2f(s.projectionVector,i.x,-i.y),e.uniform2f(s.offsetVector,-n.x,-n.y),e.uniform1f(s.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.verticies,e.STATIC_DRAW),e.vertexAttribPointer(s.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW),e.vertexAttribPointer(s.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)):(e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.verticies),e.vertexAttribPointer(s.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer),e.vertexAttribPointer(s.aTextureCoord,2,e.FLOAT,!1,0,0),e.activeTexture(e.TEXTURE0),this.texture.baseTexture._dirty[e.id]?t.renderer.updateTexture(this.texture.baseTexture):e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id]),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),e.drawElements(e.TRIANGLE_STRIP,this.indices.length,e.UNSIGNED_SHORT,0)},e.Strip.prototype._renderCanvas=function(t){var e=t.context,i=this.worldTransform;t.roundPixels?e.setTransform(i.a,i.b,i.c,i.d,0|i.tx,0|i.ty):e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);var n=this,s=n.verticies,r=n.uvs,o=s.length/2;this.count++;for(var a=0;o-2>a;a++){var h=2*a,l=s[h],c=s[h+2],u=s[h+4],d=s[h+1],A=s[h+3],p=s[h+5];if(this.padding>0){var m=(l+c+u)/3,f=(d+A+p)/3,g=l-m,_=d-f,y=Math.sqrt(g*g+_*_);l=m+g/y*(y+3),d=f+_/y*(y+3),g=c-m,_=A-f,y=Math.sqrt(g*g+_*_),c=m+g/y*(y+3),A=f+_/y*(y+3),g=u-m,_=p-f,y=Math.sqrt(g*g+_*_),u=m+g/y*(y+3),p=f+_/y*(y+3)}var v=r[h]*n.texture.width,T=r[h+2]*n.texture.width,b=r[h+4]*n.texture.width,w=r[h+1]*n.texture.height,x=r[h+3]*n.texture.height,C=r[h+5]*n.texture.height;e.save(),e.beginPath(),e.moveTo(l,d),e.lineTo(c,A),e.lineTo(u,p),e.closePath(),e.clip();var S=v*x+w*b+T*C-x*b-w*T-v*C,P=l*x+w*u+c*C-x*u-w*c-l*C,I=v*c+l*b+T*u-c*b-l*T-v*u,M=v*x*u+w*c*b+l*T*C-l*x*b-w*T*u-v*c*C,k=d*x+w*p+A*C-x*p-w*A-d*C,B=v*A+d*b+T*p-A*b-d*T-v*p,D=v*x*p+w*A*b+d*T*C-d*x*b-w*T*p-v*A*C;e.transform(P/S,k/S,I/S,B/S,M/S,D/S),e.drawImage(n.texture.baseTexture.source,0,0),e.restore()}},e.Strip.prototype.renderStripFlat=function(t){var e=this.context,i=t.verticies,n=i.length/2;this.count++,e.beginPath();for(var s=1;n-2>s;s++){var r=2*s,o=i[r],a=i[r+2],h=i[r+4],l=i[r+1],c=i[r+3],u=i[r+5];e.moveTo(o,l),e.lineTo(a,c),e.lineTo(h,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},e.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},e.Rope=function(t,i){e.Strip.call(this,t),this.points=i,this.verticies=new e.Float32Array(4*i.length),this.uvs=new e.Float32Array(4*i.length),this.colors=new e.Float32Array(2*i.length),this.indices=new e.Uint16Array(2*i.length),this.refresh()},e.Rope.prototype=Object.create(e.Strip.prototype),e.Rope.prototype.constructor=e.Rope,e.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=t[0],n=this.indices,s=this.colors;this.count-=.2,e[0]=0,e[1]=0,e[2]=0,e[3]=1,s[0]=1,s[1]=1,n[0]=0,n[1]=1;for(var r,o,a,h=t.length,l=1;h>l;l++)r=t[l],o=4*l,a=l/(h-1),l%2?(e[o]=a,e[o+1]=0,e[o+2]=a,e[o+3]=1):(e[o]=a,e[o+1]=0,e[o+2]=a,e[o+3]=1),o=2*l,s[o]=1,s[o+1]=1,o=2*l,n[o]=o,n[o+1]=o+1,i=r}},e.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var i,n=t[0],s={x:0,y:0};this.count-=.2;for(var r,o,a,h,l,c=this.verticies,u=t.length,d=0;u>d;d++)r=t[d],o=4*d,i=d<t.length-1?t[d+1]:r,s.y=-(i.x-n.x),s.x=i.y-n.y,a=10*(1-d/(u-1)),a>1&&(a=1),h=Math.sqrt(s.x*s.x+s.y*s.y),l=this.texture.height/2,s.x/=h,s.y/=h,s.x*=l,s.y*=l,c[o]=r.x+s.x,c[o+1]=r.y+s.y,c[o+2]=r.x-s.x,c[o+3]=r.y-s.y,n=r;e.DisplayObjectContainer.prototype.updateTransform.call(this)}},e.Rope.prototype.setTexture=function(t){this.texture=t},e.TilingSprite=function(t,i,n){e.Sprite.call(this,t),this._width=i||100,this._height=n||100,this.tileScale=new e.Point(1,1),this.tileScaleOffset=new e.Point(1,1),this.tilePosition=new e.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=e.blendModes.NORMAL},e.TilingSprite.prototype=Object.create(e.Sprite.prototype),e.TilingSprite.prototype.constructor=e.TilingSprite,Object.defineProperty(e.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}}),Object.defineProperty(e.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}}),e.TilingSprite.prototype.setTexture=function(t){this.texture!==t&&(this.texture=t,this.refreshTexture=!0,this.cachedTint=16777215)},e.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha){var i,n;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(e.updateWebGLTexture(this.tilingTexture.baseTexture,t.gl),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),i=0,n=this.children.length;n>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop(),this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this._mask,t),t.spriteBatch.start()}},e.TilingSprite.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){var i=t.context;this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha;var n,s,r=this.worldTransform,o=t.resolution;if(i.setTransform(r.a*o,r.c*o,r.b*o,r.d*o,r.tx*o,r.ty*o),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=e.blendModesCanvas[t.currentBlendMode]);var a=this.tilePosition,h=this.tileScale;for(a.x%=this.tilingTexture.baseTexture.width,a.y%=this.tilingTexture.baseTexture.height,i.scale(h.x,h.y),i.translate(a.x+this.anchor.x*-this._width,a.y+this.anchor.y*-this._height),i.fillStyle=this.__tilePattern,i.fillRect(-a.x,-a.y,this._width/h.x,this._height/h.y),i.scale(1/h.x,1/h.y),i.translate(-a.x+this.anchor.x*this._width,-a.y+this.anchor.y*this._height),this._mask&&t.maskManager.popMask(t.context),n=0,s=this.children.length;s>n;n++)this.children[n]._renderCanvas(t)}},e.TilingSprite.prototype.getBounds=function(){var t=this._width,e=this._height,i=t*(1-this.anchor.x),n=t*-this.anchor.x,s=e*(1-this.anchor.y),r=e*-this.anchor.y,o=this.worldTransform,a=o.a,h=o.c,l=o.b,c=o.d,u=o.tx,d=o.ty,A=a*n+l*r+u,p=c*r+h*n+d,m=a*i+l*r+u,f=c*r+h*i+d,g=a*i+l*s+u,_=c*s+h*i+d,y=a*n+l*s+u,v=c*s+h*n+d,T=-(1/0),b=-(1/0),w=1/0,x=1/0;w=w>A?A:w,w=w>m?m:w,w=w>g?g:w,w=w>y?y:w,x=x>p?p:x,x=x>f?f:x,x=x>_?_:x,x=x>v?v:x,T=A>T?A:T,T=m>T?m:T,T=g>T?g:T,T=y>T?y:T,b=p>b?p:b,b=f>b?f:b,b=_>b?_:b,b=v>b?v:b;var C=this._bounds;return C.x=w,C.width=T-w,C.y=x,C.height=b-x,this._currentBounds=C,C},e.TilingSprite.prototype.onTextureUpdate=function(){},e.TilingSprite.prototype.generateTilingTexture=function(t){if(this.texture.baseTexture.hasLoaded){var i,n,s=this.originalTexture||this.texture,r=s.frame,o=r.width!==s.baseTexture.width||r.height!==s.baseTexture.height,a=!1;if(t?(i=e.getNextPowerOfTwo(r.width),n=e.getNextPowerOfTwo(r.height),(r.width!==i||r.height!==n)&&(a=!0)):o&&(i=r.width,n=r.height,a=!0),a){var h;this.tilingTexture&&this.tilingTexture.isTiling?(h=this.tilingTexture.canvasBuffer,h.resize(i,n),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=n,this.tilingTexture.needsUpdate=!0):(h=new e.CanvasBuffer(i,n),this.tilingTexture=e.Texture.fromCanvas(h.canvas),this.tilingTexture.canvasBuffer=h,this.tilingTexture.isTiling=!0),h.context.drawImage(s.baseTexture.source,s.crop.x,s.crop.y,s.crop.width,s.crop.height,0,0,i,n),this.tileScaleOffset.x=r.width/i,this.tileScaleOffset.y=r.height/n}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=s;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0}},e.BaseTextureCache={},e.BaseTextureCacheIdGenerator=0,e.BaseTexture=function(t,i){if(this.resolution=1,this.width=100,this.height=100,this.scaleMode=i||e.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this._UID=e._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[!0,!0,!0,!0],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var n=this;this.source.onload=function(){n.hasLoaded=!0,n.width=n.source.naturalWidth||n.source.width,n.height=n.source.naturalHeight||n.source.height,n.dirty(),n.dispatchEvent({type:"loaded",content:n})},this.source.onerror=function(){n.dispatchEvent({type:"error",content:n})}}this.imageUrl=null,
this._powerOf2=!1}},e.BaseTexture.prototype.constructor=e.BaseTexture,e.EventTarget.mixin(e.BaseTexture.prototype),e.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete e.BaseTextureCache[this.imageUrl],delete e.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=""):this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId],this.source=null;for(var t=this._glTextures.length-1;t>=0;t--){var i=this._glTextures[t],n=e.glContexts[t];n&&i&&n.deleteTexture(i)}this._glTextures.length=0},e.BaseTexture.prototype.updateSourceImage=function(t){this.hasLoaded=!1,this.source.src=null,this.source.src=t},e.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++)this._dirty[t]=!0},e.BaseTexture.fromImage=function(t,i,n){var s=e.BaseTextureCache[t];if(void 0===i&&-1===t.indexOf("data:")&&(i=!0),!s){var r=new Image;i&&(r.crossOrigin=""),r.src=t,s=new e.BaseTexture(r,n),s.imageUrl=t,e.BaseTextureCache[t]=s,-1!==t.indexOf(e.RETINA_PREFIX+".")&&(s.resolution=2)}return s},e.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+e.TextureCacheIdGenerator++);var n=e.BaseTextureCache[t._pixiId];return n||(n=new e.BaseTexture(t,i),e.BaseTextureCache[t._pixiId]=n),n},e.TextureCache={},e.FrameCache={},e.TextureCacheIdGenerator=0,e.Texture=function(t,i,n,s){this.noFrame=!1,i||(this.noFrame=!0,i=new e.Rectangle(0,0,1,1)),t instanceof e.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=i,this.trim=s,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||new e.Rectangle(0,0,1,1),t.hasLoaded?(this.noFrame&&(i=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},e.Texture.prototype.constructor=e.Texture,e.EventTarget.mixin(e.Texture.prototype),e.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new e.Rectangle(0,0,t.width,t.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},e.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy(),this.valid=!1},e.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},e.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new e.TextureUvs);var t=this.crop,i=this.baseTexture.width,n=this.baseTexture.height;this._uvs.x0=t.x/i,this._uvs.y0=t.y/n,this._uvs.x1=(t.x+t.width)/i,this._uvs.y1=t.y/n,this._uvs.x2=(t.x+t.width)/i,this._uvs.y2=(t.y+t.height)/n,this._uvs.x3=t.x/i,this._uvs.y3=(t.y+t.height)/n},e.Texture.fromImage=function(t,i,n){var s=e.TextureCache[t];return s||(s=new e.Texture(e.BaseTexture.fromImage(t,i,n)),e.TextureCache[t]=s),s},e.Texture.fromFrame=function(t){var i=e.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i},e.Texture.fromCanvas=function(t,i){var n=e.BaseTexture.fromCanvas(t,i);return new e.Texture(n)},e.Texture.addTextureToCache=function(t,i){e.TextureCache[i]=t},e.Texture.removeTextureFromCache=function(t){var i=e.TextureCache[t];return delete e.TextureCache[t],delete e.BaseTextureCache[t],i},e.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},e.RenderTexture=function(t,i,n,s,r){if(this.width=t||100,this.height=i||100,this.resolution=r||1,this.frame=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new e.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new e.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=s||e.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,e.Texture.call(this,this.baseTexture,new e.Rectangle(0,0,this.width,this.height)),this.renderer=n||e.defaultRenderer,this.renderer.type===e.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1,this.textureBuffer=new e.FilterTexture(o,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new e.Point(.5*this.width,.5*-this.height)}else this.render=this.renderCanvas,this.textureBuffer=new e.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},e.RenderTexture.prototype=Object.create(e.Texture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.resize=function(t,i,n){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,n&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===e.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution))},e.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===e.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},e.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),n.translate(0,2*this.projection.y),e&&n.append(e),n.scale(1,-1),t.worldAlpha=1;for(var s=t.children,r=0,o=s.length;o>r;r++)s[r].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0}},e.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var n=t.worldTransform;n.identity(),e&&n.append(e);for(var s=t.children,r=0,o=s.length;o>r;r++)s[r].updateTransform();i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,a),this.renderer.resolution=h}},e.RenderTexture.prototype.getImage=function(){var t=new Image;return t.src=this.getBase64(),t},e.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},e.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===e.WEBGL_RENDERER){var t=this.renderer.gl,i=this.textureBuffer.width,n=this.textureBuffer.height,s=new Uint8Array(4*i*n);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer),t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,s),t.bindFramebuffer(t.FRAMEBUFFER,null);for(var r=new e.CanvasBuffer(i,n),o=r.context.getImageData(0,0,i,n),a=o.data,h=0;h<s.length;h+=4){var l=s[h+3];a[h]=s[h]*l,a[h+1]=s[h+1]*l,a[h+2]=s[h+2]*l,a[h+3]=l}return r.context.putImageData(o,0,0),r.canvas}return this.textureBuffer.canvas},e.RenderTexture.tempMatrix=new e.Matrix,e.AbstractFilter=function(t,e){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=e||{},this.fragmentSrc=t||[]},e.AbstractFilter.prototype.constructor=e.AbstractFilter,e.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;e>t;t++)this.shaders[t].dirty=!0},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.PIXI=e):"undefined"!=typeof define&&define.amd?define("PIXI",function(){return t.PIXI=e}()):t.PIXI=e}.call(this),define("pixi",function(){}),window.Modernizr=function(t,e,i){function n(t){_.cssText=t}function s(t,e){return typeof t===e}function r(t,e){return!!~(""+t).indexOf(e)}function o(t,e){for(var n in t){var s=t[n];if(!r(s,"-")&&_[s]!==i)return"pfx"==e?s:!0}return!1}function a(t,e,n){for(var r in t){var o=e[t[r]];if(o!==i)return n===!1?t[r]:s(o,"function")?o.bind(n||e):o}return!1}function h(t,e,i){var n=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+w.join(n+" ")+n).split(" ");return s(e,"string")||s(e,"undefined")?o(r,e):(r=(t+" "+x.join(n+" ")+n).split(" "),a(r,e,i))}function l(){A.input=function(i){for(var n=0,s=i.length;s>n;n++)P[i[n]]=!!(i[n]in y);return P.list&&(P.list=!(!e.createElement("datalist")||!t.HTMLDataListElement)),P}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),A.inputtypes=function(t){for(var n,s,r,o=0,a=t.length;a>o;o++)y.setAttribute("type",s=t[o]),n="text"!==y.type,n&&(y.value=v,y.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&y.style.WebkitAppearance!==i?(m.appendChild(y),r=e.defaultView,n=r.getComputedStyle&&"textfield"!==r.getComputedStyle(y,null).WebkitAppearance&&0!==y.offsetHeight,m.removeChild(y)):/^(search|tel)$/.test(s)||(n=/^(url|email)$/.test(s)?y.checkValidity&&y.checkValidity()===!1:y.value!=v)),S[t[o]]=!!n;return S}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var c,u,d="2.8.1",A={},p=!0,m=e.documentElement,f="modernizr",g=e.createElement(f),_=g.style,y=e.createElement("input"),v=":)",T=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),b="Webkit Moz O ms",w=b.split(" "),x=b.toLowerCase().split(" "),C={},S={},P={},I=[],M=I.slice,k=function(t,i,n,s){var r,o,a,h,l=e.createElement("div"),c=e.body,u=c||e.createElement("body");if(parseInt(n,10))for(;n--;)a=e.createElement("div"),a.id=s?s[n]:f+(n+1),l.appendChild(a);return r=["&#173;",'<style id="s',f,'">',t,"</style>"].join(""),l.id=f,(c?l:u).innerHTML+=r,u.appendChild(l),c||(u.style.background="",u.style.overflow="hidden",h=m.style.overflow,m.style.overflow="hidden",m.appendChild(u)),o=i(l,t),c?l.parentNode.removeChild(l):(u.parentNode.removeChild(u),m.style.overflow=h),!!o},B=function(e){var i=t.matchMedia||t.msMatchMedia;if(i)return i(e)&&i(e).matches||!1;var n;return k("@media "+e+" { #"+f+" { position: absolute; } }",function(e){n="absolute"==(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle).position}),n},D=function(){function t(t,r){r=r||e.createElement(n[t]||"div"),t="on"+t;var o=t in r;return o||(r.setAttribute||(r=e.createElement("div")),r.setAttribute&&r.removeAttribute&&(r.setAttribute(t,""),o=s(r[t],"function"),s(r[t],"undefined")||(r[t]=i),r.removeAttribute(t))),r=null,o}var n={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return t}(),E={}.hasOwnProperty;u=s(E,"undefined")||s(E.call,"undefined")?function(t,e){return e in t&&s(t.constructor.prototype[e],"undefined")}:function(t,e){return E.call(t,e)},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new TypeError;var i=M.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=e.prototype;var r=new s,o=e.apply(r,i.concat(M.call(arguments)));return Object(o)===o?o:r}return e.apply(t,i.concat(M.call(arguments)))};return n}),C.webgl=function(){return!!t.WebGLRenderingContext},C.touch=function(){var i;return"ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch?i=!0:k(["@media (",T.join("touch-enabled),("),f,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){i=9===t.offsetTop}),i},C.geolocation=function(){return"geolocation"in navigator},C.postmessage=function(){return!!t.postMessage},C.websqldatabase=function(){return!!t.openDatabase},C.indexedDB=function(){return!!h("indexedDB",t)},C.hashchange=function(){return D("hashchange",t)&&(e.documentMode===i||e.documentMode>7)},C.history=function(){return!(!t.history||!history.pushState)},C.draganddrop=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t},C.websockets=function(){return"WebSocket"in t||"MozWebSocket"in t},C.fontface=function(){var t;return k('@font-face {font-family:"font";src:url("https://")}',function(i,n){var s=e.getElementById("smodernizr"),r=s.sheet||s.styleSheet,o=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";t=/src/i.test(o)&&0===o.indexOf(n.split(" ")[0])}),t},C.localstorage=function(){try{return localStorage.setItem(f,f),localStorage.removeItem(f),!0}catch(t){return!1}},C.sessionstorage=function(){try{return sessionStorage.setItem(f,f),sessionStorage.removeItem(f),!0}catch(t){return!1}},C.webworkers=function(){return!!t.Worker};for(var O in C)u(C,O)&&(c=O.toLowerCase(),A[c]=C[O](),I.push((A[c]?"":"no-")+c));return A.input||l(),A.addTest=function(t,e){if("object"==typeof t)for(var n in t)u(t,n)&&A.addTest(n,t[n]);else{if(t=t.toLowerCase(),A[t]!==i)return A;e="function"==typeof e?e():e,"undefined"!=typeof p&&p&&(m.className+=" "+(e?"":"no-")+t),A[t]=e}return A},n(""),g=y=null,A._version=d,A._prefixes=T,A._domPrefixes=x,A._cssomPrefixes=w,A.mq=B,A.hasEvent=D,A.testProp=function(t){return o([t])},A.testAllProps=h,A.testStyles=k,A.prefixed=function(t,e,i){return e?h(t,e,i):h(t,"pfx")},m.className=m.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(p?" js "+I.join(" "):""),A}(this,this.document),Modernizr.addTest("strictmode",function(){return function(){"use strict";return!this}()}),Modernizr.addTest("devicemotion","DeviceMotionEvent"in window),Modernizr.addTest("deviceorientation","DeviceOrientationEvent"in window),Modernizr.addTest("vibrate",!!Modernizr.prefixed("vibrate",navigator)),define("modernizr",function(){}),define("gt/utils/device",[],function(){function t(t){return r.className+=" "+t}function e(){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),e=["webgl","experimental-webgl","moz-webgl","webkit-3d"],i=!1,n=0;n<e.length;n++)try{if(i=t.getContext(e[n]),i&&"function"==typeof i.getParameter)return!0}catch(s){}return!1}return!1}var i=navigator.userAgent,n={};n.iOS=/iphone|ipad|ipod/gi.test(i),n.iOS6=n.iOS&&/OS 6/gi.test(i),n.iOS7=n.iOS&&/OS 7/gi.test(i),n.iOS8=n.iOS&&/OS 8/gi.test(i),n.iPhone=/iphone/gi.test(i),n.iPod=/ipod/gi.test(i),n.iPad=/ipad/gi.test(i),n.android=/android/gi.test(i),n.androidPhone=n.android&&/mobile/gi.test(i),n.androidTablet=n.android&&!/mobile/gi.test(i),n.androidVersion=n.android?i.match(/Android (\d+(?:\.\d+)+)/)[0].replace("Android ",""):null,n.blackberry=/blackberry|bb10|rim/gi.test(i),n.blackberryPhone=n.blackberry&&!/tablet/gi.test(i),n.blackberryTablet=n.blackberry&&/tablet/gi.test(i),n.chromeOS=/CrOS/gi.test(i),n.arm=/ARM/gi.test(i),n.windows=/windows/gi.test(i),n.windowsPhone=n.windows&&/phone/gi.test(i),n.windowsTouch=n.windows&&/touch/gi.test(i),n.fxOS=/(\(mobile|\(tablet)(?=.*; rv:)/gi.test(i),n.fxOSPhone=n.fxOS&&/mobile/gi.test(i),n.fxOSTablet=n.fxOS&&/tablet/gi.test(i),n.meego=/meego/gi.test(i),n.sony=/sony|SO-/gi.test(i),n.samsung=/samsung|GT-/gi.test(i),n.galaxyS3=/GT-I93/gi.test(i),n.galaxyS4=/GT-I95/gi.test(i),n.galaxyS5=/SM-G900/gi.test(i),n.mobile=n.androidPhone||n.iPhone||n.iPod||n.windowsPhone||n.blackberryPhone||n.fxOSPhone||n.meego,n.tablet=n.iPad||n.androidTablet||n.blackberryTablet||n.fxOSTablet||n.windows&&n.arm,n.portable=n.mobile||n.tablet,n.desktop=!n.portable,n.getPlatformString=function(){return n.desktop?"desktop":"mobile"};var s=window.devicePixelRatio||1;n.screen={width:screen.width*s,height:screen.height*s,pixelRatio:s},n.bigScreen=n.tablet||n.desktop;var r=document.documentElement;return n.samsung&&t("samsung"),n.mobile&&t("mobile"),n.tablet&&t("tablet"),n.desktop&&t("desktop"),n.iPhone&&t("iphone"),n.iPad&&t("ipad"),n.iPod&&t("ipod"),n.galaxyS3&&t("galaxyS3"),n.galaxyS4&&t("galaxyS4"),n.galaxyS5&&t("galaxyS4"),n.fxOS&&t("fxos"),n.meego&&t("meego"),n.iOS&&t("ios"),n.android&&t("android"),n.blackberry&&t("blackberry"),n.windows&&t("windows"),n.chromeOS&&t("chromeOS"),n.webGL=e(),window.device=n}),define("gt/utils/browser",["bottom_line","gt/utils/device","modernizr"],function(t,e){function i(t,e){e?Modernizr.addTest(t,e):s[t]=e}var n=navigator.userAgent,s=Modernizr;return i("samsung",/SamsungBrowser/gi.test(n)),i("stock",e.android&&(n.match(/AppleWebKit\/([\d.]+)/)||[])[1]<537),i("chrome",/chrome/gi.test(n)&&!s.stock),i("firefox",/firefox/gi.test(n)),i("safari",/safari/gi.test(n)&&!s.chrome),i("ie",/MSIE/gi.test(n)||/Trident/gi.test(n)),i("bad",s.ie),s.firefoxTextOffset=2,window.browser=s}),function(t,e){"use strict";var i="0.7.12",n="",s="?",r="function",o="undefined",a="object",h="string",l="major",c="model",u="name",d="type",A="vendor",p="version",m="architecture",f="console",g="mobile",_="tablet",y="smarttv",v="wearable",T="embedded",b={extend:function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2===0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i},has:function(t,e){return"string"==typeof t?-1!==e.toLowerCase().indexOf(t.toLowerCase()):!1},lowerize:function(t){return t.toLowerCase()},major:function(t){return typeof t===h?t.replace(/[^\d\.]/g,"").split(".")[0]:e},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},w={rgx:function(){for(var t,i,n,s,h,l,c,u=0,d=arguments;u<d.length&&!l;){var A=d[u],p=d[u+1];if(typeof t===o){t={};for(s in p)p.hasOwnProperty(s)&&(h=p[s],typeof h===a?t[h[0]]=e:t[h]=e)}for(i=n=0;i<A.length&&!l;)if(l=A[i++].exec(this.getUA()))for(s=0;s<p.length;s++)c=l[++n],h=p[s],typeof h===a&&h.length>0?2==h.length?typeof h[1]==r?t[h[0]]=h[1].call(this,c):t[h[0]]=h[1]:3==h.length?typeof h[1]!==r||h[1].exec&&h[1].test?t[h[0]]=c?c.replace(h[1],h[2]):e:t[h[0]]=c?h[1].call(this,c,h[2]):e:4==h.length&&(t[h[0]]=c?h[3].call(this,c.replace(h[1],h[2])):e):t[h]=c?c:e;u+=2}return t},str:function(t,i){for(var n in i)if(typeof i[n]===a&&i[n].length>0){for(var r=0;r<i[n].length;r++)if(b.has(i[n][r],t))return n===s?e:n}else if(b.has(i[n],t))return n===s?e:n;return t}},x={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},C={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[u,p],[/(opios)[\/\s]+([\w\.]+)/i],[[u,"Opera Mini"],p],[/\s(opr)\/([\w\.]+)/i],[[u,"Opera"],p],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[u,p],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[u,"IE"],p],[/(edge)\/((\d+)?[\w\.]+)/i],[u,p],[/(yabrowser)\/([\w\.]+)/i],[[u,"Yandex"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],p],[/(micromessenger)\/([\w\.]+)/i],[[u,"WeChat"],p],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[p,[u,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[u,/(.+)/,"$1 WebView"],p],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[p,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[u,p],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[u,"UCBrowser"],p],[/(dolfin)\/([\w\.]+)/i],[[u,"Dolphin"],p],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[u,"Chrome"],p],[/;fbav\/([\w\.]+);/i],[p,[u,"Facebook"]],[/fxios\/([\w\.-]+)/i],[p,[u,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[p,[u,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[p,u],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[u,[p,w.str,x.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[u,p],[/(navigator|netscape)\/([\w\.-]+)/i],[[u,"Netscape"],p],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[u,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,b.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",b.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,b.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[c,A,[d,_]],[/applecoremedia\/[\w\.]+ \((ipad)/],[c,[A,"Apple"],[d,_]],[/(apple\s{0,1}tv)/i],[[c,"Apple TV"],[A,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[A,c,[d,_]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[c,[A,"Amazon"],[d,_]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[c,w.str,x.device.amazon.model],[A,"Amazon"],[d,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[c,A,[d,g]],[/\((ip[honed|\s\w*]+);/i],[c,[A,"Apple"],[d,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[A,c,[d,g]],[/\(bb10;\s(\w+)/i],[c,[A,"BlackBerry"],[d,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[c,[A,"Asus"],[d,_]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[A,"Sony"],[c,"Xperia Tablet"],[d,_]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[A,"Sony"],[c,"Xperia Phone"],[d,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[A,c,[d,f]],[/android.+;\s(shield)\sbuild/i],[c,[A,"Nvidia"],[d,f]],[/(playstation\s[34portablevi]+)/i],[c,[A,"Sony"],[d,f]],[/(sprint\s(\w+))/i],[[A,w.str,x.device.sprint.vendor],[c,w.str,x.device.sprint.model],[d,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[A,c,[d,_]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[A,[c,/_/g," "],[d,g]],[/(nexus\s9)/i],[c,[A,"HTC"],[d,_]],[/(nexus\s6p)/i],[c,[A,"Huawei"],[d,g]],[/(microsoft);\s(lumia[\s\w]+)/i],[A,c,[d,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[c,[A,"Microsoft"],[d,f]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[A,"Microsoft"],[d,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[c,[A,"Motorola"],[d,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[A,"Motorola"],[d,_]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[A,b.trim],[c,b.trim],[d,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[A,"Samsung"],[d,y]],[/\(dtv[\);].+(aquos)/i],[c,[A,"Sharp"],[d,y]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[A,"Samsung"],c,[d,_]],[/smart-tv.+(samsung)/i],[A,[d,y],c],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[A,"Samsung"],c,[d,g]],[/sie-(\w+)*/i],[c,[A,"Siemens"],[d,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[A,"Nokia"],c,[d,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[c,[A,"Acer"],[d,_]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[A,"LG"],c,[d,_]],[/(lg) netcast\.tv/i],[A,c,[d,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[c,[A,"LG"],[d,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[c,[A,"Lenovo"],[d,_]],[/linux;.+((jolla));/i],[A,c,[d,g]],[/((pebble))app\/[\d\.]+\s/i],[A,c,[d,v]],[/android.+;\s(glass)\s\d/i],[c,[A,"Google"],[d,v]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[c,/_/g," "],[A,"Xiaomi"],[d,g]],[/android.+a000(1)\s+build/i],[c,[A,"OnePlus"],[d,g]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[d,b.lowerize],A,c]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[p,[u,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,p],[/rv\:([\w\.]+).*(gecko)/i],[p,u]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[u,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[p,w.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,"Windows"],[p,w.str,x.os.windows.version]],[/\((bb)(10);/i],[[u,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[u,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[u,"Symbian"],p],[/\((series40);/i],[u],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,"Firefox OS"],p],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[u,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,"Chromium OS"],p],[/(sunos)\s?([\w\.]+\d)*/i],[[u,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[u,p],[/(haiku)\s(\w+)/i],[u,p],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[u,"iOS"],[p,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[u,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[u,p]]},S=function(e,i){if(this instanceof S){var s=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:n),r=i?b.extend(C,i):C;return this.getBrowser=function(){var t=w.rgx.apply(this,r.browser);return t.major=b.major(t.version),t},this.getCPU=function(){return w.rgx.apply(this,r.cpu)},this.getDevice=function(){return w.rgx.apply(this,r.device)},this.getEngine=function(){return w.rgx.apply(this,r.engine)},this.getOS=function(){return w.rgx.apply(this,r.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return s},this.setUA=function(t){return s=t,this},this}return new S(e,i).getResult()};S.VERSION=i,S.BROWSER={NAME:u,MAJOR:l,VERSION:p},S.CPU={ARCHITECTURE:m},S.DEVICE={MODEL:c,VENDOR:A,TYPE:d,CONSOLE:f,MOBILE:g,SMARTTV:y,TABLET:_,WEARABLE:v,EMBEDDED:T},S.ENGINE={NAME:u,VERSION:p},S.OS={NAME:u,VERSION:p},typeof exports!==o?(typeof module!==o&&module.exports&&(exports=module.exports=S),exports.UAParser=S):typeof define===r&&define.amd?define("uaparser",[],function(){return S}):t.UAParser=S;var P=t.jQuery||t.Zepto;if(typeof P!==o){var I=new S;P.ua=I.getResult(),P.ua.get=function(){return I.getUA()},P.ua.set=function(t){I.setUA(t);var e=I.getResult();for(var i in e)P.ua[i]=e[i]}}}("object"==typeof window?window:this),define("gt/utils/device.info",["bottom_line","gt/utils/device","gt/utils/browser","uaparser"],function(t,e,i,n){var s=navigator.userAgent,r=n(s);return r.screen=e.screen,r.device.type||(r.device.type=e.desktop?"desktop":e.tablet?"tablet":e.mobile?"mobile":void 0),r.device.vendor||(r.device.vendor=e.samsung?"Samsung":e.sony?"Sony":void 0),r.browser.name||(r.browser.name=i.stock?"Stock":i.chrome?"Chrome":i.firefox?"Firefox":i.safari?"Safari":i.ie?"IE":void 0),e.android&&/safari/gi.test(r.browser.name)&&(r.browser.major=void 0,r.browser.name=i.stock?"stock":void 0,r.browser.version=i.stock?e.androidVersion:void 0),"Sony"!==r.device.vendor||r.device.model||(r.device.model=(/so-\S+/gi.exec(s)||[])[0]),e.info=r,r}),define("gt/utils/polyfills",["gt/utils/device","gt/utils/browser"],function(t,e){function i(t){t.preventDefault(),t.returnValue=!1}if(e.ie){var n;n=function(t,e){var i;return e=e||{bubbles:!1,cancelable:!1,detail:void 0},i=document.createEvent("CustomEvent"),i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i},n.prototype=window.Event.prototype,window.CustomEvent=n}window.addEventListener&&window.addEventListener("DOMMouseScroll",i,!1),window.onmousewheel=document.onmousewheel=i,navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||function(){}}),define("gt/utils/dom",["bottom_line"],function(t){t.extend(window,{dom:document.querySelector.bind(document),dom$:document.querySelectorAll.bind(document)});var e=function(t,e,i){var n=function(){e.apply(null,arguments),this.removeEventListener(t,n)}.bind(this);this.on.call(this,t,n,i)};t.extend(Element.prototype,{enumerable:!1},{on:Element.prototype.addEventListener,once:e}),t.extend(Document.prototype,{enumerable:!1},{on:Document.prototype.addEventListener,once:e}),t.extend(window.constructor.prototype,{enumerable:!1},{on:window.constructor.prototype.addEventListener,once:e})});var spine={};spine.BoneData=function(t,e){this.name=t,this.parent=e},spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},spine.SlotData=function(t,e){this.name=t,this.boneData=e},spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},spine.Bone=function(t,e){this.data=t,this.parent=e,this.setToSetupPose()},spine.Bone.yDown=!1,spine.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(t,e){var i=this.parent;null!=i?(this.worldX=this.x*i.m00+this.y*i.m01+i.worldX,this.worldY=this.x*i.m10+this.y*i.m11+i.worldY,this.worldScaleX=i.worldScaleX*this.scaleX,this.worldScaleY=i.worldScaleY*this.scaleY,this.worldRotation=i.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var n=this.worldRotation*Math.PI/180,s=Math.cos(n),r=Math.sin(n);this.m00=s*this.worldScaleX,this.m10=r*this.worldScaleX,this.m01=-r*this.worldScaleY,this.m11=s*this.worldScaleY,t&&(this.m00=-this.m00,this.m01=-this.m01),e&&(this.m10=-this.m10,this.m11=-this.m11),spine.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY}},spine.Slot=function(t,e,i){this.data=t,this.skeleton=e,this.bone=i,this.setToSetupPose()},spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(t){this.attachment=t,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(t){this._attachmentTime=this.skeleton.time-t},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.skeleton.data.slots,i=0,n=e.length;n>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},spine.Skin=function(t){this.name=t,this.attachments={}},spine.Skin.prototype={
addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var n=i.indexOf(":"),s=parseInt(i.substring(0,n),10),r=i.substring(n+1),o=t.slots[s];if(o.attachment&&o.attachment.name==r){var a=this.getAttachment(s,r);a&&o.setAttachment(a)}}}},spine.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},spine.Animation.prototype={apply:function(t,e,i){i&&this.duration&&(e%=this.duration);for(var n=this.timelines,s=0,r=n.length;r>s;s++)n[s].apply(t,e,1)},mix:function(t,e,i,n){i&&this.duration&&(e%=this.duration);for(var s=this.timelines,r=0,o=s.length;o>r;r++)s[r].apply(t,e,n)}},spine.binarySearch=function(t,e,i){var n=0,s=Math.floor(t.length/i)-2;if(!s)return i;for(var r=s>>>1;;){if(t[(r+1)*i]<=e?n=r+1:s=r,n==s)return(n+1)*i;r=n+s>>>1}},spine.linearSearch=function(t,e,i){for(var n=0,s=t.length-i;s>=n;n+=i)if(t[n]>e)return n;return-1},spine.Curves=function(t){this.curves=[],this.curves.length=6*(t-1)},spine.Curves.prototype={setLinear:function(t){this.curves[6*t]=0},setStepped:function(t){this.curves[6*t]=-1},setCurve:function(t,e,i,n,s){var r=.1,o=r*r,a=o*r,h=3*r,l=3*o,c=6*o,u=6*a,d=2*-e+n,A=2*-i+s,p=3*(e-n)+1,m=3*(i-s)+1,f=6*t,g=this.curves;g[f]=e*h+d*l+p*a,g[f+1]=i*h+A*l+m*a,g[f+2]=d*c+p*u,g[f+3]=A*c+m*u,g[f+4]=p*u,g[f+5]=m*u},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=6*t,n=this.curves,s=n[i];if(!s)return e;if(-1==s)return 0;for(var r=n[i+1],o=n[i+2],a=n[i+3],h=n[i+4],l=n[i+5],c=s,u=r,d=8;;){if(c>=e){var A=c-s,p=u-r;return p+(u-p)*(e-A)/(c-A)}if(!d)break;d--,s+=o,r+=a,o+=h,a+=l,c+=s,u+=r}return u+(1-u)*(e-c)/(1-c)}},spine.RotateTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=2*t},spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i){var n,s=this.frames;if(!(e<s[0])){var r=t.bones[this.boneIndex];if(e>=s[s.length-2]){for(n=r.data.rotation+s[s.length-1]-r.rotation;n>180;)n-=360;for(;-180>n;)n+=360;return void(r.rotation+=n*i)}var o=spine.binarySearch(s,e,2),a=s[o-1],h=s[o],l=1-(e-h)/(s[o-2]-h);for(l=this.curves.getCurvePercent(o/2-1,l),n=s[o+1]-a;n>180;)n-=360;for(;-180>n;)n+=360;for(n=r.data.rotation+(a+n*l)-r.rotation;n>180;)n-=360;for(;-180>n;)n+=360;r.rotation+=n*i}}},spine.TranslateTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=3*t},spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i){var n=this.frames;if(!(e<n[0])){var s=t.bones[this.boneIndex];if(e>=n[n.length-3])return s.x+=(s.data.x+n[n.length-2]-s.x)*i,void(s.y+=(s.data.y+n[n.length-1]-s.y)*i);var r=spine.binarySearch(n,e,3),o=n[r-2],a=n[r-1],h=n[r],l=1-(e-h)/(n[r+-3]-h);l=this.curves.getCurvePercent(r/3-1,l),s.x+=(s.data.x+o+(n[r+1]-o)*l-s.x)*i,s.y+=(s.data.y+a+(n[r+2]-a)*l-s.y)*i}}},spine.ScaleTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=3*t},spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,n){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n},apply:function(t,e,i){var n=this.frames;if(!(e<n[0])){var s=t.bones[this.boneIndex];if(e>=n[n.length-3])return s.scaleX+=(s.data.scaleX-1+n[n.length-2]-s.scaleX)*i,void(s.scaleY+=(s.data.scaleY-1+n[n.length-1]-s.scaleY)*i);var r=spine.binarySearch(n,e,3),o=n[r-2],a=n[r-1],h=n[r],l=1-(e-h)/(n[r+-3]-h);l=this.curves.getCurvePercent(r/3-1,l),s.scaleX+=(s.data.scaleX-1+o+(n[r+1]-o)*l-s.scaleX)*i,s.scaleY+=(s.data.scaleY-1+a+(n[r+2]-a)*l-s.scaleY)*i}}},spine.ColorTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=5*t},spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(t,e,i,n,s,r){t*=5,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=n,this.frames[t+3]=s,this.frames[t+4]=r},apply:function(t,e,i){var n=this.frames;if(!(e<n[0])){var s=t.slots[this.slotIndex];if(e>=n[n.length-5]){var r=n.length-1;return s.r=n[r-3],s.g=n[r-2],s.b=n[r-1],void(s.a=n[r])}var o=spine.binarySearch(n,e,5),a=n[o-4],h=n[o-3],l=n[o-2],c=n[o-1],u=n[o],d=1-(e-u)/(n[o-5]-u);d=this.curves.getCurvePercent(o/5-1,d);var A=a+(n[o+1]-a)*d,p=h+(n[o+2]-h)*d,m=l+(n[o+3]-l)*d,f=c+(n[o+4]-c)*d;1>i?(s.r+=(A-s.r)*i,s.g+=(p-s.g)*i,s.b+=(m-s.b)*i,s.a+=(f-s.a)*i):(s.r=A,s.g=p,s.b=m,s.a=f)}}},spine.AttachmentTimeline=function(t){this.curves=new spine.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e,i){var n=this.frames;if(!(e<n[0])){var s;s=e>=n[n.length-1]?n.length-1:spine.binarySearch(n,e,1)-1;var r=this.attachmentNames[s];t.slots[this.slotIndex].setAttachment(r?t.getAttachmentBySlotIndex(this.slotIndex,r):null)}}},spine.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},spine.SkeletonData.prototype={defaultSkin:null,findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null}},spine.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var n=t.bones[e],s=n.parent?this.bones[t.bones.indexOf(n.parent)]:null;this.bones.push(new spine.Bone(n,s))}for(this.slots=[],this.drawOrder=[],e=0,i=t.slots.length;i>e;e++){var r=t.slots[e],o=this.bones[t.bones.indexOf(r.boneData)],a=new spine.Slot(r,this,o);this.slots.push(a),this.drawOrder.push(a)}},spine.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var t=this.flipX,e=this.flipY,i=this.bones,n=0,s=i.length;s>n;n++)i[n].updateWorldTransform(t,e)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;i>e;e++)t[e].setToSetupPose(e)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,n=e.length;n>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){this.skin&&t&&t._attachAll(this,this.skin),this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},setAttachment:function(t,e){for(var i=this.slots,n=0,s=i.size;s>n;n++){var r=i[n];if(r.data.name==t){var o=null;if(e&&(o=this.getAttachment(n,e),null==o))throw"Attachment not found: "+e+", for slot: "+t;return void r.setAttachment(o)}}throw"Slot not found: "+t},update:function(t){time+=t}},spine.AttachmentType={region:0},spine.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},spine.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,n,s){var r=this.uvs;s?(r[2]=t,r[3]=n,r[4]=t,r[5]=e,r[6]=i,r[7]=e,r[0]=i,r[1]=n):(r[0]=t,r[1]=n,r[2]=t,r[3]=e,r[4]=i,r[5]=e,r[6]=i,r[7]=n)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,n=-this.height/2*this.scaleY+this.regionOffsetY*e,s=i+this.regionWidth*t,r=n+this.regionHeight*e,o=this.rotation*Math.PI/180,a=Math.cos(o),h=Math.sin(o),l=i*a+this.x,c=i*h,u=n*a+this.y,d=n*h,A=s*a+this.x,p=s*h,m=r*a+this.y,f=r*h,g=this.offset;g[0]=l-d,g[1]=u+c,g[2]=l-f,g[3]=m+c,g[4]=A-f,g[5]=m+p,g[6]=A-d,g[7]=u+p},computeVertices:function(t,e,i,n){t+=i.worldX,e+=i.worldY;var s=i.m00,r=i.m01,o=i.m10,a=i.m11,h=this.offset;n[0]=h[0]*s+h[1]*r+t,n[1]=h[0]*o+h[1]*a+e,n[2]=h[2]*s+h[3]*r+t,n[3]=h[2]*o+h[3]*a+e,n[4]=h[4]*s+h[5]*r+t,n[5]=h[4]*o+h[5]*a+e,n[6]=h[6]*s+h[7]*r+t,n[7]=h[6]*o+h[7]*a+e}},spine.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},spine.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var n=this.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;var s=this.skeletonData.findAnimation(e);if(!s)throw"Animation not found: "+e;this.setMix(n,s,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=this.animationToMixTime[t.name+":"+e.name];return i?i:this.defaultMix}},spine.AnimationState=function(t){this.data=t,this.queue=[]},spine.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(t){if(this.currentTime+=t*this.animationSpeed,this.previousTime+=t,this.mixTime+=t,this.queue.length>0){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop),this.queue.shift())}},apply:function(t){if(this.current)if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var e=this.mixTime/this.mixDuration;e>=1&&(e=1,this.previous=null),this.current.mix(t,this.currentTime,this.currentLoop,e)}else this.current.apply(t,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e){this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e){var i=this.data.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setAnimation(i,e)},setAnimation:function(t,e){this.queue.length=0,this._setAnimation(t,e)},addAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;this.addAnimation(n,e,i)},addAnimation:function(t,e,i){var n={};if(n.animation=t,n.loop=e,!i||0>=i){var s=this.queue.length?this.queue[this.queue.length-1].animation:this.current;i=null!=s?s.duration-this.data.getMix(s,t)+(i||0):0}n.delay=i,this.queue.push(n)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},spine.SkeletonJson=function(t){this.attachmentLoader=t},spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(t){for(var e,i=new spine.SkeletonData,n=t.bones,s=0,r=n.length;r>s;s++){var o=n[s],a=null;if(o.parent&&(a=i.findBone(o.parent),!a))throw"Parent bone not found: "+o.parent;e=new spine.BoneData(o.name,a),e.length=(o.length||0)*this.scale,e.x=(o.x||0)*this.scale,e.y=(o.y||0)*this.scale,e.rotation=o.rotation||0,e.scaleX=o.scaleX||1,e.scaleY=o.scaleY||1,i.bones.push(e)}var h=t.slots;for(s=0,r=h.length;r>s;s++){var l=h[s];if(e=i.findBone(l.bone),!e)throw"Slot bone not found: "+l.bone;var c=new spine.SlotData(l.name,e),u=l.color;u&&(c.r=spine.SkeletonJson.toColor(u,0),c.g=spine.SkeletonJson.toColor(u,1),c.b=spine.SkeletonJson.toColor(u,2),c.a=spine.SkeletonJson.toColor(u,3)),c.attachmentName=l.attachment,i.slots.push(c)}var d=t.skins;for(var A in d)if(d.hasOwnProperty(A)){var p=d[A],m=new spine.Skin(A);for(var f in p)if(p.hasOwnProperty(f)){var g=i.findSlotIndex(f),_=p[f];for(var y in _)if(_.hasOwnProperty(y)){var v=this.readAttachment(m,y,_[y]);null!=v&&m.addAttachment(g,y,v)}}i.skins.push(m),"default"==m.name&&(i.defaultSkin=m)}var T=t.animations;for(var b in T)T.hasOwnProperty(b)&&this.readAnimation(b,T[b],i);return i},readAttachment:function(t,e,i){e=i.name||e;var n=spine.AttachmentType[i.type||"region"];if(n==spine.AttachmentType.region){var s=new spine.RegionAttachment;return s.x=(i.x||0)*this.scale,s.y=(i.y||0)*this.scale,s.scaleX=i.scaleX||1,s.scaleY=i.scaleY||1,s.rotation=i.rotation||0,s.width=(i.width||32)*this.scale,s.height=(i.height||32)*this.scale,s.updateOffset(),s.rendererObject={},s.rendererObject.name=e,s.rendererObject.scale={},s.rendererObject.scale.x=s.scaleX,s.rendererObject.scale.y=s.scaleY,s.rendererObject.rotation=-s.rotation*Math.PI/180,s}throw"Unknown attachment type: "+n},readAnimation:function(t,e,i){var n,s,r,o,a,h,l,c=[],u=0,d=e.bones;for(var A in d)if(d.hasOwnProperty(A)){var p=i.findBoneIndex(A);if(-1==p)throw"Bone not found: "+A;var m=d[A];for(r in m)if(m.hasOwnProperty(r))if(a=m[r],"rotate"==r){for(s=new spine.RotateTimeline(a.length),s.boneIndex=p,n=0,h=0,l=a.length;l>h;h++)o=a[h],s.setFrame(n,o.time,o.angle),spine.SkeletonJson.readCurve(s,n,o),n++;c.push(s),u=Math.max(u,s.frames[2*s.getFrameCount()-2])}else{if("translate"!=r&&"scale"!=r)throw"Invalid timeline type for a bone: "+r+" ("+A+")";var f=1;for("scale"==r?s=new spine.ScaleTimeline(a.length):(s=new spine.TranslateTimeline(a.length),f=this.scale),s.boneIndex=p,n=0,h=0,l=a.length;l>h;h++){o=a[h];var g=(o.x||0)*f,_=(o.y||0)*f;s.setFrame(n,o.time,g,_),spine.SkeletonJson.readCurve(s,n,o),n++}c.push(s),u=Math.max(u,s.frames[3*s.getFrameCount()-3])}}var y=e.slots;for(var v in y)if(y.hasOwnProperty(v)){var T=y[v],b=i.findSlotIndex(v);for(r in T)if(T.hasOwnProperty(r))if(a=T[r],"color"==r){for(s=new spine.ColorTimeline(a.length),s.slotIndex=b,n=0,h=0,l=a.length;l>h;h++){o=a[h];var w=o.color,x=spine.SkeletonJson.toColor(w,0),C=spine.SkeletonJson.toColor(w,1),S=spine.SkeletonJson.toColor(w,2),P=spine.SkeletonJson.toColor(w,3);s.setFrame(n,o.time,x,C,S,P),spine.SkeletonJson.readCurve(s,n,o),n++}c.push(s),u=Math.max(u,s.frames[5*s.getFrameCount()-5])}else{if("attachment"!=r)throw"Invalid timeline type for a slot: "+r+" ("+v+")";for(s=new spine.AttachmentTimeline(a.length),s.slotIndex=b,n=0,h=0,l=a.length;l>h;h++)o=a[h],s.setFrame(n++,o.time,o.name);c.push(s),u=Math.max(u,s.frames[s.getFrameCount()-1])}}i.animations.push(new spine.Animation(t,c,u))}},spine.SkeletonJson.readCurve=function(t,e,i){var n=i.curve;n&&("stepped"==n?t.curves.setStepped(e):n instanceof Array&&t.curves.setCurve(e,n[0],n[1],n[2],n[3]))},spine.SkeletonJson.toColor=function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substr(2*e,2),16)/255},spine.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new spine.AtlasReader(t),n=[];n.length=4;for(var s=null;;){var r=i.readLine();if(null==r)break;if(r=i.trim(r),r.length)if(s){var o=new spine.AtlasRegion;o.name=r,o.page=s,o.rotate="true"==i.readValue(),i.readTuple(n);var a=parseInt(n[0],10),h=parseInt(n[1],10);i.readTuple(n);var l=parseInt(n[0],10),c=parseInt(n[1],10);o.u=a/s.width,o.v=h/s.height,o.rotate?(o.u2=(a+c)/s.width,o.v2=(h+l)/s.height):(o.u2=(a+l)/s.width,o.v2=(h+c)/s.height),o.x=a,o.y=h,o.width=Math.abs(l),o.height=Math.abs(c),4==i.readTuple(n)&&(o.splits=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)],4==i.readTuple(n)&&(o.pads=[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10)],i.readTuple(n))),o.originalWidth=parseInt(n[0],10),o.originalHeight=parseInt(n[1],10),i.readTuple(n),o.offsetX=parseInt(n[0],10),o.offsetY=parseInt(n[1],10),o.index=parseInt(i.readValue(),10),this.regions.push(o)}else{s=new spine.AtlasPage,s.name=r,s.format=spine.Atlas.Format[i.readValue()],i.readTuple(n),s.minFilter=spine.Atlas.TextureFilter[n[0]],s.magFilter=spine.Atlas.TextureFilter[n[1]];var u=i.readValue();s.uWrap=spine.Atlas.TextureWrap.clampToEdge,s.vWrap=spine.Atlas.TextureWrap.clampToEdge,"x"==u?s.uWrap=spine.Atlas.TextureWrap.repeat:"y"==u?s.vWrap=spine.Atlas.TextureWrap.repeat:"xy"==u&&(s.uWrap=s.vWrap=spine.Atlas.TextureWrap.repeat),e.load(s,r),this.pages.push(s)}else s=null}},spine.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,n=e.length;n>i;i++){var s=e[i];s.page==t&&(s.u=s.x/t.width,s.v=s.y/t.height,s.rotate?(s.u2=(s.x+s.height)/t.width,s.v2=(s.y+s.width)/t.height):(s.u2=(s.x+s.width)/t.width,s.v2=(s.y+s.height)/t.height))}}},spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},spine.AtlasPage=function(){},spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},spine.AtlasRegion=function(){},spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},spine.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},spine.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var n=0,s=i+1;3>n;n++){var r=e.indexOf(",",s);if(-1==r){if(!n)throw"Invalid line: "+e;break}t[n]=this.trim(e.substr(s,r-s)),s=r+1}return t[n]=this.trim(e.substring(s)),n+1}},spine.AtlasAttachmentLoader=function(t){this.atlas=t},spine.AtlasAttachmentLoader.prototype={newAttachment:function(t,e,i){switch(e){case spine.AttachmentType.region:var n=this.atlas.findRegion(i);if(!n)throw"Region not found in atlas: "+i+" ("+e+")";var s=new spine.RegionAttachment(i);return s.rendererObject=n,s.setUVs(n.u,n.v,n.u2,n.v2,n.rotate),s.regionOffsetX=n.offsetX,s.regionOffsetY=n.offsetY,s.regionWidth=n.width,s.regionHeight=n.height,s.regionOriginalWidth=n.originalWidth,s.regionOriginalHeight=n.originalHeight,s}throw"Unknown attachment type: "+e}},spine.Bone.yDown=!0,PIXI.AnimCache={},PIXI.Spine=function(t){if(PIXI.DisplayObjectContainer.call(this),this.spineData=PIXI.AnimCache[t],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new spine.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new spine.AnimationStateData(this.spineData),this.state=new spine.AnimationState(this.stateData),this.slotContainers=[];for(var e=0,i=this.skeleton.drawOrder.length;i>e;e++){var n=this.skeleton.drawOrder[e],s=n.attachment,r=new PIXI.DisplayObjectContainer;if(this.slotContainers.push(r),this.addChild(r),s instanceof spine.RegionAttachment){var o=s.rendererObject.name,a=this.createSprite(n,s.rendererObject);n.currentSprite=a,n.currentSpriteName=o,r.addChild(a)}}},PIXI.Spine.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Spine.prototype.constructor=PIXI.Spine,PIXI.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var e=this.skeleton.drawOrder,i=0,n=e.length;n>i;i++){var s=e[i],r=s.attachment,o=this.slotContainers[i];if(r instanceof spine.RegionAttachment){if(r.rendererObject&&(!s.currentSpriteName||s.currentSpriteName!=r.name)){var a=r.rendererObject.name;if(void 0!==s.currentSprite&&(s.currentSprite.visible=!1),s.sprites=s.sprites||{},void 0!==s.sprites[a])s.sprites[a].visible=!0;else{var h=this.createSprite(s,r.rendererObject);o.addChild(h)}s.currentSprite=s.sprites[a],s.currentSpriteName=a}o.visible=!0;var l=s.bone;o.position.x=l.worldX+r.x*l.m00+r.y*l.m01,o.position.y=l.worldY+r.x*l.m10+r.y*l.m11,o.scale.x=l.worldScaleX,o.scale.y=l.worldScaleY,o.rotation=-(s.bone.worldRotation*Math.PI/180),o.alpha=s.a,s.currentSprite.tint=PIXI.rgb2hex([s.r,s.g,s.b])}else o.visible=!1}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)},PIXI.Spine.prototype.createSprite=function(t,e){var i=PIXI.TextureCache[e.name]?e.name:e.name+".png",n=new PIXI.Sprite(PIXI.Texture.fromFrame(i));return n.scale=e.scale,n.rotation=e.rotation,n.anchor.x=n.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[e.name]=n,n},define("spine",function(){}),define("gt/tweaks/Pixi/Sprite",["bottom_line","pixi"],function(t){t.extend(PIXI.Sprite.prototype,{enumerable:!1},{_renderCanvas:{overwriteaction:"ignore",value:function(t){if(!(this.visible===!1||0===this.alpha||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var e=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.roundPixels?t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var i=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,n=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,0|this.texture.crop.width,0|this.texture.crop.height,i/e,n/e,this.texture.crop.width/e|0,this.texture.crop.height/e|0)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,0|this.texture.crop.width,0|this.texture.crop.height,i/e,n/e,this.texture.crop.width/e|0,this.texture.crop.height/e|0)}for(var s=0,r=this.children.length;r>s;s++)this.children[s]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}}}})}),function(){var t=this,e=e||{VERSION:"2.1.3",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};if(PIXI.InteractionManager=PIXI.InteractionManager||function(){},PIXI.dontSayHello=!0,e.Utils={getProperty:function(t,e){for(var i=e.split("."),n=i.pop(),s=i.length,r=1,o=i[0];s>r&&(t=t[o]);)o=i[r],r++;return t?t[n]:null},setProperty:function(t,e,i){for(var n=e.split("."),s=n.pop(),r=n.length,o=1,a=n[0];r>o&&(t=t[a]);)a=n[o],o++;return t&&(t[s]=i),t},transposeArray:function(t){for(var e=new Array(t[0].length),i=0;i<t[0].length;i++){e[i]=new Array(t.length-1);for(var n=t.length-1;n>-1;n--)e[i][n]=t[n][i]}return e},rotateArray:function(t,i){if("string"!=typeof i&&(i=(i%360+360)%360),90===i||-270===i||"rotateLeft"===i)t=e.Utils.transposeArray(t),t=t.reverse();else if(-90===i||270===i||"rotateRight"===i)t=t.reverse(),t=e.Utils.transposeArray(t);else if(180===Math.abs(i)||"rotate180"===i){for(var n=0;n<t.length;n++)t[n].reverse();t=t.reverse()}return t},parseDimension:function(t,e){var i=0,n=0;return"string"==typeof t?"%"===t.substr(-1)?(i=parseInt(t,10)/100,n=0===e?window.innerWidth*i:window.innerHeight*i):n=parseInt(t,10):n=t,n},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},pad:function(t,e,i,n){if("undefined"==typeof e)var e=0;if("undefined"==typeof i)var i=" ";if("undefined"==typeof n)var n=3;var s=0;if(e+1>=t.length)switch(n){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var r=Math.ceil((s=e-t.length)/2),o=s-r;t=new Array(o+1).join(i)+t+new Array(r+1).join(i);break;default:t+=new Array(e+1-t.length).join(i)}return t},isPlainObject:function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},extend:function(){var t,i,n,s,r,o,a=arguments[0]||{},h=1,l=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},h=2),l===h&&(a=this,--h);l>h;h++)if(null!=(t=arguments[h]))for(i in t)n=a[i],s=t[i],a!==s&&(c&&s&&(e.Utils.isPlainObject(s)||(r=Array.isArray(s)))?(r?(r=!1,o=n&&Array.isArray(n)?n:[]):o=n&&e.Utils.isPlainObject(n)?n:{},a[i]=e.Utils.extend(c,o,s)):void 0!==s&&(a[i]=s));return a},mixin:function(t,i){if(!t||"object"!=typeof t)return i;for(var n in t){var s=t[n];if(!s.childNodes&&!s.cloneNode){var r=typeof t[n];t[n]&&"object"===r?typeof i[n]===r?i[n]=e.Utils.mixin(t[n],i[n]):i[n]=e.Utils.mixin(t[n],new s.constructor):i[n]=t[n]}}return i}},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function i(){var r=s.concat(t.call(arguments));n.apply(this instanceof i?this:e,r)}var n=this,s=t.call(arguments,1);if("function"!=typeof n)throw new TypeError;return i.prototype=function r(t){return t&&(r.prototype=t),this instanceof r?void 0:new r}(n.prototype),i}}()),Array.isArray||(Array.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var n=arguments.length>=2?arguments[1]:void 0,s=0;i>s;s++)s in e&&t.call(n,e[s],s,e)}),"function"!=typeof window.Uint32Array&&"object"!=typeof window.Uint32Array){var i=function(t){var e=new Array;window[t]=function(t){if("number"==typeof t){Array.call(this,t),this.length=t;for(var e=0;e<this.length;e++)this[e]=0}else{Array.call(this,t.length),this.length=t.length;for(var e=0;e<this.length;e++)this[e]=t[e]}},window[t].prototype=e,window[t].constructor=window[t]};i("Uint32Array"),i("Int16Array")}window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){}),e.Circle=function(t,e,i){t=t||0,e=e||0,i=i||0,this.x=t,this.y=e,this._diameter=i,i>0?this._radius=.5*i:this._radius=0},e.Circle.prototype={type:null,circumference:function(){return 2*(Math.PI*this._radius)},getBounds:function(){return new e.Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)},setTo:function(t,e,i){return this.x=t,this.y=e,this._diameter=i,this._radius=.5*i,this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.diameter=this._diameter,t},distance:function(t,i){return"undefined"==typeof i&&(i=!1),i?e.Math.distanceRounded(this.x,this.y,t.x,t.y):e.Math.distance(this.x,this.y,t.x,t.y)},clone:function(t){return"undefined"==typeof t||null===t?t=new e.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,i){return e.Circle.contains(this,t,i)},circumferencePoint:function(t,i,n){return e.Circle.circumferencePoint(this,t,i,n)},offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}},e.Circle.prototype.constructor=e.Circle,Object.defineProperty(e.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){t>0&&(this._diameter=t,this._radius=.5*t)}}),Object.defineProperty(e.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){t>0&&(this._radius=t,this._diameter=2*t)}}),Object.defineProperty(e.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){t>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-t}}),Object.defineProperty(e.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){t<this.x?(this._radius=0,this._diameter=0):this.radius=t-this.x}}),Object.defineProperty(e.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){t>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-t}}),Object.defineProperty(e.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){t<this.y?(this._radius=0,this._diameter=0):this.radius=t-this.y}}),Object.defineProperty(e.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}}),Object.defineProperty(e.Circle.prototype,"empty",{get:function(){return 0===this._diameter},set:function(t){t===!0&&this.setTo(0,0,0)}}),e.Circle.contains=function(t,e,i){if(t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom){var n=(t.x-e)*(t.x-e),s=(t.y-i)*(t.y-i);return n+s<=t.radius*t.radius}return!1},e.Circle.equals=function(t,e){return t.x==e.x&&t.y==e.y&&t.diameter==e.diameter},e.Circle.intersects=function(t,i){return e.Math.distance(t.x,t.y,i.x,i.y)<=t.radius+i.radius},e.Circle.circumferencePoint=function(t,i,n,s){return"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=new e.Point),n===!0&&(i=e.Math.degToRad(i)),s.x=t.x+t.radius*Math.cos(i),s.y=t.y+t.radius*Math.sin(i),s},e.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth),n=e.halfWidth+t.radius;if(i>n)return!1;var s=Math.abs(t.y-e.y-e.halfHeight),r=e.halfHeight+t.radius;if(s>r)return!1;if(i<=e.halfWidth||s<=e.halfHeight)return!0;var o=i-e.halfWidth,a=s-e.halfHeight,h=o*o,l=a*a,c=t.radius*t.radius;return c>=h+l},PIXI.Circle=e.Circle,e.Point=function(t,e){t=t||0,e=e||0,this.x=t,this.y=e},e.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},set:function(t,e){return this.x=t||0,this.y=e||(0!==e?this.x:0),this},add:function(t,e){return this.x+=t,this.y+=e,this},subtract:function(t,e){return this.x-=t,this.y-=e,
this},multiply:function(t,e){return this.x*=t,this.y*=e,this},divide:function(t,e){return this.x/=t,this.y/=e,this},clampX:function(t,i){return this.x=e.Math.clamp(this.x,t,i),this},clampY:function(t,i){return this.y=e.Math.clamp(this.y,t,i),this},clamp:function(t,i){return this.x=e.Math.clamp(this.x,t,i),this.y=e.Math.clamp(this.y,t,i),this},clone:function(t){return"undefined"==typeof t||null===t?t=new e.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(t){return t.x=this.x,t.y=this.y,t},distance:function(t,i){return e.Point.distance(this,t,i)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,i){return"undefined"==typeof i&&(i=!1),i?e.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},angleSq:function(t){return this.subtract(t).angle(t.subtract(this))},rotate:function(t,i,n,s,r){return e.Point.rotate(this,t,i,n,s,r)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t,this.y/=t}return this},isZero:function(){return 0===this.x&&0===this.y},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(-1*this.y,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}},e.Point.prototype.constructor=e.Point,e.Point.add=function(t,i,n){return"undefined"==typeof n&&(n=new e.Point),n.x=t.x+i.x,n.y=t.y+i.y,n},e.Point.subtract=function(t,i,n){return"undefined"==typeof n&&(n=new e.Point),n.x=t.x-i.x,n.y=t.y-i.y,n},e.Point.multiply=function(t,i,n){return"undefined"==typeof n&&(n=new e.Point),n.x=t.x*i.x,n.y=t.y*i.y,n},e.Point.divide=function(t,i,n){return"undefined"==typeof n&&(n=new e.Point),n.x=t.x/i.x,n.y=t.y/i.y,n},e.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y},e.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},e.Point.angleSq=function(t,e){return t.subtract(e).angle(e.subtract(t))},e.Point.negative=function(t,i){return"undefined"==typeof i&&(i=new e.Point),i.setTo(-t.x,-t.y)},e.Point.multiplyAdd=function(t,i,n,s){return"undefined"==typeof s&&(s=new e.Point),s.setTo(t.x+i.x*n,t.y+i.y*n)},e.Point.interpolate=function(t,i,n,s){return"undefined"==typeof s&&(s=new e.Point),s.setTo(t.x+(i.x-t.x)*n,t.y+(i.y-t.y)*n)},e.Point.perp=function(t,i){return"undefined"==typeof i&&(i=new e.Point),i.setTo(-t.y,t.x)},e.Point.rperp=function(t,i){return"undefined"==typeof i&&(i=new e.Point),i.setTo(t.y,-t.x)},e.Point.distance=function(t,i,n){return"undefined"==typeof n&&(n=!1),n?e.Math.distanceRounded(t.x,t.y,i.x,i.y):e.Math.distance(t.x,t.y,i.x,i.y)},e.Point.project=function(t,i,n){"undefined"==typeof n&&(n=new e.Point);var s=t.dot(i)/i.getMagnitudeSq();return 0!==s&&n.setTo(s*i.x,s*i.y),n},e.Point.projectUnit=function(t,i,n){"undefined"==typeof n&&(n=new e.Point);var s=t.dot(i);return 0!==s&&n.setTo(s*i.x,s*i.y),n},e.Point.normalRightHand=function(t,i){return"undefined"==typeof i&&(i=new e.Point),i.setTo(-1*t.y,t.x)},e.Point.normalize=function(t,i){"undefined"==typeof i&&(i=new e.Point);var n=t.getMagnitude();return 0!==n&&i.setTo(t.x/n,t.y/n),i},e.Point.rotate=function(t,i,n,s,r,o){r=r||!1,o=o||null,r&&(s=e.Math.degToRad(s)),null===o&&(o=Math.sqrt((i-t.x)*(i-t.x)+(n-t.y)*(n-t.y)));var a=s+Math.atan2(t.y-n,t.x-i);return t.setTo(i+o*Math.cos(a),n+o*Math.sin(a))},e.Point.centroid=function(t,i){if("undefined"==typeof i&&(i=new e.Point),"[object Array]"!==Object.prototype.toString.call(t))throw new Error("Phaser.Point. Parameter 'points' must be an array");var n=t.length;if(1>n)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(1===n)return i.copyFrom(t[0]),i;for(var s=0;n>s;s++)e.Point.add(i,t[s],i);return i.divide(n,n),i},e.Point.parse=function(t,i,n){i=i||"x",n=n||"y";var s=new e.Point;return t[i]&&(s.x=parseInt(t[i],10)),t[n]&&(s.y=parseInt(t[n],10)),s},PIXI.Point=e.Point,e.Rectangle=function(t,e,i,n){t=t||0,e=e||0,i=i||0,n=n||0,this.x=t,this.y=e,this.width=i,this.height=n},e.Rectangle.prototype={offset:function(t,e){return this.x+=t,this.y+=e,this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},scale:function(t,e){return"undefined"==typeof e&&(e=t),this.width*=t,this.height*=e,this},centerOn:function(t,e){return this.centerX=t,this.centerY=e,this},floor:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},inflate:function(t,i){return e.Rectangle.inflate(this,t,i)},size:function(t){return e.Rectangle.size(this,t)},clone:function(t){return e.Rectangle.clone(this,t)},contains:function(t,i){return e.Rectangle.contains(this,t,i)},containsRect:function(t){return e.Rectangle.containsRect(t,this)},equals:function(t){return e.Rectangle.equals(this,t)},intersection:function(t,i){return e.Rectangle.intersection(this,t,i)},intersects:function(t,i){return e.Rectangle.intersects(this,t,i)},intersectsRaw:function(t,i,n,s,r){return e.Rectangle.intersectsRaw(this,t,i,n,s,r)},union:function(t,i){return e.Rectangle.union(this,t,i)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}},Object.defineProperty(e.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}}),Object.defineProperty(e.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}}),Object.defineProperty(e.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<=this.y?this.height=0:this.height=t-this.y}}),Object.defineProperty(e.Rectangle.prototype,"bottomRight",{get:function(){return new e.Point(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}}),Object.defineProperty(e.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t}}),Object.defineProperty(e.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<=this.x?this.width=0:this.width=t-this.x}}),Object.defineProperty(e.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}}),Object.defineProperty(e.Rectangle.prototype,"perimeter",{get:function(){return 2*this.width+2*this.height}}),Object.defineProperty(e.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}}),Object.defineProperty(e.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}}),Object.defineProperty(e.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}}),Object.defineProperty(e.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}}),Object.defineProperty(e.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){t>=this.bottom?(this.height=0,this.y=t):this.height=this.bottom-t}}),Object.defineProperty(e.Rectangle.prototype,"topLeft",{get:function(){return new e.Point(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}}),Object.defineProperty(e.Rectangle.prototype,"topRight",{get:function(){return new e.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x,this.y=t.y}}),Object.defineProperty(e.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){t===!0&&this.setTo(0,0,0,0)}}),e.Rectangle.prototype.constructor=e.Rectangle,e.Rectangle.inflate=function(t,e,i){return t.x-=e,t.width+=2*e,t.y-=i,t.height+=2*i,t},e.Rectangle.inflatePoint=function(t,i){return e.Rectangle.inflate(t,i.x,i.y)},e.Rectangle.size=function(t,i){return"undefined"==typeof i||null===i?i=new e.Point(t.width,t.height):i.setTo(t.width,t.height),i},e.Rectangle.clone=function(t,i){return"undefined"==typeof i||null===i?i=new e.Rectangle(t.x,t.y,t.width,t.height):i.setTo(t.x,t.y,t.width,t.height),i},e.Rectangle.contains=function(t,e,i){return t.width<=0||t.height<=0?!1:e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom},e.Rectangle.containsRaw=function(t,e,i,n,s,r){return s>=t&&t+i>s&&r>=e&&e+n>r},e.Rectangle.containsPoint=function(t,i){return e.Rectangle.contains(t,i.x,i.y)},e.Rectangle.containsRect=function(t,e){return t.volume>e.volume?!1:t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom},e.Rectangle.equals=function(t,e){return t.x==e.x&&t.y==e.y&&t.width==e.width&&t.height==e.height},e.Rectangle.intersection=function(t,i,n){return"undefined"==typeof n&&(n=new e.Rectangle),e.Rectangle.intersects(t,i)&&(n.x=Math.max(t.x,i.x),n.y=Math.max(t.y,i.y),n.width=Math.min(t.right,i.right)-n.x,n.height=Math.min(t.bottom,i.bottom)-n.y),n},e.Rectangle.intersects=function(t,e){return t.width<=0||t.height<=0||e.width<=0||e.height<=0?!1:!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)},e.Rectangle.intersectsRaw=function(t,e,i,n,s,r){return"undefined"==typeof r&&(r=0),!(e>t.right+r||i<t.left-r||n>t.bottom+r||s<t.top-r)},e.Rectangle.union=function(t,i,n){return"undefined"==typeof n&&(n=new e.Rectangle),n.setTo(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.right,i.right)-Math.min(t.left,i.left),Math.max(t.bottom,i.bottom)-Math.min(t.top,i.top))},e.Rectangle.aabb=function(t,i){"undefined"==typeof i&&(i=new e.Rectangle);var n=Number.MIN_VALUE,s=Number.MAX_VALUE,r=Number.MIN_VALUE,o=Number.MAX_VALUE;return t.forEach(function(t){t.x>n&&(n=t.x),t.x<s&&(s=t.x),t.y>r&&(r=t.y),t.y<o&&(o=t.y)}),i.setTo(s,o,n-s,r-o),i},PIXI.Rectangle=e.Rectangle,PIXI.EmptyRectangle=new e.Rectangle(0,0,0,0),e.Line=function(t,i,n,s){t=t||0,i=i||0,n=n||0,s=s||0,this.start=new e.Point(t,i),this.end=new e.Point(n,s)},e.Line.prototype={setTo:function(t,e,i,n){return this.start.setTo(t,e),this.end.setTo(i,n),this},fromSprite:function(t,e,i){return"undefined"==typeof i&&(i=!1),i?this.setTo(t.center.x,t.center.y,e.center.x,e.center.y):this.setTo(t.x,t.y,e.x,e.y)},intersects:function(t,i,n){return e.Line.intersectsPoints(this.start,this.end,t.start,t.end,i,n)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x),n=Math.max(this.start.x,this.end.x),s=Math.min(this.start.y,this.end.y),r=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&t>=i&&n>=t&&e>=s&&r>=e},coordinatesOnLine:function(t,e){"undefined"==typeof t&&(t=1),"undefined"==typeof e&&(e=[]);var i=Math.round(this.start.x),n=Math.round(this.start.y),s=Math.round(this.end.x),r=Math.round(this.end.y),o=Math.abs(s-i),a=Math.abs(r-n),h=s>i?1:-1,l=r>n?1:-1,c=o-a;e.push([i,n]);for(var u=1;i!=s||n!=r;){var d=c<<1;d>-a&&(c-=a,i+=h),o>d&&(c+=o,n+=l),u%t===0&&e.push([i,n]),u++}return e},clone:function(t){return"undefined"==typeof t||null===t?t=new e.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}},Object.defineProperty(e.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}}),Object.defineProperty(e.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}}),Object.defineProperty(e.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}}),Object.defineProperty(e.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}}),Object.defineProperty(e.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(e.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(e.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}}),Object.defineProperty(e.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}}),Object.defineProperty(e.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}}),Object.defineProperty(e.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}}),Object.defineProperty(e.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}}),Object.defineProperty(e.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}}),e.Line.intersectsPoints=function(t,i,n,s,r,o){"undefined"==typeof r&&(r=!0),"undefined"==typeof o&&(o=new e.Point);var a=i.y-t.y,h=s.y-n.y,l=t.x-i.x,c=n.x-s.x,u=i.x*t.y-t.x*i.y,d=s.x*n.y-n.x*s.y,A=a*c-h*l;if(0===A)return null;if(o.x=(l*d-c*u)/A,o.y=(h*u-a*d)/A,r){var p=(s.y-n.y)*(i.x-t.x)-(s.x-n.x)*(i.y-t.y),m=((s.x-n.x)*(t.y-n.y)-(s.y-n.y)*(t.x-n.x))/p,f=((i.x-t.x)*(t.y-n.y)-(i.y-t.y)*(t.x-n.x))/p;return m>=0&&1>=m&&f>=0&&1>=f?o:null}return o},e.Line.intersects=function(t,i,n,s){return e.Line.intersectsPoints(t.start,t.end,i.start,i.end,n,s)},e.Ellipse=function(t,i,n,s){this.type=e.ELLIPSE,t=t||0,i=i||0,n=n||0,s=s||0,this.x=t,this.y=i,this.width=n,this.height=s},e.Ellipse.prototype={setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},getBounds:function(){return new e.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},clone:function(t){return"undefined"==typeof t||null===t?t=new e.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,i){return e.Ellipse.contains(this,t,i)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}},e.Ellipse.prototype.constructor=e.Ellipse,Object.defineProperty(e.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}}),Object.defineProperty(e.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){t<this.x?this.width=0:this.width=this.x+t}}),Object.defineProperty(e.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}}),Object.defineProperty(e.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){t<this.y?this.height=0:this.height=this.y+t}}),Object.defineProperty(e.Ellipse.prototype,"empty",{get:function(){return 0===this.width||0===this.height},set:function(t){t===!0&&this.setTo(0,0,0,0)}}),e.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0)return!1;var n=(e-t.x)/t.width-.5,s=(i-t.y)/t.height-.5;return n*=n,s*=s,.25>n+s},e.Ellipse.prototype.getBounds=function(){return new e.Rectangle(this.x,this.y,this.width,this.height)},PIXI.Ellipse=e.Ellipse,e.Polygon=function(t){if(this.type=e.POLYGON,t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof e.Point){for(var i=[],n=0,s=t.length;s>n;n++)i.push(t[n].x,t[n].y);t=i}this.points=t,this.closed=!0},e.Polygon.prototype={clone:function(t){var i=this.points.slice();return"undefined"==typeof t||null===t?t=new e.Polygon(i):t.setTo(i),t},contains:function(t,e){for(var i=!1,n=this.points.length/2,s=0,r=n-1;n>s;r=s++){var o=this.points[2*s].x,a=this.points[2*s+1].y,h=this.points[2*r].x,l=this.points[2*r+1].y,c=a>e!=l>e&&(h-o)*(e-a)/(l-a)+o>t;c&&(i=!i)}return i},setTo:function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),t[0]instanceof e.Point){for(var i=[],n=0,s=t.length;s>n;n++)i.push(t[n].x,t[n].y);t=i}return this.points=t,this}},e.Polygon.prototype.constructor=e.Polygon,Object.defineProperty(e.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),"number"==typeof t[0]){for(var i=[],n=0,s=t.length;s>n;n+=2)i.push(new e.Point(t[n],t[n+1]));t=i}this._points=t}}),Object.defineProperty(e.Polygon.prototype,"area",{get:function(){var t,e,i,n,s,r=Number.MAX_VALUE,o=0;for(s=0;s<this.points.length;s++)this.points[s].y<r&&(r=this.points[s].y);for(s=0;s<this.points.length;s++)t=this.points[s],e=s===this.points.length-1?this.points[0]:this.points[s+1],i=(t.y-r+(e.y-r))/2,n=t.x-e.x,o+=i*n;return o}}),PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=PIXI.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Graphics.prototype.constructor=PIXI.Graphics,Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),PIXI.Graphics.prototype.lineStyle=function(t,e,i){if(this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=arguments.length<3?1:i,this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},PIXI.Graphics.prototype.moveTo=function(t,e){return this.drawShape(new PIXI.Polygon([t,e])),this},PIXI.Graphics.prototype.lineTo=function(t,e){return this.currentPath.shape.points.push(t,e),this.dirty=!0,this},PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,n){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var s,r,o=20,a=this.currentPath.shape.points;0===a.length&&this.moveTo(0,0);for(var h=a[a.length-2],l=a[a.length-1],c=0,u=1;o>=u;u++)c=u/o,s=h+(t-h)*c,r=l+(e-l)*c,a.push(s+(t+(i-t)*c-s)*c,r+(e+(n-e)*c-r)*c);return this.dirty=!0,this},PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,n,s,r){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var o,a,h,l,c,u=20,d=this.currentPath.shape.points,A=d[d.length-2],p=d[d.length-1],m=0,f=1;u>=f;f++)m=f/u,o=1-m,a=o*o,h=a*o,l=m*m,c=l*m,d.push(h*A+3*a*m*t+3*o*l*i+c*s,h*p+3*a*m*e+3*o*l*n+c*r);return this.dirty=!0,this},PIXI.Graphics.prototype.arcTo=function(t,e,i,n,s){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[t,e]):this.moveTo(t,e),0===this.currentPath.length&&this.moveTo(t,e);var r=this.currentPath,o=r[r.length-2],a=r[r.length-1],h=a-e,l=o-t,c=n-e,u=i-t,d=Math.abs(h*u-l*c);if(1e-8>d||0===s)r.push(t,e);else{var A=h*h+l*l,p=c*c+u*u,m=h*c+l*u,f=s*Math.sqrt(A)/d,g=s*Math.sqrt(p)/d,_=f*m/A,y=g*m/p,v=f*u+g*l,T=f*c+g*h,b=l*(g+_),w=h*(g+_),x=u*(f+y),C=c*(f+y),S=Math.atan2(w-T,b-v),P=Math.atan2(C-T,x-v);this.arc(v+t,T+e,s,S,P,l*c>u*h)}return this.dirty=!0,this},PIXI.Graphics.prototype.arc=function(t,e,i,n,s,r){var o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,h=this.currentPath.shape.points;if((0!==h.length&&h[h.length-2]!==o||h[h.length-1]!==a)&&(this.moveTo(o,a),h=this.currentPath.shape.points),n===s)return this;!r&&n>=s?s+=2*Math.PI:r&&s>=n&&(n+=2*Math.PI);var l=r?-1*(n-s):s-n,c=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var u=l/(2*c),d=2*u,A=Math.cos(u),p=Math.sin(u),m=c-1,f=m%1/m,g=0;m>=g;g++){var _=g+f*g,y=u+n+d*_,v=Math.cos(y),T=-Math.sin(y);h.push((A*v+p*T)*i+t,(A*-T+p*v)*i+e)}return this.dirty=!0,this},PIXI.Graphics.prototype.beginFill=function(t,e){return this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0===e?1:e,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},PIXI.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},PIXI.Graphics.prototype.drawRect=function(t,e,i,n){return this.drawShape(new PIXI.Rectangle(t,e,i,n)),this},PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,n,s){return this.drawShape({points:[t,e,i,n,s],type:PIXI.Graphics.RREC}),this},PIXI.Graphics.prototype.drawCircle=function(t,e,i){return this.drawShape(new PIXI.Circle(t,e,i)),this},PIXI.Graphics.prototype.drawEllipse=function(t,e,i,n){return this.drawShape(new PIXI.Ellipse(t,e,i,n)),this},PIXI.Graphics.prototype.drawPolygon=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments)),this.drawShape(new PIXI.Polygon(t)),this},PIXI.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},PIXI.Graphics.prototype.generateTexture=function(t,e){t=t||1;var i=this.getBounds(),n=new PIXI.CanvasBuffer(i.width*t,i.height*t),s=PIXI.Texture.fromCanvas(n.canvas,e);return s.baseTexture.resolution=t,n.context.scale(t,t),n.context.translate(-i.x,-i.y),PIXI.CanvasGraphics.renderGraphics(this,n.context),s},PIXI.Graphics.prototype._renderWebGL=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),PIXI.WebGLGraphics.renderGraphics(this,t),this.children.length){t.spriteBatch.start();for(var i=0,n=this.children.length;n>i;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter(),this._mask&&t.maskManager.popMask(this.mask,t),t.drawCount++,t.spriteBatch.start()}},PIXI.Graphics.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return(this.dirty||this.cachedSpriteDirty)&&(this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1),this._cachedSprite.alpha=this.alpha,void PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);var e=t.context,i=this.worldTransform;this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t);var n=t.resolution;e.setTransform(i.a*n,i.b*n,i.c*n,i.d*n,i.tx*n,i.ty*n),PIXI.CanvasGraphics.renderGraphics(this,e);for(var s=0,r=this.children.length;r>s;s++)this.children[s]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.Graphics.prototype.getBounds=function(t){this.dirty&&(this.updateBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var e=this._bounds,i=e.x,n=e.width+e.x,s=e.y,r=e.height+e.y,o=t||this.worldTransform,a=o.a,h=o.c,l=o.b,c=o.d,u=o.tx,d=o.ty,A=a*n+l*r+u,p=c*r+h*n+d,m=a*i+l*r+u,f=c*r+h*i+d,g=a*i+l*s+u,_=c*s+h*i+d,y=a*n+l*s+u,v=c*s+h*n+d,T=A,b=p,w=A,x=p;return w=w>m?m:w,w=w>g?g:w,w=w>y?y:w,x=x>f?f:x,x=x>_?_:x,x=x>v?v:x,T=m>T?m:T,T=g>T?g:T,T=y>T?y:T,b=f>b?f:b,b=_>b?_:b,b=v>b?v:b,e.x=w,e.width=T-w,e.y=x,e.height=b-x,e},PIXI.Graphics.prototype.updateBounds=function(){var t=1/0,e=-(1/0),i=1/0,n=-(1/0);if(this.graphicsData.length)for(var s,r,o,a,h,l,c=0;c<this.graphicsData.length;c++){var u=this.graphicsData[c],d=u.type,A=u.lineWidth;if(s=u.shape,d===PIXI.Graphics.RECT||d===PIXI.Graphics.RRECT)o=s.x-A/2,a=s.y-A/2,h=s.width+A,l=s.height+A,t=t>o?o:t,e=o+h>e?o+h:e,i=i>a?a:i,n=a+l>n?a+l:n;else if(d===PIXI.Graphics.CIRC)o=s.x,a=s.y,h=s.radius+A/2,l=s.radius+A/2,t=t>o-h?o-h:t,e=o+h>e?o+h:e,i=i>a-l?a-l:i,n=a+l>n?a+l:n;else if(d===PIXI.Graphics.ELIP)o=s.x,a=s.y,h=s.width+A/2,l=s.height+A/2,t=t>o-h?o-h:t,e=o+h>e?o+h:e,i=i>a-l?a-l:i,n=a+l>n?a+l:n;else{r=s.points;for(var p=0;p<r.length;p+=2)o=r[p],a=r[p+1],t=t>o-A?o-A:t,e=o+A>e?o+A:e,i=i>a-A?a-A:i,n=a+A>n?a+A:n}}else t=0,e=0,i=0,n=0;var m=this.boundsPadding,f=this._bounds;f.x=t-m,f.width=e-t+2*m,f.y=i-m,f.height=n-i+2*m},PIXI.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(t.width,t.height);else{var e=new PIXI.CanvasBuffer(t.width,t.height),i=PIXI.Texture.fromCanvas(e.canvas);this._cachedSprite=new PIXI.Sprite(i),this._cachedSprite.buffer=e,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(t.x/t.width),this._cachedSprite.anchor.y=-(t.y/t.height),this._cachedSprite.buffer.context.translate(-t.x,-t.y),this.worldAlpha=1,PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite,e=t.texture,i=t.buffer.canvas;e.baseTexture.width=i.width,e.baseTexture.height=i.height,e.crop.width=e.frame.width=i.width,e.crop.height=e.frame.height=i.height,t._width=i.width,t._height=i.height,e.baseTexture.dirty()},PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},PIXI.Graphics.prototype.drawShape=function(t){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var e=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);return this.graphicsData.push(e),e.type===PIXI.Graphics.POLY&&(e.shape.closed=this.filling,this.currentPath=e),this.dirty=!0,e},PIXI.GraphicsData=function(t,e,i,n,s,r,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=n,this.fillAlpha=s,this.fill=r,this.shape=o,this.type=o.type},PIXI.Graphics.POLY=0,PIXI.Graphics.RECT=1,PIXI.Graphics.CIRC=2,PIXI.Graphics.ELIP=3,PIXI.Graphics.RREC=4,PIXI.Polygon.prototype.type=PIXI.Graphics.POLY,PIXI.Rectangle.prototype.type=PIXI.Graphics.RECT,PIXI.Circle.prototype.type=PIXI.Graphics.CIRC,PIXI.Ellipse.prototype.type=PIXI.Graphics.ELIP,e.Camera=function(game,t,i,n,s,r){this.game=game,this.world=game.world,this.id=0,this.view=new e.Rectangle(i,n,s,r),this.screenView=new e.Rectangle(i,n,s,r),this.bounds=new e.Rectangle(i,n,s,r),this.deadzone=null,this.visible=!0,this.roundPx=!0,this.atLimit={x:!1,y:!1},this.target=null,this._edge=0,this._position=new e.Point,this.displayObject=null,this.scale=null,this._targetPosition=new e.Point},e.Camera.FOLLOW_LOCKON=0,e.Camera.FOLLOW_PLATFORMER=1,e.Camera.FOLLOW_TOPDOWN=2,e.Camera.FOLLOW_TOPDOWN_TIGHT=3,e.Camera.prototype={follow:function(t,i){"undefined"==typeof i&&(i=e.Camera.FOLLOW_LOCKON),this.target=t;var n;switch(i){case e.Camera.FOLLOW_PLATFORMER:var s=this.width/8,r=this.height/3;this.deadzone=new e.Rectangle((this.width-s)/2,(this.height-r)/2-.25*r,s,r);break;case e.Camera.FOLLOW_TOPDOWN:n=Math.max(this.width,this.height)/4,this.deadzone=new e.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case e.Camera.FOLLOW_TOPDOWN_TIGHT:n=Math.max(this.width,this.height)/8,this.deadzone=new e.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case e.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},update:function(){this.target&&this.updateTarget(),this.bounds&&this.checkBounds(),this.roundPx&&this.view.floor(),this.displayObject.position.x=-this.view.x,this.displayObject.position.y=-this.view.y},updateTarget:function(){this._targetPosition.copyFrom(this.target).multiply(this.target.parent?this.target.parent.worldTransform.a:1,this.target.parent?this.target.parent.worldTransform.d:1),this.deadzone?(this._edge=this._targetPosition.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this._targetPosition.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this._targetPosition.x-this.deadzone.right),this._edge=this._targetPosition.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this._targetPosition.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this._targetPosition.y-this.deadzone.bottom)):(this.view.x=this._targetPosition.x-this.view.halfWidth,this.view.y=this._targetPosition.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1,this.atLimit.y=!1,this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x),this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width),this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top),this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(t,e){this.view.x=t,this.view.y=e,this.bounds&&this.checkBounds()},setSize:function(t,e){this.view.width=t,this.view.height=e},reset:function(){this.target=null,this.view.x=0,this.view.y=0}},e.Camera.prototype.constructor=e.Camera,Object.defineProperty(e.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t,this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(t){"undefined"!=typeof t.x&&(this.view.x=t.x),"undefined"!=typeof t.y&&(this.view.y=t.y),this.bounds&&this.checkBounds()}}),Object.defineProperty(e.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}}),Object.defineProperty(e.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}}),e.State=function(){this.game=null,this.add=null,this.make=null,this.camera=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.sound=null,this.scale=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.particles=null,this.physics=null,this.rnd=null},e.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}},e.State.prototype.constructor=e.State,e.StateManager=function(game,t){this.game=game,this.states={},this._pendingState=null,"undefined"!=typeof t&&null!==t&&(this._pendingState=t),this._clearWorld=!1,this._clearCache=!1,this._created=!1,this._args=[],this.current="",this.onInitCallback=null,this.onPreloadCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPreRenderCallback=null,this.onLoadUpdateCallback=null,this.onLoadRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.onShutDownCallback=null},e.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this),this.game.onResume.add(this.resume,this),
this.game.load.onLoadComplete.add(this.loadComplete,this),null!==this._pendingState&&"string"!=typeof this._pendingState&&this.add("default",this._pendingState,!0)},add:function(t,i,n){"undefined"==typeof n&&(n=!1);var s;return i instanceof e.State?s=i:"object"==typeof i?(s=i,s.game=this.game):"function"==typeof i&&(s=new i(this.game)),this.states[t]=s,n&&(this.game.isBooted?this.start(t):this._pendingState=t),s},remove:function(t){this.current===t&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null),delete this.states[t]},start:function(t,e,i){"undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=!1),this.checkState(t)&&(this._pendingState=t,this._clearWorld=e,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(t,e){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!1),this._pendingState=this.current,this._clearWorld=t,this._clearCache=e,arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){if(this.clearCurrentState(),this.setCurrentState(this._pendingState),this.current!==this._pendingState)return;this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext,this.game),0===this.game.load.totalQueuedFiles()&&0===this.game.load.totalQueuedPacks()?this.loadComplete():this.game.load.start()):this.loadComplete()}},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy()))},checkState:function(t){if(this.states[t]){var e=!1;return this.states[t].preload&&(e=!0),this.states[t].create&&(e=!0),this.states[t].update&&(e=!0),this.states[t].render&&(e=!0),e===!1?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+t),!1},link:function(t){this.states[t].game=this.game,this.states[t].add=this.game.add,this.states[t].make=this.game.make,this.states[t].camera=this.game.camera,this.states[t].cache=this.game.cache,this.states[t].input=this.game.input,this.states[t].load=this.game.load,this.states[t].math=this.game.math,this.states[t].sound=this.game.sound,this.states[t].scale=this.game.scale,this.states[t].state=this,this.states[t].stage=this.game.stage,this.states[t].time=this.game.time,this.states[t].tweens=this.game.tweens,this.states[t].world=this.game.world,this.states[t].particles=this.game.particles,this.states[t].rnd=this.game.rnd,this.states[t].physics=this.game.physics},unlink:function(t){this.states[t]&&(this.states[t].game=null,this.states[t].add=null,this.states[t].make=null,this.states[t].camera=null,this.states[t].cache=null,this.states[t].input=null,this.states[t].load=null,this.states[t].math=null,this.states[t].sound=null,this.states[t].scale=null,this.states[t].state=null,this.states[t].stage=null,this.states[t].time=null,this.states[t].tweens=null,this.states[t].world=null,this.states[t].particles=null,this.states[t].rnd=null,this.states[t].physics=null)},setCurrentState:function(t){this.callbackContext=this.states[t],this.link(t),this.onInitCallback=this.states[t].init||this.dummy,this.onPreloadCallback=this.states[t].preload||null,this.onLoadRenderCallback=this.states[t].loadRender||null,this.onLoadUpdateCallback=this.states[t].loadUpdate||null,this.onCreateCallback=this.states[t].create||null,this.onUpdateCallback=this.states[t].update||null,this.onPreRenderCallback=this.states[t].preRender||null,this.onRenderCallback=this.states[t].render||null,this.onResizeCallback=this.states[t].resize||null,this.onPausedCallback=this.states[t].paused||null,this.onResumedCallback=this.states[t].resumed||null,this.onPauseUpdateCallback=this.states[t].pauseUpdate||null,this.onShutDownCallback=this.states[t].shutdown||this.dummy,this.current=t,this._created=!1,this.onInitCallback.apply(this.callbackContext,this._args),t===this._pendingState&&(this._args=[])},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},resize:function(t,e){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,t,e)},render:function(){this._created&&this.onRenderCallback?(this.game.renderType===e.CANVAS&&(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0)),this.onRenderCallback.call(this.callbackContext,this.game),this.game.renderType===e.CANVAS&&this.game.context.restore()):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState(),this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null,this.game=null,this.states={},this._pendingState=null}},e.StateManager.prototype.constructor=e.StateManager,e.LinkedList=function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.total=0},e.LinkedList.prototype={add:function(t){return 0===this.total&&null===this.first&&null===this.last?(this.first=t,this.last=t,this.next=t,t.prev=this,this.total++,t):(this.last.next=t,t.prev=this.last,this.last=t,this.total++,t)},reset:function(){this.first=null,this.last=null,this.next=null,this.prev=null,this.total=0},remove:function(t){return 1===this.total?(this.reset(),void(t.next=t.prev=null)):(t===this.first?this.first=this.first.next:t===this.last&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=t.prev=null,null===this.first&&(this.last=null),void this.total--)},callAll:function(t){if(this.first&&this.last){var entity=this.first;do entity&&entity[t]&&entity[t].call(entity),entity=entity.next;while(entity!=this.last.next)}}},e.LinkedList.prototype.constructor=e.LinkedList,e.ArrayList=function(){this.total=0,this.position=0,this.list=[]},e.ArrayList.prototype={add:function(t){return this.exists(t)||(this.list.push(t),this.total++),t},getIndex:function(t){return this.list.indexOf(t)},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0,this.total=0},remove:function(t){var e=this.list.indexOf(t);return e>-1?(this.list.splice(e,1),this.total--,t):void 0},setAll:function(t,e){for(var i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&(this.list[i][t]=e)},callAll:function(t){for(var e=Array.prototype.splice.call(arguments,1),i=this.list.length;i--;)this.list[i]&&this.list[i][t]&&this.list[i][t].apply(this.list[i],e)}},Object.defineProperty(e.ArrayList.prototype,"first",{get:function(){return this.position=0,this.total>0?this.list[0]:null}}),Object.defineProperty(e.ArrayList.prototype,"next",{get:function(){return this.position<this.total?(this.position++,this.list[this.position]):null}}),e.ArrayList.prototype.constructor=e.ArrayList,e.Signal=function(){this._bindings=[],this._prevParams=null;var t=this;this.dispatch=function(){e.Signal.prototype.dispatch.apply(t,arguments)}},e.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(t,e){if("function"!=typeof t)throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))},_registerListener:function(t,i,n,s){var r,o=this._indexOfListener(t,n);if(-1!==o){if(r=this._bindings[o],r.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.")}else r=new e.SignalBinding(this,t,i,n,s),this._addBinding(r);return this.memorize&&this._prevParams&&r.execute(this._prevParams),r},_addBinding:function(t){var e=this._bindings.length;do e--;while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){for(var i,n=this._bindings.length;n--;)if(i=this._bindings[n],i._listener===t&&i.context===e)return n;return-1},has:function(t,e){return-1!==this._indexOfListener(t,e)},add:function(t,e,i){return this.validateListener(t,"add"),this._registerListener(t,!1,e,i)},addOnce:function(t,e,i){return this.validateListener(t,"addOnce"),this._registerListener(t,!0,e,i)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),t},removeAll:function(t){"undefined"==typeof t&&(t=null);for(var e=this._bindings.length;e--;)t?this._bindings[e].context===t&&(this._bindings[e]._destroy(),this._bindings.splice(e,1)):this._bindings[e]._destroy();t||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var t,e=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=e),i){t=this._bindings.slice(),this._shouldPropagate=!0;do i--;while(t[i]&&this._shouldPropagate&&t[i].execute(e)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},e.Signal.prototype.constructor=e.Signal,e.SignalBinding=function(t,e,i,n,s){this._listener=e,this._isOnce=i,this.context=n,this._signal=t,this._priority=s||0},e.SignalBinding.prototype={active:!0,params:null,execute:function(t){var e,i;return this.active&&this._listener&&(i=this.params?this.params.concat(t):t,e=this._listener.apply(this.context,i),this._isOnce&&this.detach()),e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},e.SignalBinding.prototype.constructor=e.SignalBinding,e.Filter=function(game,t,i){this.game=game,this.type=e.WEBGL_FILTER,this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.prevPoint=new e.Point;var n=new Date;if(this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[n.getFullYear(),n.getMonth(),n.getDate(),60*n.getHours()*60+60*n.getMinutes()+n.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}},t)for(var s in t)this.uniforms[s]=t[s];this.fragmentSrc=i||[]},e.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t,this.uniforms.resolution.value.y=e},update:function(t){if("undefined"!=typeof t){var e=t.x/this.game.width,i=1-t.y/this.game.height;(e!==this.prevPoint.x||i!==this.prevPoint.y)&&(this.uniforms.mouse.value.x=e.toFixed(2),this.uniforms.mouse.value.y=i.toFixed(2),this.prevPoint.set(e,i))}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}},e.Filter.prototype.constructor=e.Filter,Object.defineProperty(e.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}}),Object.defineProperty(e.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}}),e.Plugin=function(game,t){"undefined"==typeof t&&(t=null),this.game=game,this.parent=t,this.active=!1,this.visible=!1,this.hasPreUpdate=!1,this.hasUpdate=!1,this.hasPostUpdate=!1,this.hasRender=!1,this.hasPostRender=!1},e.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null,this.parent=null,this.active=!1,this.visible=!1}},e.Plugin.prototype.constructor=e.Plugin,e.PluginManager=function(game){this.game=game,this.plugins=[],this._len=0,this._i=0},e.PluginManager.prototype={add:function(t){var e=Array.prototype.splice.call(arguments,1),i=!1;return"function"==typeof t?t=new t(this.game,this):(t.game=this.game,t.parent=this),"function"==typeof t.preUpdate&&(t.hasPreUpdate=!0,i=!0),"function"==typeof t.update&&(t.hasUpdate=!0,i=!0),"function"==typeof t.postUpdate&&(t.hasPostUpdate=!0,i=!0),"function"==typeof t.render&&(t.hasRender=!0,i=!0),"function"==typeof t.postRender&&(t.hasPostRender=!0,i=!0),i?((t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate)&&(t.active=!0),(t.hasRender||t.hasPostRender)&&(t.visible=!0),this._len=this.plugins.push(t),"function"==typeof t.init&&t.init.apply(t,e),t):null},remove:function(t){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===t)return t.destroy(),this.plugins.splice(this._i,1),void this._len--},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0,this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll(),this.game=null}},e.PluginManager.prototype.constructor=e.PluginManager,e.Stage=function(game){this.game=game,PIXI.Stage.call(this,0),this.name="_stage_root",this.interactive=!1,this.disableVisibilityChange=!1,this.exists=!0,this.currentRenderOrderID=0,this._hiddenVar="hidden",this._backgroundColor=0,game.config&&this.parseConfig(game.config)},e.Stage.prototype=Object.create(PIXI.Stage.prototype),e.Stage.prototype.constructor=e.Stage,e.Stage.prototype.parseConfig=function(t){t.disableVisibilityChange&&(this.disableVisibilityChange=t.disableVisibilityChange),t.backgroundColor&&(this.backgroundColor=t.backgroundColor)},e.Stage.prototype.boot=function(){e.Canvas.getOffset(this.game.canvas,this.offset);var t=this;this._onChange=function(e){return t.visibilityChange(e)},e.Canvas.setUserSelect(this.game.canvas,"none"),e.Canvas.setTouchAction(this.game.canvas,"none"),this.checkVisibility()},e.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=this.children.length,e=0;t>e;e++)this.children[e].preUpdate()},e.Stage.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},e.Stage.prototype.postUpdate=function(){if(this.game.world.camera.target){this.game.world.camera.target.postUpdate(),this.game.world.camera.update();for(var t=this.children.length;t--;)this.children[t]!==this.game.world.camera.target&&this.children[t].postUpdate()}else{this.game.world.camera.update();for(var t=this.children.length;t--;)this.children[t].postUpdate()}},e.Stage.prototype.checkVisibility=function(){void 0!==document.webkitHidden?this._hiddenVar="webkitvisibilitychange":void 0!==document.mozHidden?this._hiddenVar="mozvisibilitychange":void 0!==document.msHidden?this._hiddenVar="msvisibilitychange":void 0!==document.hidden?this._hiddenVar="visibilitychange":this._hiddenVar=null,this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=this._onChange,window.onpageshow=this._onChange,window.onblur=this._onChange,window.onfocus=this._onChange;var t=this;this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){e.Stage.prototype.visibilityChange.call(t,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){e.Stage.prototype.visibilityChange.call(t,{type:"resume"})}))},e.Stage.prototype.visibilityChange=function(t){return"pagehide"===t.type||"blur"===t.type||"pageshow"===t.type||"focus"===t.type?void("pagehide"===t.type||"blur"===t.type?this.game.focusLoss(t):("pageshow"===t.type||"focus"===t.type)&&this.game.focusGain(t)):void(this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?this.game.gamePaused(t):this.game.gameResumed(t)))},e.Stage.prototype.setBackgroundColor=function(t){if("string"==typeof t){var i=e.Color.hexToColor(t);this._backgroundColor=e.Color.getColor(i.r,i.g,i.b)}else{var i=e.Color.getRGB(t);this._backgroundColor=t}this.backgroundColorSplit=[i.r/255,i.g/255,i.b/255],this.backgroundColorString=e.Color.RGBtoString(i.r,i.g,i.b,255,"#")},e.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1),window.onpagehide=null,window.onpageshow=null,window.onblur=null,window.onfocus=null},Object.defineProperty(e.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this.game.transparent||this.setBackgroundColor(t)}}),Object.defineProperty(e.Stage.prototype,"smoothed",{get:function(){return!PIXI.scaleModes.LINEAR},set:function(t){t?PIXI.scaleModes.LINEAR=0:PIXI.scaleModes.LINEAR=1}}),e.Group=function(game,t,i,n,s,r){"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!1),"undefined"==typeof r&&(r=e.Physics.ARCADE),this.game=game,"undefined"==typeof t&&(t=game.world),this.name=i||"group",PIXI.DisplayObjectContainer.call(this),n?this.game.stage.addChild(this):t&&t.addChild(this),this.z=0,this.type=e.GROUP,this.alive=!0,this.exists=!0,this.ignoreDestroy=!1,this.classType=e.Sprite,this.scale=new e.Point(1,1),this.cursor=null,this.cameraOffset=new e.Point,this.enableBody=s,this.enableBodyDebug=!1,this.physicsBodyType=r,this.onDestroy=new e.Signal,this._sortProperty="z",this._cache=[0,0,0,0,1,0,1,0,0,0]},e.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.Group.prototype.constructor=e.Group,e.Group.RETURN_NONE=0,e.Group.RETURN_TOTAL=1,e.Group.RETURN_CHILD=2,e.Group.SORT_ASCENDING=-1,e.Group.SORT_DESCENDING=1,e.Group.prototype.add=function(t,e){return"undefined"==typeof e&&(e=!1),t.parent!==this&&(this.enableBody&&this.game.physics.enable(t,this.physicsBodyType),this.addChild(t),t.z=this.children.length,!e&&t.events&&t.events.onAddedToGroup.dispatch(t,this),null===this.cursor&&(this.cursor=t)),t},e.Group.prototype.addMultiple=function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return t},e.Group.prototype.addAt=function(t,e,i){return"undefined"==typeof i&&(i=!1),t.parent!==this&&(this.enableBody&&this.game.physics.enable(t,this.physicsBodyType),this.addChildAt(t,e),this.updateZ(),!i&&t.events&&t.events.onAddedToGroup.dispatch(t,this),null===this.cursor&&(this.cursor=t)),t},e.Group.prototype.getAt=function(t){return 0>t||t>=this.children.length?-1:this.getChildAt(t)},e.Group.prototype.create=function(t,e,i,n,s){"undefined"==typeof s&&(s=!0);var r=new this.classType(this.game,t,e,i,n);return this.enableBody&&this.game.physics.enable(r,this.physicsBodyType,this.enableBodyDebug),r.exists=s,r.visible=s,r.alive=s,this.addChild(r),r.z=this.children.length,r.events&&r.events.onAddedToGroup.dispatch(r,this),null===this.cursor&&(this.cursor=r),r},e.Group.prototype.createMultiple=function(t,e,i,n){"undefined"==typeof n&&(n=!1);for(var s=0;t>s;s++)this.create(0,0,e,i,n)},e.Group.prototype.updateZ=function(){for(var t=this.children.length;t--;)this.children[t].z=t},e.Group.prototype.resetCursor=function(t){return"undefined"==typeof t&&(t=0),t>this.children.length-1&&(t=0),this.cursor?(this._cache[8]=t,this.cursor=this.children[this._cache[8]],this.cursor):void 0},e.Group.prototype.next=function(){return this.cursor?(this._cache[8]>=this.children.length-1?this._cache[8]=0:this._cache[8]++,this.cursor=this.children[this._cache[8]],this.cursor):void 0},e.Group.prototype.previous=function(){return this.cursor?(0===this._cache[8]?this._cache[8]=this.children.length-1:this._cache[8]--,this.cursor=this.children[this._cache[8]],this.cursor):void 0},e.Group.prototype.swap=function(t,e){this.swapChildren(t,e),this.updateZ()},e.Group.prototype.bringToTop=function(t){return t.parent===this&&this.getIndex(t)<this.children.length&&(this.remove(t,!1,!0),this.add(t,!0)),t},e.Group.prototype.sendToBack=function(t){return t.parent===this&&this.getIndex(t)>0&&(this.remove(t,!1,!0),this.addAt(t,0,!0)),t},e.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t),i=this.getAt(e+1);i&&this.swap(t,i)}return t},e.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t),i=this.getAt(e-1);i&&this.swap(t,i)}return t},e.Group.prototype.xy=function(t,e,i){return 0>t||t>this.children.length?-1:(this.getChildAt(t).x=e,void(this.getChildAt(t).y=i))},e.Group.prototype.reverse=function(){this.children.reverse(),this.updateZ()},e.Group.prototype.getIndex=function(t){return this.children.indexOf(t)},e.Group.prototype.replace=function(t,i){var n=this.getIndex(t);if(-1!==n){void 0!==i.parent&&(i.events.onRemovedFromGroup.dispatch(i,this),i.parent.removeChild(i),i.parent instanceof e.Group&&i.parent.updateZ());var s=t;return this.remove(s),this.addAt(i,n),s}},e.Group.prototype.hasProperty=function(t,e){var i=e.length;return 1===i&&e[0]in t?!0:2===i&&e[0]in t&&e[1]in t[e[0]]?!0:3===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]?!0:4===i&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]?!0:!1},e.Group.prototype.setProperty=function(t,e,i,n,s){if("undefined"==typeof s&&(s=!1),n=n||0,!this.hasProperty(t,e)&&(!s||n>0))return!1;var r=e.length;return 1===r?0===n?t[e[0]]=i:1==n?t[e[0]]+=i:2==n?t[e[0]]-=i:3==n?t[e[0]]*=i:4==n&&(t[e[0]]/=i):2===r?0===n?t[e[0]][e[1]]=i:1==n?t[e[0]][e[1]]+=i:2==n?t[e[0]][e[1]]-=i:3==n?t[e[0]][e[1]]*=i:4==n&&(t[e[0]][e[1]]/=i):3===r?0===n?t[e[0]][e[1]][e[2]]=i:1==n?t[e[0]][e[1]][e[2]]+=i:2==n?t[e[0]][e[1]][e[2]]-=i:3==n?t[e[0]][e[1]][e[2]]*=i:4==n&&(t[e[0]][e[1]][e[2]]/=i):4===r&&(0===n?t[e[0]][e[1]][e[2]][e[3]]=i:1==n?t[e[0]][e[1]][e[2]][e[3]]+=i:2==n?t[e[0]][e[1]][e[2]][e[3]]-=i:3==n?t[e[0]][e[1]][e[2]][e[3]]*=i:4==n&&(t[e[0]][e[1]][e[2]][e[3]]/=i)),!0},e.Group.prototype.checkProperty=function(t,i,n,s){return"undefined"==typeof s&&(s=!1),!e.Utils.getProperty(t,i)&&s?!1:e.Utils.getProperty(t,i)!==n?!1:!0},e.Group.prototype.set=function(t,e,i,n,s,r,o){return"undefined"==typeof o&&(o=!1),e=e.split("."),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!1),(n===!1||n&&t.alive)&&(s===!1||s&&t.visible)?this.setProperty(t,e,i,r,o):void 0},e.Group.prototype.setAll=function(t,e,i,n,s,r){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof r&&(r=!1),t=t.split("."),s=s||0;for(var o=0,a=this.children.length;a>o;o++)(!i||i&&this.children[o].alive)&&(!n||n&&this.children[o].visible)&&this.setProperty(this.children[o],t,e,s,r)},e.Group.prototype.setAllChildren=function(t,i,n,s,r,o){"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!1),"undefined"==typeof o&&(o=!1),r=r||0;for(var a=0,h=this.children.length;h>a;a++)(!n||n&&this.children[a].alive)&&(!s||s&&this.children[a].visible)&&(this.children[a]instanceof e.Group?this.children[a].setAllChildren(t,i,n,s,r,o):this.setProperty(this.children[a],t.split("."),i,r,o))},e.Group.prototype.checkAll=function(t,e,i,n,s){"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!1);for(var r=0,o=this.children.length;o>r;r++)if((!i||i&&this.children[r].alive)&&(!n||n&&this.children[r].visible)&&!this.checkProperty(this.children[r],t,e,s))return!1;return!0},e.Group.prototype.addAll=function(t,e,i,n){this.setAll(t,e,i,n,1)},e.Group.prototype.subAll=function(t,e,i,n){this.setAll(t,e,i,n,2)},e.Group.prototype.multiplyAll=function(t,e,i,n){this.setAll(t,e,i,n,3)},e.Group.prototype.divideAll=function(t,e,i,n){this.setAll(t,e,i,n,4)},e.Group.prototype.callAllExists=function(t,e){for(var i=Array.prototype.splice.call(arguments,2),n=0,s=this.children.length;s>n;n++)this.children[n].exists===e&&this.children[n][t]&&this.children[n][t].apply(this.children[n],i)},e.Group.prototype.callbackFromArray=function(t,e,i){if(1==i){if(t[e[0]])return t[e[0]]}else if(2==i){if(t[e[0]][e[1]])return t[e[0]][e[1]]}else if(3==i){if(t[e[0]][e[1]][e[2]])return t[e[0]][e[1]][e[2]]}else if(4==i){if(t[e[0]][e[1]][e[2]][e[3]])return t[e[0]][e[1]][e[2]][e[3]]}else if(t[e])return t[e];return!1},e.Group.prototype.callAll=function(t,e){if("undefined"!=typeof t){t=t.split(".");var i=t.length;if("undefined"==typeof e||null===e||""===e)e=null;else if("string"==typeof e){e=e.split(".");var n=e.length}for(var s=Array.prototype.splice.call(arguments,2),r=null,o=null,a=0,h=this.children.length;h>a;a++)r=this.callbackFromArray(this.children[a],t,i),e&&r?(o=this.callbackFromArray(this.children[a],e,n),r&&r.apply(o,s)):r&&r.apply(this.children[a],s)}},e.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var t=this.children.length;t--;)this.children[t].preUpdate();return!0},e.Group.prototype.update=function(){for(var t=this.children.length;t--;)this.children[t].update()},e.Group.prototype.postUpdate=function(){1===this._cache[7]&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=this.children.length;t--;)this.children[t].postUpdate()},e.Group.prototype.filter=function(t,i){for(var n=-1,s=this.children.length,r=new e.ArrayList;++n<s;){var o=this.children[n];(!i||i&&o.exists)&&t(o,n,this.children)&&r.add(o)}return r},e.Group.prototype.forEach=function(t,e,i){"undefined"==typeof i&&(i=!1);var n=Array.prototype.splice.call(arguments,3);n.unshift(null);for(var s=0,r=this.children.length;r>s;s++)(!i||i&&this.children[s].exists)&&(n[0]=this.children[s],t.apply(e,n))},e.Group.prototype.forEachExists=function(t,i){var n=Array.prototype.splice.call(arguments,2);n.unshift(null),this.iterate("exists",!0,e.Group.RETURN_TOTAL,t,i,n)},e.Group.prototype.forEachAlive=function(t,i){var n=Array.prototype.splice.call(arguments,2);n.unshift(null),this.iterate("alive",!0,e.Group.RETURN_TOTAL,t,i,n)},e.Group.prototype.forEachDead=function(t,i){var n=Array.prototype.splice.call(arguments,2);n.unshift(null),this.iterate("alive",!1,e.Group.RETURN_TOTAL,t,i,n)},e.Group.prototype.sort=function(t,i){this.children.length<2||("undefined"==typeof t&&(t="z"),"undefined"==typeof i&&(i=e.Group.SORT_ASCENDING),this._sortProperty=t,i===e.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())},e.Group.prototype.customSort=function(t,e){this.children.length<2||(this.children.sort(t.bind(e)),this.updateZ())},e.Group.prototype.ascendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?-1:t[this._sortProperty]>e[this._sortProperty]?1:t.z<e.z?-1:1},e.Group.prototype.descendingSortHandler=function(t,e){return t[this._sortProperty]<e[this._sortProperty]?1:t[this._sortProperty]>e[this._sortProperty]?-1:0},e.Group.prototype.iterate=function(t,i,n,s,r,o){if(n===e.Group.RETURN_TOTAL&&0===this.children.length)return 0;"undefined"==typeof s&&(s=!1);for(var a=0,h=0,l=this.children.length;l>h;h++)if(this.children[h][t]===i&&(a++,s&&(o[0]=this.children[h],s.apply(r,o)),n===e.Group.RETURN_CHILD))return this.children[h];return n===e.Group.RETURN_TOTAL?a:n===e.Group.RETURN_CHILD?null:void 0},e.Group.prototype.getFirstExists=function(t){return"boolean"!=typeof t&&(t=!0),this.iterate("exists",t,e.Group.RETURN_CHILD)},e.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,e.Group.RETURN_CHILD)},e.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,e.Group.RETURN_CHILD)},e.Group.prototype.getTop=function(){return this.children.length>0?this.children[this.children.length-1]:void 0},e.Group.prototype.getBottom=function(){return this.children.length>0?this.children[0]:void 0},e.Group.prototype.countLiving=function(){return this.iterate("alive",!0,e.Group.RETURN_TOTAL)},e.Group.prototype.countDead=function(){return this.iterate("alive",!1,e.Group.RETURN_TOTAL)},e.Group.prototype.getRandom=function(t,e){return 0===this.children.length?null:(t=t||0,e=e||this.children.length,this.game.math.getRandom(this.children,t,e))},e.Group.prototype.remove=function(t,e,i){if("undefined"==typeof e&&(e=!1),"undefined"==typeof i&&(i=!1),0===this.children.length||-1===this.children.indexOf(t))return!1;i||!t.events||t.destroyPhase||t.events.onRemovedFromGroup.dispatch(t,this);var n=this.removeChild(t);return this.updateZ(),this.cursor===t&&this.next(),e&&n&&n.destroy(!0),!0},e.Group.prototype.removeAll=function(t,e){if("undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!1),0!==this.children.length){do{!e&&this.children[0].events&&this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this);var i=this.removeChild(this.children[0]);t&&i&&i.destroy(!0)}while(this.children.length>0);this.cursor=null}},e.Group.prototype.removeBetween=function(t,e,i,n){if("undefined"==typeof e&&(e=this.children.length-1),"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),0!==this.children.length){if(t>e||0>t||e>this.children.length)return!1;for(var s=e;s>=t;){!n&&this.children[s].events&&this.children[s].events.onRemovedFromGroup.dispatch(this.children[s],this);var r=this.removeChild(this.children[s]);i&&r&&r.destroy(!0),this.cursor===this.children[s]&&(this.cursor=null),s--}this.updateZ()}},e.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||("undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Object.defineProperty(e.Group.prototype,"total",{
get:function(){return this.iterate("exists",!0,e.Group.RETURN_TOTAL)}}),Object.defineProperty(e.Group.prototype,"length",{get:function(){return this.children.length}}),Object.defineProperty(e.Group.prototype,"angle",{get:function(){return e.Math.radToDeg(this.rotation)},set:function(t){this.rotation=e.Math.degToRad(t)}}),Object.defineProperty(e.Group.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),e.World=function(game){e.Group.call(this,game,null,"__world",!1),this.bounds=new e.Rectangle(0,0,game.width,game.height),this.camera=null,this._definedSize=!1,this._width=game.width,this._height=game.height},e.World.prototype=Object.create(e.Group.prototype),e.World.prototype.constructor=e.World,e.World.prototype.boot=function(){this.camera=new e.Camera(this.game,0,0,0,this.game.width,this.game.height),this.camera.displayObject=this,this.camera.scale=this.scale,this.game.camera=this.camera,this.game.stage.addChild(this)},e.World.prototype.setBounds=function(t,e,i,n){this._definedSize=!0,this._width=i,this._height=n,this.bounds.setTo(t,e,i,n),this.camera.bounds&&this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(n,this.game.height)),this.game.physics.setBoundsToWorld()},e.World.prototype.resize=function(t,e){this._definedSize&&(t<this._width&&(t=this._width),e<this._height&&(e=this._height)),this.bounds.width=t,this.bounds.height=e,this.game.camera.setBoundsToWorld(),this.game.physics.setBoundsToWorld()},e.World.prototype.shutdown=function(){this.destroy(!0,!0)},e.World.prototype.wrap=function(t,e,i,n,s){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!0),"undefined"==typeof s&&(s=!0),i?(t.getBounds(),n&&(t.x+t._currentBounds.width<this.bounds.x?t.x=this.bounds.right:t.x>this.bounds.right&&(t.x=this.bounds.left)),s&&(t.y+t._currentBounds.height<this.bounds.top?t.y=this.bounds.bottom:t.y>this.bounds.bottom&&(t.y=this.bounds.top))):(n&&t.x+e<this.bounds.x?t.x=this.bounds.right+e:n&&t.x-e>this.bounds.right&&(t.x=this.bounds.left-e),s&&t.y+e<this.bounds.top?t.y=this.bounds.bottom+e:s&&t.y-e>this.bounds.bottom&&(t.y=this.bounds.top-e))},Object.defineProperty(e.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){t<this.game.width&&(t=this.game.width),this.bounds.width=t,this._width=t,this._definedSize=!0}}),Object.defineProperty(e.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){t<this.game.height&&(t=this.game.height),this.bounds.height=t,this._height=t,this._definedSize=!0}}),Object.defineProperty(e.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}}),Object.defineProperty(e.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}}),Object.defineProperty(e.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}}),Object.defineProperty(e.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}}),e.FlexGrid=function(t,i,n){this.game=t.game,this.manager=t,this.width=i,this.height=n,this.boundsCustom=new e.Rectangle(0,0,i,n),this.boundsFluid=new e.Rectangle(0,0,i,n),this.boundsFull=new e.Rectangle(0,0,i,n),this.boundsNone=new e.Rectangle(0,0,i,n),this.positionCustom=new e.Point(0,0),this.positionFluid=new e.Point(0,0),this.positionFull=new e.Point(0,0),this.positionNone=new e.Point(0,0),this.scaleCustom=new e.Point(1,1),this.scaleFluid=new e.Point(1,1),this.scaleFluidInversed=new e.Point(1,1),this.scaleFull=new e.Point(1,1),this.scaleNone=new e.Point(1,1),this.customWidth=0,this.customHeight=0,this.customOffsetX=0,this.customOffsetY=0,this.ratioH=i/n,this.ratioV=n/i,this.multiplier=0,this.layers=[]},e.FlexGrid.prototype={setSize:function(t,i){this.width=t,this.height=i,this.ratioH=t/i,this.ratioV=i/t,this.scaleNone=new e.Point(1,1),this.boundsNone.width=this.width,this.boundsNone.height=this.height,this.refresh()},createCustomLayer:function(t,i,n,s){"undefined"==typeof s&&(s=!0),this.customWidth=t,this.customHeight=i,this.boundsCustom.width=t,this.boundsCustom.height=i;var r=new e.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);return s&&this.game.world.add(r),this.layers.push(r),"undefined"!=typeof n&&null!==typeof n&&r.addMultiple(n),r},createFluidLayer:function(t,i){"undefined"==typeof i&&(i=!0);var n=new e.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return i&&this.game.world.add(n),this.layers.push(n),"undefined"!=typeof t&&null!==typeof t&&n.addMultiple(t),n},createFullLayer:function(t){var i=new e.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(i),this.layers.push(i),"undefined"!=typeof t&&i.addMultiple(t),i},createFixedLayer:function(t){var i=new e.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(i),this.layers.push(i),"undefined"!=typeof t&&i.addMultiple(t),i},reset:function(){for(var t=this.layers.length;t--;)this.layers[t].persist||(this.layers[t].position=null,this.layers[t].scale=null,this.layers.slice(t,1))},onResize:function(t,e){this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width),this.boundsFluid.width=Math.round(this.width*this.multiplier),this.boundsFluid.height=Math.round(this.height*this.multiplier),this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height),this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height),this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height),this.boundsFull.width=this.manager.width*this.scaleFluidInversed.x,this.boundsFull.height=this.manager.height*this.scaleFluidInversed.y,this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY),this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y),this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16),this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1)}},e.FlexGrid.prototype.constructor=e.FlexGrid,e.FlexLayer=function(t,i,n,s){e.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1),this.manager=t.manager,this.grid=t,this.persist=!1,this.position=i,this.bounds=n,this.scale=s,this.topLeft=n.topLeft,this.topMiddle=new e.Point(n.halfWidth,0),this.topRight=n.topRight,this.bottomLeft=n.bottomLeft,this.bottomMiddle=new e.Point(n.halfWidth,n.bottom),this.bottomRight=n.bottomRight},e.FlexLayer.prototype=Object.create(e.Group.prototype),e.FlexLayer.prototype.constructor=e.FlexLayer,e.FlexLayer.prototype.resize=function(){},e.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16),this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1),this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9"),this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")},e.ScaleManager=function(game,t,i){this.game=game,this.grid=null,this.width=0,this.height=0,this.minWidth=null,this.maxWidth=null,this.minHeight=null,this.maxHeight=null,this.offset=new e.Point,this.forceLandscape=!1,this.forcePortrait=!1,this.incorrectOrientation=!1,this.pageAlignHorizontally=!1,this.pageAlignVertically=!1,this.maxIterations=5,this.enterLandscape=new e.Signal,this.enterPortrait=new e.Signal,this.enterIncorrectOrientation=new e.Signal,this.leaveIncorrectOrientation=new e.Signal,this.fullScreenTarget=null,this.enterFullScreen=new e.Signal,this.leaveFullScreen=new e.Signal,this.orientation=0,window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight&&(this.orientation=90),this.scaleFactor=new e.Point(1,1),this.scaleFactorInversed=new e.Point(1,1),this.margin=new e.Point(0,0),this.bounds=new e.Rectangle,this.aspectRatio=0,this.sourceAspectRatio=0,this.event=null,this.fullScreenScaleMode=e.ScaleManager.NO_SCALE,this.parentIsWindow=!1,this.parentNode=null,this.parentScaleFactor=new e.Point(1,1),this.trackParentInterval=2e3,this.onResize=null,this.onResizeContext=null,this._scaleMode=e.ScaleManager.NO_SCALE,this._width=0,this._height=0,this._check=null,this._nextParentCheck=0,this._parentBounds=null,game.config&&this.parseConfig(game.config),this.setupScale(t,i)},e.ScaleManager.EXACT_FIT=0,e.ScaleManager.NO_SCALE=1,e.ScaleManager.SHOW_ALL=2,e.ScaleManager.RESIZE=3,e.ScaleManager.prototype={parseConfig:function(t){t.scaleMode&&(this.scaleMode=t.scaleMode),t.fullScreenScaleMode&&(this.fullScreenScaleMode=t.fullScreenScaleMode),t.fullScreenTarget&&(this.fullScreenTarget=t.fullScreenTarget)},setupScale:function(t,i){var n,s=new e.Rectangle;""!==this.game.parent&&("string"==typeof this.game.parent?n=document.getElementById(this.game.parent):"object"==typeof this.game.parent&&1===this.game.parent.nodeType&&(n=this.game.parent)),n?(this.parentNode=n,this.parentIsWindow=!1,this._parentBounds=this.parentNode.getBoundingClientRect(),s.width=this._parentBounds.width,s.height=this._parentBounds.height,this.offset.set(this._parentBounds.left,this._parentBounds.top)):(this.parentNode=null,this.parentIsWindow=!0,s.width=window.innerWidth,s.height=window.innerHeight);var r=0,o=0;"number"==typeof t?r=t:(this.parentScaleFactor.x=parseInt(t,10)/100,r=s.width*this.parentScaleFactor.x),"number"==typeof i?o=i:(this.parentScaleFactor.y=parseInt(i,10)/100,o=s.height*this.parentScaleFactor.y),this.grid=new e.FlexGrid(this,r,o),this.updateDimensions(r,o,!1)},boot:function(){this.fullScreenTarget=this.game.canvas;var t=this;this._checkOrientation=function(e){return t.checkOrientation(e)},this._checkResize=function(e){return t.checkResize(e)},this._fullScreenChange=function(e){return t.fullScreenChange(e)},window.addEventListener("orientationchange",this._checkOrientation,!1),window.addEventListener("resize",this._checkResize,!1),this.game.device.cocoonJS||(document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1)),this.updateDimensions(this.width,this.height,!0),e.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height)},setResizeCallback:function(t,e){this.onResize=t,this.onResizeContext=e},setMinMax:function(t,e,i,n){this.minWidth=t,this.minHeight=e,"undefined"!=typeof i&&(this.maxWidth=i),"undefined"!=typeof n&&(this.maxHeight=n)},preUpdate:function(){this.game.time.now<this._nextParentCheck||(this.parentIsWindow||(e.Canvas.getOffset(this.game.canvas,this.offset),this._scaleMode===e.ScaleManager.RESIZE&&(this._parentBounds=this.parentNode.getBoundingClientRect(),(this._parentBounds.width!==this.width||this._parentBounds.height!==this.height)&&this.updateDimensions(this._parentBounds.width,this._parentBounds.height,!0))),this._nextParentCheck=this.game.time.now+this.trackParentInterval)},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x,this.height=e*this.parentScaleFactor.y,this.game.width=this.width,this.game.height=this.height,this.sourceAspectRatio=this.width/this.height,this.bounds.width=this.width,this.bounds.height=this.height,i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height)),this.grid.onResize(t,e),this.onResize&&this.onResize.call(this.onResizeContext,this.width,this.height),this.game.state.resize(t,e)},forceOrientation:function(t,e){"undefined"==typeof e&&(e=!1),this.forceLandscape=t,this.forcePortrait=e},checkOrientationState:function(){this.incorrectOrientation?(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)&&(this.incorrectOrientation=!1,this.leaveIncorrectOrientation.dispatch(),this.scaleMode!==e.ScaleManager.NO_SCALE&&this.refresh()):(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)&&(this.incorrectOrientation=!0,this.enterIncorrectOrientation.dispatch(),this.scaleMode!==e.ScaleManager.NO_SCALE&&this.refresh())},checkOrientation:function(t){this.event=t,this.orientation=window.orientation,this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0),this.scaleMode!==e.ScaleManager.NO_SCALE&&this.refresh()},checkResize:function(t){this.event=t;var i=this.isLandscape;window.outerWidth>window.outerHeight?this.orientation=90:this.orientation=0,i&&this.isPortrait?(this.enterPortrait.dispatch(this.orientation,!1,!0),this.forceLandscape?this.enterIncorrectOrientation.dispatch():this.forcePortrait&&this.leaveIncorrectOrientation.dispatch()):!i&&this.isLandscape&&(this.enterLandscape.dispatch(this.orientation,!0,!1),this.forceLandscape?this.leaveIncorrectOrientation.dispatch():this.forcePortrait&&this.enterIncorrectOrientation.dispatch()),this._scaleMode===e.ScaleManager.RESIZE&&this.parentIsWindow?this.updateDimensions(window.innerWidth,window.innerHeight,!0):(this._scaleMode===e.ScaleManager.EXACT_FIT||this._scaleMode===e.ScaleManager.SHOW_ALL)&&(this.refresh(),this.onResize&&this.onResize.call(this.onResizeContext,this.width,this.height)),this.checkOrientationState()},refresh:function(){if(this.scaleMode!==e.ScaleManager.RESIZE&&(this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),null===this._check&&this.maxIterations>0)){this._iterations=this.maxIterations;var t=this;this._check=window.setInterval(function(){return t.setScreenSize()},10),this.setScreenSize()}},setScreenSize:function(t){this.scaleMode!==e.ScaleManager.RESIZE&&("undefined"==typeof t&&(t=!1),this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),this._iterations--,(t||this._iterations<0)&&(document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation?this.setMaximum():this.isFullScreen?this.fullScreenScaleMode===e.ScaleManager.EXACT_FIT?this.setExactFit():this.fullScreenScaleMode===e.ScaleManager.SHOW_ALL&&this.setShowAll():this.scaleMode===e.ScaleManager.EXACT_FIT?this.setExactFit():this.scaleMode===e.ScaleManager.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null))},setSize:function(){this.incorrectOrientation||(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight)),this.game.canvas.style.width=this.width+"px",this.game.canvas.style.height=this.height+"px",this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.pageAlignHorizontally&&(this.width<window.innerWidth&&!this.incorrectOrientation?(this.margin.x=Math.round((window.innerWidth-this.width)/2),this.game.canvas.style.marginLeft=this.margin.x+"px"):(this.margin.x=0,this.game.canvas.style.marginLeft="0px")),this.pageAlignVertically&&(this.height<window.innerHeight&&!this.incorrectOrientation?(this.margin.y=Math.round((window.innerHeight-this.height)/2),this.game.canvas.style.marginTop=this.margin.y+"px"):(this.margin.y=0,this.game.canvas.style.marginTop="0px")),e.Canvas.getOffset(this.game.canvas,this.offset),this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.scaleFactorInversed.x=this.width/this.game.width,this.scaleFactorInversed.y=this.height/this.game.height,this.checkOrientationState()},reset:function(t){t&&this.grid.reset()},setMaximum:function(){this.width=window.innerWidth,this.height=window.innerHeight},setShowAll:function(){var t=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*t),this.height=Math.round(this.game.height*t)},setExactFit:function(){var t=window.innerWidth,e=window.innerHeight;this.maxWidth&&t>this.maxWidth?this.width=this.maxWidth:this.width=t,this.maxHeight&&e>this.maxHeight?this.height=this.maxHeight:this.height=e},startFullScreen:function(t){!this.isFullScreen&&this.game.device.fullscreen&&("undefined"!=typeof t&&this.game.renderType===e.CANVAS&&(this.game.stage.smoothed=t),this._width=this.width,this._height=this.height,this.game.device.fullscreenKeyboard?this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):this.fullScreenTarget[this.game.device.requestFullscreen]())},stopFullScreen:function(){document[this.game.device.cancelFullscreen]()},fullScreenChange:function(t){this.event=t,this.isFullScreen?(this.fullScreenScaleMode===e.ScaleManager.EXACT_FIT?(this.fullScreenTarget.style.width="100%",this.fullScreenTarget.style.height="100%",this.width=window.outerWidth,this.height=window.outerHeight,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.checkResize()):this.fullScreenScaleMode===e.ScaleManager.SHOW_ALL&&(this.setShowAll(),this.refresh()),this.enterFullScreen.dispatch(this.width,this.height)):(this.fullScreenTarget.style.width=this.game.width+"px",this.fullScreenTarget.style.height=this.game.height+"px",this.width=this._width,this.height=this._height,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.leaveFullScreen.dispatch(this.width,this.height))},destroy:function(){window.removeEventListener("orientationchange",this._checkOrientation,!1),window.removeEventListener("resize",this._checkResize,!1),this.game.device.cocoonJS||(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1))}},e.ScaleManager.prototype.constructor=e.ScaleManager,Object.defineProperty(e.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){t!==this._scaleMode&&(this._scaleMode=t)}}),Object.defineProperty(e.ScaleManager.prototype,"isFullScreen",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(e.ScaleManager.prototype,"isPortrait",{get:function(){return 0===this.orientation||180===this.orientation}}),Object.defineProperty(e.ScaleManager.prototype,"isLandscape",{get:function(){return 90===this.orientation||-90===this.orientation}}),e.Game=function(t,i,n,s,r,o,a,h){this.id=e.GAMES.push(this)-1,this.config=null,this.physicsConfig=h,this.parent="",this.width=800,this.height=600,this.transparent=!1,this.antialias=!0,this.preserveDrawingBuffer=!1,this.renderer=null,this.renderType=e.AUTO,this.state=null,this.isBooted=!1,this.isRunning=!1,this.raf=null,this.add=null,this.make=null,this.cache=null,this.input=null,this.load=null,this.math=null,this.net=null,this.scale=null,this.sound=null,this.stage=null,this.time=null,this.tweens=null,this.world=null,this.physics=null,this.rnd=null,this.device=null,this.camera=null,this.canvas=null,this.context=null,this.debug=null,this.particles=null,this.stepping=!1,this.pendingStep=!1,this.stepCount=0,this.onPause=null,this.onResume=null,this.onBlur=null,this.onFocus=null,this._paused=!1,this._codePaused=!1,this._width=800,this._height=600,1===arguments.length&&"object"==typeof arguments[0]?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},"undefined"!=typeof t&&(this._width=t),"undefined"!=typeof i&&(this._height=i),"undefined"!=typeof n&&(this.renderType=n),"undefined"!=typeof s&&(this.parent=s),"undefined"!=typeof o&&(this.transparent=o),"undefined"!=typeof a&&(this.antialias=a),this.rnd=new e.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new e.StateManager(this,r));var l=this;return this._onBoot=function(){return l.boot()},"complete"===document.readyState||"interactive"===document.readyState?window.setTimeout(this._onBoot,0):"undefined"!=typeof window.cordova?document.addEventListener("deviceready",this._onBoot,!1):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this},e.Game.prototype={parseConfig:function(t){this.config=t,"undefined"==typeof t.enableDebug&&(this.config.enableDebug=!0),t.width&&(this._width=t.width),t.height&&(this._height=t.height),t.renderer&&(this.renderType=t.renderer),t.parent&&(this.parent=t.parent),t.transparent&&(this.transparent=t.transparent),t.antialias&&(this.antialias=t.antialias),t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer),t.physicsConfig&&(this.physicsConfig=t.physicsConfig);var i=[(Date.now()*Math.random()).toString()];t.seed&&(i=t.seed),this.rnd=new e.RandomDataGenerator(i);var n=null;t.state&&(n=t.state),this.state=new e.StateManager(this,n)},boot:function(){this.isBooted||(document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new e.Signal,this.onResume=new e.Signal,this.onBlur=new e.Signal,this.onFocus=new e.Signal,this.isBooted=!0,this.device=new e.Device(this),this.math=e.Math,this.scale=new e.ScaleManager(this,this._width,this._height),this.stage=new e.Stage(this),this.setUpRenderer(),this.device.checkFullScreenSupport(),this.world=new e.World(this),this.add=new e.GameObjectFactory(this),this.make=new e.GameObjectCreator(this),this.cache=new e.Cache(this),this.load=new e.Loader(this),this.time=new e.Time(this),this.tweens=new e.TweenManager(this),this.input=new e.Input(this),this.sound=new e.SoundManager(this),this.physics=new e.Physics(this,this.physicsConfig),this.particles=new e.Particles(this),this.plugins=new e.PluginManager(this),this.net=new e.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug&&(this.debug=new e.Utils.Debug(this),this.debug.boot()),this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new e.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new e.RequestAnimationFrame(this,!1),this.raf.start()):window.setTimeout(this._onBoot,20))},showDebugHeader:function(){var t=e.VERSION,i="Canvas",n="HTML Audio",s=1;if(this.renderType===e.WEBGL?(i="WebGL",s++):this.renderType==e.HEADLESS&&(i="Headless"),this.device.webAudio&&(n="WebAudio",s++),this.device.chrome){for(var r=["%c %c %c Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+i+" | "+n+"  %c %c  http://phaser.io  %c %c ♥%c♥%c♥ ","background: #7a66a3","background: #625186","color: #ffffff; background: #43375b;","background: #625186","background: #ccb9f2","background: #625186"],o=0;3>o;o++)s>o?r.push("color: #ff2424; background: #fff"):r.push("color: #959595; background: #fff");console.log.apply(console,r)}else window.console&&console.log("Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+i+" | "+n+" | http://phaser.io")},setUpRenderer:function(){if(this.config.canvasID?this.canvas=e.Canvas.create(this.width,this.height,this.config.canvasID):this.canvas=e.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.renderType===e.CANVAS?this.canvas.screencanvas=!0:this.canvas.screencanvas=!1),this.renderType===e.HEADLESS||this.renderType===e.CANVAS||this.renderType===e.AUTO&&this.device.webGL===!1){if(!this.device.canvas)throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");this.renderType===e.AUTO&&(this.renderType=e.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:1,clearBeforeRender:!0}),this.context=this.renderer.context}else this.renderType=e.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,{view:this.canvas,transparent:this.transparent,resolution:1,antialias:this.antialias,preserveDrawingBuffer:this.preserveDrawingBuffer}),this.context=null;this.renderType!==e.HEADLESS&&(this.stage.smoothed=this.antialias,e.Canvas.addToDOM(this.canvas,this.parent,!1),e.Canvas.setTouchAction(this.canvas))},update:function(t){this.time.update(t),this._paused||this.pendingStep?(this.state.pauseUpdate(),this.config.enableDebug&&this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.config.enableDebug&&this.debug.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(),this.plugins.preUpdate(),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate()),this.renderType!=e.HEADLESS&&(this.state.preRender(),this.renderer.render(this.stage),this.plugins.render(),this.state.render(),this.plugins.postRender(),this.device.cocoonJS&&this.renderType===e.CANVAS&&1===this.stage.currentRenderOrderID&&this.context.fillRect(0,0,0,0))},enableStep:function(){this.stepping=!0,this.pendingStep=!1,this.stepCount=0},disableStep:function(){this.stepping=!1,this.pendingStep=!1},step:function(){this.pendingStep=!1,this.stepCount++},destroy:function(){this.raf.stop(),this.state.destroy(),this.sound.destroy(),this.scale.destroy(),this.stage.destroy(),this.input.destroy(),this.physics.destroy(),this.state=null,this.cache=null,this.input=null,this.load=null,this.sound=null,this.stage=null,this.time=null,this.world=null,this.isBooted=!1,e.Canvas.removeFromDOM(this.canvas)},gamePaused:function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(t))},gameResumed:function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(t))},focusLoss:function(t){this.onBlur.dispatch(t),this.stage.disableVisibilityChange||this.gamePaused(t)},focusGain:function(t){this.onFocus.dispatch(t),this.stage.disableVisibilityChange||this.gameResumed(t)}},e.Game.prototype.constructor=e.Game,Object.defineProperty(e.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){t===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}}),e.Input=function(game){this.game=game,this.hitCanvas=null,this.hitContext=null,this.moveCallbacks=[],this.moveCallback=null,this.moveCallbackContext=this,this.pollRate=0,this.disabled=!1,this.multiInputOverride=e.Input.MOUSE_TOUCH_COMBINE,this.position=null,this.speed=null,this.circle=null,this.scale=null,this.maxPointers=10,this.currentPointers=0,this.tapRate=200,this.doubleTapRate=300,this.holdRate=2e3,this.justPressedRate=200,this.justReleasedRate=200,this.recordPointerHistory=!1,this.recordRate=100,this.recordLimit=100,this.pointer1=null,this.pointer2=null,this.pointer3=null,this.pointer4=null,this.pointer5=null,this.pointer6=null,this.pointer7=null,this.pointer8=null,this.pointer9=null,this.pointer10=null,this.activePointer=null,this.mousePointer=null,this.mouse=null,this.keyboard=null,this.touch=null,this.mspointer=null,this.gamepad=null,this.resetLocked=!1,this.onDown=null,this.onUp=null,this.onTap=null,this.onHold=null,this.minPriorityID=0,this.interactiveItems=new e.ArrayList,this._localPoint=new e.Point,this._pollCounter=0,this._oldPosition=null,this._x=0,this._y=0},e.Input.MOUSE_OVERRIDES_TOUCH=0,e.Input.TOUCH_OVERRIDES_MOUSE=1,e.Input.MOUSE_TOUCH_COMBINE=2,e.Input.prototype={boot:function(){this.mousePointer=new e.Pointer(this.game,0),this.pointer1=new e.Pointer(this.game,1),this.pointer2=new e.Pointer(this.game,2),this.mouse=new e.Mouse(this.game),this.keyboard=new e.Keyboard(this.game),this.touch=new e.Touch(this.game),this.mspointer=new e.MSPointer(this.game),this.gamepad=new e.Gamepad(this.game),this.onDown=new e.Signal,this.onUp=new e.Signal,this.onTap=new e.Signal,this.onHold=new e.Signal,this.scale=new e.Point(1,1),this.speed=new e.Point,this.position=new e.Point,this._oldPosition=new e.Point,this.circle=new e.Circle(0,0,44),this.activePointer=this.mousePointer,this.currentPointers=0,this.hitCanvas=document.createElement("canvas"),this.hitCanvas.width=1,this.hitCanvas.height=1,this.hitContext=this.hitCanvas.getContext("2d"),this.mouse.start(),this.keyboard.start(),this.touch.start(),this.mspointer.start(),this.mousePointer.active=!0},destroy:function(){this.mouse.stop(),this.keyboard.stop(),this.touch.stop(),this.mspointer.stop(),this.gamepad.stop(),this.moveCallbacks=[]},addMoveCallback:function(t,e){return this.moveCallbacks.push({callback:t,context:e})-1},deleteMoveCallback:function(t){this.moveCallbacks[t]&&this.moveCallbacks.splice(t,1)},addPointer:function(){for(var t=0,i=10;i>0;i--)null===this["pointer"+i]&&(t=i);return 0===t?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+t]=new e.Pointer(this.game,t),this["pointer"+t])},update:function(){return this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate?void this._pollCounter++:(this.speed.x=this.position.x-this._oldPosition.x,this.speed.y=this.position.y-this._oldPosition.y,this._oldPosition.copyFrom(this.position),this.mousePointer.update(),this.gamepad.active&&this.gamepad.update(),this.pointer1.update(),this.pointer2.update(),this.pointer3&&this.pointer3.update(),this.pointer4&&this.pointer4.update(),this.pointer5&&this.pointer5.update(),this.pointer6&&this.pointer6.update(),this.pointer7&&this.pointer7.update(),this.pointer8&&this.pointer8.update(),this.pointer9&&this.pointer9.update(),this.pointer10&&this.pointer10.update(),void(this._pollCounter=0))},reset:function(t){if(this.game.isBooted&&!this.resetLocked){"undefined"==typeof t&&(t=!1),this.keyboard.reset(t),this.mousePointer.reset(),this.gamepad.reset();for(var i=1;10>=i;i++)this["pointer"+i]&&this["pointer"+i].reset();this.currentPointers=0,"none"!==this.game.canvas.style.cursor&&(this.game.canvas.style.cursor="inherit"),t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new e.Signal,this.onUp=new e.Signal,this.onTap=new e.Signal,this.onHold=new e.Signal,this.moveCallbacks=[]),this._pollCounter=0}},resetSpeed:function(t,e){this._oldPosition.setTo(t,e),this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active===!1)return this.pointer1.start(t);if(this.pointer2.active===!1)return this.pointer2.start(t);for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].active===!1)return this["pointer"+e].start(t);return null},updatePointer:function(t){
if(this.pointer1.active&&this.pointer1.identifier==t.identifier)return this.pointer1.move(t);if(this.pointer2.active&&this.pointer2.identifier==t.identifier)return this.pointer2.move(t);for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].active&&this["pointer"+e].identifier==t.identifier)return this["pointer"+e].move(t);return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier==t.identifier)return this.pointer1.stop(t);if(this.pointer2.active&&this.pointer2.identifier==t.identifier)return this.pointer2.stop(t);for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].active&&this["pointer"+e].identifier==t.identifier)return this["pointer"+e].stop(t);return null},getPointer:function(t){if(t=t||!1,this.pointer1.active==t)return this.pointer1;if(this.pointer2.active==t)return this.pointer2;for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].active==t)return this["pointer"+e];return null},getPointerFromIdentifier:function(t){if(this.pointer1.identifier===t)return this.pointer1;if(this.pointer2.identifier===t)return this.pointer2;for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].identifier===t)return this["pointer"+e];return null},getPointerFromId:function(t){if(this.pointer1.pointerId===t)return this.pointer1;if(this.pointer2.pointerId===t)return this.pointer2;for(var e=3;10>=e;e++)if(this["pointer"+e]&&this["pointer"+e].pointerId===t)return this["pointer"+e];return null},getLocalPosition:function(t,i,n){"undefined"==typeof n&&(n=new e.Point);var s=t.worldTransform,r=1/(s.a*s.d+s.c*-s.b);return n.setTo(s.d*r*i.x+-s.c*r*i.y+(s.ty*s.c-s.tx*s.d)*r,s.a*r*i.y+-s.b*r*i.x+(-s.ty*s.a+s.tx*s.b)*r)},hitTest:function(t,i,n){if(!t.worldVisible)return!1;if(this.getLocalPosition(t,i,this._localPoint),n.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y);if(t instanceof PIXI.Sprite){var s=t.texture.frame.width,r=t.texture.frame.height,o=-s*t.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+s){var a=-r*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+r)return!0}}else if(t instanceof e.TileSprite){var s=t.width,r=t.height,o=-s*t.anchor.x;if(this._localPoint.x>=o&&this._localPoint.x<o+s){var a=-r*t.anchor.y;if(this._localPoint.y>=a&&this._localPoint.y<a+r)return!0}}else if(t instanceof e.Graphics)for(var h=0;h<t.graphicsData.length;h++){var l=t.graphicsData[h];if(l.fill&&l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y))return!0}for(var h=0,c=t.children.length;c>h;h++)if(this.hitTest(t.children[h],i,n))return!0;return!1}},e.Input.prototype.constructor=e.Input,Object.defineProperty(e.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}}),Object.defineProperty(e.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}}),Object.defineProperty(e.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}}),Object.defineProperty(e.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}}),Object.defineProperty(e.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var t=1;10>=t;t++)this["pointer"+t]&&this["pointer"+t].active&&this.currentPointers++;return this.currentPointers}}),Object.defineProperty(e.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}}),Object.defineProperty(e.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}}),e.Key=function(game,t){this.game=game,this.enabled=!0,this.event=null,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.timeDown=0,this.duration=0,this.timeUp=-2500,this.repeats=0,this.keyCode=t,this.onDown=new e.Signal,this.onHoldCallback=null,this.onHoldContext=null,this.onUp=new e.Signal},e.Key.prototype={update:function(){this.enabled&&this.isDown&&(this.duration=this.game.time.now-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(t){this.enabled&&(this.event=t,this.isDown||(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.onDown.dispatch(this)))},processKeyUp:function(t){this.enabled&&(this.event=t,this.isUp||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=this.game.time.now-this.timeDown,this.onUp.dispatch(this)))},reset:function(t){"undefined"==typeof t&&(t=!0),this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=0,this.enabled=!0,t&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},justPressed:function(t){return"undefined"==typeof t&&(t=50),this.isDown&&this.duration<t},justReleased:function(t){return"undefined"==typeof t&&(t=50),!this.isDown&&this.game.time.now-this.timeUp<t}},e.Key.prototype.constructor=e.Key,e.Keyboard=function(game){this.game=game,this.disabled=!1,this.event=null,this.pressEvent=null,this.callbackContext=this,this.onDownCallback=null,this.onPressCallback=null,this.onUpCallback=null,this._keys=[],this._capture=[],this._onKeyDown=null,this._onKeyPress=null,this._onKeyUp=null,this._i=0,this._k=0},e.Keyboard.prototype={addCallbacks:function(t,e,i,n){this.callbackContext=t,"undefined"!=typeof e&&(this.onDownCallback=e),"undefined"!=typeof i&&(this.onUpCallback=i),"undefined"!=typeof n&&(this.onPressCallback=n)},addKey:function(t){return this._keys[t]||(this._keys[t]=new e.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},removeKey:function(t){this._keys[t]&&(this._keys[t]=null,this.removeKeyCapture(t))},createCursorKeys:function(){return{up:this.addKey(e.Keyboard.UP),down:this.addKey(e.Keyboard.DOWN),left:this.addKey(e.Keyboard.LEFT),right:this.addKey(e.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&null===this._onKeyDown){var t=this;this._onKeyDown=function(e){return t.processKeyDown(e)},this._onKeyUp=function(e){return t.processKeyUp(e)},this._onKeyPress=function(e){return t.processKeyPress(e)},window.addEventListener("keydown",this._onKeyDown,!1),window.addEventListener("keyup",this._onKeyUp,!1),window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("keypress",this._onKeyPress),this._onKeyDown=null,this._onKeyUp=null,this._onKeyPress=null},destroy:function(){this.stop(),this.clearCaptures(),this._keys.length=0,this._i=0},addKeyCapture:function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){this.event=t,this.game.input.disabled||this.disabled||(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new e.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyDown(t),this._k=t.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t))},processKeyPress:function(t){this.pressEvent=t,this.game.input.disabled||this.disabled||this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)},processKeyUp:function(t){this.event=t,this.game.input.disabled||this.disabled||(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new e.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t))},reset:function(t){"undefined"==typeof t&&(t=!0),this.event=null;for(var e=this._keys.length;e--;)this._keys[e]&&this._keys[e].reset(t)},justPressed:function(t,e){return"undefined"==typeof e&&(e=50),this._keys[t]?this._keys[t].justPressed(e):!1},justReleased:function(t,e){return"undefined"==typeof e&&(e=50),this._keys[t]?this._keys[t].justReleased(e):!1},isDown:function(t){return this._keys[t]?this._keys[t].isDown:!1}},Object.defineProperty(e.Keyboard.prototype,"lastChar",{get:function(){return 32===this.event.charCode?"":String.fromCharCode(this.pressEvent.charCode)}}),Object.defineProperty(e.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}}),e.Keyboard.prototype.constructor=e.Keyboard,e.Keyboard.A="A".charCodeAt(0),e.Keyboard.B="B".charCodeAt(0),e.Keyboard.C="C".charCodeAt(0),e.Keyboard.D="D".charCodeAt(0),e.Keyboard.E="E".charCodeAt(0),e.Keyboard.F="F".charCodeAt(0),e.Keyboard.G="G".charCodeAt(0),e.Keyboard.H="H".charCodeAt(0),e.Keyboard.I="I".charCodeAt(0),e.Keyboard.J="J".charCodeAt(0),e.Keyboard.K="K".charCodeAt(0),e.Keyboard.L="L".charCodeAt(0),e.Keyboard.M="M".charCodeAt(0),e.Keyboard.N="N".charCodeAt(0),e.Keyboard.O="O".charCodeAt(0),e.Keyboard.P="P".charCodeAt(0),e.Keyboard.Q="Q".charCodeAt(0),e.Keyboard.R="R".charCodeAt(0),e.Keyboard.S="S".charCodeAt(0),e.Keyboard.T="T".charCodeAt(0),e.Keyboard.U="U".charCodeAt(0),e.Keyboard.V="V".charCodeAt(0),e.Keyboard.W="W".charCodeAt(0),e.Keyboard.X="X".charCodeAt(0),e.Keyboard.Y="Y".charCodeAt(0),e.Keyboard.Z="Z".charCodeAt(0),e.Keyboard.ZERO="0".charCodeAt(0),e.Keyboard.ONE="1".charCodeAt(0),e.Keyboard.TWO="2".charCodeAt(0),e.Keyboard.THREE="3".charCodeAt(0),e.Keyboard.FOUR="4".charCodeAt(0),e.Keyboard.FIVE="5".charCodeAt(0),e.Keyboard.SIX="6".charCodeAt(0),e.Keyboard.SEVEN="7".charCodeAt(0),e.Keyboard.EIGHT="8".charCodeAt(0),e.Keyboard.NINE="9".charCodeAt(0),e.Keyboard.NUMPAD_0=96,e.Keyboard.NUMPAD_1=97,e.Keyboard.NUMPAD_2=98,e.Keyboard.NUMPAD_3=99,e.Keyboard.NUMPAD_4=100,e.Keyboard.NUMPAD_5=101,e.Keyboard.NUMPAD_6=102,e.Keyboard.NUMPAD_7=103,e.Keyboard.NUMPAD_8=104,e.Keyboard.NUMPAD_9=105,e.Keyboard.NUMPAD_MULTIPLY=106,e.Keyboard.NUMPAD_ADD=107,e.Keyboard.NUMPAD_ENTER=108,e.Keyboard.NUMPAD_SUBTRACT=109,e.Keyboard.NUMPAD_DECIMAL=110,e.Keyboard.NUMPAD_DIVIDE=111,e.Keyboard.F1=112,e.Keyboard.F2=113,e.Keyboard.F3=114,e.Keyboard.F4=115,e.Keyboard.F5=116,e.Keyboard.F6=117,e.Keyboard.F7=118,e.Keyboard.F8=119,e.Keyboard.F9=120,e.Keyboard.F10=121,e.Keyboard.F11=122,e.Keyboard.F12=123,e.Keyboard.F13=124,e.Keyboard.F14=125,e.Keyboard.F15=126,e.Keyboard.COLON=186,e.Keyboard.EQUALS=187,e.Keyboard.UNDERSCORE=189,e.Keyboard.QUESTION_MARK=191,e.Keyboard.TILDE=192,e.Keyboard.OPEN_BRACKET=219,e.Keyboard.BACKWARD_SLASH=220,e.Keyboard.CLOSED_BRACKET=221,e.Keyboard.QUOTES=222,e.Keyboard.BACKSPACE=8,e.Keyboard.TAB=9,e.Keyboard.CLEAR=12,e.Keyboard.ENTER=13,e.Keyboard.SHIFT=16,e.Keyboard.CONTROL=17,e.Keyboard.ALT=18,e.Keyboard.CAPS_LOCK=20,e.Keyboard.ESC=27,e.Keyboard.SPACEBAR=32,e.Keyboard.PAGE_UP=33,e.Keyboard.PAGE_DOWN=34,e.Keyboard.END=35,e.Keyboard.HOME=36,e.Keyboard.LEFT=37,e.Keyboard.UP=38,e.Keyboard.RIGHT=39,e.Keyboard.DOWN=40,e.Keyboard.INSERT=45,e.Keyboard.DELETE=46,e.Keyboard.HELP=47,e.Keyboard.NUM_LOCK=144,e.Keyboard.PLUS=43,e.Keyboard.MINUS=45,e.Mouse=function(game){this.game=game,this.callbackContext=this.game,this.mouseDownCallback=null,this.mouseMoveCallback=null,this.mouseUpCallback=null,this.mouseOutCallback=null,this.mouseOverCallback=null,this.mouseWheelCallback=null,this.capture=!1,this.button=-1,this.wheelDelta=0,this.disabled=!1,this.locked=!1,this.stopOnGameOut=!1,this.pointerLock=new e.Signal,this.event=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onMouseOut=null,this._onMouseOver=null,this._onMouseWheel=null},e.Mouse.NO_BUTTON=-1,e.Mouse.LEFT_BUTTON=0,e.Mouse.MIDDLE_BUTTON=1,e.Mouse.RIGHT_BUTTON=2,e.Mouse.WHEEL_UP=1,e.Mouse.WHEEL_DOWN=-1,e.Mouse.prototype={start:function(){if((!this.game.device.android||this.game.device.chrome!==!1)&&null===this._onMouseDown){var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)},this._onMouseMove=function(e){return t.onMouseMove(e)},this._onMouseUp=function(e){return t.onMouseUp(e)},this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)},this._onMouseOut=function(e){return t.onMouseOut(e)},this._onMouseOver=function(e){return t.onMouseOver(e)},this._onMouseWheel=function(e){return t.onMouseWheel(e)},this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0),this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0),this.game.canvas.addEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel,!0))}},onMouseDown:function(t){this.event=t,this.capture&&t.preventDefault(),this.button=t.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled||(t.identifier=0,this.game.input.mousePointer.start(t))},onMouseMove:function(t){this.event=t,this.capture&&t.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled||(t.identifier=0,this.game.input.mousePointer.move(t))},onMouseUp:function(t){this.event=t,this.capture&&t.preventDefault(),this.button=e.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled||(t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.game.input.mousePointer.withinGame||(this.button=e.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseOut:function(t){this.event=t,this.capture&&t.preventDefault(),this.game.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled||this.stopOnGameOut&&(t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseWheel:function(t){this.event=t,this.capture&&t.preventDefault(),this.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,t)},onMouseOver:function(t){this.event=t,this.capture&&t.preventDefault(),this.game.input.mousePointer.withinGame=!0,this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},pointerLockChange:function(t){var e=this.game.canvas;document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e?(this.locked=!0,this.pointerLock.dispatch(!0,t)):(this.locked=!1,this.pointerLock.dispatch(!1,t))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock(),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0),this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0),this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0),this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0),this.game.canvas.removeEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.removeEventListener("DOMMouseScroll",this._onMouseWheel,!0),window.removeEventListener("mouseup",this._onMouseUpGlobal,!0),document.removeEventListener("pointerlockchange",this._pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}},e.Mouse.prototype.constructor=e.Mouse,e.MSPointer=function(game){this.game=game,this.callbackContext=this.game,this.disabled=!1,this._onMSPointerDown=null,this._onMSPointerMove=null,this._onMSPointerUp=null},e.MSPointer.prototype={start:function(){if(null===this._onMSPointerDown){var t=this;this.game.device.mspointer&&(this._onMSPointerDown=function(e){return t.onPointerDown(e)},this._onMSPointerMove=function(e){return t.onPointerMove(e)},this._onMSPointerUp=function(e){return t.onPointerUp(e)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(t){this.game.input.disabled||this.disabled||(t.preventDefault(),t.identifier=t.pointerId,this.game.input.startPointer(t))},onPointerMove:function(t){this.game.input.disabled||this.disabled||(t.preventDefault(),t.identifier=t.pointerId,this.game.input.updatePointer(t))},onPointerUp:function(t){this.game.input.disabled||this.disabled||(t.preventDefault(),t.identifier=t.pointerId,this.game.input.stopPointer(t))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp),this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown),this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove),this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}},e.MSPointer.prototype.constructor=e.MSPointer,e.Pointer=function(game,t){this.game=game,this.id=t,this.type=e.POINTER,this.exists=!0,this.identifier=0,this.pointerId=null,this.target=null,this.button=null,this._holdSent=!1,this._history=[],this._nextDrop=0,this._stateReset=!1,this.withinGame=!1,this.clientX=-1,this.clientY=-1,this.pageX=-1,this.pageY=-1,this.screenX=-1,this.screenY=-1,this.rawMovementX=0,this.rawMovementY=0,this.movementX=0,this.movementY=0,this.x=-1,this.y=-1,this.isMouse=!1,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.timeUp=0,this.previousTapTime=0,this.totalTouches=0,this.msSinceLastClick=Number.MAX_VALUE,this.targetObject=null,this.active=!1,this.dirty=!1,this.position=new e.Point,this.positionDown=new e.Point,this.positionUp=new e.Point,this.circle=new e.Circle(0,0,44),0===t&&(this.isMouse=!0)},e.Pointer.prototype={start:function(t){return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,"undefined"!=typeof t.button&&(this.button=t.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,t),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,null!==this.targetObject&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(!0),this.dirty=!1),this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==e.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==e.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==e.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(t,i){if(!this.game.input.pollLocked){if("undefined"==typeof i&&(i=!1),"undefined"!=typeof t.button&&(this.button=t.button),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&this.game.input.mouse.locked&&!i&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var n=this.game.input.moveCallbacks.length;n--;)this.game.input.moveCallbacks[n].callback.call(this.game.input.moveCallbacks[n].context,this,this.x,this.y,i);return null!==this.targetObject&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(i),this}},processInteractiveObjects:function(t){this.game.input.interactiveItems.setAll("checked",!1),this._highestRenderOrderID=Number.MAX_SAFE_INTEGER,this._highestRenderObject=null,this._highestInputPriorityID=-1;var e=this.game.input.interactiveItems.first;do e&&e.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!1)&&(e.checked=!0,(t&&e.checkPointerDown(this,!0)||!t&&e.checkPointerOver(this,!0))&&(this._highestRenderOrderID=e.sprite._cache[3],this._highestInputPriorityID=e.priorityID,this._highestRenderObject=e)),e=this.game.input.interactiveItems.next;while(null!==e);var e=this.game.input.interactiveItems.first;do e&&!e.checked&&e.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!0)&&(t&&e.checkPointerDown(this,!1)||!t&&e.checkPointerOver(this,!1))&&(this._highestRenderOrderID=e.sprite._cache[3],this._highestInputPriorityID=e.priorityID,this._highestRenderObject=e),e=this.game.input.interactiveItems.next;while(null!==e);return null===this._highestRenderObject?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):null===this.targetObject?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject===this._highestRenderObject?this._highestRenderObject.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this)),null!==this.targetObject},leave:function(t){this.withinGame=!1,this.move(t,!1)},stop:function(t){return this._stateReset?void t.preventDefault():(this.timeUp=this.game.time.now,(this.game.input.multiInputOverride===e.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===e.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===e.Input.TOUCH_OVERRIDES_MOUSE&&0===this.game.input.currentPointers)&&(this.game.input.onUp.dispatch(this,t),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this.targetObject=null,this)},justPressed:function(t){return t=t||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+t>this.game.time.now},justReleased:function(t){return t=t||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+t>this.game.time.now},reset:function(){this.isMouse===!1&&(this.active=!1),this.pointerId=null,this.identifier=null,this.dirty=!1,this.isDown=!1,this.isUp=!0,this.totalTouches=0,this._holdSent=!1,this._history.length=0,this._stateReset=!0,this.targetObject&&this.targetObject._releasedHandler(this),this.targetObject=null},resetMovement:function(){this.movementX=0,this.movementY=0}},e.Pointer.prototype.constructor=e.Pointer,Object.defineProperty(e.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}}),Object.defineProperty(e.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}}),Object.defineProperty(e.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}}),e.Touch=function(game){this.game=game,this.disabled=!1,this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null,this.preventDefault=!0,this.event=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchCancel=null,this._onTouchMove=null},e.Touch.prototype={start:function(){if(null===this._onTouchStart){var t=this;this.game.device.touch&&(this._onTouchStart=function(e){return t.onTouchStart(e)},this._onTouchMove=function(e){return t.onTouchMove(e)},this._onTouchEnd=function(e){return t.onTouchEnd(e)},this._onTouchEnter=function(e){return t.onTouchEnter(e)},this._onTouchLeave=function(e){return t.onTouchLeave(e)},this._onTouchCancel=function(e){return t.onTouchCancel(e)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()},document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(t){if(this.event=t,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),!this.game.input.disabled&&!this.disabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){if(this.event=t,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),!this.game.input.disabled&&!this.disabled){this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled||this.preventDefault&&t.preventDefault()},onTouchLeave:function(t){this.event=t,this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault()},onTouchMove:function(t){this.event=t,this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.updatePointer(t.changedTouches[e])},onTouchEnd:function(t){this.event=t,this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),this.preventDefault&&t.preventDefault();for(var e=0;e<t.changedTouches.length;e++)this.game.input.stopPointer(t.changedTouches[e])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}},e.Touch.prototype.constructor=e.Touch,e.Gamepad=function(game){this.game=game,this._gamepadIndexMap={},this._rawPads=[],this._active=!1,this.disabled=!1,this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!=navigator.userAgent.indexOf("Firefox/")||!!navigator.getGamepads,this._prevRawGamepadTypes=[],this._prevTimestamps=[],this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this._ongamepadconnected=null,this._gamepaddisconnected=null,this._gamepads=[new e.SinglePad(game,this),new e.SinglePad(game,this),new e.SinglePad(game,this),new e.SinglePad(game,this)]},e.Gamepad.prototype={addCallbacks:function(t,e){"undefined"!=typeof e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback)},start:function(){if(!this._active){this._active=!0;var t=this;this._onGamepadConnected=function(e){return t.onGamepadConnected(e)},this._onGamepadDisconnected=function(e){return t.onGamepadDisconnected(e)},window.addEventListener("gamepadconnected",this._onGamepadConnected,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e),this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads)this._rawPads[i].index===e.index&&this._rawPads.splice(i,1);this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads(),this.pad1.pollStatus(),this.pad2.pollStatus(),this.pad3.pollStatus(),this.pad4.pollStatus()},_pollGamepads:function(){if(navigator.getGamepads)var t=navigator.getGamepads();else if(navigator.webkitGetGamepads)var t=navigator.webkitGetGamepads();else if(navigator.webkitGamepads)var t=navigator.webkitGamepads();if(t){this._rawPads=[];for(var e=!1,i=0;i<t.length&&(typeof t[i]!==this._prevRawGamepadTypes[i]&&(e=!0,
this._prevRawGamepadTypes[i]=typeof t[i]),t[i]&&this._rawPads.push(t[i]),3!==i);i++);if(e){for(var n,s={rawIndices:{},padIndices:{}},r=0;r<this._gamepads.length;r++)if(n=this._gamepads[r],n.connected)for(var o=0;o<this._rawPads.length;o++)this._rawPads[o].index===n.index&&(s.rawIndices[n.index]=!0,s.padIndices[r]=!0);for(var a=0;a<this._gamepads.length;a++)if(n=this._gamepads[a],!s.padIndices[a]){this._rawPads.length<1&&n.disconnect();for(var h=0;h<this._rawPads.length&&!s.padIndices[a];h++){var l=this._rawPads[h];if(l){if(s.rawIndices[l.index]){n.disconnect();continue}n.connect(l),s.rawIndices[l.index]=!0,s.padIndices[a]=!0}else n.disconnect()}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++)this._gamepads[e].deadZone=t},stop:function(){this._active=!1,window.removeEventListener("gamepadconnected",this._onGamepadConnected),window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].reset()},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justPressed(t,e)===!0)return!0;return!1},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justReleased(t,e)===!0)return!0;return!1},isDown:function(t){for(var e=0;e<this._gamepads.length;e++)if(this._gamepads[e].isDown(t)===!0)return!0;return!1},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].destroy()}},e.Gamepad.prototype.constructor=e.Gamepad,Object.defineProperty(e.Gamepad.prototype,"active",{get:function(){return this._active}}),Object.defineProperty(e.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}}),Object.defineProperty(e.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}}),Object.defineProperty(e.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}}),Object.defineProperty(e.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}}),Object.defineProperty(e.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}}),Object.defineProperty(e.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}}),e.Gamepad.BUTTON_0=0,e.Gamepad.BUTTON_1=1,e.Gamepad.BUTTON_2=2,e.Gamepad.BUTTON_3=3,e.Gamepad.BUTTON_4=4,e.Gamepad.BUTTON_5=5,e.Gamepad.BUTTON_6=6,e.Gamepad.BUTTON_7=7,e.Gamepad.BUTTON_8=8,e.Gamepad.BUTTON_9=9,e.Gamepad.BUTTON_10=10,e.Gamepad.BUTTON_11=11,e.Gamepad.BUTTON_12=12,e.Gamepad.BUTTON_13=13,e.Gamepad.BUTTON_14=14,e.Gamepad.BUTTON_15=15,e.Gamepad.AXIS_0=0,e.Gamepad.AXIS_1=1,e.Gamepad.AXIS_2=2,e.Gamepad.AXIS_3=3,e.Gamepad.AXIS_4=4,e.Gamepad.AXIS_5=5,e.Gamepad.AXIS_6=6,e.Gamepad.AXIS_7=7,e.Gamepad.AXIS_8=8,e.Gamepad.AXIS_9=9,e.Gamepad.XBOX360_A=0,e.Gamepad.XBOX360_B=1,e.Gamepad.XBOX360_X=2,e.Gamepad.XBOX360_Y=3,e.Gamepad.XBOX360_LEFT_BUMPER=4,e.Gamepad.XBOX360_RIGHT_BUMPER=5,e.Gamepad.XBOX360_LEFT_TRIGGER=6,e.Gamepad.XBOX360_RIGHT_TRIGGER=7,e.Gamepad.XBOX360_BACK=8,e.Gamepad.XBOX360_START=9,e.Gamepad.XBOX360_STICK_LEFT_BUTTON=10,e.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11,e.Gamepad.XBOX360_DPAD_LEFT=14,e.Gamepad.XBOX360_DPAD_RIGHT=15,e.Gamepad.XBOX360_DPAD_UP=12,e.Gamepad.XBOX360_DPAD_DOWN=13,e.Gamepad.XBOX360_STICK_LEFT_X=0,e.Gamepad.XBOX360_STICK_LEFT_Y=1,e.Gamepad.XBOX360_STICK_RIGHT_X=2,e.Gamepad.XBOX360_STICK_RIGHT_Y=3,e.Gamepad.PS3XC_X=0,e.Gamepad.PS3XC_CIRCLE=1,e.Gamepad.PS3XC_SQUARE=2,e.Gamepad.PS3XC_TRIANGLE=3,e.Gamepad.PS3XC_L1=4,e.Gamepad.PS3XC_R1=5,e.Gamepad.PS3XC_L2=6,e.Gamepad.PS3XC_R2=7,e.Gamepad.PS3XC_SELECT=8,e.Gamepad.PS3XC_START=9,e.Gamepad.PS3XC_STICK_LEFT_BUTTON=10,e.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11,e.Gamepad.PS3XC_DPAD_UP=12,e.Gamepad.PS3XC_DPAD_DOWN=13,e.Gamepad.PS3XC_DPAD_LEFT=14,e.Gamepad.PS3XC_DPAD_RIGHT=15,e.Gamepad.PS3XC_STICK_LEFT_X=0,e.Gamepad.PS3XC_STICK_LEFT_Y=1,e.Gamepad.PS3XC_STICK_RIGHT_X=2,e.Gamepad.PS3XC_STICK_RIGHT_Y=3,e.SinglePad=function(game,t){this.game=game,this.index=null,this.connected=!1,this.callbackContext=this,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null,this.deadZone=.26,this._padParent=t,this._rawPad=null,this._prevTimestamp=null,this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0},e.SinglePad.prototype={addCallbacks:function(t,e){"undefined"!=typeof e&&(this.onConnectCallback="function"==typeof e.onConnect?e.onConnect:this.onConnectCallback,this.onDisconnectCallback="function"==typeof e.onDisconnect?e.onDisconnect:this.onDisconnectCallback,this.onDownCallback="function"==typeof e.onDown?e.onDown:this.onDownCallback,this.onUpCallback="function"==typeof e.onUp?e.onUp:this.onUpCallback,this.onAxisCallback="function"==typeof e.onAxis?e.onAxis:this.onAxisCallback,this.onFloatCallback="function"==typeof e.onFloat?e.onFloat:this.onFloatCallback)},getButton:function(t){return this._buttons[t]?this._buttons[t]:null},pollStatus:function(){if(!(!this.connected||this.game.input.disabled||this.game.input.gamepad.disabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp)){for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];e!==this._buttons[t].value&&(1===e?this.processButtonDown(t,e):0===e?this.processButtonUp(t,e):this.processButtonFloat(t,e))}for(var i=0;i<this._axesLen;i++){var n=this._rawPad.axes[i];n>0&&n>this.deadZone||0>n&&n<-this.deadZone?this.processAxisChange(i,n):this.processAxisChange(i,0)}this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var i=!this.connected;this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length;for(var n=0;n<this._axesLen;n++)this._axes[n]=t.axes[n];for(var s in t.buttons)s=parseInt(s,10),this._buttons[s]=new e.GamepadButton(this,s);i&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index),i&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,e=this.index;this.connected=!1,this.index=null,this._rawPad=void 0;for(var i=0;i<this._buttonsLen;i++)this._buttons[i].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e),t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=void 0;for(var t=0;t<this._buttonsLen;t++)this._buttons[t].destroy();this._buttons=[],this._buttonsLen=0,this._axes=[],this._axesLen=0,this.onConnectCallback=null,this.onDisconnectCallback=null,this.onDownCallback=null,this.onUpCallback=null,this.onAxisCallback=null,this.onFloatCallback=null},processAxisChange:function(t,e){this._axes[t]!==e&&(this._axes[t]=e,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,t,e))},processButtonDown:function(t,e){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index),this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].processButtonDown(e)},processButtonUp:function(t,e){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].processButtonUp(e)},processButtonFloat:function(t,e){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index),this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,t,e),this._buttons[t]&&this._buttons[t].processButtonFloat(e)},axis:function(t){return this._axes[t]?this._axes[t]:!1},isDown:function(t){return this._buttons[t]?this._buttons[t].isDown:!1},isUp:function(t){return this._buttons[t]?this._buttons[t].isUp:!1},justReleased:function(t,e){return this._buttons[t]?this._buttons[t].justReleased(e):void 0},justPressed:function(t,e){return this._buttons[t]?this._buttons[t].justPressed(e):void 0},buttonValue:function(t){return this._buttons[t]?this._buttons[t].value:null},reset:function(){for(var t=0;t<this._axes.length;t++)this._axes[t]=0}},e.SinglePad.prototype.constructor=e.SinglePad,e.GamepadButton=function(t,i){this.pad=t,this.game=t.game,this.isDown=!1,this.isUp=!0,this.timeDown=0,this.duration=0,this.timeUp=0,this.repeats=0,this.value=0,this.buttonCode=i,this.onDown=new e.Signal,this.onUp=new e.Signal,this.onFloat=new e.Signal},e.GamepadButton.prototype={processButtonDown:function(t){this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.value=t,this.onDown.dispatch(this,t)},processButtonUp:function(t){this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.value=t,this.onUp.dispatch(this,t)},processButtonFloat:function(t){this.value=t,this.onFloat.dispatch(this,t)},justPressed:function(t){return t=t||250,this.isDown===!0&&this.timeDown+t>this.game.time.now},justReleased:function(t){return t=t||250,this.isUp===!0&&this.timeUp+t>this.game.time.now},reset:function(){this.isDown=!1,this.isUp=!0,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0},destroy:function(){this.onDown.dispose(),this.onUp.dispose(),this.onFloat.dispose(),this.pad=null,this.game=null}},e.GamepadButton.prototype.constructor=e.GamepadButton,e.InputHandler=function(t){this.sprite=t,this.game=t.game,this.enabled=!1,this.checked=!1,this.priorityID=0,this.useHandCursor=!1,this._setHandCursor=!1,this.isDragged=!1,this.allowHorizontalDrag=!0,this.allowVerticalDrag=!0,this.bringToTop=!1,this.snapOffset=null,this.snapOnDrag=!1,this.snapOnRelease=!1,this.snapX=0,this.snapY=0,this.snapOffsetX=0,this.snapOffsetY=0,this.pixelPerfectOver=!1,this.pixelPerfectClick=!1,this.pixelPerfectAlpha=255,this.draggable=!1,this.boundsRect=null,this.boundsSprite=null,this.consumePointerEvent=!1,this.scaleLayer=!1,this._dragPhase=!1,this._wasEnabled=!1,this._tempPoint=new e.Point,this._pointerData=[],this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})},e.InputHandler.prototype={start:function(t,i){if(t=t||0,"undefined"==typeof i&&(i=!1),this.enabled===!1){this.game.input.interactiveItems.add(this),this.useHandCursor=i,this.priorityID=t;for(var n=0;10>n;n++)this._pointerData[n]={id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new e.Point,this.enabled=!0,this._wasEnabled=!0,this.sprite.events&&null===this.sprite.events.onInputOver&&(this.sprite.events.onInputOver=new e.Signal,this.sprite.events.onInputOut=new e.Signal,this.sprite.events.onInputDown=new e.Signal,this.sprite.events.onInputUp=new e.Signal,this.sprite.events.onDragStart=new e.Signal,this.sprite.events.onDragStop=new e.Signal)}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1,this.flagged=!1;for(var t=0;10>t;t++)this._pointerData[t]={id:t,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(t,e,i){return"undefined"==typeof i&&(i=!0),0===this.sprite.scale.x||0===this.sprite.scale.y||this.priorityID<this.game.input.minPriorityID?!1:(i||!this.pixelPerfectClick&&!this.pixelPerfectOver)&&(this.priorityID>t||this.priorityID===t&&this.sprite._cache[3]<e)?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){return t=t||0,this._pointerData[t].x},pointerY:function(t){return t=t||0,this._pointerData[t].y},pointerDown:function(t){return t=t||0,this._pointerData[t].isDown},pointerUp:function(t){return t=t||0,this._pointerData[t].isUp},pointerTimeDown:function(t){return t=t||0,this._pointerData[t].timeDown},pointerTimeUp:function(t){return t=t||0,this._pointerData[t].timeUp},pointerOver:function(t){if(this.enabled){if("undefined"!=typeof t)return this._pointerData[t].isOver;for(var e=0;10>e;e++)if(this._pointerData[e].isOver)return!0}return!1},pointerOut:function(t){if(this.enabled){if("undefined"!=typeof t)return this._pointerData[t].isOut;for(var e=0;10>e;e++)if(this._pointerData[e].isOut)return!0}return!1},pointerTimeOver:function(t){return t=t||0,this._pointerData[t].timeOver},pointerTimeOut:function(t){return t=t||0,this._pointerData[t].timeOut},pointerDragged:function(t){return t=t||0,this._pointerData[t].isDragged},checkPointerDown:function(t,e){return t.isDown&&this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,t,this._tempPoint)?("undefined"==typeof e&&(e=!1),!e&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(t,e){return this.enabled&&this.sprite&&this.sprite.parent&&this.sprite.visible&&this.sprite.parent.visible&&this.game.input.hitTest(this.sprite,t,this._tempPoint)?("undefined"==typeof e&&(e=!1),!e&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(null===t&&null===e){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);var t=this._tempPoint.x,e=this._tempPoint.y}if(0!==this.sprite.anchor.x&&(t-=-this.sprite.texture.frame.width*this.sprite.anchor.x),0!==this.sprite.anchor.y&&(e-=-this.sprite.texture.frame.height*this.sprite.anchor.y),t+=this.sprite.texture.frame.x,e+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(t-=this.sprite.texture.trim.x,e-=this.sprite.texture.trim.y,t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom))return this._dx=t,this._dy=e,!1;this._dx=t,this._dy=e,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1);var n=this.game.input.hitContext.getImageData(0,0,1,1);if(n.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(t){return null!==this.sprite&&void 0!==this.sprite.parent?this.enabled&&this.sprite.visible&&this.sprite.parent.visible?this.draggable&&this._draggedPointerID===t.id?this.updateDrag(t):this._pointerData[t.id].isOver?this.checkPointerOver(t)?(this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,!0):(this._pointerOutHandler(t),!1):void 0:(this._pointerOutHandler(t),!1):void 0},_pointerOverHandler:function(t){null!==this.sprite&&(this._pointerData[t.id].isOver===!1||t.dirty)&&(this._pointerData[t.id].isOver=!0,this._pointerData[t.id].isOut=!1,this._pointerData[t.id].timeOver=this.game.time.now,this._pointerData[t.id].x=t.x-this.sprite.x,this._pointerData[t.id].y=t.y-this.sprite.y,this.useHandCursor&&this._pointerData[t.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver.dispatch(this.sprite,t))},_pointerOutHandler:function(t){null!==this.sprite&&(this._pointerData[t.id].isOver=!1,this._pointerData[t.id].isOut=!0,this._pointerData[t.id].timeOut=this.game.time.now,this.useHandCursor&&this._pointerData[t.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut.dispatch(this.sprite,t))},_touchedHandler:function(t){if(null!==this.sprite){if(this._pointerData[t.id].isDown===!1&&this._pointerData[t.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t))return;this._pointerData[t.id].isDown=!0,this._pointerData[t.id].isUp=!1,this._pointerData[t.id].timeDown=this.game.time.now,this.sprite&&this.sprite.events&&this.sprite.events.onInputDown.dispatch(this.sprite,t),t.dirty=!0,this.draggable&&this.isDragged===!1&&this.startDrag(t),this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(t){null!==this.sprite&&this._pointerData[t.id].isDown&&t.isUp&&(this._pointerData[t.id].isDown=!1,this._pointerData[t.id].isUp=!0,this._pointerData[t.id].timeUp=this.game.time.now,this._pointerData[t.id].downDuration=this._pointerData[t.id].timeUp-this._pointerData[t.id].timeDown,this.checkPointerOver(t)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,t,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,t,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),t.dirty=!0,this.draggable&&this.isDragged&&this._draggedPointerID===t.id&&this.stopDrag(t))},updateDrag:function(t){if(t.isUp)return this.stopDrag(t),!1;var e=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x,i=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;return this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=e),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=i),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=e),this.allowVerticalDrag&&(this.sprite.y=i),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0},justOver:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isOut&&this.game.time.now-this._pointerData[t].timeOut<e},justPressed:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){return t=t||0,e=e||500,this._pointerData[t].isUp&&this.game.time.now-this._pointerData[t].timeUp<e},overDuration:function(t){return t=t||0,this._pointerData[t].isOver?this.game.time.now-this._pointerData[t].timeOver:-1},downDuration:function(t){return t=t||0,this._pointerData[t].isDown?this.game.time.now-this._pointerData[t].timeDown:-1},enableDrag:function(t,i,n,s,r,o){"undefined"==typeof t&&(t=!1),"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=255),"undefined"==typeof r&&(r=null),"undefined"==typeof o&&(o=null),this._dragPoint=new e.Point,this.draggable=!0,this.bringToTop=i,this.dragOffset=new e.Point,this.dragFromCenter=t,this.pixelPerfectClick=n,this.pixelPerfectAlpha=s,r&&(this.boundsRect=r),o&&(this.boundsSprite=o)},disableDrag:function(){if(this._pointerData)for(var t=0;10>t;t++)this._pointerData[t].isDragged=!1;this.draggable=!1,this.isDragged=!1,this._draggedPointerID=-1},startDrag:function(t){if(this.isDragged=!0,this._draggedPointerID=t.id,this._pointerData[t.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(t.x,t.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y);else{if(this.dragFromCenter){var e=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-e.centerX),this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-e.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))}this.updateDrag(t),this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop()),this.sprite.events.onDragStart.dispatch(this.sprite,t)},globalToLocalX:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.x,t*=this.game.scale.grid.scaleFluidInversed.x),t},globalToLocalY:function(t){return this.scaleLayer&&(t-=this.game.scale.grid.boundsFluid.y,t*=this.game.scale.grid.scaleFluidInversed.y),t},stopDrag:function(t){this.isDragged=!1,this._draggedPointerID=-1,this._pointerData[t.id].isDragged=!1,this._dragPhase=!1,this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),this.sprite.events.onDragStop.dispatch(this.sprite,t),this.checkPointerOver(t)===!1&&this._pointerOutHandler(t)},setDragLock:function(t,e){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!0),this.allowHorizontalDrag=t,this.allowVerticalDrag=e},enableSnap:function(t,e,i,n,s,r){"undefined"==typeof i&&(i=!0),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=0),this.snapX=t,this.snapY=e,this.snapOffsetX=s,this.snapOffsetY=r,this.snapOnDrag=i,this.snapOnRelease=n},disableSnap:function(){this.snapOnDrag=!1,this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.camerOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.camerOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height))}},e.InputHandler.prototype.constructor=e.InputHandler,e.Events=function(t){this.parent=t,this.onAddedToGroup=new e.Signal,this.onRemovedFromGroup=new e.Signal,this.onDestroy=new e.Signal,this.onKilled=new e.Signal,this.onRevived=new e.Signal,this.onOutOfBounds=new e.Signal,this.onEnterBounds=new e.Signal,this.onInputOver=null,this.onInputOut=null,this.onInputDown=null,this.onInputUp=null,this.onDragStart=null,this.onDragStop=null,this.onAnimationStart=null,this.onAnimationComplete=null,this.onAnimationLoop=null},e.Events.prototype={destroy:function(){this.parent=null,this.onDestroy.dispose(),this.onAddedToGroup.dispose(),this.onRemovedFromGroup.dispose(),this.onKilled.dispose(),this.onRevived.dispose(),this.onOutOfBounds.dispose(),this.onInputOver&&(this.onInputOver.dispose(),this.onInputOut.dispose(),this.onInputDown.dispose(),this.onInputUp.dispose(),this.onDragStart.dispose(),this.onDragStop.dispose()),this.onAnimationStart&&(this.onAnimationStart.dispose(),this.onAnimationComplete.dispose(),this.onAnimationLoop.dispose())}},e.Events.prototype.constructor=e.Events,e.GameObjectFactory=function(game){this.game=game,this.world=this.game.world},e.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},image:function(t,i,n,s,r){return"undefined"==typeof r&&(r=this.world),r.add(new e.Image(this.game,t,i,n,s))},sprite:function(t,e,i,n,s){return"undefined"==typeof s&&(s=this.world),s.create(t,e,i,n)},tween:function(t){return this.game.tweens.create(t)},group:function(t,i,n,s,r){return new e.Group(this.game,t,i,n,s,r)},physicsGroup:function(t,i,n,s){return new e.Group(this.game,i,n,s,!0,t)},spriteBatch:function(t,i,n){return"undefined"==typeof t&&(t=null),"undefined"==typeof i&&(i="group"),"undefined"==typeof n&&(n=!1),new e.SpriteBatch(this.game,t,i,n)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,i,n,s,r,o,a){return"undefined"==typeof a&&(a=this.world),a.add(new e.TileSprite(this.game,t,i,n,s,r,o))},rope:function(t,i,n,s,r,o){return"undefined"==typeof o&&(o=this.world),o.add(new e.Rope(this.game,t,i,n,s,r))},text:function(t,i,n,s,r){return"undefined"==typeof r&&(r=this.world),r.add(new e.Text(this.game,t,i,n,s))},button:function(t,i,n,s,r,o,a,h,l,c){return"undefined"==typeof c&&(c=this.world),c.add(new e.Button(this.game,t,i,n,s,r,o,a,h,l))},graphics:function(t,i,n){return"undefined"==typeof n&&(n=this.world),n.add(new e.Graphics(this.game,t,i))},emitter:function(t,i,n){return this.game.particles.add(new e.Particles.Arcade.Emitter(this.game,t,i,n))},retroFont:function(t,i,n,s,r,o,a,h,l){return new e.RetroFont(this.game,t,i,n,s,r,o,a,h,l)},bitmapText:function(t,i,n,s,r,o){return"undefined"==typeof o&&(o=this.world),o.add(new e.BitmapText(this.game,t,i,n,s,r))},tilemap:function(t,i,n,s,r){return new e.Tilemap(this.game,t,i,n,s,r)},renderTexture:function(t,i,n,s){("undefined"==typeof n||""===n)&&(n=this.game.rnd.uuid()),"undefined"==typeof s&&(s=!1);var r=new e.RenderTexture(this.game,t,i,n);return s&&this.game.cache.addRenderTexture(n,r),r},bitmapData:function(t,i,n,s){"undefined"==typeof s&&(s=!1),("undefined"==typeof n||""===n)&&(n=this.game.rnd.uuid());var r=new e.BitmapData(this.game,n,t,i);return s&&this.game.cache.addBitmapData(n,r),r},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new e.Filter[t](this.game);return t.init.apply(t,i),t},plugin:function(t){return this.game.plugins.add(t)}},e.GameObjectFactory.prototype.constructor=e.GameObjectFactory,e.GameObjectCreator=function(game){this.game=game,this.world=this.game.world},e.GameObjectCreator.prototype={image:function(t,i,n,s){return new e.Image(this.game,t,i,n,s)},sprite:function(t,i,n,s){return new e.Sprite(this.game,t,i,n,s)},tween:function(t){return new e.Tween(t,this.game)},group:function(t,i,n,s,r){return new e.Group(this.game,null,i,n,s,r)},spriteBatch:function(t,i,n){return"undefined"==typeof i&&(i="group"),"undefined"==typeof n&&(n=!1),new e.SpriteBatch(this.game,t,i,n)},audio:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,n){return this.game.sound.add(t,e,i,n)},tileSprite:function(t,i,n,s,r,o){return new e.TileSprite(this.game,t,i,n,s,r,o)},rope:function(t,i,n,s,r){return new e.Rope(this.game,t,i,n,s,r)},text:function(t,i,n,s){return new e.Text(this.game,t,i,n,s)},button:function(t,i,n,s,r,o,a,h,l){return new e.Button(this.game,t,i,n,s,r,o,a,h,l)},graphics:function(t,i){return new e.Graphics(this.game,t,i)},emitter:function(t,i,n){return new e.Particles.Arcade.Emitter(this.game,t,i,n)},retroFont:function(t,i,n,s,r,o,a,h,l){return new e.RetroFont(this.game,t,i,n,s,r,o,a,h,l)},bitmapText:function(t,i,n,s,r){return new e.BitmapText(this.game,t,i,n,s,r)},tilemap:function(t,i,n,s,r){return new e.Tilemap(this.game,t,i,n,s,r)},renderTexture:function(t,i,n,s){("undefined"==typeof n||""===n)&&(n=this.game.rnd.uuid()),"undefined"==typeof s&&(s=!1);var r=new e.RenderTexture(this.game,t,i,n);return s&&this.game.cache.addRenderTexture(n,r),r},bitmapData:function(t,i,n,s){"undefined"==typeof s&&(s=!1),("undefined"==typeof n||""===n)&&(n=this.game.rnd.uuid());var r=new e.BitmapData(this.game,n,t,i);return s&&this.game.cache.addBitmapData(n,r),r},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new e.Filter[t](this.game);return t.init.apply(t,i),t}},e.GameObjectCreator.prototype.constructor=e.GameObjectCreator,e.BitmapData=function(game,t,i,n){"undefined"==typeof i&&(i=256),"undefined"==typeof n&&(n=256),this.game=game,this.key=t,this.width=i,this.height=n,this.canvas=e.Canvas.create(i,n,"",!0),this.context=this.canvas.getContext("2d"),this.ctx=this.context,this.imageData=this.context.getImageData(0,0,i,n),this.data=this.imageData.data,this.pixels=null,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new e.Frame(0,0,0,i,n,"bitmapData",game.rnd.uuid()),this.texture.frame=this.textureFrame,this.type=e.BITMAPDATA,this.disableTextureUpload=!1,this.dirty=!1,this.cls=this.clear,this._image=null,this._pos=new e.Point,this._size=new e.Point,this._scale=new e.Point,this._rotate=0,this._alpha={prev:1,current:1},this._anchor=new e.Point,this._tempR=0,this._tempG=0,this._tempB=0,this._circle=new e.Circle},e.BitmapData.prototype={add:function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)t[e].loadTexture&&t[e].loadTexture(this);else t.loadTexture(this);return this},load:function(t){return"string"==typeof t&&(t=this.game.cache.getImage(t)),t?(this.resize(t.width,t.height),this.cls(),this.draw(t),this.update(),this):void 0},clear:function(){return this.context.clearRect(0,0,this.width,this.height),this.dirty=!0,this},fill:function(t,e,i,n){return"undefined"==typeof n&&(n=1),this.context.fillStyle="rgba("+t+","+e+","+i+","+n+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(t,e){return(t!==this.width||e!==this.height)&&(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.baseTexture.width=t,this.baseTexture.height=e,this.textureFrame.width=t,this.textureFrame.height=e,
this.texture.width=t,this.texture.height=e,this.texture.crop.width=t,this.texture.crop.height=e,this.update(),this.dirty=!0),this},update:function(t,e,i,n){return"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=this.width),"undefined"==typeof n&&(n=this.height),this.imageData=this.context.getImageData(t,e,i,n),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,i,n,s,r,o){"undefined"==typeof n&&(n=0),"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=this.width),"undefined"==typeof o&&(o=this.height);for(var a=n+r,h=s+o,l=e.Color.createColor(),c={r:0,g:0,b:0,a:0},u=!1,d=s;h>d;d++)for(var A=n;a>A;A++)e.Color.unpackPixel(this.getPixel32(A,d),l),c=t.call(i,l,A,d),c!==!1&&null!==c&&void 0!==c&&(this.setPixel32(A,d,c.r,c.g,c.b,c.a,!1),u=!0);return u&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(t,e,i,n,s,r){"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof s&&(s=this.width),"undefined"==typeof r&&(r=this.height);for(var o=i+s,a=n+r,h=0,l=0,c=!1,u=n;a>u;u++)for(var d=i;o>d;d++)h=this.getPixel32(d,u),l=t.call(e,h,d,u),l!==h&&(this.pixels[u*this.width+d]=l,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,i,n,s,r,o,a,h,l){var c=0,u=0,d=this.width,A=this.height,p=e.Color.packPixel(t,i,n,s);void 0!==l&&l instanceof e.Rectangle&&(c=l.x,u=l.y,d=l.width,A=l.height);for(var m=0;A>m;m++)for(var f=0;d>f;f++)this.getPixel32(c+f,u+m)===p&&this.setPixel32(c+f,u+m,r,o,a,h,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,i,n,s){if(("undefined"==typeof t||null===t)&&(t=!1),("undefined"==typeof i||null===i)&&(i=!1),("undefined"==typeof n||null===n)&&(n=!1),t||i||n){"undefined"==typeof s&&(s=new e.Rectangle(0,0,this.width,this.height));for(var r=e.Color.createColor(),o=s.y;o<s.bottom;o++)for(var a=s.x;a<s.right;a++)e.Color.unpackPixel(this.getPixel32(a,o),r,!0),t&&(r.h=t),i&&(r.s=i),n&&(r.l=n),e.Color.HSLtoRGB(r.h,r.s,r.l,r),this.setPixel32(a,o,r.r,r.g,r.b,r.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,i,n,s){if(("undefined"==typeof t||null===t)&&(t=!1),("undefined"==typeof i||null===i)&&(i=!1),("undefined"==typeof n||null===n)&&(n=!1),t||i||n){"undefined"==typeof s&&(s=new e.Rectangle(0,0,this.width,this.height));for(var r=e.Color.createColor(),o=s.y;o<s.bottom;o++)for(var a=s.x;a<s.right;a++)e.Color.unpackPixel(this.getPixel32(a,o),r,!0),t&&(r.h=this.game.math.wrap(r.h+t,0,1)),i&&(r.s=this.game.math.limitValue(r.s+i,0,1)),n&&(r.l=this.game.math.limitValue(r.l+n,0,1)),e.Color.HSLtoRGB(r.h,r.s,r.l,r),this.setPixel32(a,o,r.r,r.g,r.b,r.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,i,n,s,r,o,a){return"undefined"==typeof a&&(a=!0),t>=0&&t<=this.width&&i>=0&&i<=this.height&&(e.Device.LITTLE_ENDIAN?this.pixels[i*this.width+t]=o<<24|r<<16|s<<8|n:this.pixels[i*this.width+t]=n<<24|s<<16|r<<8|o,a&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(t,e,i,n,s,r){return this.setPixel32(t,e,i,n,s,255,r)},getPixel:function(t,i,n){n||(n=e.Color.createColor());var s=~~(t+i*this.width);return s*=4,n.r=this.data[s],n.g=this.data[++s],n.b=this.data[++s],n.a=this.data[++s],n},getPixel32:function(t,e){return t>=0&&t<=this.width&&e>=0&&e<=this.height?this.pixels[e*this.width+t]:void 0},getPixelRGB:function(t,i,n,s,r){return e.Color.unpackPixel(this.getPixel32(t,i),n,s,r)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){"undefined"==typeof t&&(t=0);var i=e.Color.createColor(),n=0,s=0,r=1,o=!1;1===t?(r=-1,s=this.height):3===t&&(r=-1,n=this.width);do e.Color.unpackPixel(this.getPixel32(n,s),i),0===t||1===t?(n++,n===this.width&&(n=0,s+=r,(s>=this.height||0>=s)&&(o=!0))):(2===t||3===t)&&(s++,s===this.height&&(s=0,n+=r,(n>=this.width||0>=n)&&(o=!0)));while(0===i.a&&!o);return i.x=n,i.y=s,i},getBounds:function(t){return"undefined"==typeof t&&(t=new e.Rectangle),t.x=this.getFirstPixel(2).x,t.x===this.width?t.setTo(0,0,0,0):(t.y=this.getFirstPixel(0).y,t.width=this.getFirstPixel(3).x-t.x+1,t.height=this.getFirstPixel(1).y-t.y+1,t)},addToWorld:function(t,e,i,n,s,r){s=s||1,r=r||1;var o=this.game.add.image(t,e,this);return o.anchor.set(i,n),o.scale.set(s,r),o},copy:function(t,i,n,s,r,o,a,h,l,c,u,d,A,p,m,f,g){if(("undefined"==typeof t||null===t)&&(t=this),this._image=t,t instanceof e.Sprite||t instanceof e.Image||t instanceof e.Text)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,this._image=t.texture.baseTexture.source,t.texture.trim&&(o+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height),16777215!==t.tint&&(t.cachedTint!==t.tint&&(t.cachedTint=t.tint,t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)),this._image=t.tintedTexture);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof e.BitmapData)this._image=t.canvas;else if("string"==typeof t){if(t=this.game.cache.getImage(t),null===t)return;this._image=t}this._size.set(this._image.width,this._image.height)}return("undefined"==typeof i||null===i)&&(i=0),("undefined"==typeof n||null===n)&&(n=0),s&&(this._size.x=s),r&&(this._size.y=r),("undefined"==typeof o||null===o)&&(o=i),("undefined"==typeof a||null===a)&&(a=n),("undefined"==typeof h||null===h)&&(h=this._size.x),("undefined"==typeof l||null===l)&&(l=this._size.y),"number"==typeof c&&(this._rotate=c),"number"==typeof u&&(this._anchor.x=u),"number"==typeof d&&(this._anchor.y=d),"number"==typeof A&&(this._scale.x=A),"number"==typeof p&&(this._scale.y=p),"number"==typeof m&&(this._alpha.current=m),"undefined"==typeof f&&(f=null),"undefined"==typeof g&&(g=!1),this._alpha.current<=0||0===this._scale.x||0===this._scale.y||0===this._size.x||0===this._size.y?void 0:(this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,f&&(this.context.globalCompositeOperation=f),g&&(o|=0,a|=0),this.context.translate(o,a),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),this.context.drawImage(this._image,this._pos.x+i,this._pos.y+n,this._size.x,this._size.y,-h*this._anchor.x,-l*this._anchor.y,h,l),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this)},copyRect:function(t,e,i,n,s,r,o){return this.copy(t,e.x,e.y,e.width,e.height,i,n,e.width,e.height,0,0,0,1,1,s,r,o)},draw:function(t,e,i,n,s,r,o){return this.copy(t,null,null,null,null,e,i,n,s,null,null,null,null,null,null,r,o)},shadow:function(t,e,i,n){"undefined"==typeof t||null===t?this.context.shadowColor="rgba(0,0,0,0)":(this.context.shadowColor=t,this.context.shadowBlur=e||5,this.context.shadowOffsetX=i||10,this.context.shadowOffsetY=n||10)},alphaMask:function(t,e,i,n){return"undefined"==typeof n||null===n?this.draw(e).blendSourceAtop():this.draw(e,n.x,n.y,n.width,n.height).blendSourceAtop(),"undefined"==typeof i||null===i?this.draw(t).blendReset():this.draw(t,i.x,i.y,i.width,i.height).blendReset(),this},extract:function(t,e,i,n,s,r,o,a,h){return"undefined"==typeof s&&(s=255),"undefined"==typeof r&&(r=!1),"undefined"==typeof o&&(o=e),"undefined"==typeof a&&(a=i),"undefined"==typeof h&&(h=n),r&&t.resize(this.width,this.height),this.processPixelRGB(function(r,l,c){return r.r===e&&r.g===i&&r.b===n&&t.setPixel32(l,c,o,a,h,s,!1),!1},this),t.context.putImageData(t.imageData,0,0),t.dirty=!0,t},rect:function(t,e,i,n,s){return"undefined"!=typeof s&&(this.context.fillStyle=s),this.context.fillRect(t,e,i,n),this},circle:function(t,e,i,n){return"undefined"!=typeof n&&(this.context.fillStyle=n),this.context.beginPath(),this.context.arc(t,e,i,0,2*Math.PI,!1),this.context.closePath(),this.context.fill(),this},textureLine:function(t,i,n){if("undefined"==typeof n&&(n="repeat-x"),"string"!=typeof i||(i=this.game.cache.getImage(i))){var s=t.length;return"no-repeat"===n&&s>i.width&&(s=i.width),this.context.fillStyle=this.context.createPattern(i,n),this._circle=new e.Circle(t.start.x,t.start.y,i.height),this._circle.circumferencePoint(t.angle-1.5707963267948966,!1,this._pos),this.context.save(),this.context.translate(this._pos.x,this._pos.y),this.context.rotate(t.angle),this.context.fillRect(0,0,s,i.height),this.context.restore(),this.dirty=!0,this}},render:function(){return!this.disableTextureUpload&&this.dirty&&(this.baseTexture.dirty(),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation="source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation="destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation="darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation="difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}},Object.defineProperty(e.BitmapData.prototype,"smoothed",{get:function(){e.Canvas.getSmoothingEnabled(this.context)},set:function(t){e.Canvas.setSmoothingEnabled(this.context,t)}}),e.BitmapData.getTransform=function(t,e,i,n,s,r){return"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),"number"!=typeof i&&(i=1),"number"!=typeof n&&(n=1),"number"!=typeof s&&(s=0),"number"!=typeof r&&(r=0),{sx:i,sy:n,scaleX:i,scaleY:n,skewX:s,skewY:r,translateX:t,translateY:e,tx:t,ty:e}},e.BitmapData.prototype.constructor=e.BitmapData,e.Sprite=function(game,t,i,n,s){t=t||0,i=i||0,n=n||null,s=s||null,this.game=game,this.name="",this.type=e.SPRITE,this.z=0,this.events=new e.Events(this),this.animations=new e.AnimationManager(this),this.key=n,PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.position.set(t,i),this.world=new e.Point(t,i),this.autoCull=!1,this.input=null,this.body=null,this.alive=!0,this.health=1,this.lifespan=0,this.checkWorldBounds=!1,this.outOfBoundsKill=!1,this.debug=!1,this.cameraOffset=new e.Point,this.cropRect=null,this._cache=[0,0,0,0,1,0,1,0],this._crop=null,this._frame=null,this._bounds=new e.Rectangle,this.loadTexture(n,s)},e.Sprite.prototype=Object.create(PIXI.Sprite.prototype),e.Sprite.prototype.constructor=e.Sprite,e.Sprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;if(this.lifespan>0&&(this.lifespan-=this.game.time.elapsed,this.lifespan<=0))return this.kill(),!1;if((this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds)if(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds))this._cache[5]=0,this.events.onEnterBounds.dispatch(this);else if(0===this._cache[5]&&!this.game.world.bounds.intersects(this._bounds)&&(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this),this.outOfBoundsKill))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),this.body&&this.body.preUpdate();for(var t=0,e=this.children.length;e>t;t++)this.children[t].preUpdate();return!0},e.Sprite.prototype.update=function(){},e.Sprite.prototype.postUpdate=function(){this.key instanceof e.BitmapData&&this.key.render(),this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0,i=this.children.length;i>t;t++)this.children[t].postUpdate()},e.Sprite.prototype.loadTexture=function(t,i,n){i=i||0,(n||"undefined"==typeof n)&&this.animations.stop(),this.key=t;var s=!0,r=this.smoothed;t instanceof e.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof e.BitmapData?(this.setTexture(t.texture),this.game.cache.getFrameData(t.key,e.Cache.BITMAPDATA)&&(s=!this.animations.loadFrameData(this.game.cache.getFrameData(t.key,e.Cache.BITMAPDATA),i))):t instanceof PIXI.Texture?this.setTexture(t):null===t||"undefined"==typeof t?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof t||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),s=!this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),this.texture.baseTexture.dirty(),s&&(this._frame=e.Rectangle.clone(this.texture.frame)),r||(this.smoothed=!1)},e.Sprite.prototype.setFrame=function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture._updateUvs()},e.Sprite.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)},e.Sprite.prototype.crop=function(t,i){"undefined"==typeof i&&(i=!1),t?(i&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):i&&null===this.cropRect?this.cropRect=new e.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},e.Sprite.prototype.updateCrop=function(){if(this.cropRect){this._crop=e.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),n=Math.min(this._frame.right,this._crop.right)-t,s=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t,this.texture.crop.y=i,this.texture.crop.width=n,this.texture.crop.height=s,this.texture.frame.width=Math.min(n,this.cropRect.width),this.texture.frame.height=Math.min(s,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs()}},e.Sprite.prototype.revive=function(t){return"undefined"==typeof t&&(t=1),this.alive=!0,this.exists=!0,this.visible=!0,this.health=t,this.events&&this.events.onRevived.dispatch(this),this},e.Sprite.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},e.Sprite.prototype.destroy=function(t){if(null!==this.game&&1!==this._cache[8]){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.events&&this.events.onDestroy.dispatch(this),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this)),this.input&&this.input.destroy(),this.animations&&this.animations.destroy(),this.body&&this.body.destroy(),this.events&&this.events.destroy();var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this._crop&&(this._crop=null),this._frame&&(this._frame=null),this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},e.Sprite.prototype.damage=function(t){return this.alive&&(this.health-=t,this.health<=0&&this.kill()),this},e.Sprite.prototype.reset=function(t,e,i){return"undefined"==typeof i&&(i=1),this.world.setTo(t,e),this.position.x=t,this.position.y=e,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=i,this.body&&this.body.reset(t,e,!1,!1),this._cache[4]=1,this},e.Sprite.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},e.Sprite.prototype.play=function(t,e,i,n){return this.animations?this.animations.play(t,e,i,n):void 0},e.Sprite.prototype.overlap=function(t){return e.Rectangle.intersects(this.getBounds(),t.getBounds())},Object.defineProperty(e.Sprite.prototype,"angle",{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(t){this.rotation=e.Math.degToRad(e.Math.wrapAngle(t))}}),Object.defineProperty(e.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(e.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(e.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(e.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(e.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(e.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}}),Object.defineProperty(e.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}),Object.defineProperty(e.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(e.Sprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.Sprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===e.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===e.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}}),Object.defineProperty(e.Sprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.Sprite.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(e.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.Sprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.Image=function(game,t,i,n,s){t=t||0,i=i||0,n=n||null,s=s||null,this.game=game,this.exists=!0,this.name="",this.type=e.IMAGE,this.z=0,this.events=new e.Events(this),this.animations=new e.AnimationManager(this),this.key=n,PIXI.Sprite.call(this,PIXI.TextureCache.__default),this.position.set(t,i),this.world=new e.Point(t,i),this.alive=!0,this.autoCull=!1,this.input=null,this.debug=!1,this.cameraOffset=new e.Point,this.cropRect=null,this._cache=[0,0,0,0,1,0,1,0,0],this._crop=null,this._frame=null,this._bounds=new e.Rectangle,this.loadTexture(n,s)},e.Image.prototype=Object.create(PIXI.Sprite.prototype),e.Image.prototype.constructor=e.Image,e.Image.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;this.autoCull&&(this._bounds.copyFrom(this.getBounds()),this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var t=0,e=this.children.length;e>t;t++)this.children[t].preUpdate();return!0},e.Image.prototype.update=function(){},e.Image.prototype.postUpdate=function(){this.key instanceof e.BitmapData&&this.key.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0,i=this.children.length;i>t;t++)this.children[t].postUpdate()},e.Image.prototype.loadTexture=function(t,i){i=i||0,this.key=t;var n=!0,s=this.smoothed;t instanceof e.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof e.BitmapData?(this.setTexture(t.texture),this.game.cache.getFrameData(t.key,e.Cache.BITMAPDATA)&&(n=!this.animations.loadFrameData(this.game.cache.getFrameData(t.key,e.Cache.BITMAPDATA),i))):t instanceof PIXI.Texture?this.setTexture(t):null===t||"undefined"==typeof t?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof t||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),n=!this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),this.texture.baseTexture.dirty(),n&&(this._frame=e.Rectangle.clone(this.texture.frame)),s||(this.smoothed=!1)},e.Image.prototype.setFrame=function(t){this._frame=t,this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.cropRect&&this.updateCrop(),this.texture._updateUvs()},e.Image.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)},e.Image.prototype.crop=function(t,i){"undefined"==typeof i&&(i=!1),t?(i&&null!==this.cropRect?this.cropRect.setTo(t.x,t.y,t.width,t.height):i&&null===this.cropRect?this.cropRect=new e.Rectangle(t.x,t.y,t.width,t.height):this.cropRect=t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())},e.Image.prototype.updateCrop=function(){if(this.cropRect){this._crop=e.Rectangle.clone(this.cropRect,this._crop),this._crop.x+=this._frame.x,this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),n=Math.min(this._frame.right,this._crop.right)-t,s=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t,this.texture.crop.y=i,this.texture.crop.width=n,this.texture.crop.height=s,this.texture.frame.width=Math.min(n,this.cropRect.width),this.texture.frame.height=Math.min(s,this.cropRect.height),this.texture.width=this.texture.frame.width,this.texture.height=this.texture.frame.height,this.texture._updateUvs()}},e.Image.prototype.revive=function(){return this.alive=!0,this.exists=!0,this.visible=!0,this.events&&this.events.onRevived.dispatch(this),this},e.Image.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this},e.Image.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.events&&this.events.onDestroy.dispatch(this),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this)),this.events&&this.events.destroy(),this.input&&this.input.destroy(),this.animations&&this.animations.destroy();var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this.alive=!1,this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},e.Image.prototype.reset=function(t,e){return this.world.setTo(t,e),this.position.x=t,this.position.y=e,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this},e.Image.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this},Object.defineProperty(e.Image.prototype,"angle",{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(t){this.rotation=e.Math.degToRad(e.Math.wrapAngle(t))}}),Object.defineProperty(e.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}}),Object.defineProperty(e.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}}),Object.defineProperty(e.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}}),Object.defineProperty(e.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}),Object.defineProperty(e.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}}),Object.defineProperty(e.Image.prototype,"frame",{get:function(){return this._frame},set:function(t){if(t!==this.frame){var e=this.game.cache.getFrameData(this.key);e&&t<e.total&&e.getFrame(t)&&(this.setTexture(PIXI.TextureCache[e.getFrame(t).uuid]),this._frame=t)}}}),Object.defineProperty(e.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(t){if(t!==this.frameName){var e=this.game.cache.getFrameData(this.key);e&&e.getFrameByName(t)&&(this.setTexture(PIXI.TextureCache[e.getFrameByName(t).uuid]),this._frameName=t)}}}),Object.defineProperty(e.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}}),Object.defineProperty(e.Image.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.Image.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.Image.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){t?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}}),Object.defineProperty(e.Image.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.TileSprite=function(game,t,i,n,s,r,o){t=t||0,i=i||0,n=n||256,s=s||256,r=r||null,o=o||null,this.game=game,this.name="",this.type=e.TILESPRITE,this.z=0,this.events=new e.Events(this),this.animations=new e.AnimationManager(this),this.key=r,this._frame=0,this._frameName="",this._scroll=new e.Point,PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,n,s),this.position.set(t,i),this.input=null,this.world=new e.Point(t,i),this.autoCull=!1,this.checkWorldBounds=!1,this.cameraOffset=new e.Point,this.body=null,this.alive=!0,this._cache=[0,0,0,0,1,0,1,0,0],this.loadTexture(r,o)},e.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype),e.TileSprite.prototype.constructor=e.TileSprite,e.TileSprite.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds&&(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):0!==this._cache[5]||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this))),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.body&&this.body.preUpdate();for(var t=0,e=this.children.length;e>t;t++)this.children[t].preUpdate();return!0},e.TileSprite.prototype.update=function(){},e.TileSprite.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate(),
1===this._cache[7]&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=0,e=this.children.length;e>t;t++)this.children[t].postUpdate()},e.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)},e.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)},e.TileSprite.prototype.loadTexture=function(t,i){i=i||0,this.key=t,t instanceof e.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof e.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):null===t||"undefined"==typeof t?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof t||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key])),this.texture.baseTexture.dirty()},e.TileSprite.prototype.setFrame=function(t){this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.texture._updateUvs()},e.TileSprite.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.events&&this.events.onDestroy.dispatch(this),this.filters&&(this.filters=null),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this)),this.animations.destroy(),this.events.destroy();var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this.exists=!1,this.visible=!1,this.alive=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},e.TileSprite.prototype.play=function(t,e,i,n){return this.animations.play(t,e,i,n)},e.TileSprite.prototype.reset=function(t,e){return this.world.setTo(t,e),this.position.x=t,this.position.y=e,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(t,e,!1,!1),this._cache[4]=1,this},Object.defineProperty(e.TileSprite.prototype,"angle",{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(t){this.rotation=e.Math.degToRad(e.Math.wrapAngle(t))}}),Object.defineProperty(e.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(t){t!==this.animations.frame&&(this.animations.frame=t)}}),Object.defineProperty(e.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(t){t!==this.animations.frameName&&(this.animations.frameName=t)}}),Object.defineProperty(e.TileSprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.TileSprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===e.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===e.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}}),Object.defineProperty(e.TileSprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.TileSprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.Rope=function(game,t,i,n,s,r){this.points=[],this.points=r,this._hasUpdateAnimation=!1,this._updateAnimationCallback=null,t=t||0,i=i||0,n=n||null,s=s||null,this.game=game,this.name="",this.type=e.ROPE,this.z=0,this.events=new e.Events(this),this.animations=new e.AnimationManager(this),this.key=n,this._frame=0,this._frameName="",this._scroll=new e.Point,PIXI.Rope.call(this,n,this.points),this.position.set(t,i),this.input=null,this.world=new e.Point(t,i),this.autoCull=!1,this.checkWorldBounds=!1,this.cameraOffset=new e.Point,this.body=null,this._cache=[0,0,0,0,1,0,1,0,0],this.loadTexture(n,s)},e.Rope.prototype=Object.create(PIXI.Rope.prototype),e.Rope.prototype.constructor=e.Rope,e.Rope.prototype.preUpdate=function(){if(1===this._cache[4]&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds&&(1===this._cache[5]&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):0!==this._cache[5]||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this))),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),this.animations.update(),0!==this._scroll.x&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed),0!==this._scroll.y&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed),this.body&&this.body.preUpdate();for(var t=0,e=this.children.length;e>t;t++)this.children[t].preUpdate();return!0},e.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)},e.Rope.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate(),1===this._cache[7]&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var t=0,e=this.children.length;e>t;t++)this.children[t].postUpdate()},e.Rope.prototype.loadTexture=function(t,i){i=i||0,this.key=t,t instanceof e.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof e.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):null===t||"undefined"==typeof t?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):"string"!=typeof t||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]))},e.Rope.prototype.setFrame=function(t){this.texture.frame.x=t.x,this.texture.frame.y=t.y,this.texture.frame.width=t.width,this.texture.frame.height=t.height,this.texture.crop.x=t.x,this.texture.crop.y=t.y,this.texture.crop.width=t.width,this.texture.crop.height=t.height,t.trimmed?(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH):!t.trimmed&&this.texture.trim&&(this.texture.trim=null),this.texture._updateUvs()},e.Rope.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.events&&this.events.onDestroy.dispatch(this),this.filters&&(this.filters=null),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this)),this.animations.destroy(),this.events.destroy();var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},e.Rope.prototype.play=function(t,e,i,n){return this.animations.play(t,e,i,n)},e.Rope.prototype.reset=function(t,e){return this.world.setTo(t,e),this.position.x=t,this.position.y=e,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(t,e,!1,!1),this._cache[4]=1,this},Object.defineProperty(e.Rope.prototype,"angle",{get:function(){return e.Math.wrapAngle(e.Math.radToDeg(this.rotation))},set:function(t){this.rotation=e.Math.degToRad(e.Math.wrapAngle(t))}}),Object.defineProperty(e.Rope.prototype,"frame",{get:function(){return this.animations.frame},set:function(t){t!==this.animations.frame&&(this.animations.frame=t)}}),Object.defineProperty(e.Rope.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(t){t!==this.animations.frameName&&(this.animations.frameName=t)}}),Object.defineProperty(e.Rope.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.Rope.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===e.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===e.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}}),Object.defineProperty(e.Rope.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.Rope.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.Rope.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t,this.body&&this.body.type===e.Physics.ARCADE&&2===this.body.phase&&(this.body._reset=1)}}),Object.defineProperty(e.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){t&&"function"==typeof t?(this._hasUpdateAnimation=!0,this._updateAnimation=t):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}}),Object.defineProperty(e.Rope.prototype,"segments",{get:function(){for(var t,i,n,s,r,o,a,h,l=[],c=0;c<this.points.length;c++)t=4*c,i=this.verticies[t],n=this.verticies[t+1],s=this.verticies[t+4],r=this.verticies[t+3],o=e.Math.difference(i,s),a=e.Math.difference(n,r),i+=this.world.x,n+=this.world.y,h=new e.Rectangle(i,n,o,a),l.push(h);return l}}),Object.defineProperty(e.Rope.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.Text=function(game,t,i,n,s){t=t||0,i=i||0,n=n||" ",s=s||{},n=0===n.length?" ":n.toString(),this.game=game,this.exists=!0,this.name="",this.type=e.TEXT,this.z=0,this.world=new e.Point(t,i),this._text=n,this._font="",this._fontSize=32,this._fontWeight="normal",this._lineSpacing=0,this._charCount=0,this.events=new e.Events(this),this.input=null,this.cameraOffset=new e.Point,this.colors=[],this.setStyle(s),PIXI.Text.call(this,n,this.style),this.position.set(t,i),this._cache=[0,0,0,0,1,0,1,0,0]," "!==n&&this.updateText()},e.Text.prototype=Object.create(PIXI.Text.prototype),e.Text.prototype.constructor=e.Text,e.Text.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var t=0,e=this.children.length;e>t;t++)this.children[t].preUpdate();return!0},e.Text.prototype.update=function(){},e.Text.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0,e=this.children.length;e>t;t++)this.children[t].postUpdate()},e.Text.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.events&&this.events.onDestroy.dispatch(this),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this)),this.texture.destroy(!0),this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},e.Text.prototype.setShadow=function(t,e,i,n){this.style.shadowOffsetX=t||0,this.style.shadowOffsetY=e||0,this.style.shadowColor=i||"rgba(0,0,0,0)",this.style.shadowBlur=n||0,this.dirty=!0},e.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,t.shadowOffsetX=t.shadowOffsetX||0,t.shadowOffsetY=t.shadowOffsetY||0,t.shadowColor=t.shadowColor||"rgba(0,0,0,0)",t.shadowBlur=t.shadowBlur||0,this.style=t,this.dirty=!0},e.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,s=this.determineFontProperties(this.style.font),r=0;r<e.length;r++){var o=this.context.measureText(e[r]).width;i[r]=o,n=Math.max(n,o)}var a=n+this.style.strokeThickness;this.canvas.width=(a+this.context.lineWidth)*this.resolution;var h=s.fontSize+this.style.strokeThickness,l=h*e.length;this.canvas.height=l*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var c,u;for(this._charCount=0,r=0;r<e.length;r++)c=this.style.strokeThickness/2,u=this.style.strokeThickness/2+r*h+s.ascent,"right"===this.style.align?c+=n-i[r]:"center"===this.style.align&&(c+=(n-i[r])/2),u+=this._lineSpacing,this.colors.length>0?this.updateLine(e[r],c,u):(this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[r],c,u),this.style.fill&&this.context.fillText(e[r],c,u));this.updateTexture()},e.Text.prototype.updateLine=function(t,e,i){for(var n=0;n<t.length;n++){var s=t[n];this.colors[this._charCount]&&(this.context.fillStyle=this.colors[this._charCount],this.context.strokeStyle=this.colors[this._charCount]),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(s,e,i),this.style.fill&&this.context.fillText(s,e,i),e+=this.context.measureText(s).width,this._charCount++}},e.Text.prototype.clearColors=function(){this.colors=[],this.dirty=!0},e.Text.prototype.addColor=function(t,e){this.colors[e]=t,this.dirty=!0},e.Text.prototype.runWordWrap=function(t){for(var e="",i=t.split("\n"),n=0;n<i.length;n++){for(var s=this.style.wordWrapWidth,r=i[n].split(" "),o=0;o<r.length;o++){var a=this.context.measureText(r[o]).width,h=a+this.context.measureText(" ").width;h>s?(o>0&&(e+="\n"),e+=r[o]+" ",s=this.style.wordWrapWidth-a):(s-=h,e+=r[o]+" ")}n<i.length-1&&(e+="\n")}return e},Object.defineProperty(e.Text.prototype,"angle",{get:function(){return e.Math.radToDeg(this.rotation)},set:function(t){this.rotation=e.Math.degToRad(t)}}),Object.defineProperty(e.Text.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||" ",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t=parseInt(t,10),t!==this._fontSize&&(this._fontSize=t,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){t!==this._fontWeight&&(this._fontWeight=t,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){t!==this.style.fill&&(this.style.fill=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){t!==this.style.align&&(this.style.align=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){t!==this.style.stroke&&(this.style.stroke=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){t!==this.style.strokeThickness&&(this.style.strokeThickness=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){t!==this.style.wordWrap&&(this.style.wordWrap=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){t!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){t!==this._lineSpacing&&(this._lineSpacing=parseFloat(t),this.dirty=!0,this.parent&&this.updateTransform())}}),Object.defineProperty(e.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){t!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){t!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){t!==this.style.shadowColor&&(this.style.shadowColor=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){t!==this.style.shadowBlur&&(this.style.shadowBlur=t,this.dirty=!0)}}),Object.defineProperty(e.Text.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.Text.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.Text.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.BitmapText=function(game,t,i,n,s,r){t=t||0,i=i||0,n=n||"",s=s||"",r=r||32,this.game=game,this.exists=!0,this.name="",this.type=e.BITMAPTEXT,this.z=0,this.world=new e.Point(t,i),this._text=s,this._font=n,this._fontSize=r,this._align="left",this._tint=16777215,this.events=new e.Events(this),this.input=null,this.cameraOffset=new e.Point,PIXI.BitmapText.call(this,s),this.position.set(t,i),this._cache=[0,0,0,0,1,0,1,0,0]},e.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype),e.BitmapText.prototype.constructor=e.BitmapText,e.BitmapText.prototype.setStyle=function(){this.style={align:this._align},this.fontName=this._font,this.fontSize=this._fontSize,this.dirty=!0},e.BitmapText.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},e.BitmapText.prototype.update=function(){},e.BitmapText.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},e.BitmapText.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this));var i=this.children.length;if(t)for(;i--;)this.children[i].destroy?this.children[i].destroy(t):this.removeChild(this.children[i]);else for(;i--;)this.removeChild(this.children[i]);this.exists=!1,this.visible=!1,this.filters=null,this.mask=null,this.game=null,this._cache[8]=0}},Object.defineProperty(e.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){t!==this._align&&(this._align=t,this.setStyle())}}),Object.defineProperty(e.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this.dirty=!0)}}),Object.defineProperty(e.BitmapText.prototype,"angle",{get:function(){return e.Math.radToDeg(this.rotation)},set:function(t){this.rotation=e.Math.degToRad(t)}}),Object.defineProperty(e.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){t!==this._font&&(this._font=t.trim(),this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(e.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t=parseInt(t,10),t!==this._fontSize&&(this._fontSize=t,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}}),Object.defineProperty(e.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){t!==this._text&&(this._text=t.toString()||" ",this.dirty=!0)}}),Object.defineProperty(e.BitmapText.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?null===this.input?(this.input=new e.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}}),Object.defineProperty(e.BitmapText.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.BitmapText.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.Button=function(game,t,i,n,s,r,o,a,h,l){t=t||0,i=i||0,n=n||null,s=s||null,r=r||this,e.Image.call(this,game,t,i,n,a),this.type=e.BUTTON,this._onOverFrameName=null,this._onOutFrameName=null,this._onDownFrameName=null,this._onUpFrameName=null,this._onOverFrameID=null,this._onOutFrameID=null,this._onDownFrameID=null,this._onUpFrameID=null,this.onOverMouseOnly=!1,this.onOverSound=null,this.onOutSound=null,this.onDownSound=null,this.onUpSound=null,this.onOverSoundMarker="",this.onOutSoundMarker="",this.onDownSoundMarker="",this.onUpSoundMarker="",this.onInputOver=new e.Signal,this.onInputOut=new e.Signal,this.onInputDown=new e.Signal,this.onInputUp=new e.Signal,this.freezeFrames=!1,this.forceOut=!1,this.inputEnabled=!0,this.input.start(0,!0),this.setFrames(o,a,h,l),null!==s&&this.onInputUp.add(s,r),this.events.onInputOver.add(this.onInputOverHandler,this),this.events.onInputOut.add(this.onInputOutHandler,this),this.events.onInputDown.add(this.onInputDownHandler,this),this.events.onInputUp.add(this.onInputUpHandler,this)},e.Button.prototype=Object.create(e.Image.prototype),e.Button.prototype.constructor=e.Button,e.Button.prototype.clearFrames=function(){this._onOverFrameName=null,this._onOverFrameID=null,this._onOutFrameName=null,this._onOutFrameID=null,this._onDownFrameName=null,this._onDownFrameID=null,this._onUpFrameName=null,this._onUpFrameID=null},e.Button.prototype.setFrames=function(t,e,i,n){this.clearFrames(),null!==t&&("string"==typeof t?(this._onOverFrameName=t,this.input.pointerOver()&&(this.frameName=t)):(this._onOverFrameID=t,this.input.pointerOver()&&(this.frame=t))),null!==e&&("string"==typeof e?(this._onOutFrameName=e,this.input.pointerOver()===!1&&(this.frameName=e)):(this._onOutFrameID=e,this.input.pointerOver()===!1&&(this.frame=e))),null!==i&&("string"==typeof i?(this._onDownFrameName=i,this.input.pointerDown()&&(this.frameName=i)):(this._onDownFrameID=i,this.input.pointerDown()&&(this.frame=i))),null!==n&&("string"==typeof n?(this._onUpFrameName=n,this.input.pointerUp()&&(this.frameName=n)):(this._onUpFrameID=n,this.input.pointerUp()&&(this.frame=n)))},e.Button.prototype.setSounds=function(t,e,i,n,s,r,o,a){this.setOverSound(t,e),this.setOutSound(s,r),this.setDownSound(i,n),this.setUpSound(o,a)},e.Button.prototype.setOverSound=function(t,i){this.onOverSound=null,this.onOverSoundMarker="",(t instanceof e.Sound||t instanceof e.AudioSprite)&&(this.onOverSound=t),"string"==typeof i&&(this.onOverSoundMarker=i)},e.Button.prototype.setOutSound=function(t,i){this.onOutSound=null,this.onOutSoundMarker="",(t instanceof e.Sound||t instanceof e.AudioSprite)&&(this.onOutSound=t),"string"==typeof i&&(this.onOutSoundMarker=i)},e.Button.prototype.setDownSound=function(t,i){this.onDownSound=null,this.onDownSoundMarker="",(t instanceof e.Sound||t instanceof e.AudioSprite)&&(this.onDownSound=t),"string"==typeof i&&(this.onDownSoundMarker=i)},e.Button.prototype.setUpSound=function(t,i){this.onUpSound=null,this.onUpSoundMarker="",(t instanceof e.Sound||t instanceof e.AudioSprite)&&(this.onUpSound=t),"string"==typeof i&&(this.onUpSoundMarker=i)},e.Button.prototype.onInputOverHandler=function(t,e){e.justReleased()||(this.freezeFrames===!1&&this.setState(1),(!this.onOverMouseOnly||e.isMouse)&&(this.onOverSound&&this.onOverSound.play(this.onOverSoundMarker),this.onInputOver&&this.onInputOver.dispatch(this,e)))},e.Button.prototype.onInputOutHandler=function(t,e){this.freezeFrames===!1&&this.setState(2),this.onOutSound&&this.onOutSound.play(this.onOutSoundMarker),this.onInputOut&&this.onInputOut.dispatch(this,e)},e.Button.prototype.onInputDownHandler=function(t,e){this.freezeFrames===!1&&this.setState(3),this.onDownSound&&this.onDownSound.play(this.onDownSoundMarker),this.onInputDown&&this.onInputDown.dispatch(this,e)},e.Button.prototype.onInputUpHandler=function(t,e,i){this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&this.onInputUp.dispatch(this,e,i),this.freezeFrames||(this.forceOut?this.setState(2):null!==this._onUpFrameName||null!==this._onUpFrameID?this.setState(4):i?this.setState(1):this.setState(2))},e.Button.prototype.setState=function(t){1===t?null!=this._onOverFrameName?this.frameName=this._onOverFrameName:null!=this._onOverFrameID&&(this.frame=this._onOverFrameID):2===t?null!=this._onOutFrameName?this.frameName=this._onOutFrameName:null!=this._onOutFrameID&&(this.frame=this._onOutFrameID):3===t?null!=this._onDownFrameName?this.frameName=this._onDownFrameName:null!=this._onDownFrameID&&(this.frame=this._onDownFrameID):4===t&&(null!=this._onUpFrameName?this.frameName=this._onUpFrameName:null!=this._onUpFrameID&&(this.frame=this._onUpFrameID))},e.Graphics=function(game,t,i){t=t||0,i=i||0,this.game=game,this.exists=!0,this.name="",this.type=e.GRAPHICS,this.z=0,this.world=new e.Point(t,i),this.cameraOffset=new e.Point,PIXI.Graphics.call(this),this.position.set(t,i),this._cache=[0,0,0,0,1,0,1,0,0]},e.Graphics.prototype=Object.create(PIXI.Graphics.prototype),e.Graphics.prototype.constructor=e.Graphics,e.Graphics.prototype.preUpdate=function(){return this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.exists&&this.parent.exists?(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0):(this.renderOrderID=-1,!1)},e.Graphics.prototype.update=function(){},e.Graphics.prototype.postUpdate=function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},e.Graphics.prototype.destroy=function(t){if(null!==this.game&&!this.destroyPhase){"undefined"==typeof t&&(t=!0),this._cache[8]=1,this.clear(),this.parent&&(this.parent instanceof e.Group?this.parent.remove(this):this.parent.removeChild(this));var i=this.children.length;if(t)for(;i--;)this.children[i].destroy(t);else for(;i--;)this.removeChild(this.children[i]);this.exists=!1,this.visible=!1,this.game=null,this._cache[8]=0}},e.Graphics.prototype.drawTriangle=function(t,i){"undefined"==typeof i&&(i=!1);var n=new e.Polygon(t);if(i){var s=new e.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),r=new e.Point(t[1].x-t[0].x,t[1].y-t[0].y),o=new e.Point(t[1].x-t[2].x,t[1].y-t[2].y),a=o.cross(r);s.dot(a)>0&&this.drawPolygon(n)}else this.drawPolygon(n)},e.Graphics.prototype.drawTriangles=function(t,i,n){"undefined"==typeof n&&(n=!1);var s,r=new e.Point,o=new e.Point,a=new e.Point,h=[];if(i)if(t[0]instanceof e.Point)for(s=0;s<i.length/3;s++)h.push(t[i[3*s]]),h.push(t[i[3*s+1]]),h.push(t[i[3*s+2]]),3===h.length&&(this.drawTriangle(h,n),h=[]);else for(s=0;s<i.length;s++)r.x=t[2*i[s]],r.y=t[2*i[s]+1],h.push(r.copyTo({})),3===h.length&&(this.drawTriangle(h,n),h=[]);else if(t[0]instanceof e.Point)for(s=0;s<t.length/3;s++)this.drawTriangle([t[3*s],t[3*s+1],t[3*s+2]],n);else for(s=0;s<t.length/6;s++)r.x=t[6*s+0],r.y=t[6*s+1],o.x=t[6*s+2],o.y=t[6*s+3],a.x=t[6*s+4],a.y=t[6*s+5],this.drawTriangle([r,o,a],n)},Object.defineProperty(e.Graphics.prototype,"angle",{
get:function(){return e.Math.radToDeg(this.rotation)},set:function(t){this.rotation=e.Math.degToRad(t)}}),Object.defineProperty(e.Graphics.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(t){t?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}}),Object.defineProperty(e.Graphics.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}}),e.RenderTexture=function(game,t,i,n,s,r){"undefined"==typeof n&&(n=""),"undefined"==typeof s&&(s=e.scaleModes.DEFAULT),"undefined"==typeof r&&(r=1),this.game=game,this.key=n,this.type=e.RENDERTEXTURE,this.matrix=new PIXI.Matrix,PIXI.RenderTexture.call(this,t,i,this.game.renderer,s,r),this.render=e.RenderTexture.prototype.render},e.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype),e.RenderTexture.prototype.constructor=e.RenderTexture,e.RenderTexture.prototype.renderXY=function(t,e,i,n){this.matrix.tx=e,this.matrix.ty=i,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this.matrix,n):this.renderCanvas(t,this.matrix,n)},e.RenderTexture.prototype.render=function(t,e,i){this.matrix.tx=e.x,this.matrix.ty=e.y,this.renderer.type===PIXI.WEBGL_RENDERER?this.renderWebGL(t,this.matrix,i):this.renderCanvas(t,this.matrix,i)},e.SpriteBatch=function(game,t,i,n){("undefined"==typeof t||null===t)&&(t=game.world),PIXI.SpriteBatch.call(this),e.Group.call(this,game,t,i,n),this.type=e.SPRITEBATCH},e.SpriteBatch.prototype=e.Utils.extend(!0,e.SpriteBatch.prototype,e.Group.prototype,PIXI.SpriteBatch.prototype),e.SpriteBatch.prototype.constructor=e.SpriteBatch,e.RetroFont=function(game,t,i,n,s,r,o,a,h,l){if(!game.cache.checkImageKey(t))return!1;("undefined"==typeof r||null===r)&&(r=game.cache.getImage(t).width/i),this.characterWidth=i,this.characterHeight=n,this.characterSpacingX=o||0,this.characterSpacingY=a||0,this.characterPerRow=r,this.offsetX=h||0,this.offsetY=l||0,this.align="left",this.multiLine=!1,this.autoUpperCase=!0,this.customSpacingX=0,this.customSpacingY=0,this.fixedWidth=0,this.fontSet=game.cache.getImage(t),this._text="",this.grabData=[],this.frameData=new e.FrameData;for(var c=this.offsetX,u=this.offsetY,d=0,A=0;A<s.length;A++){var p=game.rnd.uuid(),m=this.frameData.addFrame(new e.Frame(A,c,u,this.characterWidth,this.characterHeight,"",p));this.grabData[s.charCodeAt(A)]=m.index,PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:c,y:u,width:this.characterWidth,height:this.characterHeight}),d++,d==this.characterPerRow?(d=0,c=this.offsetX,u+=this.characterHeight+this.characterSpacingY):c+=this.characterWidth+this.characterSpacingX}game.cache.updateFrameData(t,this.frameData),this.stamp=new e.Image(game,0,0,t,0),e.RenderTexture.call(this,game,100,100,"",e.scaleModes.NEAREST),this.type=e.RETROFONT},e.RetroFont.prototype=Object.create(e.RenderTexture.prototype),e.RetroFont.prototype.constructor=e.RetroFont,e.RetroFont.ALIGN_LEFT="left",e.RetroFont.ALIGN_RIGHT="right",e.RetroFont.ALIGN_CENTER="center",e.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",e.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",e.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",e.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",e.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",e.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",e.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",e.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789",e.RetroFont.prototype.setFixedWidth=function(t,e){"undefined"==typeof e&&(e="left"),this.fixedWidth=t,this.align=e},e.RetroFont.prototype.setText=function(t,e,i,n,s,r){this.multiLine=e||!1,this.customSpacingX=i||0,this.customSpacingY=n||0,this.align=s||"left",r?this.autoUpperCase=!1:this.autoUpperCase=!0,t.length>0&&(this.text=t)},e.RetroFont.prototype.buildRetroFontText=function(){var t=0,i=0;if(this.clear(),this.multiLine){var n=this._text.split("\n");this.fixedWidth>0?this.resize(this.fixedWidth,n.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),n.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0);for(var s=0;s<n.length;s++){switch(this.align){case e.RetroFont.ALIGN_LEFT:t=0;break;case e.RetroFont.ALIGN_RIGHT:t=this.width-n[s].length*(this.characterWidth+this.customSpacingX);break;case e.RetroFont.ALIGN_CENTER:t=this.width/2-n[s].length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2}0>t&&(t=0),this.pasteLine(n[s],t,i,this.customSpacingX),i+=this.characterHeight+this.customSpacingY}}else{switch(this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0),this.align){case e.RetroFont.ALIGN_LEFT:t=0;break;case e.RetroFont.ALIGN_RIGHT:t=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case e.RetroFont.ALIGN_CENTER:t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2,t+=this.customSpacingX/2}this.textureBuffer.clear(),this.pasteLine(this._text,t,0,this.customSpacingX)}},e.RetroFont.prototype.pasteLine=function(t,i,n,s){for(var r=new e.Point,o=0;o<t.length;o++)if(" "==t.charAt(o))i+=this.characterWidth+s;else if(this.grabData[t.charCodeAt(o)]>=0&&(this.stamp.frame=this.grabData[t.charCodeAt(o)],r.set(i,n),this.render(this.stamp,r,!1),i+=this.characterWidth+s,i>this.width))break},e.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0)for(var e=this._text.split("\n"),i=0;i<e.length;i++)e[i].length>t&&(t=e[i].length);return t},e.RetroFont.prototype.removeUnsupportedCharacters=function(t){for(var e="",i=0;i<this._text.length;i++){var n=this._text[i],s=n.charCodeAt(0);(this.grabData[s]>=0||!t&&"\n"===n)&&(e=e.concat(n))}return e},e.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX!==t||this.offsetY!==e){for(var i=t-this.offsetX,n=e-this.offsetY,s=this.game.cache.getFrameData(this.stamp.key).getFrames(),r=s.length;r--;)s[r].x+=i,s[r].y+=n,PIXI.TextureCache[s[r].uuid].frame.x=s[r].x,PIXI.TextureCache[s[r].uuid].frame.y=s[r].y;this.buildRetroFontText()}},Object.defineProperty(e.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;e=this.autoUpperCase?t.toUpperCase():t,e!==this._text&&(this._text=e,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}}),Object.defineProperty(e.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t,this.buildRetroFontText()}}),e.Particle=function(game,t,i,n,s){e.Sprite.call(this,game,t,i,n,s),this.autoScale=!1,this.scaleData=null,this._s=0,this.autoAlpha=!1,this.alphaData=null,this._a=0},e.Particle.prototype=Object.create(e.Sprite.prototype),e.Particle.prototype.constructor=e.Particle,e.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1),this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)},e.Particle.prototype.onEmit=function(){},e.Particle.prototype.setAlphaData=function(t){this.alphaData=t,this._a=t.length-1,this.alpha=this.alphaData[this._a].v,this.autoAlpha=!0},e.Particle.prototype.setScaleData=function(t){this.scaleData=t,this._s=t.length-1,this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y),this.autoScale=!0},e.Particle.prototype.reset=function(t,e,i){return"undefined"==typeof i&&(i=1),this.world.setTo(t,e),this.position.x=t,this.position.y=e,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=i,this.body&&this.body.reset(t,e,!1,!1),this._cache[4]=1,this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this},e.Canvas={create:function(t,e,i){t=t||256,e=e||256;var n=document.createElement("canvas");return"string"==typeof i&&""!==i&&(n.id=i),n.width=t,n.height=e,n.style.display="block",n},getOffset:function(t,i){i=i||new e.Point;var n=t.getBoundingClientRect(),s=t.clientTop||document.body.clientTop||0,r=t.clientLeft||document.body.clientLeft||0,o=0,a=0;return"CSS1Compat"===document.compatMode?(o=window.pageYOffset||document.documentElement.scrollTop||t.scrollTop||0,a=window.pageXOffset||document.documentElement.scrollLeft||t.scrollLeft||0):(o=window.pageYOffset||document.body.scrollTop||t.scrollTop||0,a=window.pageXOffset||document.body.scrollLeft||t.scrollLeft||0),i.x=n.left+a-r,i.y=n.top+o-s,i},getAspectRatio:function(t){return t.width/t.height},setBackgroundColor:function(t,e){return e=e||"rgb(0,0,0)",t.style.backgroundColor=e,t},setTouchAction:function(t,e){return e=e||"none",t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t},setUserSelect:function(t,e){return e=e||"none",t.style["-webkit-touch-callout"]=e,t.style["-webkit-user-select"]=e,t.style["-khtml-user-select"]=e,t.style["-moz-user-select"]=e,t.style["-ms-user-select"]=e,t.style["user-select"]=e,t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",t},addToDOM:function(t,e,i){var n;return"undefined"==typeof i&&(i=!0),e&&("string"==typeof e?n=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(n=e)),n||(n=document.body),i&&n.style&&(n.style.overflow="hidden"),n.appendChild(t),t},removeFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)},setTransform:function(t,e,i,n,s,r,o){return t.setTransform(n,r,o,s,e,i),t},setSmoothingEnabled:function(t,e){return t.imageSmoothingEnabled=e,t.mozImageSmoothingEnabled=e,t.oImageSmoothingEnabled=e,t.webkitImageSmoothingEnabled=e,t.msImageSmoothingEnabled=e,t},getSmoothingEnabled:function(t){return t.imageSmoothingEnabled||t.mozImageSmoothingEnabled||t.oImageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.msImageSmoothingEnabled},setImageRenderingCrisp:function(t){return t.style["image-rendering"]="optimizeSpeed",t.style["image-rendering"]="crisp-edges",t.style["image-rendering"]="-moz-crisp-edges",t.style["image-rendering"]="-webkit-optimize-contrast",t.style["image-rendering"]="optimize-contrast",t.style["image-rendering"]="pixelated",t.style.msInterpolationMode="nearest-neighbor",t},setImageRenderingBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t}},e.Device=function(game){this.game=game,this.desktop=!1,this.iOS=!1,this.cocoonJS=!1,this.cocoonJSApp=!1,this.cordova=!1,this.node=!1,this.nodeWebkit=!1,this.ejecta=!1,this.crosswalk=!1,this.android=!1,this.chromeOS=!1,this.linux=!1,this.macOS=!1,this.windows=!1,this.windowsPhone=!1,this.canvas=!1,this.file=!1,this.fileSystem=!1,this.localStorage=!1,this.webGL=!1,this.worker=!1,this.touch=!1,this.mspointer=!1,this.css3D=!1,this.pointerLock=!1,this.typedArray=!1,this.vibration=!1,this.getUserMedia=!1,this.quirksMode=!1,this.arora=!1,this.chrome=!1,this.epiphany=!1,this.firefox=!1,this.ie=!1,this.ieVersion=0,this.trident=!1,this.tridentVersion=0,this.mobileSafari=!1,this.midori=!1,this.opera=!1,this.safari=!1,this.webApp=!1,this.silk=!1,this.audioData=!1,this.webAudio=!1,this.ogg=!1,this.opus=!1,this.mp3=!1,this.wav=!1,this.m4a=!1,this.webm=!1,this.iPhone=!1,this.iPhone4=!1,this.iPad=!1,this.pixelRatio=0,this.littleEndian=!1,this.support32bit=!1,this.fullscreen=!1,this.requestFullscreen="",this.cancelFullscreen="",this.fullscreenKeyboard=!1,this._checkOS(),this._checkAudio(),this._checkBrowser(),this._checkCSS3D(),this._checkDevice(),this._checkFeatures()},e.Device.LITTLE_ENDIAN=!1,e.Device.prototype={_checkOS:function(){var t=navigator.userAgent;/Playstation Vita/.test(t)?this.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?this.kindle=!0:/Android/.test(t)?this.android=!0:/CrOS/.test(t)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?this.iOS=!0:/Linux/.test(t)?this.linux=!0:/Mac OS/.test(t)?this.macOS=!0:/Windows/.test(t)&&(this.windows=!0,/Windows Phone/i.test(t)&&(this.windowsPhone=!0)),(this.windows||this.macOS||this.linux&&this.silk===!1||this.chromeOS)&&(this.desktop=!0),(this.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(this.desktop=!1)},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(t){this.localStorage=!1}this.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),this.fileSystem=!!window.requestFileSystem,this.webGL=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}(),null===this.webGL||this.webGL===!1?this.webGL=!1:this.webGL=!0,this.worker=!!window.Worker,("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)&&(this.touch=!0),(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(this.mspointer=!0),this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,this.quirksMode="CSS1Compat"===document.compatMode?!1:!0,this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){for(var t=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],e=0;e<t.length;e++)if(this.game.canvas[t[e]]){this.fullscreen=!0,this.requestFullscreen=t[e];break}var i=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(this.fullscreen)for(var e=0;e<i.length;e++)if(document[i[e]]){this.cancelFullscreen=i[e];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.fullscreenKeyboard=!0)},_checkBrowser:function(){var t=navigator.userAgent;if(/Arora/.test(t)?this.arora=!0:/Chrome/.test(t)?this.chrome=!0:/Epiphany/.test(t)?this.epiphany=!0:/Firefox/.test(t)?this.firefox=!0:/AppleWebKit/.test(t)&&this.iOS?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(t)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(t)?this.midori=!0:/Opera/.test(t)?this.opera=!0:/Safari/.test(t)?this.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(t)&&(this.ie=!0,this.trident=!0,this.tridentVersion=parseInt(RegExp.$1,10),this.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(t)&&(this.silk=!0),navigator.standalone&&(this.webApp=!0),"undefined"!=typeof window.cordova&&(this.cordova=!0),"undefined"!=typeof process&&"undefined"!=typeof require&&(this.node=!0),this.node)try{this.nodeWebkit="undefined"!=typeof require("nw.gui")}catch(e){this.nodeWebkit=!1}if(navigator.isCocoonJS&&(this.cocoonJS=!0),this.cocoonJS)try{this.cocoonJSApp="undefined"!=typeof CocoonJS}catch(e){this.cocoonJSApp=!1}"undefined"!=typeof window.ejecta&&(this.ejecta=!0),/Crosswalk/.test(t)&&(this.crosswalk=!0)},_checkAudio:function(){this.audioData=!!window.Audio,this.webAudio=!(!window.webkitAudioContext&&!window.AudioContext);var t=document.createElement("audio"),e=!1;try{(e=!!t.canPlayType)&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,""))&&(this.opus=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0),t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0))}catch(i){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1,this.iPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone"),this.iPhone4=2==this.pixelRatio&&this.iPhone,this.iPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad"),"undefined"!=typeof Int8Array?this.typedArray=!0:this.typedArray=!1,"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(this.littleEndian=this._checkIsLittleEndian(),e.Device.LITTLE_ENDIAN=this.littleEndian),this.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==this.littleEndian&&this._checkIsUint8ClampedImageData(),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(this.vibration=!0)},_checkIsLittleEndian:function(){var t=new ArrayBuffer(4),e=new Uint8Array(t),i=new Uint32Array(t);return e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041==i[0]?!0:2712847316==i[0]?!1:null},_checkIsUint8ClampedImageData:function(){if("undefined"==typeof Uint8ClampedArray)return!1;var t=document.createElement("canvas"),e=t.getContext("2d");if(!e)return!1;var i=e.createImageData(1,1);return i.data instanceof Uint8ClampedArray},_checkCSS3D:function(){var t,e=document.createElement("p"),i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var n in i)void 0!==e.style[n]&&(e.style[n]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(i[n]));document.body.removeChild(e),this.css3D=void 0!==t&&t.length>0&&"none"!==t},canPlayAudio:function(t){return"mp3"==t&&this.mp3?!0:"ogg"==t&&(this.ogg||this.opus)?!0:"m4a"==t&&this.m4a?!0:"opus"==t&&this.opus?!0:"wav"==t&&this.wav?!0:"webm"==t&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1}},e.Device.prototype.constructor=e.Device,e.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537},e.RequestAnimationFrame=function(game,t){"undefined"==typeof t&&(t=!1),this.game=game,this.isRunning=!1,this.forceSetTimeOut=t;for(var e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;i++)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"];this._isSetTimeOut=!1,this._onLoop=null,this._timeOutID=null},e.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var t=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return t.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(e){return t.updateRAF(e)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(){this.game.update(Date.now()),this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now()),this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID),this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}},e.RequestAnimationFrame.prototype.constructor=e.RequestAnimationFrame,e.Math={PI2:2*Math.PI,fuzzyEqual:function(t,e,i){return"undefined"==typeof i&&(i=1e-4),Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){return"undefined"==typeof i&&(i=1e-4),e+i>t},fuzzyGreaterThan:function(t,e,i){return"undefined"==typeof i&&(i=1e-4),t>e-i},fuzzyCeil:function(t,e){return"undefined"==typeof e&&(e=1e-4),Math.ceil(t-e)},fuzzyFloor:function(t,e){return"undefined"==typeof e&&(e=1e-4),Math.floor(t+e)},average:function(){for(var t=[],e=0;e<arguments.length-0;e++)t[e]=arguments[e+0];for(var i=0,n=0;n<t.length;n++)i+=t[n];return i/t.length},truncate:function(t){return t>0?Math.floor(t):Math.ceil(t)},shear:function(t){return t%1},snapTo:function(t,e,i){return"undefined"==typeof i&&(i=0),0===e?t:(t-=i,t=e*Math.round(t/e),i+t)},snapToFloor:function(t,e,i){return"undefined"==typeof i&&(i=0),0===e?t:(t-=i,t=e*Math.floor(t/e),i+t)},snapToCeil:function(t,e,i){return"undefined"==typeof i&&(i=0),0===e?t:(t-=i,t=e*Math.ceil(t/e),i+t)},snapToInArray:function(t,e,i){if("undefined"==typeof i&&(i=!0),i&&e.sort(),t<e[0])return e[0];for(var n=1;e[n]<t;)n++;var s=e[n-1],r=n<e.length?e[n]:Number.POSITIVE_INFINITY;return t-s>=r-t?r:s},roundTo:function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.round(t*n)/n},floorTo:function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.floor(t*n)/n},ceilTo:function(t,e,i){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=10);var n=Math.pow(i,-e);return Math.ceil(t*n)/n},interpolateFloat:function(t,e,i){return(e-t)*i+t},angleBetween:function(t,e,i,n){return Math.atan2(n-e,i-t)},angleBetweenY:function(t,e,i,n){return Math.atan2(i-t,n-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,!0)},normalizeAngle:function(t){return t%=2*Math.PI,t>=0?t:t+2*Math.PI},normalizeLatitude:function(t){return Math.max(-90,Math.min(90,t))},normalizeLongitude:function(t){return t%360==180?180:(t%=360,-180>t?t+360:t>180?t-360:t)},chanceRoll:function(t){return"undefined"==typeof t&&(t=50),0>=t?!1:t>=100?!0:100*Math.random()>=t?!1:!0},numberArray:function(t,e){for(var i=[],n=t;e>=n;n++)i.push(n);return i},numberArrayStep:function(t,i,n){t=+t||0;var s=typeof i;"number"!==s&&"string"!==s||!n||n[i]!==t||(i=n=null),n=null==n?1:+n||0,null===i?(i=t,t=0):i=+i||0;for(var r=-1,o=e.Math.max(e.Math.ceil((i-t)/(n||1)),0),a=new Array(o);++r<o;)a[r]=t,t+=n;return a},maxAdd:function(t,e,i){return t+=e,t>i&&(t=i),t},minSub:function(t,e,i){return t-=e,i>t&&(t=i),t},wrap:function(t,e,i){var n=i-e;if(0>=n)return 0;var s=(t-e)%n;return 0>s&&(s+=n),s+e},wrapValue:function(t,e,i){var n;return t=Math.abs(t),e=Math.abs(e),i=Math.abs(i),n=(t+e)%i},limitValue:function(t,e,i){return e>t?e:t>i?i:t},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(t){return 1&t},isEven:function(t){return 1&t?!1:!0},min:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else var t=arguments;for(var e=1,i=0,n=t.length;n>e;e++)t[e]<t[i]&&(i=e);return t[i]},max:function(){if(1===arguments.length&&"object"==typeof arguments[0])var t=arguments[0];else var t=arguments;for(var e=1,i=0,n=t.length;n>e;e++)t[e]>t[i]&&(i=e);return t[i]},minProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else var e=arguments.slice(1);for(var i=1,n=0,s=e.length;s>i;i++)e[i][t]<e[n][t]&&(n=i);return e[n][t]},maxProperty:function(t){if(2===arguments.length&&"object"==typeof arguments[1])var e=arguments[1];else var e=arguments.slice(1);for(var i=1,n=0,s=e.length;s>i;i++)e[i][t]>e[n][t]&&(n=i);return e[n][t]},wrapAngle:function(t,e){var i=e?Math.PI/180:1;return this.wrap(t,-180*i,180*i)},angleLimit:function(t,e,i){var n=t;return t>i?n=i:e>t&&(n=e),n},linearInterpolation:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n);return 0>e?this.linear(t[0],t[1],n):e>1?this.linear(t[i],t[i-1],i-n):this.linear(t[s],t[s+1>i?i:s+1],n-s)},bezierInterpolation:function(t,e){for(var i=0,n=t.length-1,s=0;n>=s;s++)i+=Math.pow(1-e,n-s)*Math.pow(e,s)*t[s]*this.bernstein(n,s);return i},catmullRomInterpolation:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n);return t[0]===t[i]?(0>e&&(s=Math.floor(n=i*(1+e))),this.catmullRom(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):0>e?t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):this.catmullRom(t[s?s-1:0],t[s],t[s+1>i?i:s+1],t[s+2>i?i:s+2],n-s)},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e},catmullRom:function(t,e,i,n,s){var r=.5*(i-t),o=.5*(n-e),a=s*s,h=s*a;return(2*e-2*i+r+o)*h+(-3*e+3*i-2*r-o)*a+r*s+e},difference:function(t,e){return Math.abs(t-e)},getRandom:function(t,e,i){if("undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),null!=t){var n=i;if((0===n||n>t.length-e)&&(n=t.length-e),n>0)return t[e+Math.floor(Math.random()*n)]}return null},removeRandom:function(t,e,i){if("undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=0),null!=t){var n=i;if((0===n||n>t.length-e)&&(n=t.length-e),n>0){var s=e+Math.floor(Math.random()*n),r=t.splice(s,1);return r[0]}}return null},floor:function(t){var e=0|t;return t>0?e:e!=t?e-1:e},ceil:function(t){var e=0|t;return t>0&&e!=t?e+1:e},sinCosGenerator:function(t,e,i,n){"undefined"==typeof e&&(e=1),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=1);for(var s=e,r=i,o=n*Math.PI/t,a=[],h=[],l=0;t>l;l++)r-=s*o,s+=r*o,a[l]=r,h[l]=s;return{sin:h,cos:a,length:t}},shift:function(t){var e=t.shift();return t.push(e),e},shuffleArray:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}return t},distance:function(t,e,i,n){var s=t-i,r=e-n;return Math.sqrt(s*s+r*r)},distancePow:function(t,e,i,n,s){return"undefined"==typeof s&&(s=2),Math.sqrt(Math.pow(i-t,s)+Math.pow(n-e,s))},distanceRounded:function(t,i,n,s){return Math.round(e.Math.distance(t,i,n,s))},clamp:function(t,e,i){return e>t?e:t>i?i:t},clampBottom:function(t,e){return e>t?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,n,s){return n+(t-e)*(s-n)/(i-e)},smoothstep:function(t,e,i){return t=Math.max(0,Math.min(1,(t-e)/(i-e))),t*t*(3-2*t)},smootherstep:function(t,e,i){return t=Math.max(0,Math.min(1,(t-e)/(i-e))),t*t*t*(t*(6*t-15)+10)},sign:function(t){return 0>t?-1:t>0?1:0},percent:function(t,e,i){return"undefined"==typeof i&&(i=0),t>e||i>e?1:i>t||i>t?0:(t-i)/e},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}(),radToDeg:function(){var t=180/Math.PI;return function(e){return e*t}}()},e.RandomDataGenerator=function(t){"undefined"==typeof t&&(t=[]),this.c=1,this.s0=0,this.s1=0,this.s2=0,this.sow(t)},e.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2},sow:function(t){"undefined"==typeof t&&(t=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1;for(var e,i=0;e=t[i++];)this.s0-=this.hash(e),this.s0+=~~(this.s0<0),this.s1-=this.hash(e),this.s1+=~~(this.s1<0),this.s2-=this.hash(e),this.s2+=~~(this.s2<0)},hash:function(t){var e,i,n;for(n=4022871197,t=t.toString(),i=0;i<t.length;i++)n+=t.charCodeAt(i),e=.02519603282416938*n,n=e>>>0,e-=n,e*=n,n=e>>>0,e-=n,n+=4294967296*e;return 2.3283064365386963e-10*(n>>>0)},integer:function(){return 4294967296*this.rnd.apply(this)},frac:function(){return this.rnd.apply(this)+1.1102230246251565e-16*(2097152*this.rnd.apply(this)|0)},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="",e="";for(e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1))]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)}},e.RandomDataGenerator.prototype.constructor=e.RandomDataGenerator,e.QuadTree=function(t,e,i,n,s,r,o){this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(t,e,i,n,s,r,o)},e.QuadTree.prototype={reset:function(t,e,i,n,s,r,o){this.maxObjects=s||10,this.maxLevels=r||4,this.level=o||0,this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:n,subWidth:Math.floor(i/2),subHeight:Math.floor(n/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(n/2)},this.objects.length=0,this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,!0)},populateHandler:function(t){t.body&&t.exists&&this.insert(t.body)},split:function(){this.nodes[0]=new e.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[1]=new e.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[2]=new e.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1),this.nodes[3]=new e.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e,i=0;if(null!=this.nodes[0]&&(e=this.getIndex(t),-1!==e))return void this.nodes[e].insert(t);if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();i<this.objects.length;)e=this.getIndex(this.objects[i]),-1!==e?this.nodes[e].insert(this.objects.splice(i,1)[0]):i++},getIndex:function(t){var e=-1;return t.x<this.bounds.right&&t.right<this.bounds.right?t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=1:t.y>this.bounds.bottom&&(e=2):t.x>this.bounds.right&&(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom?e=0:t.y>this.bounds.bottom&&(e=3)),e},retrieve:function(t){if(t instanceof e.Rectangle)var i=this.objects,n=this.getIndex(t);else{if(!t.body)return this._empty;var i=this.objects,n=this.getIndex(t.body)}return this.nodes[0]&&(-1!==n?i=i.concat(this.nodes[n].retrieve(t)):(i=i.concat(this.nodes[0].retrieve(t)),i=i.concat(this.nodes[1].retrieve(t)),i=i.concat(this.nodes[2].retrieve(t)),i=i.concat(this.nodes[3].retrieve(t)))),i},clear:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}},e.QuadTree.prototype.constructor=e.QuadTree,e.Net=function(game){this.game=game},e.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(t){return-1!==window.location.hostname.indexOf(t)},updateQueryString:function(t,e,i,n){"undefined"==typeof i&&(i=!1),("undefined"==typeof n||""===n)&&(n=window.location.href);var s="",r=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(r.test(n))s="undefined"!=typeof e&&null!==e?n.replace(r,"$1"+t+"="+e+"$2$3"):n.replace(r,"$1$3").replace(/(&|\?)$/,"");else if("undefined"!=typeof e&&null!==e){var o=-1!==n.indexOf("?")?"&":"?",a=n.split("#");n=a[0]+o+t+"="+e,a[1]&&(n+="#"+a[1]),s=n}else s=n;return i?void(window.location.href=s):s},getQueryString:function(t){"undefined"==typeof t&&(t="");var e={},i=location.search.substring(1).split("&");for(var n in i){var s=i[n].split("=");if(s.length>1){if(t&&t==this.decodeURI(s[0]))return this.decodeURI(s[1]);e[this.decodeURI(s[0])]=this.decodeURI(s[1])}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}},e.Net.prototype.constructor=e.Net,e.TweenManager=function(game){this.game=game,this._tweens=[],this._add=[],this.game.onPause.add(this._pauseAll,this),this.game.onResume.add(this._resumeAll,this)},e.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){
for(var t=0;t<this._tweens.length;t++)this._tweens[t].pendingDelete=!0;this._add=[]},add:function(t){t._manager=this,this._add.push(t)},create:function(t){return new e.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens[e].pendingDelete=!0:(e=this._add.indexOf(t),-1!==e&&(this._add[e].pendingDelete=!0))},update:function(){var t=this._add.length,e=this._tweens.length;if(0===e&&0===t)return!1;for(var i=0;e>i;)this._tweens[i].update(this.game.time.now)?i++:(this._tweens.splice(i,1),e--);return t>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(t){return this._tweens.some(function(e){return e._object===t})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._pause()},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t]._resume()},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].pause()},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--)this._tweens[t].resume(!0)}},e.TweenManager.prototype.constructor=e.TweenManager,e.Tween=function(t,game,i){this._object=t,this.game=game,this._manager=i,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._repeat=0,this._yoyo=!1,this._reversed=!1,this._delayTime=0,this._startTime=null,this._easingFunction=e.Easing.Default,this._interpolationFunction=e.Math.linearInterpolation,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onUpdateCallback=null,this._onUpdateCallbackContext=null,this._paused=!1,this._pausedTime=0,this._codePaused=!1,this.pendingDelete=!1,this.onStart=new e.Signal,this.onLoop=new e.Signal,this.onComplete=new e.Signal,this.isRunning=!1},e.Tween.prototype={to:function(t,e,i,n,s,r,o){e=e||1e3,i=i||null,n=n||!1,s=s||0,r=r||0,o=o||!1,o&&0===r&&(r=1);var a;return this._parent?(a=this._manager.create(this._object),this._lastChild.chain(a),this._lastChild=a):(a=this,this._parent=this,this._lastChild=this),a._repeat=r,a._duration=e,a._valuesEnd=t,null!==i&&(a._easingFunction=i),s>0&&(a._delayTime=s),a._yoyo=o,n?this.start():this},from:function(t,e,i,n,s,r,o){var a={};for(var h in t)a[h]=this._object[h],this._object[h]=t[h];return this.to(a,e,i,n,s,r,o)},start:function(){if(null!==this.game&&null!==this._object){this._manager.add(this),this.isRunning=!0,this._onStartCallbackFired=!1,this._startTime=this.game.time.now+this._delayTime;for(var t in this._valuesEnd){if(Array.isArray(this._valuesEnd[t])){if(0===this._valuesEnd[t].length)continue;this._valuesEnd[t]=[this._object[t]].concat(this._valuesEnd[t])}this._valuesStart[t]=this._object[t],Array.isArray(this._valuesStart[t])||(this._valuesStart[t]*=1),this._valuesStartRepeat[t]=this._valuesStart[t]||0}return this}},generateData:function(t,e){if(null===this.game||null===this._object)return null;this._startTime=0;for(var i in this._valuesEnd){if(Array.isArray(this._valuesEnd[i])){if(0===this._valuesEnd[i].length)continue;this._valuesEnd[i]=[this._object[i]].concat(this._valuesEnd[i])}this._valuesStart[i]=this._object[i],Array.isArray(this._valuesStart[i])||(this._valuesStart[i]*=1),this._valuesStartRepeat[i]=this._valuesStart[i]||0}for(var n=0,s=Math.floor(t*(this._duration/1e3)),r=this._duration/s,o=[];s--;){var i,a=(n-this._startTime)/this._duration;a=a>1?1:a;var h=this._easingFunction(a),l={};for(i in this._valuesEnd){var c=this._valuesStart[i]||0,u=this._valuesEnd[i];u instanceof Array?l[i]=this._interpolationFunction(u,h):"string"==typeof u?u=c+parseFloat(u,10):"number"==typeof u&&(l[i]=c+(u-c)*h)}o.push(l),n+=r}var l={};for(i in this._valuesEnd)l[i]=this._valuesEnd[i];if(o.push(l),this._yoyo){var d=o.slice();d.reverse(),o=o.concat(d)}return"undefined"!=typeof e?e=e.concat(o):o},stop:function(){return this.isRunning=!1,this._onUpdateCallback=null,this._manager.remove(this),this},delay:function(t){return this._delayTime=t,this},repeat:function(t){return this._repeat=t,this},yoyo:function(t){return this._yoyo=t,t&&0===this._repeat&&(this._repeat=1),this},easing:function(t){return this._easingFunction=t,this},interpolation:function(t){return this._interpolationFunction=t,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._lastChild.chain(this),this},onUpdateCallback:function(t,e){return this._onUpdateCallback=t,this._onUpdateCallbackContext=e,this},pause:function(){this._codePaused=!0,this._paused=!0,this._pausedTime=this.game.time.now},_pause:function(){this._codePaused||(this._paused=!0,this._pausedTime=this.game.time.now)},resume:function(){this._paused&&(this._paused=!1,this._codePaused=!1,this._startTime+=this.game.time.now-this._pausedTime)},_resume:function(){this._codePaused||(this._startTime+=this.game.time.pauseDuration,this._paused=!1)},update:function(t){if(this.pendingDelete)return!1;if(this._paused||t<this._startTime)return!0;var e;if(t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this.onStart.dispatch(this._object),this._onStartCallbackFired=!0);var i=(t-this._startTime)/this._duration;i=i>1?1:i;var n=this._easingFunction(i);for(e in this._valuesEnd){var s=this._valuesStart[e]||0,r=this._valuesEnd[e];r instanceof Array?this._object[e]=this._interpolationFunction(r,n):("string"==typeof r&&(r=s+parseFloat(r,10)),"number"==typeof r&&(this._object[e]=s+(r-s)*n))}if(null!==this._onUpdateCallback&&(this._onUpdateCallback.call(this._onUpdateCallbackContext,this,n),!this.isRunning))return!1;if(1==i){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(e in this._valuesStartRepeat){if("string"==typeof this._valuesEnd[e]&&(this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(this._valuesEnd[e],10)),this._yoyo){var o=this._valuesStartRepeat[e];this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=o}this._valuesStart[e]=this._valuesStartRepeat[e]}return this._yoyo&&(this._reversed=!this._reversed),this._startTime=t+this._delayTime,this.onLoop.dispatch(this._object),!0}this.isRunning=!1,this.onComplete.dispatch(this._object);for(var a=0,h=this._chainedTweens.length;h>a;a++)this._chainedTweens[a].start(t);return!1}return!0}},e.Tween.prototype.constructor=e.Tween,e.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)):i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-e.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*e.Easing.Bounce.In(2*t):.5*e.Easing.Bounce.Out(2*t-1)+.5}}},e.Easing.Default=e.Easing.Linear.None,e.Time=function(game){this.game=game,this.time=0,this.prevTime=0,this.now=0,this.elapsed=0,this.pausedTime=0,this.advancedTiming=!1,this.fps=0,this.fpsMin=1e3,this.fpsMax=0,this.msMin=1e3,this.msMax=0,this.physicsElapsed=0,this.deltaCap=0,this.timeCap=1/60*1e3,this.frames=0,this.pauseDuration=0,this.timeToCall=0,this.lastTime=0,this.events=new e.Timer(this.game,!1),this._started=0,this._timeLastSecond=0,this._pauseStarted=0,this._justResumed=!1,this._timers=[],this._len=0,this._i=0},e.Time.prototype={boot:function(){this._started=Date.now(),this.events.start()},add:function(t){return this._timers.push(t),t},create:function(t){"undefined"==typeof t&&(t=!0);var i=new e.Timer(this.game,t);return this._timers.push(i),i},removeAll:function(){for(var t=0;t<this._timers.length;t++)this._timers[t].destroy();this._timers=[],this.events.removeAll()},update:function(t){if(this.prevTime=this.now,this.now=t,this.timeToCall=this.game.math.max(0,16-(t-this.lastTime)),this.elapsed=this.now-this.time,this.elapsed>this.timeCap&&(this.elapsed=this.timeCap),this.physicsElapsed=this.elapsed/1e3||1/60,this.deltaCap>0&&this.physicsElapsed>this.deltaCap&&(this.physicsElapsed=this.deltaCap),this.advancedTiming&&(this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(1e3*this.frames/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),this.time=this.now,this.lastTime=t+this.timeToCall,!this.game.paused)for(this.events.update(this.now),this._i=0,this._len=this._timers.length;this._i<this._len;)this._timers[this._i].update(this.now)?this._i++:(this._timers.splice(this._i,1),this._len--)},gamePaused:function(){this._pauseStarted=this.now,this.events.pause();for(var t=this._timers.length;t--;)this._timers[t]._pause()},gameResumed:function(){this.time=this.now=Date.now(),this.pauseDuration=this.time-this._pauseStarted,this.events.resume();for(var t=this._timers.length;t--;)this._timers[t]._resume()},totalElapsedSeconds:function(){return.001*(this.now-this._started)},elapsedSince:function(t){return this.now-t},elapsedSecondsSince:function(t){return.001*(this.now-t)},reset:function(){this._started=this.now,this.removeAll()}},e.Time.prototype.constructor=e.Time,e.Timer=function(game,t){"undefined"==typeof t&&(t=!0),this.game=game,this.running=!1,this.autoDestroy=t,this.expired=!1,this.elapsed=0,this.events=[],this.onComplete=new e.Signal,this.nextTick=0,this.timeCap=1e3,this.paused=!1,this._codePaused=!1,this._started=0,this._pauseStarted=0,this._pauseTotal=0,this._now=Date.now(),this._len=0,this._marked=0,this._i=0,this._diff=0,this._newTick=0},e.Timer.MINUTE=6e4,e.Timer.SECOND=1e3,e.Timer.HALF=500,e.Timer.QUARTER=250,e.Timer.prototype={create:function(t,i,n,s,r,o){t=Math.round(t);var a=t;a+=0===this._now?this.game.time.now:this._now;var h=new e.TimerEvent(this,t,a,n,i,s,r,o);return this.events.push(h),this.order(),this.expired=!1,h},add:function(t,e,i){return this.create(t,!1,0,e,i,Array.prototype.splice.call(arguments,3))},repeat:function(t,e,i,n){return this.create(t,!1,e,i,n,Array.prototype.splice.call(arguments,4))},loop:function(t,e,i){return this.create(t,!0,0,e,i,Array.prototype.splice.call(arguments,3))},start:function(t){if(!this.running){this._started=this.game.time.now+(t||0),this.running=!0;for(var e=0;e<this.events.length;e++)this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=!1,"undefined"==typeof t&&(t=!0),t&&(this.events.length=0)},remove:function(t){for(var e=0;e<this.events.length;e++)if(this.events[e]===t)return this.events[e].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(t,e){return t.tick<e.tick?-1:t.tick>e.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length,this._i=0},update:function(t){if(this.paused)return!0;if(this.elapsed=t-this._now,this._now=t,this.elapsed>this.timeCap&&this.adjustEvents(t-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){for(;this._i<this._len&&this.running&&this._now>=this.events[this._i].tick;)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&(this._codePaused=!0,this.paused||(this._pauseStarted=this.game.time.now,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.now,this.paused=!0)},adjustEvents:function(t){for(var e=0;e<this.events.length;e++)if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;0>i&&(i=0),this.events[e].tick=this._now+i}var n=this.nextTick-t;0>n?this.nextTick=this._now:this.nextTick=this._now+n},resume:function(){if(this.paused){var t=this.game.time.now;this._pauseTotal+=t-this._now,this._now=t,this.adjustEvents(this._pauseStarted),this.paused=!1,this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll(),this.events.length=0,this._len=0,this._i=0},destroy:function(){this.onComplete.removeAll(),this.running=!1,this.events=[],this._len=0,this._i=0}},Object.defineProperty(e.Timer.prototype,"next",{get:function(){return this.nextTick}}),Object.defineProperty(e.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}}),Object.defineProperty(e.Timer.prototype,"length",{get:function(){return this.events.length}}),Object.defineProperty(e.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}}),Object.defineProperty(e.Timer.prototype,"seconds",{get:function(){return this.running?.001*this.ms:0}}),e.Timer.prototype.constructor=e.Timer,e.TimerEvent=function(t,e,i,n,s,r,o,a){this.timer=t,this.delay=e,this.tick=i,this.repeatCount=n-1,this.loop=s,this.callback=r,this.callbackContext=o,this.args=a,this.pendingDelete=!1},e.TimerEvent.prototype.constructor=e.TimerEvent,e.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},e.AnimationManager.prototype={loadFrameData:function(t,e){if("undefined"==typeof t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,"undefined"==typeof e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return"undefined"==typeof e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,i,n,s,r){return i=i||[],n=n||60,"undefined"==typeof s&&(s=!1),"undefined"==typeof r&&(r=i&&"number"==typeof i[0]?!0:!1),null===this.sprite.events.onAnimationStart&&(this.sprite.events.onAnimationStart=new e.Signal,this.sprite.events.onAnimationComplete=new e.Signal,this.sprite.events.onAnimationLoop=new e.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(i,r,this._outputFrames),this._anims[t]=new e.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,n,s),this.currentAnim=this._anims[t],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(t,e){"undefined"==typeof e&&(e=!0);for(var i=0;i<t.length;i++)if(e===!0){if(t[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(t[i])===!1)return!1;return!0},play:function(t,e,i,n){return this._anims[t]?this.currentAnim===this._anims[t]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(e,i,n)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[t],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(e,i,n)):void 0},stop:function(t,e){"undefined"==typeof e&&(e=!1),"string"==typeof t?this._anims[t]&&(this.currentAnim=this._anims[t],this.currentAnim.stop(e)):this.currentAnim&&this.currentAnim.stop(e)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()===!0?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.currentFrame=this.currentAnim.currentFrame)},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._frameData=null,this._frameIndex=0,this.currentAnim=null,this.currentFrame=null}},e.AnimationManager.prototype.constructor=e.AnimationManager,Object.defineProperty(e.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(e.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(e.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(e.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}}),Object.defineProperty(e.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this._frameIndex:void 0},set:function(t){"number"==typeof t&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&(this._frameIndex=t,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(e.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(t){"string"==typeof t&&null!==this._frameData.getFrameByName(t)?(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+t)}}),e.Animation=function(game,t,i,n,s,r,o){"undefined"==typeof o&&(o=!1),this.game=game,this._parent=t,this._frameData=n,this.name=i,this._frames=[],this._frames=this._frames.concat(s),this.delay=1e3/r,this.loop=o,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.onStart=new e.Signal,this.onUpdate=null,this.onComplete=new e.Signal,this.onLoop=new e.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},e.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),"undefined"!=typeof i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this._parent.events.onAnimationStart.dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if("undefined"==typeof e&&(e=!1),"string"==typeof t)for(var n=0;n<this._frames.length;n++)this._frameData.getFrame(this._frames[n]).name===t&&(i=n);else if("number"==typeof t)if(e)i=t;else for(var n=0;n<this._frames.length;n++)this.frames[n]===i&&(i=n);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.now,this.update())},stop:function(t,e){"undefined"==typeof t&&(t=!1),"undefined"==typeof e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.now)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.now+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.now>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.now-this._timeNextFrame,this._timeLastFrame=this.game.time.now,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length&&(this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop.dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this)):this.complete()),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame)),!0):!1},next:function(t){"undefined"==typeof t&&(t=1);var e=this._frameIndex+t;e>=this._frames.length&&(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))},previous:function(t){"undefined"==typeof t&&(t=1);var e=this._frameIndex-t;0>e&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose()},complete:function(){this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},e.Animation.prototype.constructor=e.Animation,Object.defineProperty(e.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.now:this.isPlaying&&(this._timeNextFrame=this.game.time.now+this.delay)}}),Object.defineProperty(e.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(e.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]),null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(e.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){t>=1&&(this.delay=1e3/t)}}),Object.defineProperty(e.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new e.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),e.Animation.generateFrameNames=function(t,i,n,s,r){"undefined"==typeof s&&(s="");var o=[],a="";if(n>i)for(var h=i;n>=h;h++)a="number"==typeof r?e.Utils.pad(h.toString(),r,"0",1):h.toString(),a=t+a+s,o.push(a);else for(var h=i;h>=n;h--)a="number"==typeof r?e.Utils.pad(h.toString(),r,"0",1):h.toString(),a=t+a+s,o.push(a);return o},e.Frame=function(t,i,n,s,r,o,a){this.index=t,this.x=i,this.y=n,this.width=s,this.height=r,this.name=o,this.uuid=a,this.centerX=Math.floor(s/2),this.centerY=Math.floor(r/2),this.distance=e.Math.distance(0,0,s,r),this.rotated=!1,this.rotationDirection="cw",this.trimmed=!1,this.sourceSizeW=s,this.sourceSizeH=r,this.spriteSourceSizeX=0,this.spriteSourceSizeY=0,this.spriteSourceSizeW=0,this.spriteSourceSizeH=0,this.right=this.x+this.width,this.bottom=this.y+this.height},e.Frame.prototype={setTrim:function(t,e,i,n,s,r,o){this.trimmed=t,t&&(this.sourceSizeW=e,this.sourceSizeH=i,this.centerX=Math.floor(e/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=n,this.spriteSourceSizeY=s,this.spriteSourceSizeW=r,this.spriteSourceSizeH=o)},clone:function(){var t=new e.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var i in this)this.hasOwnProperty(i)&&(t[i]=this[i]);return t},getRect:function(t){return"undefined"==typeof t?t=new e.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}},e.Frame.prototype.constructor=e.Frame,e.FrameData=function(){this._frames=[],this._frameNames=[]},e.FrameData.prototype={addFrame:function(t){return t.index=this._frames.length,this._frames.push(t),""!==t.name&&(this._frameNames[t.name]=t.index),t},getFrame:function(t){return t>this._frames.length&&(t=0),this._frames[t]},getFrameByName:function(t){return"number"==typeof this._frameNames[t]?this._frames[this._frameNames[t]]:null},checkFrameName:function(t){return null==this._frameNames[t]?!1:!0},clone:function(){for(var t=new e.FrameData,i=0;i<this._frames.length;i++)t._frames.push(this._frames[i].clone());for(var i=0;i<this._frameNames.length;i++)t._frameNames.push(this._frameNames[i]);return t},getFrameRange:function(t,e,i){"undefined"==typeof i&&(i=[]);for(var n=t;e>=n;n++)i.push(this._frames[n]);return i},getFrames:function(t,e,i){if("undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=[]),"undefined"==typeof t||0===t.length)for(var n=0;n<this._frames.length;n++)i.push(this._frames[n]);else for(var n=0,s=t.length;s>n;n++)e?i.push(this.getFrame(t[n])):i.push(this.getFrameByName(t[n]));return i},getFrameIndexes:function(t,e,i){if("undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=[]),"undefined"==typeof t||0===t.length)for(var n=0,s=this._frames.length;s>n;n++)i.push(this._frames[n].index);else for(var n=0,s=t.length;s>n;n++)e?i.push(t[n]):this.getFrameByName(t[n])&&i.push(this.getFrameByName(t[n]).index);return i}},e.FrameData.prototype.constructor=e.FrameData,Object.defineProperty(e.FrameData.prototype,"total",{get:function(){return this._frames.length}}),e.AnimationParser={spriteSheet:function(game,t,i,n,s,r,o){var a=game.cache.getImage(t);if(null==a)return null;var h=a.width,l=a.height;0>=i&&(i=Math.floor(-h/Math.min(-1,i))),0>=n&&(n=Math.floor(-l/Math.min(-1,n)));var c=Math.floor((h-r)/(i+o)),u=Math.floor((l-r)/(n+o)),d=c*u;if(-1!==s&&(d=s),0===h||0===l||i>h||n>l||0===d)return console.warn("Phaser.AnimationParser.spriteSheet: '"+t+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;for(var A=new e.FrameData,p=r,m=r,f=0;d>f;f++){var g=game.rnd.uuid();A.addFrame(new e.Frame(f,p,m,i,n,"",g)),PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[t],{x:p,y:m,width:i,height:n}),p+=i+o,p+i>h&&(p=r,m+=n+o)}return A},JSONData:function(game,t,i){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array"),void console.log(t);for(var n,s=new e.FrameData,r=t.frames,o=0;o<r.length;o++){var a=game.rnd.uuid();n=s.addFrame(new e.Frame(o,r[o].frame.x,r[o].frame.y,r[o].frame.w,r[o].frame.h,r[o].filename,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:r[o].frame.x,y:r[o].frame.y,width:r[o].frame.w,height:r[o].frame.h}),r[o].trimmed&&n.setTrim(r[o].trimmed,r[o].sourceSize.w,r[o].sourceSize.h,r[o].spriteSourceSize.x,r[o].spriteSourceSize.y,r[o].spriteSourceSize.w,r[o].spriteSourceSize.h)}return s},JSONDataHash:function(game,t,i){if(!t.frames)return console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object"),void console.log(t);var n,s=new e.FrameData,r=t.frames,o=0;for(var a in r){var h=game.rnd.uuid();n=s.addFrame(new e.Frame(o,r[a].frame.x,r[a].frame.y,r[a].frame.w,r[a].frame.h,a,h)),PIXI.TextureCache[h]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:r[a].frame.x,y:r[a].frame.y,width:r[a].frame.w,height:r[a].frame.h}),r[a].trimmed&&n.setTrim(r[a].trimmed,r[a].sourceSize.w,r[a].sourceSize.h,r[a].spriteSourceSize.x,r[a].spriteSourceSize.y,r[a].spriteSourceSize.w,r[a].spriteSourceSize.h),o++}return s},XMLData:function(game,t,i){if(!t.getElementsByTagName("TextureAtlas"))return void console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");for(var n,s,r,o,a,h,l,c,u,d,A,p,m=new e.FrameData,f=t.getElementsByTagName("SubTexture"),g=0;g<f.length;g++)s=game.rnd.uuid(),o=f[g].attributes,r=o.name.value,a=parseInt(o.x.value,10),h=parseInt(o.y.value,10),l=parseInt(o.width.value,10),c=parseInt(o.height.value,10),u=null,d=null,o.frameX&&(u=Math.abs(parseInt(o.frameX.value,10)),
d=Math.abs(parseInt(o.frameY.value,10)),A=parseInt(o.frameWidth.value,10),p=parseInt(o.frameHeight.value,10)),n=m.addFrame(new e.Frame(g,a,h,l,c,r,s)),PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:a,y:h,width:l,height:c}),(null!==u||null!==d)&&n.setTrim(!0,l,c,u,d,A,p);return m}},e.Cache=function(game){this.game=game,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._json={},this._xml={},this._physics={},this._tilemaps={},this._binary={},this._bitmapDatas={},this._bitmapFont={},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new e.Signal,this._cacheMap=[],this._cacheMap[e.Cache.CANVAS]=this._canvases,this._cacheMap[e.Cache.IMAGE]=this._images,this._cacheMap[e.Cache.TEXTURE]=this._textures,this._cacheMap[e.Cache.SOUND]=this._sounds,this._cacheMap[e.Cache.TEXT]=this._text,this._cacheMap[e.Cache.PHYSICS]=this._physics,this._cacheMap[e.Cache.TILEMAP]=this._tilemaps,this._cacheMap[e.Cache.BINARY]=this._binary,this._cacheMap[e.Cache.BITMAPDATA]=this._bitmapDatas,this._cacheMap[e.Cache.BITMAPFONT]=this._bitmapFont,this._cacheMap[e.Cache.JSON]=this._json,this._cacheMap[e.Cache.XML]=this._xml},e.Cache.CANVAS=1,e.Cache.IMAGE=2,e.Cache.TEXTURE=3,e.Cache.SOUND=4,e.Cache.TEXT=5,e.Cache.PHYSICS=6,e.Cache.TILEMAP=7,e.Cache.BINARY=8,e.Cache.BITMAPDATA=9,e.Cache.BITMAPFONT=10,e.Cache.JSON=11,e.Cache.XML=12,e.Cache.prototype={addCanvas:function(t,e,i){this._canvases[t]={canvas:e,context:i}},addBinary:function(t,e){this._binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,this._bitmapDatas[t]={data:e,frameData:i},e},addRenderTexture:function(t,i){var n=new e.Frame(0,0,0,i.width,i.height,"","");this._textures[t]={texture:i,frame:n}},addSpriteSheet:function(t,i,n,s,r,o,a,h){this._images[t]={url:i,data:n,frameWidth:s,frameHeight:r,margin:a,spacing:h},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(n),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),this._images[t].frameData=e.AnimationParser.spriteSheet(this.game,t,s,r,o,a,h),this._urlMap[this._resolveUrl(i)]=this._images[t]},addTilemap:function(t,e,i,n){this._tilemaps[t]={url:e,data:i,format:n},this._urlMap[this._resolveUrl(e)]=this._tilemaps[t]},addTextureAtlas:function(t,i,n,s,r){this._images[t]={url:i,data:n},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(n),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),r==e.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[t].frameData=e.AnimationParser.JSONData(this.game,s,t):r==e.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[t].frameData=e.AnimationParser.JSONDataHash(this.game,s,t):r==e.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[t].frameData=e.AnimationParser.XMLData(this.game,s,t)),this._urlMap[this._resolveUrl(i)]=this._images[t]},addBitmapFont:function(t,i,n,s,r,o){this._images[t]={url:i,data:n},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(n),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),e.LoaderParser.bitmapFont(this.game,s,t,r,o),this._bitmapFont[t]=PIXI.BitmapText.fonts[t],this._urlMap[this._resolveUrl(i)]=this._bitmapFont[t]},addPhysicsData:function(t,e,i,n){this._physics[t]={url:e,data:i,format:n},this._urlMap[this._resolveUrl(e)]=this._physics[t]},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:t},this._images.__default.frame=new e.Frame(0,0,0,32,32,"",""),this._images.__default.frameData=new e.FrameData,this._images.__default.frameData.addFrame(new e.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(t),PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:t},this._images.__missing.frame=new e.Frame(0,0,0,32,32,"",""),this._images.__missing.frameData=new e.FrameData,this._images.__missing.frameData.addFrame(new e.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(t),PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(t,e,i){this._text[t]={url:e,data:i},this._urlMap[this._resolveUrl(e)]=this._text[t]},addJSON:function(t,e,i){this._json[t]={url:e,data:i},this._urlMap[this._resolveUrl(e)]=this._json[t]},addXML:function(t,e,i){this._xml[t]={url:e,data:i}},addImage:function(t,i,n){this._images[t]={url:i,data:n},this._images[t].frame=new e.Frame(0,0,0,n.width,n.height,t,this.game.rnd.uuid()),this._images[t].frameData=new e.FrameData,this._images[t].frameData.addFrame(new e.Frame(0,0,0,n.width,n.height,i,this.game.rnd.uuid())),PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(n),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),this._urlMap[this._resolveUrl(i)]=this._images[t]},addSound:function(t,e,i,n,s){n=n||!0,s=s||!1;var r=!1;s&&(r=!0),this._sounds[t]={url:e,data:i,isDecoding:!1,decoded:r,webAudio:n,audioTag:s,locked:this.game.sound.touchLocked},this._urlMap[this._resolveUrl(e)]=this._sounds[t]},reloadSound:function(t){var e=this;this._sounds[t]&&(this._sounds[t].data.src=this._sounds[t].url,this._sounds[t].data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),this._sounds[t].data.load())},reloadSoundComplete:function(t){this._sounds[t]&&(this._sounds[t].locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){this._sounds[t]&&(this._sounds[t][e]=i)},decodedSound:function(t,e){this._sounds[t].data=e,this._sounds[t].decoded=!0,this._sounds[t].isDecoding=!1},getCanvas:function(t){return this._canvases[t]?this._canvases[t].canvas:void console.warn('Phaser.Cache.getCanvas: Invalid key: "'+t+'"')},getBitmapData:function(t){return this._bitmapDatas[t]?this._bitmapDatas[t].data:void console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+t+'"')},getBitmapFont:function(t){return this._bitmapFont[t]?this._bitmapFont[t]:void console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+t+'"')},getPhysicsData:function(t,e,i){if("undefined"==typeof e||null===e){if(this._physics[t])return this._physics[t].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+t+'"')}else if(this._physics[t]&&this._physics[t].data[e]){var n=this._physics[t].data[e];if(!n||!i)return n;for(var s in n)if(s=n[s],s.fixtureKey===i)return s;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"');return null},checkKey:function(t,e){return this._cacheMap[t][e]?!0:!1},checkCanvasKey:function(t){return this.checkKey(e.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(e.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(e.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(e.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(e.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(e.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(e.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(e.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(e.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(e.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(e.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(e.Cache.XML,t)},checkUrl:function(t){return this._urlMap[this._resolveUrl(t)]?!0:!1},getImage:function(t){return this._images[t]?this._images[t].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+t+'"'),null)},getTilemapData:function(t){return this._tilemaps[t]?this._tilemaps[t]:void console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+t+'"')},getFrameData:function(t,i){return"undefined"==typeof i&&(i=e.Cache.IMAGE),this._cacheMap[i][t]?this._cacheMap[i][t].frameData:null},updateFrameData:function(t,e){this._images[t]&&(this._images[t].frameData=e)},getFrameByIndex:function(t,e){return this._images[t]?this._images[t].frameData.getFrame(e):null},getFrameByName:function(t,e){return this._images[t]?this._images[t].frameData.getFrameByName(e):null},getFrame:function(t){return this._images[t]?this._images[t].frame:null},getTextureFrame:function(t){return this._textures[t]?this._textures[t].frame:null},getTexture:function(t){return this._textures[t]?this._textures[t]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+t+'"')},getSound:function(t){return this._sounds[t]?this._sounds[t]:void console.warn('Phaser.Cache.getSound: Invalid key: "'+t+'"')},getSoundData:function(t){return this._sounds[t]?this._sounds[t].data:void console.warn('Phaser.Cache.getSoundData: Invalid key: "'+t+'"')},isSoundDecoded:function(t){return this._sounds[t]?this._sounds[t].decoded:void 0},isSoundReady:function(t){return this._sounds[t]&&this._sounds[t].decoded&&this.game.sound.touchLocked===!1},getFrameCount:function(t){return this._images[t]?this._images[t].frameData.total:0},getText:function(t){return this._text[t]?this._text[t].data:void console.warn('Phaser.Cache.getText: Invalid key: "'+t+'"')},getJSON:function(t){return this._json[t]?this._json[t].data:void console.warn('Phaser.Cache.getJSON: Invalid key: "'+t+'"')},getXML:function(t){return this._xml[t]?this._xml[t].data:void console.warn('Phaser.Cache.getXML: Invalid key: "'+t+'"')},getBinary:function(t){return this._binary[t]?this._binary[t]:void console.warn('Phaser.Cache.getBinary: Invalid key: "'+t+'"')},getUrl:function(t){return this._urlMap[this._resolveUrl(t)]?this._urlMap[this._resolveUrl(t)]:void console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'"')},getKeys:function(t){var i=null;switch(t){case e.Cache.CANVAS:i=this._canvases;break;case e.Cache.IMAGE:i=this._images;break;case e.Cache.TEXTURE:i=this._textures;break;case e.Cache.SOUND:i=this._sounds;break;case e.Cache.TEXT:i=this._text;break;case e.Cache.PHYSICS:i=this._physics;break;case e.Cache.TILEMAP:i=this._tilemaps;break;case e.Cache.BINARY:i=this._binary;break;case e.Cache.BITMAPDATA:i=this._bitmapDatas;break;case e.Cache.BITMAPFONT:i=this._bitmapFont;break;case e.Cache.JSON:i=this._json;break;case e.Cache.XML:i=this._xml}if(i){var n=[];for(var s in i)"__default"!==s&&"__missing"!==s&&n.push(s);return n}},removeCanvas:function(t){delete this._canvases[t]},removeImage:function(t,e){"undefined"==typeof e&&(e=!0),delete this._images[t],e&&PIXI.BaseTextureCache[t].destroy()},removeSound:function(t){delete this._sounds[t]},removeText:function(t){delete this._text[t]},removeJSON:function(t){delete this._json[t]},removeXML:function(t){delete this._xml[t]},removePhysics:function(t){delete this._physics[t]},removeTilemap:function(t){delete this._tilemaps[t]},removeBinary:function(t){delete this._binary[t]},removeBitmapData:function(t){delete this._bitmapDatas[t]},removeBitmapFont:function(t){delete this._bitmapFont[t]},_resolveUrl:function(t){return this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",this._urlTemp},destroy:function(){for(var t in this._canvases)delete this._canvases[t];for(var t in this._images)"__default"!==t&&"__missing"!==t&&delete this._images[t];for(var t in this._sounds)delete this._sounds[t];for(var t in this._text)delete this._text[t];for(var t in this._json)delete this._json[t];for(var t in this._xml)delete this._xml[t];for(var t in this._textures)delete this._textures[t];for(var t in this._physics)delete this._physics[t];for(var t in this._tilemaps)delete this._tilemaps[t];for(var t in this._binary)delete this._binary[t];for(var t in this._bitmapDatas)delete this._bitmapDatas[t];for(var t in this._bitmapFont)delete this._bitmapFont[t];this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},e.Cache.prototype.constructor=e.Cache,e.Loader=function(game){this.game=game,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.progressFloat=0,this.preloadSprite=null,this.crossOrigin=!1,this.baseURL="",this.onLoadStart=new e.Signal,this.onFileStart=new e.Signal,this.onFileComplete=new e.Signal,this.onFileError=new e.Signal,this.onLoadComplete=new e.Signal,this.onPackComplete=new e.Signal,this.useXDomainRequest=9===this.game.device.ieVersion,this._packList=[],this._packIndex=0,this._fileList=[],this._fileIndex=0,this._progressChunk=0,this._xhr=new XMLHttpRequest,this._ajax=null},e.Loader.TEXTURE_ATLAS_JSON_ARRAY=0,e.Loader.TEXTURE_ATLAS_JSON_HASH=1,e.Loader.TEXTURE_ATLAS_XML_STARLING=2,e.Loader.PHYSICS_LIME_CORONA_JSON=3,e.Loader.PHYSICS_PHASER_JSON=4,e.Loader.prototype={setPreloadSprite:function(t,i){i=i||0,this.preloadSprite={sprite:t,direction:i,width:t.width,height:t.height,rect:null},0===i?this.preloadSprite.rect=new e.Rectangle(0,0,1,t.height):this.preloadSprite.rect=new e.Rectangle(0,0,t.width,1),t.crop(this.preloadSprite.rect),t.visible=!0},checkKeyExists:function(t,e){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===t&&this._fileList[i].key===e)return!0;return!1},getAssetIndex:function(t,e){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===t&&this._fileList[i].key===e)return i;return-1},getAsset:function(t,e){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===t&&this._fileList[i].key===e)return{index:i,file:this._fileList[i]};return!1},reset:function(){this.preloadSprite=null,this.isLoading=!1,this._packList.length=0,this._packIndex=0,this._fileList.length=0,this._fileIndex=0},addToFileList:function(t,e,i,n){var s={type:t,key:e,url:i,data:null,error:!1,loaded:!1};if("undefined"!=typeof n)for(var r in n)s[r]=n[r];this.checkKeyExists(t,e)===!1&&this._fileList.push(s)},replaceInFileList:function(t,e,i,n){var s={type:t,key:e,url:i,data:null,error:!1,loaded:!1};if("undefined"!=typeof n)for(var r in n)s[r]=n[r];var o=this.getAssetIndex(t,e);-1===o?this._fileList.push(s):this._fileList[o]=s},pack:function(t,e,i,n){return"undefined"==typeof e&&(e=null),"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=this),null===e&&null===i?(console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this):(i&&"string"==typeof i&&(i=JSON.parse(i)),this._packList.push({key:t,url:e,data:i,loaded:!1,error:!1,callbackContext:n}),this)},image:function(t,e,i){return"undefined"==typeof i&&(i=!1),i?this.replaceInFileList("image",t,e):this.addToFileList("image",t,e),this},text:function(t,e,i){return"undefined"==typeof i&&(i=!1),i?this.replaceInFileList("text",t,e):this.addToFileList("text",t,e),this},json:function(t,e,i){return"undefined"==typeof i&&(i=!1),i?this.replaceInFileList("json",t,e):this.addToFileList("json",t,e),this},xml:function(t,e,i){return"undefined"==typeof i&&(i=!1),i?this.replaceInFileList("xml",t,e):this.addToFileList("xml",t,e),this},script:function(t,e,i,n){return"undefined"==typeof i&&(i=!1),i!==!1&&"undefined"==typeof n&&(n=i),this.addToFileList("script",t,e,{callback:i,callbackContext:n}),this},binary:function(t,e,i,n){return"undefined"==typeof i&&(i=!1),i!==!1&&"undefined"==typeof n&&(n=i),this.addToFileList("binary",t,e,{callback:i,callbackContext:n}),this},spritesheet:function(t,e,i,n,s,r,o){return"undefined"==typeof s&&(s=-1),"undefined"==typeof r&&(r=0),"undefined"==typeof o&&(o=0),this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:n,frameMax:s,margin:r,spacing:o}),this},audio:function(t,e,i){return"undefined"==typeof i&&(i=!0),this.addToFileList("audio",t,e,{buffer:null,autoDecode:i}),this},audiosprite:function(t,e,i){return this.audio(t,e),this.json(t+"-audioatlas",i),this},tilemap:function(t,i,n,s){if("undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=e.Tilemap.CSV),null==i&&null==n)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(n){switch(s){case e.Tilemap.CSV:break;case e.Tilemap.TILED_JSON:"string"==typeof n&&(n=JSON.parse(n))}this.game.cache.addTilemap(t,null,n,s)}else this.addToFileList("tilemap",t,i,{format:s});return this},physics:function(t,i,n,s){return"undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=e.Physics.LIME_CORONA_JSON),null==i&&null==n?(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this):(n?("string"==typeof n&&(n=JSON.parse(n)),this.game.cache.addPhysicsData(t,null,n,s)):this.addToFileList("physics",t,i,{format:s}),this)},bitmapFont:function(t,e,i,n,s,r){if("undefined"==typeof i&&(i=null),"undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=0),i)this.addToFileList("bitmapfont",t,e,{xmlURL:i,xSpacing:s,ySpacing:r});else if("string"==typeof n){var o;try{if(window.DOMParser){var a=new DOMParser;o=a.parseFromString(n,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(n)}catch(h){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");this.addToFileList("bitmapfont",t,e,{xmlURL:null,xmlData:o,xSpacing:s,ySpacing:r})}return this},atlasJSONArray:function(t,i,n,s){return this.atlas(t,i,n,s,e.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,i,n,s){return this.atlas(t,i,n,s,e.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,i,n,s){return this.atlas(t,i,n,s,e.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,i,n,s,r){if("undefined"==typeof n&&(n=null),"undefined"==typeof s&&(s=null),"undefined"==typeof r&&(r=e.Loader.TEXTURE_ATLAS_JSON_ARRAY),n)this.addToFileList("textureatlas",t,i,{atlasURL:n,format:r});else{switch(r){case e.Loader.TEXTURE_ATLAS_JSON_ARRAY:"string"==typeof s&&(s=JSON.parse(s));break;case e.Loader.TEXTURE_ATLAS_XML_STARLING:if("string"==typeof s){var o;try{if(window.DOMParser){var a=new DOMParser;o=a.parseFromString(s,"text/xml")}else o=new ActiveXObject("Microsoft.XMLDOM"),o.async="false",o.loadXML(s)}catch(h){o=void 0}if(!o||!o.documentElement||o.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");s=o}}this.addToFileList("textureatlas",t,i,{atlasURL:null,atlasData:s,format:r})}return this},removeFile:function(t,e){var i=this.getAsset(t,e);i!==!1&&this._fileList.splice(i.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this._packList.length>0?(this._packIndex=0,this.loadPack()):this.beginLoad())},beginLoad:function(){this.progress=0,this.progressFloat=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this.loadFile()):(this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.isLoading=!1,this.onLoadComplete.dispatch())},loadPack:function(){if(!this._packList[this._packIndex])return void console.warn("Phaser.Loader loadPackList invalid index "+this._packIndex);var t=this._packList[this._packIndex];null!==t.data?this.packLoadComplete(this._packIndex,!1):this.xhrLoad(this._packIndex,this.baseURL+t.url,"text","packLoadComplete","packLoadError")},packLoadComplete:function(t,i){if("undefined"==typeof i&&(i=!0),!this._packList[t])return void console.warn("Phaser.Loader packLoadComplete invalid index "+t);var n=this._packList[t];if(n.loaded=!0,i)var s=JSON.parse(this._xhr.responseText);else var s=this._packList[t].data;if(s[n.key])for(var r,o=0;o<s[n.key].length;o++)switch(r=s[n.key][o],r.type){case"image":this.image(r.key,r.url,r.overwrite);break;case"text":this.text(r.key,r.url,r.overwrite);break;case"json":this.json(r.key,r.url,r.overwrite);break;case"xml":this.xml(r.key,r.url,r.overwrite);break;case"script":this.script(r.key,r.url,r.callback,n.callbackContext);break;case"binary":this.binary(r.key,r.url,r.callback,n.callbackContext);break;case"spritesheet":this.spritesheet(r.key,r.url,r.frameWidth,r.frameHeight,r.frameMax,r.margin,r.spacing);break;case"audio":this.audio(r.key,r.urls,r.autoDecode);break;case"tilemap":this.tilemap(r.key,r.url,r.data,e.Tilemap[r.format]);break;case"physics":this.physics(r.key,r.url,r.data,e.Loader[r.format]);break;case"bitmapFont":this.bitmapFont(r.key,r.textureURL,r.xmlURL,r.xmlData,r.xSpacing,r.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasXML":this.atlasXML(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlas":this.atlas(r.key,r.textureURL,r.atlasURL,r.atlasData,e.Loader[r.format])}this.nextPack(t,!0)},packError:function(t){this._packList[t].loaded=!0,this._packList[t].error=!0,this.onFileError.dispatch(this._packList[t].key,this._packList[t]),console.warn("Phaser.Loader error loading pack file: "+this._packList[t].key+" from URL "+this._packList[t].url),this.nextPack(t,!1)},nextPack:function(t,e){this.onPackComplete.dispatch(this._packList[t].key,e,this.totalLoadedPacks(),this._packList.length),this._packIndex++,this._packIndex<this._packList.length?this.loadPack():this.beginLoad()},loadFile:function(){if(!this._fileList[this._fileIndex])return void console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);var t=this._fileList[this._fileIndex],i=this;switch(this.onFileStart.dispatch(this.progress,t.key,t.url),t.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":t.data=new Image,t.data.name=t.key,t.data.onload=function(){return i.fileComplete(i._fileIndex)},t.data.onerror=function(){return i.fileError(i._fileIndex)},this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin),t.data.src=this.baseURL+t.url;break;case"audio":t.url=this.getAudioURL(t.url),null!==t.url?this.game.sound.usingWebAudio?this.xhrLoad(this._fileIndex,this.baseURL+t.url,"arraybuffer","fileComplete","fileError"):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.baseURL+t.url,this.fileComplete(this._fileIndex)):(t.data=new Audio,t.data.name=t.key,t.data.onerror=function(){return i.fileError(i._fileIndex)},t.data.preload="auto",t.data.src=this.baseURL+t.url,t.data.addEventListener("canplaythrough",function(){e.GAMES[i.game.id].load.fileComplete(i._fileIndex)},!1),t.data.load())):this.fileError(this._fileIndex);break;case"json":this.useXDomainRequest&&window.XDomainRequest?(this._ajax=new window.XDomainRequest,this._ajax.timeout=3e3,this._ajax.onerror=function(){return i.dataLoadError(i._fileIndex)},this._ajax.ontimeout=function(){return i.dataLoadError(i._fileIndex)},this._ajax.onprogress=function(){},this._ajax.onload=function(){return i.jsonLoadComplete(i._fileIndex)},this._ajax.open("GET",this.baseURL+t.url,!0),setTimeout(function(){this._ajax.send()},0)):this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","jsonLoadComplete","dataLoadError");break;case"xml":this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","xmlLoadComplete","dataLoadError");break;case"tilemap":if(t.format===e.Tilemap.TILED_JSON)this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","jsonLoadComplete","dataLoadError");else{if(t.format!==e.Tilemap.CSV)throw new Error("Phaser.Loader. Invalid Tilemap format: "+t.format);this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","csvLoadComplete","dataLoadError")}break;case"text":case"script":case"physics":this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(this._fileIndex,this.baseURL+t.url,"arraybuffer","fileComplete","fileError")}},xhrLoad:function(t,e,i,n,s){this._xhr.open("GET",e,!0),this._xhr.responseType=i;var r=this;this._xhr.onload=function(){return r[n](t)},this._xhr.onerror=function(){return r[s](t)},this._xhr.send()},getAudioURL:function(t){var e;"string"==typeof t&&(t=[t]);for(var i=0;i<t.length;i++)if(e=t[i].toLowerCase(),e=e.substr((Math.max(0,e.lastIndexOf("."))||1/0)+1),e.indexOf("?")>=0&&(e=e.substr(0,e.indexOf("?"))),this.game.device.canPlayAudio(e))return t[i];return null},fileError:function(t){this._fileList[t].loaded=!0,this._fileList[t].error=!0,this.onFileError.dispatch(this._fileList[t].key,this._fileList[t]),console.warn("Phaser.Loader error loading file: "+this._fileList[t].key+" from URL "+this._fileList[t].url),this.nextFile(t,!1)},fileComplete:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader fileComplete invalid index "+t);var i=this._fileList[t];i.loaded=!0;var n=!0;switch(i.type){case"image":this.game.cache.addImage(i.key,i.url,i.data);break;case"spritesheet":this.game.cache.addSpriteSheet(i.key,i.url,i.data,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"textureatlas":if(null==i.atlasURL)this.game.cache.addTextureAtlas(i.key,i.url,i.data,i.atlasData,i.format);else if(n=!1,i.format==e.Loader.TEXTURE_ATLAS_JSON_ARRAY||i.format==e.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(this._fileIndex,this.baseURL+i.atlasURL,"text","jsonLoadComplete","dataLoadError");else{if(i.format!=e.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+i.format);this.xhrLoad(this._fileIndex,this.baseURL+i.atlasURL,"text","xmlLoadComplete","dataLoadError")}break;case"bitmapfont":null==i.xmlURL?this.game.cache.addBitmapFont(i.key,i.url,i.data,i.xmlData,i.xSpacing,i.ySpacing):(n=!1,this.xhrLoad(this._fileIndex,this.baseURL+i.xmlURL,"text","xmlLoadComplete","dataLoadError"));break;case"audio":if(this.game.sound.usingWebAudio){if(i.data=this._xhr.response,this.game.cache.addSound(i.key,i.url,i.data,!0,!1),i.autoDecode){var s=this,r=i.key;this.game.cache.updateSound(r,"isDecoding",!0),this.game.sound.context.decodeAudioData(i.data,function(t){t&&(s.game.cache.decodedSound(r,t),s.game.sound.onSoundDecode.dispatch(r,s.game.cache.getSound(r)))})}}else i.data.removeEventListener("canplaythrough",e.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(i.key,i.url,i.data,!1,!0);break;case"text":i.data=this._xhr.responseText,this.game.cache.addText(i.key,i.url,i.data);break;case"physics":var o=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(i.key,i.url,o,i.format);break;case"script":i.data=document.createElement("script"),i.data.language="javascript",i.data.type="text/javascript",i.data.defer=!1,i.data.text=this._xhr.responseText,document.head.appendChild(i.data),i.callback&&(i.data=i.callback.call(i.callbackContext,i.key,this._xhr.responseText));break;case"binary":i.callback?i.data=i.callback.call(i.callbackContext,i.key,this._xhr.response):i.data=this._xhr.response,this.game.cache.addBinary(i.key,i.data)}n&&this.nextFile(t,!0)},jsonLoadComplete:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader jsonLoadComplete invalid index "+t);var e=this._fileList[t];if(this._ajax&&this._ajax.responseText)var i=JSON.parse(this._ajax.responseText);else var i=JSON.parse(this._xhr.responseText);e.loaded=!0,"tilemap"===e.type?this.game.cache.addTilemap(e.key,e.url,i,e.format):"json"===e.type?this.game.cache.addJSON(e.key,e.url,i):this.game.cache.addTextureAtlas(e.key,e.url,e.data,i,e.format),this.nextFile(t,!0)},csvLoadComplete:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader csvLoadComplete invalid index "+t);var e=this._fileList[t],i=this._xhr.responseText;e.loaded=!0,this.game.cache.addTilemap(e.key,e.url,i,e.format),this.nextFile(t,!0)},dataLoadError:function(t){var e=this._fileList[t];e.loaded=!0,e.error=!0,console.warn("Phaser.Loader dataLoadError: "+e.key),this.nextFile(t,!0)},xmlLoadComplete:function(t){""!==this._xhr.responseType&&"text"!==this._xhr.responseType&&(console.warn("Invalid XML Response Type",this._fileList[t]),console.warn(this._xhr));var e,i=this._xhr.responseText;try{if(window.DOMParser){var n=new DOMParser;e=n.parseFromString(i,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(i)}catch(s){e=void 0}if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");var r=this._fileList[t];r.loaded=!0,"bitmapfont"===r.type?this.game.cache.addBitmapFont(r.key,r.url,r.data,e,r.xSpacing,r.ySpacing):"textureatlas"===r.type?this.game.cache.addTextureAtlas(r.key,r.url,r.data,e,r.format):"xml"===r.type&&this.game.cache.addXML(r.key,r.url,e),this.nextFile(t,!0)},nextFile:function(t,e){this.progressFloat+=this._progressChunk,this.progress=Math.round(this.progressFloat),this.progress>100&&(this.progress=100),null!==this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.updateCrop()),this.onFileComplete.dispatch(this.progress,this._fileList[t].key,e,this.totalLoadedFiles(),this._fileList.length),this.totalQueuedFiles()>0?(this._fileIndex++,this.loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},totalLoadedFiles:function(){for(var t=0,e=0;e<this._fileList.length;e++)this._fileList[e].loaded&&t++;return t},totalQueuedFiles:function(){for(var t=0,e=0;e<this._fileList.length;e++)this._fileList[e].loaded===!1&&t++;return t},totalLoadedPacks:function(){for(var t=0,e=0;e<this._packList.length;e++)this._packList[e].loaded&&t++;return t},totalQueuedPacks:function(){for(var t=0,e=0;e<this._packList.length;e++)this._packList[e].loaded===!1&&t++;return t}},e.Loader.prototype.constructor=e.Loader,e.LoaderParser={bitmapFont:function(game,t,e,i,n){var s={},r=t.getElementsByTagName("info")[0],o=t.getElementsByTagName("common")[0];s.font=r.getAttribute("face"),s.size=parseInt(r.getAttribute("size"),10),s.lineHeight=parseInt(o.getAttribute("lineHeight"),10)+n,s.chars={};for(var a=t.getElementsByTagName("char"),h=0;h<a.length;h++){var l=parseInt(a[h].getAttribute("id"),10),c=new PIXI.Rectangle(parseInt(a[h].getAttribute("x"),10),parseInt(a[h].getAttribute("y"),10),parseInt(a[h].getAttribute("width"),10),parseInt(a[h].getAttribute("height"),10));s.chars[l]={xOffset:parseInt(a[h].getAttribute("xoffset"),10),yOffset:parseInt(a[h].getAttribute("yoffset"),10),xAdvance:parseInt(a[h].getAttribute("xadvance"),10)+i,kerning:{},texture:PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[e],c)}}var u=t.getElementsByTagName("kerning");for(h=0;h<u.length;h++){var d=parseInt(u[h].getAttribute("first"),10),A=parseInt(u[h].getAttribute("second"),10),p=parseInt(u[h].getAttribute("amount"),10);s.chars[A].kerning[d]=p}PIXI.BitmapText.fonts[e]=s}},e.AudioSprite=function(game,t){this.game=game,this.key=t,this.config=this.game.cache.getJSON(t+"-audioatlas"),this.autoplayKey=null,this.autoplay=!1,this.sounds={};for(var e in this.config.spritemap){var i=this.config.spritemap[e],n=this.game.add.sound(this.key);i.loop?n.addMarker(e,i.start,i.end-i.start,null,!0):n.addMarker(e,i.start,i.end-i.start,null,!1),this.sounds[e]=n}this.config.autoplay&&(this.autoplayKey=this.config.autoplay,this.play(this.autoplayKey),this.autoplay=this.sounds[this.autoplayKey])},e.AudioSprite.prototype={play:function(t,e){return"undefined"==typeof e&&(e=1),this.sounds[t].play(t,null,e)},stop:function(t){if(t)this.sounds[t].stop();else for(var e in this.sounds)this.sounds[e].stop()},get:function(t){return this.sounds[t]}},e.AudioSprite.prototype.constructor=e.AudioSprite,e.Sound=function(game,t,i,n,s){"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=game.sound.connectToMaster),
this.game=game,this.name=t,this.key=t,this.loop=n,this.volume=i,this.markers={},this.context=null,this.autoplay=!1,this.totalDuration=0,this.startTime=0,this.currentTime=0,this.duration=0,this.durationMS=0,this.position=0,this.stopTime=0,this.paused=!1,this.pausedPosition=0,this.pausedTime=0,this.isPlaying=!1,this.currentMarker="",this.pendingPlayback=!1,this.override=!1,this.allowMultiple=!1,this.usingWebAudio=this.game.sound.usingWebAudio,this.usingAudioTag=this.game.sound.usingAudioTag,this.externalNode=null,this.masterGainNode=null,this.gainNode=null,this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,"undefined"==typeof this.context.createGain?this.gainNode=this.context.createGainNode():this.gainNode=this.context.createGain(),this.gainNode.gain.value=i*this.game.sound.volume,s&&this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(t)&&this.game.cache.isSoundReady(t)?(this._sound=this.game.cache.getSoundData(t),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this),this.onDecoded=new e.Signal,this.onPlay=new e.Signal,this.onPause=new e.Signal,this.onResume=new e.Signal,this.onLoop=new e.Signal,this.onStop=new e.Signal,this.onMute=new e.Signal,this.onMarkerComplete=new e.Signal,this.onFadeComplete=new e.Signal,this._volume=i,this._buffer=null,this._muted=!1,this._tempMarker=0,this._tempPosition=0,this._tempVolume=0,this._muteVolume=0,this._tempLoop=0,this._paused=!1,this._onDecodedEventDispatched=!1},e.Sound.prototype={soundHasUnlocked:function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(t,e,i,n,s){"undefined"==typeof n&&(n=1),"undefined"==typeof s&&(s=!1),this.markers[t]={name:t,start:e,stop:e+i,volume:n,duration:i,durationMS:1e3*i,loop:s}},removeMarker:function(t){delete this.markers[t]},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0),this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)),this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),""===this.currentMarker?(this.currentTime=0,this.startTime=this.game.time.now):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(t,e,i,n,s){if("undefined"==typeof t&&(t=""),"undefined"==typeof s&&(s=!0),this.isPlaying&&!this.allowMultiple&&!s&&!this.override)return this;if(this.isPlaying&&!this.allowMultiple&&(this.override||s)&&(this.usingWebAudio?"undefined"==typeof this._sound.stop?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=t,""!==t){if(!this.markers[t])return console.warn("Phaser.Sound.play: audio marker "+t+" doesn't exist"),this;this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,"undefined"!=typeof i&&(this.volume=i),"undefined"!=typeof n&&(this.loop=n),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,"undefined"==typeof i&&(i=this._volume),"undefined"==typeof n&&(n=this.loop),this.position=e,this.volume=i,this.loop=n,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=n;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this.loop&&""===t&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this._sound.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._muted?this._sound.volume=0:this._sound.volume=this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(t,e,i,n){t=t||"",e=e||0,i=i||1,"undefined"==typeof n&&(n=!1),this.play(t,e,i,n,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.now,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.loop&&(this._sound.loop=!0),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,t,this.duration):this._sound.start(0,t,this.duration)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.now-this.pausedTime,this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1;var e=this.currentMarker;""!==this.currentMarker&&this.onMarkerComplete.dispatch(this.currentMarker,this),this.currentMarker="",this.paused||this.onStop.dispatch(this,e)},fadeIn:function(t,e){"undefined"==typeof e&&(e=!1),this.paused||(this.play("",0,0,e),this.fadeTo(t,1))},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,i){if(this.isPlaying&&!this.paused&&i!==this.volume){if("undefined"==typeof t&&(t=1e3),"undefined"==typeof i)return void console.warn("Phaser.Sound.fadeTo: No Volume Specified.");var n=this.game.add.tween(this).to({volume:i},t,e.Easing.Linear.None,!0);n.onComplete.add(this.fadeComplete,this)}},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume),0===this.volume&&this.stop()},destroy:function(t){"undefined"==typeof t&&(t=!0),this.stop(),t?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}},e.Sound.prototype.constructor=e.Sound,Object.defineProperty(e.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}}),Object.defineProperty(e.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}}),Object.defineProperty(e.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){t=t||null,t?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume)),this.onMute.dispatch(this)}}),Object.defineProperty(e.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){this.usingWebAudio?(this._volume=t,this.gainNode.gain.value=t):this.usingAudioTag&&this._sound&&t>=0&&1>=t&&(this._volume=t,this._sound.volume=t)}}),e.SoundManager=function(game){this.game=game,this.onSoundDecode=new e.Signal,this._codeMuted=!1,this._muted=!1,this._unlockSource=null,this._volume=1,this._sounds=[],this.context=null,this.usingWebAudio=!0,this.usingAudioTag=!1,this.noAudio=!1,this.connectToMaster=!0,this.touchLocked=!1,this.channels=32},e.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.touchLocked=!0,this.game.device.android&&this.game.device.chrome?this.game.canvas.addEventListener("touchend",this.unlock.bind(this),{once:!0}):(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock)):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void(this.noAudio=!0);if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&("undefined"==typeof this.context.createGain?this.masterGain=this.context.createGainNode():this.masterGain=this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1){(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null);var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),void 0===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0),"suspended"===this._unlockSource.context.state&&this._unlockSource.context.resume()}},stopAll:function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].stop()},pauseAll:function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].pause()},resumeAll:function(){for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].resume()},decode:function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&this.game.cache.isSoundDecoded(t)===!1){this.game.cache.updateSound(t,"isDecoding",!0);var n=this;this.context.decodeAudioData(i,function(i){n.game.cache.decodedSound(t,i),e&&n.onSoundDecode.dispatch(t,e)})}},update:function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update()},add:function(t,i,n,s){"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=this.connectToMaster);var r=new e.Sound(this.game,t,i,n,s);return this._sounds.push(r),r},addSprite:function(t){var i=new e.AudioSprite(this.game,t);return i},remove:function(t){for(var e=this._sounds.length;e--;)if(this._sounds[e]===t)return this._sounds[e].destroy(!1),this._sounds.splice(e,1),!0;return!1},removeByKey:function(t){for(var e=this._sounds.length,i=0;e--;)this._sounds[e].key===t&&(this._sounds[e].destroy(!1),this._sounds.splice(e,1),i++);return i},play:function(t,e,i){var n=this.add(t,e,i);return n.play(),n},setMute:function(){if(!this._muted){this._muted=!0,this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1,this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].mute=!1)}},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++)this._sounds[t]&&this._sounds[t].destroy();this._sounds=[],this.onSoundDecode.dispose()}},e.SoundManager.prototype.constructor=e.SoundManager,Object.defineProperty(e.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){if(t=t||null){if(this._muted)return;this._codeMuted=!0,this.setMute()}else{if(!this._muted)return;this._codeMuted=!1,this.unsetMute()}}}),Object.defineProperty(e.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(t){if(this._volume=t,this.usingWebAudio)this.masterGain.gain.value=t;else for(var e=0;e<this._sounds.length;e++)this._sounds[e].usingAudioTag&&(this._sounds[e].volume=this._sounds[e].volume*t)}}),e.Utils.Debug=function(game){this.game=game,this.sprite=null,this.bmd=null,this.canvas=null,this.context=null,this.font="14px Courier",this.columnWidth=100,this.lineHeight=16,this.renderShadow=!0,this.currentX=0,this.currentY=0,this.currentAlpha=1,this.dirty=!1},e.Utils.Debug.prototype={boot:function(){this.game.renderType===e.CANVAS?this.context=this.game.context:(this.bmd=this.game.make.bitmapData(this.game.width,this.game.height),this.sprite=this.game.make.image(0,0,this.bmd),this.game.stage.addChild(this.sprite),this.canvas=e.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"))},preUpdate:function(){this.dirty&&this.sprite&&(this.bmd.clear(),this.bmd.draw(this.canvas,0,0),this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height),this.sprite&&this.bmd.clear()},start:function(t,e,i,n){"number"!=typeof t&&(t=0),"number"!=typeof e&&(e=0),i=i||"rgb(255,255,255)","undefined"==typeof n&&(n=0),this.currentX=t,this.currentY=e,this.currentColor=i,this.currentAlpha=this.context.globalAlpha,this.columnWidth=n,this.dirty=!0,this.context.save(),this.context.setTransform(1,0,0,1,0,0),this.context.strokeStyle=i,this.context.fillStyle=i,this.context.font=this.font,this.context.globalAlpha=1},stop:function(){this.context.restore(),this.context.globalAlpha=this.currentAlpha},line:function(){for(var t=this.currentX,e=0;e<arguments.length;e++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[e],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[e],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked),this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback),this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding),this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying),this.line("Time: "+t.currentTime),this.line("Volume: "+t.volume+" Muted: "+t.mute),this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag),""!==t.currentMarker&&(this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")"),this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop),this.line("Position: "+t.position)),this.stop()},cameraInfo:function(t,e,i,n){this.start(e,i,n),this.line("Camera ("+t.width+" x "+t.height+")"),this.line("X: "+t.x+" Y: "+t.y),t.bounds&&this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height),this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height),this.stop()},timer:function(t,e,i,n){this.start(e,i,n),this.line("Timer (running: "+t.running+" expired: "+t.expired+")"),this.line("Next Tick: "+t.next+" Duration: "+t.duration),this.line("Paused: "+t.paused+" Length: "+t.length),this.stop()},pointer:function(t,e,i,n,s){null!=t&&("undefined"==typeof e&&(e=!1),i=i||"rgba(0,255,0,0.5)",n=n||"rgba(255,0,0,0.5)",(e!==!0||t.isUp!==!0)&&(this.start(t.x,t.y-100,s),this.context.beginPath(),this.context.arc(t.x,t.y,t.circle.radius,0,2*Math.PI),t.active?this.context.fillStyle=i:this.context.fillStyle=n,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(t.positionDown.x,t.positionDown.y),this.context.lineTo(t.position.x,t.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+t.id+" Active: "+t.active),this.line("World X: "+t.worldX+" World Y: "+t.worldY),this.line("Screen X: "+t.x+" Screen Y: "+t.y),this.line("Duration: "+t.duration+" ms"),this.line("is Down: "+t.isDown+" is Up: "+t.isUp),this.stop()))},spriteInputInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite Input: ("+t.width+" x "+t.height+")"),this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1)),this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0)),this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0)),this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut()),this.stop()},key:function(t,e,i,n){this.start(e,i,n,150),this.line("Key:",t.keyCode,"isDown:",t.isDown),this.line("justPressed:",t.justPressed(),"justReleased:",t.justReleased()),this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0)),this.stop()},inputInfo:function(t,e,i){this.start(t,e,i),this.line("Input"),this.line("X: "+this.game.input.x+" Y: "+this.game.input.y),this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY),this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1)),this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY),this.stop()},spriteBounds:function(t,e,i){var n=t.getBounds();n.x+=this.game.camera.x,n.y+=this.game.camera.y,this.rectangle(n,e,i)},ropeSegments:function(t,e,i){var n=t.segments;n.forEach(function(t){this.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,n){this.start(e,i,n),this.line("Sprite:  ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y),this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1)),this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1)),this.line("visible: "+t.visible+" in camera: "+t.inCamera),this.stop()},spriteCoords:function(t,e,i,n){this.start(e,i,n,100),t.name&&this.line(t.name),this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2)),this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2)),this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2)),this.stop()},lineInfo:function(t,e,i,n){this.start(e,i,n,80),this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2)),this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2)),this.line("length:",t.length.toFixed(2),"angle:",t.angle),this.stop()},pixel:function(t,e,i,n){n=n||2,this.start(),this.context.fillStyle=i,this.context.fillRect(t,e,n,n),this.stop()},geom:function(t,i,n,s){"undefined"==typeof n&&(n=!0),"undefined"==typeof s&&(s=0),i=i||"rgba(0,255,0,0.4)",this.start(),this.context.fillStyle=i,this.context.strokeStyle=i,t instanceof e.Rectangle||1===s?n?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof e.Circle||2===s?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,2*Math.PI,!1),this.context.closePath(),n?this.context.fill():this.context.stroke()):t instanceof e.Point||3===s?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof e.Line||4===s)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke()),this.stop()},rectangle:function(t,e,i){"undefined"==typeof i&&(i=!0),e=e||"rgba(0, 255, 0, 0.4)",this.start(),i?(this.context.fillStyle=e,this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)):(this.context.strokeStyle=e,this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)),this.stop()},text:function(t,e,i,n,s){n=n||"rgb(255,255,255)",s=s||"16px Courier",this.start(),this.context.font=s,this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(t,e+1,i+1)),this.context.fillStyle=n,this.context.fillText(t,e,i),this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)",this.start();var i=t.bounds;if(0===t.nodes.length){this.context.strokeStyle=e,this.context.strokeRect(i.x,i.y,i.width,i.height),this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)";for(var n=0;n<t.objects.length;n++)this.context.strokeRect(t.objects[n].x,t.objects[n].y,t.objects[n].width,t.objects[n].height)}else for(var n=0;n<t.nodes.length;n++)this.quadTree(t.nodes[n]);this.stop()},body:function(t,i,n){t.body&&(this.start(),t.body.type===e.Physics.ARCADE?e.Physics.Arcade.Body.render(this.context,t.body,i,n):t.body.type===e.Physics.NINJA?e.Physics.Ninja.Body.render(this.context,t.body,i,n):t.body.type===e.Physics.BOX2D&&e.Physics.Box2D.renderBody(this.context,t.body,i),this.stop())},bodyInfo:function(t,i,n,s){t.body&&(this.start(i,n,s,210),t.body.type===e.Physics.ARCADE?e.Physics.Arcade.Body.renderBodyInfo(this,t.body):t.body.type===e.Physics.BOX2D&&this.game.physics.box2d.renderBodyInfo(this,t.body),this.stop())},box2dWorld:function(){this.start(),this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0),this.game.physics.box2d.renderDebugDraw(this.context),this.stop()},box2dBody:function(t,i){this.start(),e.Physics.Box2D.renderBody(this.context,t,i),this.stop()}},e.Utils.Debug.prototype.constructor=e.Utils.Debug,e.Color={packPixel:function(t,i,n,s){return e.Device.LITTLE_ENDIAN?(s<<24|n<<16|i<<8|t)>>>0:(t<<24|i<<16|n<<8|s)>>>0},unpackPixel:function(t,i,n,s){return("undefined"==typeof i||null===i)&&(i=e.Color.createColor()),("undefined"==typeof n||null===n)&&(n=!1),("undefined"==typeof s||null===s)&&(s=!1),e.Device.LITTLE_ENDIAN?(i.a=(4278190080&t)>>>24,i.b=(16711680&t)>>>16,i.g=(65280&t)>>>8,i.r=255&t):(i.r=(4278190080&t)>>>24,i.g=(16711680&t)>>>16,i.b=(65280&t)>>>8,i.a=255&t),i.color=t,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a/255+")",n&&e.Color.RGBtoHSL(i.r,i.g,i.b,i),s&&e.Color.RGBtoHSV(i.r,i.g,i.b,i),i},fromRGBA:function(t,i){return i||(i=e.Color.createColor()),i.r=(4278190080&t)>>>24,i.g=(16711680&t)>>>16,i.b=(65280&t)>>>8,i.a=255&t,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",i},toRGBA:function(t,e,i,n){return t<<24|e<<16|i<<8|n},RGBtoHSL:function(t,i,n,s){s||(s=e.Color.createColor(t,i,n,1)),t/=255,i/=255,n/=255;var r=Math.min(t,i,n),o=Math.max(t,i,n);if(s.h=0,s.s=0,s.l=(o+r)/2,o!==r){var a=o-r;s.s=s.l>.5?a/(2-o-r):a/(o+r),o===t?s.h=(i-n)/a+(n>i?6:0):o===i?s.h=(n-t)/a+2:o===n&&(s.h=(t-i)/a+4),s.h/=6}return s},HSLtoRGB:function(t,i,n,s){if(s?(s.r=n,s.g=n,s.b=n):s=e.Color.createColor(n,n,n),0!==i){var r=.5>n?n*(1+i):n+i-n*i,o=2*n-r;s.r=e.Color.hueToColor(o,r,t+1/3),s.g=e.Color.hueToColor(o,r,t),s.b=e.Color.hueToColor(o,r,t-1/3)}return s.r=Math.floor(255*s.r|0),s.g=Math.floor(255*s.g|0),s.b=Math.floor(255*s.b|0),e.Color.updateColor(s),s},RGBtoHSV:function(t,i,n,s){s||(s=e.Color.createColor(t,i,n,255)),t/=255,i/=255,n/=255;var r=Math.min(t,i,n),o=Math.max(t,i,n),a=o-r;return s.h=0,s.s=0===o?0:a/o,s.v=o,o!==r&&(o===t?s.h=(i-n)/a+(n>i?6:0):o===i?s.h=(n-t)/a+2:o===n&&(s.h=(t-i)/a+4),s.h/=6),s},HSVtoRGB:function(t,i,n,s){"undefined"==typeof s&&(s=e.Color.createColor(0,0,0,1,t,i,0,n));var r,o,a,h=Math.floor(6*t),l=6*t-h,c=n*(1-i),u=n*(1-l*i),d=n*(1-(1-l)*i);switch(h%6){case 0:r=n,o=d,a=c;break;case 1:r=u,o=n,a=c;break;case 2:r=c,o=n,a=d;break;case 3:r=c,o=u,a=n;break;case 4:r=d,o=c,a=n;break;case 5:r=n,o=c,a=u}return s.r=Math.floor(255*r),s.g=Math.floor(255*o),s.b=Math.floor(255*a),e.Color.updateColor(s),s},hueToColor:function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t},createColor:function(t,i,n,s,r,o,a,h){var l={r:t||0,g:i||0,b:n||0,a:s||1,h:r||0,s:o||0,l:a||0,v:h||0,color:0,color32:0,rgba:""};return l.color=e.Color.getColor(l.r,l.g,l.b),l.color32=e.Color.getColor32(l.a,l.r,l.g,l.b),e.Color.updateColor(l)},updateColor:function(t){return t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")",t},getColor32:function(t,e,i,n){return t<<24|e<<16|i<<8|n},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,i,n,s,r){return"undefined"==typeof s&&(s=255),"undefined"==typeof r&&(r="#"),"#"===r?"#"+((1<<24)+(t<<16)+(i<<8)+n).toString(16).slice(1):"0x"+e.Color.componentToHex(s)+e.Color.componentToHex(t)+e.Color.componentToHex(i)+e.Color.componentToHex(n)},hexToRGB:function(t){var i=e.Color.hexToColor(t);return i?e.Color.getColor32(i.a,i.r,i.g,i.b):void 0},hexToColor:function(t,i){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(n){var s=parseInt(n[1],16),r=parseInt(n[2],16),o=parseInt(n[3],16);i?(i.r=s,i.g=r,i.b=o):i=e.Color.createColor(s,r,o)}return i},webToColor:function(t,i){i||(i=e.Color.createColor());var n=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/.exec(t);return n&&(i.r=parseInt(n[1],10),i.g=parseInt(n[2],10),i.b=parseInt(n[3],10)),i},componentToHex:function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},HSVColorWheel:function(t,i){"undefined"==typeof t&&(t=1),"undefined"==typeof i&&(i=1);for(var n=[],s=0;359>=s;s++)n.push(e.Color.HSVtoRGB(s/359,t,i));return n},HSLColorWheel:function(t,i){"undefined"==typeof t&&(t=.5),"undefined"==typeof i&&(i=.5);for(var n=[],s=0;359>=s;s++)n.push(e.Color.HSLtoRGB(s/359,t,i));return n},interpolateColor:function(t,i,n,s,r){"undefined"==typeof r&&(r=255);var o=e.Color.getRGB(t),a=e.Color.getRGB(i),h=(a.red-o.red)*s/n+o.red,l=(a.green-o.green)*s/n+o.green,c=(a.blue-o.blue)*s/n+o.blue;return e.Color.getColor32(r,h,l,c)},interpolateColorWithRGB:function(t,i,n,s,r,o){var a=e.Color.getRGB(t),h=(i-a.red)*o/r+a.red,l=(n-a.green)*o/r+a.green,c=(s-a.blue)*o/r+a.blue;return e.Color.getColor(h,l,c)},interpolateRGB:function(t,i,n,s,r,o,a,h){var l=(s-t)*h/a+t,c=(r-i)*h/a+i,u=(o-n)*h/a+n;return e.Color.getColor(l,c,u)},getRandomColor:function(t,i,n){if("undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=255),"undefined"==typeof n&&(n=255),i>255||t>i)return e.Color.getColor(255,255,255);var s=t+Math.round(Math.random()*(i-t)),r=t+Math.round(Math.random()*(i-t)),o=t+Math.round(Math.random()*(i-t));return e.Color.getColor32(n,s,r,o)},getRGB:function(t){return t>16777215?{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:255&t,a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{alpha:255,red:t>>16&255,green:t>>8&255,blue:255&t,a:255,r:t>>16&255,g:t>>8&255,b:255&t}},getWebRGB:function(t){if("object"==typeof t)return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var i=e.Color.getRGB(t);return"rgba("+i.r.toString()+","+i.g.toString()+","+i.b.toString()+","+(i.a/255).toString()+")"},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return 255&t}},e.Physics=function(game,t){t=t||{},this.game=game,this.config=t,this.arcade=null,this.p2=null,this.ninja=null,this.box2d=null,this.chipmunk=null,this.parseConfig()},e.Physics.ARCADE=0,e.Physics.P2JS=1,e.Physics.NINJA=2,e.Physics.BOX2D=3,e.Physics.CHIPMUNK=4,e.Physics.prototype={parseConfig:function(){this.config.hasOwnProperty("arcade")&&this.config.arcade!==!0||!e.Physics.hasOwnProperty("Arcade")||(this.arcade=new e.Physics.Arcade(this.game),this.game.time.deltaCap=.2),this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&e.Physics.hasOwnProperty("Ninja")&&(this.ninja=new e.Physics.Ninja(this.game)),this.config.hasOwnProperty("p2")&&this.config.p2===!0&&e.Physics.hasOwnProperty("P2")&&(this.p2=new e.Physics.P2(this.game,this.config)),this.config.hasOwnProperty("box2d")&&this.config.box2d===!0&&e.Physics.hasOwnProperty("BOX2D")&&(this.box2d=new e.Physics.BOX2D(this.game,this.config))},startSystem:function(t){if(t===e.Physics.ARCADE?this.arcade=new e.Physics.Arcade(this.game):t===e.Physics.P2JS&&(this.p2=new e.Physics.P2(this.game,this.config)),t===e.Physics.NINJA)this.ninja=new e.Physics.Ninja(this.game);else if(t===e.Physics.BOX2D&&null===this.box2d)this.box2d=new e.Physics.Box2D(this.game,this.config);else if(t===e.Physics.CHIPMUNK&&null===this.chipmunk)throw new Error("The Chipmunk physics system has not been implemented yet.")},enable:function(t,i,n){"undefined"==typeof i&&(i=e.Physics.ARCADE),"undefined"==typeof n&&(n=!1),i===e.Physics.ARCADE?this.arcade.enable(t):i===e.Physics.P2JS&&this.p2?this.p2.enable(t,n):i===e.Physics.NINJA&&this.ninja?this.ninja.enableAABB(t):i===e.Physics.BOX2D&&this.box2d&&this.box2d.enable(t)},preUpdate:function(){this.p2&&this.p2.preUpdate(),this.box2d&&this.box2d.preUpdate()},update:function(){this.p2&&this.p2.update(),this.box2d&&this.box2d.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld(),this.ninja&&this.ninja.setBoundsToWorld(),this.p2&&this.p2.setBoundsToWorld(),this.box2d&&this.box2d.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear(),this.box2d&&this.box2d.clear()},destroy:function(){this.p2&&this.p2.destroy(),this.box2d&&this.box2d.destroy(),this.arcade=null,this.ninja=null,this.p2=null,this.box2d=null}},e.Physics.prototype.constructor=e.Physics,e.Physics.Arcade=function(game){this.game=game,this.gravity=new e.Point,this.bounds=new e.Rectangle(0,0,game.world.width,game.world.height),this.checkCollision={up:!0,down:!0,left:!0,right:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.TILE_BIAS=16,this.forceX=!1,this.skipQuadTree=!1,this.quadTree=new e.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0,this.setBoundsToWorld()},e.Physics.Arcade.prototype.constructor=e.Physics.Arcade,e.Physics.Arcade.prototype={setBounds:function(t,e,i,n){this.bounds.setTo(t,e,i,n)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height);
},enable:function(t,i){"undefined"==typeof i&&(i=!0);var n=1;if(Array.isArray(t))for(n=t.length;n--;)t[n]instanceof e.Group?this.enable(t[n].children,i):(this.enableBody(t[n]),i&&t[n].hasOwnProperty("children")&&t[n].children.length>0&&this.enable(t[n],!0));else t instanceof e.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new e.Physics.Arcade.Body(t))},updateMotion:function(t){this._velocityDelta=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity,t.angularVelocity+=this._velocityDelta,t.rotation+=t.angularVelocity*this.game.time.physicsElapsed,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,n,s,r){return r=r||1e4,1==t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed:2==t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed),n?i+=n*this.game.time.physicsElapsed:s&&(this._drag=s*this.game.time.physicsElapsed,i-this._drag>0?i-=this._drag:i+this._drag<0?i+=this._drag:i=0),i>r?i=r:-r>i&&(i=-r),i},overlap:function(t,e,i,n,s){if(i=i||null,n=n||null,s=s||i,this._result=!1,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var r=0,o=e.length;o>r;r++)this.collideHandler(t,e[r],i,n,s,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(var r=0,o=t.length;o>r;r++)this.collideHandler(t[r],e,i,n,s,!0);else if(Array.isArray(t)&&Array.isArray(e))for(var r=0,o=t.length;o>r;r++)for(var a=0,h=e.length;h>a;a++)this.collideHandler(t[r],e[a],i,n,s,!0);else this.collideHandler(t,e,i,n,s,!0);return this._total>0},collide:function(t,e,i,n,s){if(i=i||null,n=n||null,s=s||i,this._result=!1,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var r=0,o=e.length;o>r;r++)this.collideHandler(t,e[r],i,n,s,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(var r=0,o=t.length;o>r;r++)this.collideHandler(t[r],e,i,n,s,!1);else if(Array.isArray(t)&&Array.isArray(e))for(var r=0,a=t.length;a>r;r++)for(var h=0,l=e.length;l>h;h++)this.collideHandler(t[r],e[h],i,n,s,!1);else this.collideHandler(t,e,i,n,s,!1);return this._total>0},collideHandler:function(t,i,n,s,r,o){return"undefined"!=typeof i||t.type!==e.GROUP&&t.type!==e.EMITTER?void(t&&i&&t.exists&&i.exists&&(t.type==e.SPRITE||t.type==e.TILESPRITE?i.type==e.SPRITE||i.type==e.TILESPRITE?this.collideSpriteVsSprite(t,i,n,s,r,o):i.type==e.GROUP||i.type==e.EMITTER?this.collideSpriteVsGroup(t,i,n,s,r,o):i.type==e.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,i,n,s,r):t.type==e.GROUP?i.type==e.SPRITE||i.type==e.TILESPRITE?this.collideSpriteVsGroup(i,t,n,s,r,o):i.type==e.GROUP||i.type==e.EMITTER?this.collideGroupVsGroup(t,i,n,s,r,o):i.type==e.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,n,s,r):t.type==e.TILEMAPLAYER?i.type==e.SPRITE||i.type==e.TILESPRITE?this.collideSpriteVsTilemapLayer(i,t,n,s,r):(i.type==e.GROUP||i.type==e.EMITTER)&&this.collideGroupVsTilemapLayer(i,t,n,s,r):t.type==e.EMITTER&&(i.type==e.SPRITE||i.type==e.TILESPRITE?this.collideSpriteVsGroup(i,t,n,s,r,o):i.type==e.GROUP||i.type==e.EMITTER?this.collideGroupVsGroup(t,i,n,s,r,o):i.type==e.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,n,s,r)))):void this.collideGroupVsSelf(t,n,s,r,o)},collideSpriteVsSprite:function(t,e,i,n,s,r){return t.body&&e.body?(this.separate(t.body,e.body,n,s,r)&&(i&&i.call(s,t,e),this._total++),!0):!1},collideSpriteVsGroup:function(t,e,i,n,s,r){if(0!==e.length&&t.body)if(t.body.skipQuadTree||this.skipQuadTree)for(var o=0,a=e.children.length;a>o;o++)e.children[o]&&e.children[o].exists&&this.collideSpriteVsSprite(t,e.children[o],i,n,s,r);else{this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(e),this._potentials=this.quadTree.retrieve(t);for(var o=0,a=this._potentials.length;a>o;o++)this.separate(t.body,this._potentials[o],n,s,r)&&(i&&i.call(s,t,this._potentials[o].sprite),this._total++)}},collideGroupVsSelf:function(t,e,i,n,s){if(0!==t.length)for(var r=t.children.length,o=0;r>o;o++)for(var a=o+1;r>=a;a++)t.children[o]&&t.children[a]&&t.children[o].exists&&t.children[a].exists&&this.collideSpriteVsSprite(t.children[o],t.children[a],e,i,n,s)},collideGroupVsGroup:function(t,i,n,s,r,o){if(0!==t.length&&0!==i.length)for(var a=0,h=t.children.length;h>a;a++)t.children[a].exists&&(t.children[a].type===e.GROUP?this.collideGroupVsGroup(t.children[a],i,n,s,r,o):this.collideSpriteVsGroup(t.children[a],i,n,s,r,o))},collideSpriteVsTilemapLayer:function(t,e,i,n,s){if(t.body&&(this._mapData=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,!1,!1),0!==this._mapData.length))for(var r=0;r<this._mapData.length;r++)n?n.call(s,t,this._mapData[r])&&this.separateTile(r,t.body,this._mapData[r])&&(this._total++,i&&i.call(s,t,this._mapData[r])):this.separateTile(r,t.body,this._mapData[r])&&(this._total++,i&&i.call(s,t,this._mapData[r]))},collideGroupVsTilemapLayer:function(t,e,i,n,s){if(0!==t.length)for(var r=0,o=t.children.length;o>r;r++)t.children[r].exists&&this.collideSpriteVsTilemapLayer(t.children[r],e,i,n,s)},separate:function(t,e,i,n,s){return t.enable&&e.enable&&this.intersects(t,e)?i&&i.call(n,t.sprite,e.sprite)===!1?!1:(this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?this._result=this.separateX(t,e,s)||this.separateY(t,e,s):this._result=this.separateY(t,e,s)||this.separateX(t,e,s),s?!0:this._result):!1},intersects:function(t,e){return t.right<=e.position.x?!1:t.bottom<=e.position.y?!1:t.position.x>=e.right?!1:t.position.y>=e.bottom?!1:!0},separateX:function(t,e,i){return t.immovable&&e.immovable?!1:(this._overlap=0,this.intersects(t,e)&&(this._maxOverlap=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS,0===t.deltaX()&&0===e.deltaX()?(t.embedded=!0,e.embedded=!0):t.deltaX()>e.deltaX()?(this._overlap=t.right-e.x,this._overlap>this._maxOverlap||t.checkCollision.right===!1||e.checkCollision.left===!1?this._overlap=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0)):t.deltaX()<e.deltaX()&&(this._overlap=t.x-e.width-e.x,-this._overlap>this._maxOverlap||t.checkCollision.left===!1||e.checkCollision.right===!1?this._overlap=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=this._overlap,e.overlapX=this._overlap,0!==this._overlap)?i||t.customSeparateX||e.customSeparateX?!0:(this._velocity1=t.velocity.x,this._velocity2=e.velocity.x,t.immovable||e.immovable?t.immovable?e.immovable||(e.x+=this._overlap,e.velocity.x=this._velocity1-this._velocity2*e.bounce.x):(t.x=t.x-this._overlap,t.velocity.x=this._velocity2-this._velocity1*t.bounce.x):(this._overlap*=.5,t.x=t.x-this._overlap,e.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*e.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/e.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.x=this._average+this._newVelocity1*t.bounce.x,e.velocity.x=this._average+this._newVelocity2*e.bounce.x),!0):!1)},separateY:function(t,e,i){return t.immovable&&e.immovable?!1:(this._overlap=0,this.intersects(t,e)&&(this._maxOverlap=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS,0===t.deltaY()&&0===e.deltaY()?(t.embedded=!0,e.embedded=!0):t.deltaY()>e.deltaY()?(this._overlap=t.bottom-e.y,this._overlap>this._maxOverlap||t.checkCollision.down===!1||e.checkCollision.up===!1?this._overlap=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0)):t.deltaY()<e.deltaY()&&(this._overlap=t.y-e.bottom,-this._overlap>this._maxOverlap||t.checkCollision.up===!1||e.checkCollision.down===!1?this._overlap=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=this._overlap,e.overlapY=this._overlap,0!==this._overlap)?i||t.customSeparateY||e.customSeparateY?!0:(this._velocity1=t.velocity.y,this._velocity2=e.velocity.y,t.immovable||e.immovable?t.immovable?e.immovable||(e.y+=this._overlap,e.velocity.y=this._velocity1-this._velocity2*e.bounce.y,t.moves&&(e.x+=t.x-t.prev.x)):(t.y=t.y-this._overlap,t.velocity.y=this._velocity2-this._velocity1*t.bounce.y,e.moves&&(t.x+=e.x-e.prev.x)):(this._overlap*=.5,t.y=t.y-this._overlap,e.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*e.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/e.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.y=this._average+this._newVelocity1*t.bounce.y,e.velocity.y=this._average+this._newVelocity2*e.bounce.y),!0):!1)},separateTile:function(t,e,i){if(!e.enable||!i.intersects(e.position.x,e.position.y,e.right,e.bottom))return!1;if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i))return!1;if(i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i))return!1;if(!(i.faceLeft||i.faceRight||i.faceTop||i.faceBottom))return!1;var n=0,s=0,r=0,o=1;if(e.deltaAbsX()>e.deltaAbsY()?r=-1:e.deltaAbsX()<e.deltaAbsY()&&(o=-1),0!==e.deltaX()&&0!==e.deltaY()&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(r=Math.min(Math.abs(e.position.x-i.right),Math.abs(e.right-i.left)),o=Math.min(Math.abs(e.position.y-i.bottom),Math.abs(e.bottom-i.top))),o>r){if((i.faceLeft||i.faceRight)&&(n=this.tileCheckX(e,i),0!==n&&!i.intersects(e.position.x,e.position.y,e.right,e.bottom)))return!0;(i.faceTop||i.faceBottom)&&(s=this.tileCheckY(e,i))}else{if((i.faceTop||i.faceBottom)&&(s=this.tileCheckY(e,i),0!==s&&!i.intersects(e.position.x,e.position.y,e.right,e.bottom)))return!0;(i.faceLeft||i.faceRight)&&(n=this.tileCheckX(e,i))}return 0!==n||0!==s},tileCheckX:function(t,e){var i=0;return t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left?e.faceRight&&t.x<e.right&&(i=t.x-e.right,i<-this.TILE_BIAS&&(i=0)):t.deltaX()>0&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right&&e.faceLeft&&t.right>e.left&&(i=t.right-e.left,i>this.TILE_BIAS&&(i=0)),0!==i&&this.processTileSeparationX(t,i),i},tileCheckY:function(t,e){var i=0;return t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up?e.faceBottom&&t.y<e.bottom&&(i=t.y-e.bottom,i<-this.TILE_BIAS&&(i=0)):t.deltaY()>0&&!t.blocked.down&&e.collideUp&&t.checkCollision.down&&e.faceTop&&t.bottom>e.top&&(i=t.bottom-e.top,i>this.TILE_BIAS&&(i=0)),0!==i&&this.processTileSeparationY(t,i),i},processTileSeparationX:function(t,e){0>e?t.blocked.left=!0:e>0&&(t.blocked.right=!0),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x},processTileSeparationY:function(t,e){0>e?t.blocked.up=!0:e>0&&(t.blocked.down=!0),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y},getObjectsUnderPointer:function(t,i,n,s){if(0!==i.length&&t.exists){this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i);var r=new e.Rectangle(t.x,t.y,1,1),o=[];this._potentials=this.quadTree.retrieve(r);for(var a=0,h=this._potentials.length;h>a;a++)this._potentials[a].hitTest(t.x,t.y)&&(n&&n.call(s,t,this._potentials[a].sprite),o.push(this._potentials[a].sprite));return o}},moveToObject:function(t,e,i,n){return"undefined"==typeof i&&(i=60),"undefined"==typeof n&&(n=0),this._angle=Math.atan2(e.y-t.y,e.x-t.x),n>0&&(i=this.distanceBetween(t,e)/(n/1e3)),t.body.velocity.x=Math.cos(this._angle)*i,t.body.velocity.y=Math.sin(this._angle)*i,this._angle},moveToPointer:function(t,e,i,n){return"undefined"==typeof e&&(e=60),i=i||this.game.input.activePointer,"undefined"==typeof n&&(n=0),this._angle=this.angleToPointer(t,i),n>0&&(e=this.distanceToPointer(t,i)/(n/1e3)),t.body.velocity.x=Math.cos(this._angle)*e,t.body.velocity.y=Math.sin(this._angle)*e,this._angle},moveToXY:function(t,e,i,n,s){return"undefined"==typeof n&&(n=60),"undefined"==typeof s&&(s=0),this._angle=Math.atan2(i-t.y,e-t.x),s>0&&(n=this.distanceToXY(t,e,i)/(s/1e3)),t.body.velocity.x=Math.cos(this._angle)*n,t.body.velocity.y=Math.sin(this._angle)*n,this._angle},velocityFromAngle:function(t,i,n){return"undefined"==typeof i&&(i=60),n=n||new e.Point,n.setTo(Math.cos(this.game.math.degToRad(t))*i,Math.sin(this.game.math.degToRad(t))*i)},velocityFromRotation:function(t,i,n){return"undefined"==typeof i&&(i=60),n=n||new e.Point,n.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerationFromRotation:function(t,i,n){return"undefined"==typeof i&&(i=60),n=n||new e.Point,n.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerateToObject:function(t,e,i,n,s){return"undefined"==typeof i&&(i=60),"undefined"==typeof n&&(n=1e3),"undefined"==typeof s&&(s=1e3),this._angle=this.angleBetween(t,e),t.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),t.body.maxVelocity.setTo(n,s),this._angle},accelerateToPointer:function(t,e,i,n,s){return"undefined"==typeof i&&(i=60),"undefined"==typeof e&&(e=this.game.input.activePointer),"undefined"==typeof n&&(n=1e3),"undefined"==typeof s&&(s=1e3),this._angle=this.angleToPointer(t,e),t.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),t.body.maxVelocity.setTo(n,s),this._angle},accelerateToXY:function(t,e,i,n,s,r){return"undefined"==typeof n&&(n=60),"undefined"==typeof s&&(s=1e3),"undefined"==typeof r&&(r=1e3),this._angle=this.angleToXY(t,e,i),t.body.acceleration.setTo(Math.cos(this._angle)*n,Math.sin(this._angle)*n),t.body.maxVelocity.setTo(s,r),this._angle},distanceBetween:function(t,e){return this._dx=t.x-e.x,this._dy=t.y-e.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(t,e,i){return this._dx=t.x-e,this._dy=t.y-i,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(t,e){return e=e||this.game.input.activePointer,this._dx=t.x-e.x,this._dy=t.y-e.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(t,e){return this._dx=e.x-t.x,this._dy=e.y-t.y,Math.atan2(this._dy,this._dx)},angleToXY:function(t,e,i){return this._dx=e-t.x,this._dy=i-t.y,Math.atan2(this._dy,this._dx)},angleToPointer:function(t,e){return e=e||this.game.input.activePointer,this._dx=e.worldX-t.x,this._dy=e.worldY-t.y,Math.atan2(this._dy,this._dx)}},e.Physics.Arcade.Body=function(t){this.sprite=t,this.game=t.game,this.type=e.Physics.ARCADE,this.enable=!0,this.offset=new e.Point,this.position=new e.Point(t.x,t.y),this.prev=new e.Point(this.position.x,this.position.y),this.allowRotation=!0,this.rotation=t.rotation,this.preRotation=t.rotation,this.sourceWidth=t.texture.frame.width,this.sourceHeight=t.texture.frame.height,this.width=t.width,this.height=t.height,this.halfWidth=Math.abs(t.width/2),this.halfHeight=Math.abs(t.height/2),this.center=new e.Point(t.x+this.halfWidth,t.y+this.halfHeight),this.velocity=new e.Point,this.newVelocity=new e.Point(0,0),this.deltaMax=new e.Point(0,0),this.acceleration=new e.Point,this.drag=new e.Point,this.allowGravity=!0,this.gravity=new e.Point(0,0),this.bounce=new e.Point,this.maxVelocity=new e.Point(1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=e.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={up:!1,down:!1,left:!1,right:!1},this.tilePadding=new e.Point,this.phase=0,this.skipQuadTree=!1,this._reset=!0,this._sx=t.scale.x,this._sy=t.scale.y,this._dx=0,this._dy=0},e.Physics.Arcade.Body.prototype={updateBounds:function(){var t=Math.abs(this.sprite.scale.x),e=Math.abs(this.sprite.scale.y);(t!==this._sx||e!==this._sy)&&(this.width=this.sourceWidth*t,this.height=this.sourceHeight*e,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=t,this._sy=e,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||1===this.sprite._cache[4])&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&2!==this.phase&&(this.phase=2,this.deltaX()<0?this.facing=e.LEFT:this.deltaX()>0&&(this.facing=e.RIGHT),this.deltaY()<0?this.facing=e.UP:this.deltaY()>0&&(this.facing=e.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.x+=this._dx,this.sprite.y+=this._dy),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite.body=null,this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0),this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(t,e,i,n){"undefined"==typeof i&&(i=this.offset.x),"undefined"==typeof n&&(n=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.setTo(i,n),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=e-this.sprite.anchor.y*this.height+this.offset.y,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(t,i){return e.Rectangle.contains(this,t,i)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}},Object.defineProperty(e.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}}),Object.defineProperty(e.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}}),e.Physics.Arcade.Body.render=function(t,e,i,n){"undefined"==typeof n&&(n=!0),i=i||"rgba(0,255,0,0.4)",n?(t.fillStyle=i,t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)):(t.strokeStyle=i,t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height))},e.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height),t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2)),t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2)),t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2)),t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down),t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)},e.Physics.Arcade.Body.prototype.constructor=e.Physics.Arcade.Body,e.Particles=function(game){this.game=game,this.emitters={},this.ID=0},e.Particles.prototype={add:function(t){return this.emitters[t.name]=t,t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters)this.emitters[t].exists&&this.emitters[t].update()}},e.Particles.prototype.constructor=e.Particles,e.Particles.Arcade={},e.Particles.Arcade.Emitter=function(game,t,i,n){this.maxParticles=n||50,e.Group.call(this,game),this.name="emitter"+this.game.particles.ID++,this.type=e.EMITTER,this.area=new e.Rectangle(t,i,1,1),this.minParticleSpeed=new e.Point(-100,-100),this.maxParticleSpeed=new e.Point(100,100),this.minParticleScale=1,this.maxParticleScale=1,this.scaleData=null,this.minRotation=-360,this.maxRotation=360,this.minParticleAlpha=1,this.maxParticleAlpha=1,this.alphaData=null,this.gravity=100,this.particleClass=e.Particle,this.particleDrag=new e.Point,this.angularDrag=0,this.frequency=100,this.lifespan=2e3,this.bounce=new e.Point,this.on=!1,this.particleAnchor=new e.Point(.5,.5),this.blendMode=e.blendModes.NORMAL,this.emitX=t,this.emitY=i,this.autoScale=!1,this.autoAlpha=!1,this.particleBringToTop=!1,this.particleSendToBack=!1,this._minParticleScale=new e.Point(1,1),this._maxParticleScale=new e.Point(1,1),this._quantity=0,this._timer=0,this._counter=0,this._explode=!0,this._frames=null},e.Particles.Arcade.Emitter.prototype=Object.create(e.Group.prototype),e.Particles.Arcade.Emitter.prototype.constructor=e.Particles.Arcade.Emitter,e.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency);for(var t=this.children.length;t--;)this.children[t].exists&&this.children[t].update()},e.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,n,s){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=this.maxParticles),"undefined"==typeof n&&(n=!1),"undefined"==typeof s&&(s=!1);var r,o=0,a=t,h=e;for(this._frames=e;i>o;)Array.isArray(t)&&(a=this.game.rnd.pick(t)),Array.isArray(e)&&(h=this.game.rnd.pick(e)),r=new this.particleClass(this.game,0,0,a,h),this.game.physics.arcade.enable(r,!1),n?(r.body.checkCollision.any=!0,r.body.checkCollision.none=!1):r.body.checkCollision.none=!0,r.body.collideWorldBounds=s,r.exists=!1,r.visible=!1,r.anchor.copyFrom(this.particleAnchor),this.add(r),o++;return this},e.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1,this.alive=!1,this.exists=!1},e.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0,this.exists=!0},e.Particles.Arcade.Emitter.prototype.explode=function(t,e){this.start(!0,t,0,e,!1)},e.Particles.Arcade.Emitter.prototype.flow=function(t,e,i){this.start(!1,t,e,i,!0)},e.Particles.Arcade.Emitter.prototype.start=function(t,e,i,n,s){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=0),("undefined"==typeof i||null===i)&&(i=250),"undefined"==typeof n&&(n=0),"undefined"==typeof s&&(s=!1),this.revive(),this.visible=!0,this.on=!0,this._explode=t,this.lifespan=e,this.frequency=i,t||s?this._quantity=n:this._quantity+=n,this._counter=0,this._timer=this.game.time.now+i},e.Particles.Arcade.Emitter.prototype.emitParticle=function(){var t=this.getFirstExists(!1);null!==t&&(this.width>1||this.height>1?t.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):t.reset(this.emitX,this.emitY),t.angle=0,t.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(t):this.particleSendToBack&&this.sendToBack(t),this.autoScale?t.setScaleData(this.scaleData):1!==this.minParticleScale||1!==this.maxParticleScale?t.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&t.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),Array.isArray("object"===this._frames)?t.frame=this.game.rnd.pick(this._frames):t.frame=this._frames,this.autoAlpha?t.setAlphaData(this.alphaData):t.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),t.blendMode=this.blendMode,t.body.updateBounds(),t.body.bounce.setTo(this.bounce.x,this.bounce.y),t.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),t.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),t.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation),t.body.gravity.y=this.gravity,t.body.drag.x=this.particleDrag.x,t.body.drag.y=this.particleDrag.y,t.body.angularDrag=this.angularDrag,t.onEmit())},e.Particles.Arcade.Emitter.prototype.setSize=function(t,e){this.area.width=t,this.area.height=e},e.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){t=t||0,e=e||0,this.minParticleSpeed.x=t,this.maxParticleSpeed.x=e},e.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){t=t||0,e=e||0,this.minParticleSpeed.y=t,this.maxParticleSpeed.y=e},e.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){t=t||0,e=e||0,this.minRotation=t,this.maxRotation=e},e.Particles.Arcade.Emitter.prototype.setAlpha=function(t,i,n,s,r){if("undefined"==typeof t&&(t=1),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=0),"undefined"==typeof s&&(s=e.Easing.Linear.None),"undefined"==typeof r&&(r=!1),this.minParticleAlpha=t,this.maxParticleAlpha=i,this.autoAlpha=!1,n>0&&t!==i){var o={v:t},a=this.game.make.tween(o).to({v:i},n,s);a.yoyo(r),this.alphaData=a.generateData(60),this.alphaData.reverse(),this.autoAlpha=!0}},e.Particles.Arcade.Emitter.prototype.setScale=function(t,i,n,s,r,o,a){if("undefined"==typeof t&&(t=1),"undefined"==typeof i&&(i=1),"undefined"==typeof n&&(n=1),"undefined"==typeof s&&(s=1),"undefined"==typeof r&&(r=0),"undefined"==typeof o&&(o=e.Easing.Linear.None),"undefined"==typeof a&&(a=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,n),this._maxParticleScale.set(i,s),this.autoScale=!1,r>0&&t!==i||n!==s){var h={x:t,y:n},l=this.game.make.tween(h).to({x:i,y:s},r,o);l.yoyo(a),this.scaleData=l.generateData(60),this.scaleData.reverse(),this.autoScale=!0}},e.Particles.Arcade.Emitter.prototype.at=function(t){t.center?(this.emitX=t.center.x,this.emitY=t.center.y):(this.emitX=t.world.x+t.anchor.x*t.width,this.emitY=t.world.y+t.anchor.y*t.height)},Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}}),Object.defineProperty(e.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}}),e.Tile=function(t,e,i,n,s,r){this.layer=t,this.index=e,this.x=i,this.y=n,this.worldX=i*s,this.worldY=n*r,this.width=s,this.height=r,this.centerX=Math.abs(s/2),this.centerY=Math.abs(r/2),this.alpha=1,this.properties={},this.scanned=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.collisionCallback=null,this.collisionCallbackContext=this},e.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,n){return i<=this.worldX?!1:n<=this.worldY?!1:t>=this.worldX+this.width?!1:e>=this.worldY+this.height?!1:!0},setCollisionCallback:function(t,e){this.collisionCallback=t,this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null,this.collisionCallbackContext=null,this.properties=null},setCollision:function(t,e,i,n){this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=n,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=n},resetCollision:function(){this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1},isInteresting:function(t,e){return t&&e?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:e?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1;
},copy:function(t){this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext}},e.Tile.prototype.constructor=e.Tile,Object.defineProperty(e.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}}),Object.defineProperty(e.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}}),Object.defineProperty(e.Tile.prototype,"left",{get:function(){return this.worldX}}),Object.defineProperty(e.Tile.prototype,"right",{get:function(){return this.worldX+this.width}}),Object.defineProperty(e.Tile.prototype,"top",{get:function(){return this.worldY}}),Object.defineProperty(e.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}}),e.Tilemap=function(game,t,i,n,s,r){this.game=game,this.key=t;var o=e.TilemapParser.parse(this.game,t,i,n,s,r);null!==o&&(this.width=o.width,this.height=o.height,this.tileWidth=o.tileWidth,this.tileHeight=o.tileHeight,this.orientation=o.orientation,this.format=o.format,this.version=o.version,this.properties=o.properties,this.widthInPixels=o.widthInPixels,this.heightInPixels=o.heightInPixels,this.layers=o.layers,this.tilesets=o.tilesets,this.tiles=o.tiles,this.objects=o.objects,this.collideIndexes=[],this.collision=o.collision,this.images=o.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)},e.Tilemap.CSV=0,e.Tilemap.TILED_JSON=1,e.Tilemap.NORTH=0,e.Tilemap.EAST=1,e.Tilemap.SOUTH=2,e.Tilemap.WEST=3,e.Tilemap.prototype={create:function(t,e,i,n,s,r){return"undefined"==typeof r&&(r=this.game.world),this.width=e,this.height=i,this.setTileSize(n,s),this.layers.length=0,this.createBlankLayer(t,e,i,n,s,r)},setTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e},addTilesetImage:function(t,i,n,s,r,o,a){if("undefined"==typeof n&&(n=this.tileWidth),"undefined"==typeof s&&(s=this.tileHeight),"undefined"==typeof r&&(r=0),"undefined"==typeof o&&(o=0),"undefined"==typeof a&&(a=0),0===n&&(n=32),0===s&&(s=32),"undefined"==typeof i){if("string"!=typeof t)return null;if(i=t,!this.game.cache.checkImageKey(i))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+i+'"'),null}if("string"==typeof t&&(t=this.getTilesetIndex(t),null===t&&this.format===e.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+i+'"'),null;if(this.tilesets[t])return this.tilesets[t].setImage(this.game.cache.getImage(i)),this.tilesets[t];var h=new e.Tileset(i,a,n,s,r,o,{});h.setImage(this.game.cache.getImage(i)),this.tilesets.push(h);for(var l=this.tilesets.length-1,c=r,u=r,d=0,A=0,p=0,m=a;m<a+h.total&&(this.tiles[m]=[c,u,l],c+=n+o,d++,d!==h.total)&&(A++,A!==h.columns||(c=r,u+=s+o,A=0,p++,p!==h.rows));m++);return h},createFromObjects:function(t,i,n,s,r,o,a,h,l){if("undefined"==typeof r&&(r=!0),"undefined"==typeof o&&(o=!1),"undefined"==typeof a&&(a=this.game.world),"undefined"==typeof h&&(h=e.Sprite),"undefined"==typeof l&&(l=!0),!this.objects[t])return void console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);for(var c,u=0,d=this.objects[t].length;d>u;u++)if(this.objects[t][u].gid===i){c=new h(this.game,this.objects[t][u].x,this.objects[t][u].y,n,s),c.name=this.objects[t][u].name,c.visible=this.objects[t][u].visible,c.autoCull=o,c.exists=r,l&&(c.y-=c.height),a.add(c);for(var A in this.objects[t][u].properties)a.set(c,A,this.objects[t][u].properties[A],!1,!1,0,!0)}},createLayer:function(t,i,n,s){"undefined"==typeof i&&(i=this.game.width),"undefined"==typeof n&&(n=this.game.height),"undefined"==typeof s&&(s=this.game.world);var r=t;return"string"==typeof t&&(r=this.getLayerIndex(t)),null===r||r>this.layers.length?void console.warn("Tilemap.createLayer: Invalid layer ID given: "+r):s.add(new e.TilemapLayer(this.game,this,r,i,n))},createBlankLayer:function(t,i,n,s,r,o){if("undefined"==typeof o&&(o=this.game.world),null!==this.getLayerIndex(t))return void console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");for(var a,h={name:t,x:0,y:0,width:i,height:n,widthInPixels:i*s,heightInPixels:n*r,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},l=[],c=0;n>c;c++){a=[];for(var u=0;i>u;u++)a.push(new e.Tile(h,-1,u,c,s,r));l.push(a)}h.data=l,this.layers.push(h),this.currentLayer=this.layers.length-1;var d=h.widthInPixels,A=h.heightInPixels;d>this.game.width&&(d=this.game.width),A>this.game.height&&(A=this.game.height);var l=new e.TilemapLayer(this.game,this,this.layers.length-1,d,A);return l.name=t,o.add(l)},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},getObjectIndex:function(t){return this.getIndex(this.objects,t)},setTileIndexCallback:function(t,e,i,n){if(n=this.getLayer(n),"number"==typeof t)this.layers[n].callbacks[t]={callback:e,callbackContext:i};else for(var s=0,r=t.length;r>s;s++)this.layers[n].callbacks[t[s]]={callback:e,callbackContext:i}},setTileLocationCallback:function(t,e,i,n,s,r,o){if(o=this.getLayer(o),this.copy(t,e,i,n,o),!(this._results.length<2))for(var a=1;a<this._results.length;a++)this._results[a].setCollisionCallback(s,r)},setCollision:function(t,e,i,n){if("undefined"==typeof e&&(e=!0),"undefined"==typeof n&&(n=!0),i=this.getLayer(i),"number"==typeof t)return this.setCollisionByIndex(t,e,i,!0);for(var s=0,r=t.length;r>s;s++)this.setCollisionByIndex(t[s],e,i,!1);n&&this.calculateFaces(i)},setCollisionBetween:function(t,e,i,n,s){if("undefined"==typeof i&&(i=!0),"undefined"==typeof s&&(s=!0),n=this.getLayer(n),!(t>e)){for(var r=t;e>=r;r++)this.setCollisionByIndex(r,i,n,!1);s&&this.calculateFaces(n)}},setCollisionByExclusion:function(t,e,i,n){"undefined"==typeof e&&(e=!0),"undefined"==typeof n&&(n=!0),i=this.getLayer(i);for(var s=0,r=this.tiles.length;r>s;s++)-1===t.indexOf(s)&&this.setCollisionByIndex(s,e,i,!1);n&&this.calculateFaces(i)},setCollisionByIndex:function(t,e,i,n){if("undefined"==typeof e&&(e=!0),"undefined"==typeof i&&(i=this.currentLayer),"undefined"==typeof n&&(n=!0),e)this.collideIndexes.push(t);else{var s=this.collideIndexes.indexOf(t);s>-1&&this.collideIndexes.splice(s,1)}for(var r=0;r<this.layers[i].height;r++)for(var o=0;o<this.layers[i].width;o++){var a=this.layers[i].data[r][o];a&&a.index===t&&(e?a.setCollision(!0,!0,!0,!0):a.resetCollision(),a.faceTop=e,a.faceBottom=e,a.faceLeft=e,a.faceRight=e)}return n&&this.calculateFaces(i),i},getLayer:function(t){return"undefined"==typeof t?t=this.currentLayer:"string"==typeof t?t=this.getLayerIndex(t):t instanceof e.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(t){if(t===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),t===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var e in this.needToRecalculate)this.calculateFaces(e);this.needToRecalculate=!1}},calculateFaces:function(t){if(this.preventingRecalculate)return void(this.needToRecalculate[t]=!0);for(var e=null,i=null,n=null,s=null,r=0,o=this.layers[t].height;o>r;r++)for(var a=0,h=this.layers[t].width;h>a;a++){var l=this.layers[t].data[r][a];l&&(e=this.getTileAbove(t,a,r),i=this.getTileBelow(t,a,r),n=this.getTileLeft(t,a,r),s=this.getTileRight(t,a,r),l.collides&&(l.faceTop=!0,l.faceBottom=!0,l.faceLeft=!0,l.faceRight=!0),e&&e.collides&&(l.faceTop=!1),i&&i.collides&&(l.faceBottom=!1),n&&n.collides&&(l.faceLeft=!1),s&&s.collides&&(l.faceRight=!1))}},getTileAbove:function(t,e,i){return i>0?this.layers[t].data[i-1][e]:null},getTileBelow:function(t,e,i){return i<this.layers[t].height-1?this.layers[t].data[i+1][e]:null},getTileLeft:function(t,e,i){return e>0?this.layers[t].data[i][e-1]:null},getTileRight:function(t,e,i){return e<this.layers[t].width-1?this.layers[t].data[i][e+1]:null},setLayer:function(t){t=this.getLayer(t),this.layers[t]&&(this.currentLayer=t)},hasTile:function(t,e,i){return i=this.getLayer(i),this.layers[i].data[e][t].index>-1},removeTile:function(t,i,n){if(n=this.getLayer(n),t>=0&&t<this.layers[n].width&&i>=0&&i<this.layers[n].height&&this.hasTile(t,i,n)){var s=this.layers[n].data[i][t];return this.layers[n].data[i][t]=new e.Tile(this.layers[n],-1,t,i,this.tileWidth,this.tileHeight),this.layers[n].dirty=!0,this.calculateFaces(n),s}},removeTileWorldXY:function(t,e,i,n,s){return s=this.getLayer(s),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.removeTile(t,e,s)},putTile:function(t,i,n,s){if(null===t)return this.removeTile(i,n,s);if(s=this.getLayer(s),i>=0&&i<this.layers[s].width&&n>=0&&n<this.layers[s].height){var r;return t instanceof e.Tile?(r=t.index,this.hasTile(i,n,s)?this.layers[s].data[n][i].copy(t):this.layers[s].data[n][i]=new e.Tile(s,r,i,n,t.width,t.height)):(r=t,this.hasTile(i,n,s)?this.layers[s].data[n][i].index=r:this.layers[s].data[n][i]=new e.Tile(this.layers[s],r,i,n,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(r)>-1?this.layers[s].data[n][i].setCollision(!0,!0,!0,!0):this.layers[s].data[n][i].resetCollision(),this.layers[s].dirty=!0,this.calculateFaces(s),this.layers[s].data[n][i]}return null},putTileWorldXY:function(t,e,i,n,s,r){return r=this.getLayer(r),e=this.game.math.snapToFloor(e,n)/n,i=this.game.math.snapToFloor(i,s)/s,this.putTile(t,e,i,r)},searchTileIndex:function(t,e,i,n){"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=!1),n=this.getLayer(n);var s=0;if(i){for(var r=this.layers[n].height-1;r>=0;r--)for(var o=this.layers[n].width-1;o>=0;o--)if(this.layers[n].data[r][o].index===t){if(s===e)return this.layers[n].data[r][o];s++}}else for(var r=0;r<this.layers[n].height;r++)for(var o=0;o<this.layers[n].width;o++)if(this.layers[n].data[r][o].index===t){if(s===e)return this.layers[n].data[r][o];s++}return null},getTile:function(t,e,i,n){return"undefined"==typeof n&&(n=!1),i=this.getLayer(i),t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height?-1===this.layers[i].data[e][t].index?n?this.layers[i].data[e][t]:null:this.layers[i].data[e][t]:null},getTileWorldXY:function(t,e,i,n,s){return"undefined"==typeof i&&(i=this.tileWidth),"undefined"==typeof n&&(n=this.tileHeight),s=this.getLayer(s),t=this.game.math.snapToFloor(t,i)/i,e=this.game.math.snapToFloor(e,n)/n,this.getTile(t,e,s)},copy:function(t,e,i,n,s){if(s=this.getLayer(s),!this.layers[s])return void(this._results.length=0);"undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),"undefined"==typeof i&&(i=this.layers[s].width),"undefined"==typeof n&&(n=this.layers[s].height),0>t&&(t=0),0>e&&(e=0),i>this.layers[s].width&&(i=this.layers[s].width),n>this.layers[s].height&&(n=this.layers[s].height),this._results.length=0,this._results.push({x:t,y:e,width:i,height:n,layer:s});for(var r=e;e+n>r;r++)for(var o=t;t+i>o;o++)this._results.push(this.layers[s].data[r][o]);return this._results},paste:function(t,e,i,n){if("undefined"==typeof t&&(t=0),"undefined"==typeof e&&(e=0),n=this.getLayer(n),i&&!(i.length<2)){for(var s=i[1].x-t,r=i[1].y-e,o=1;o<i.length;o++)this.layers[n].data[r+i[o].y][s+i[o].x].copy(i[o]);this.layers[n].dirty=!0,this.calculateFaces(n)}},swap:function(t,e,i,n,s,r,o){o=this.getLayer(o),this.copy(i,n,s,r,o),this._results.length<2||(this._tempA=t,this._tempB=e,this._results.forEach(this.swapHandler,this),this.paste(i,n,this._results,o))},swapHandler:function(t){t.index===this._tempA?t.index=this._tempB:t.index===this._tempB&&(t.index=this._tempA)},forEach:function(t,e,i,n,s,r,o){o=this.getLayer(o),this.copy(i,n,s,r,o),this._results.length<2||(this._results.forEach(t,e),this.paste(i,n,this._results,o))},replace:function(t,e,i,n,s,r,o){if(o=this.getLayer(o),this.copy(i,n,s,r,o),!(this._results.length<2)){for(var a=1;a<this._results.length;a++)this._results[a].index===t&&(this._results[a].index=e);this.paste(i,n,this._results,o)}},random:function(t,e,i,n,s){if(s=this.getLayer(s),this.copy(t,e,i,n,s),!(this._results.length<2)){for(var r=[],o=1;o<this._results.length;o++)if(this._results[o].index){var a=this._results[o].index;-1===r.indexOf(a)&&r.push(a)}for(var h=1;h<this._results.length;h++)this._results[h].index=this.game.rnd.pick(r);this.paste(t,e,this._results,s)}},shuffle:function(t,i,n,s,r){if(r=this.getLayer(r),this.copy(t,i,n,s,r),!(this._results.length<2)){for(var o=[],a=1;a<this._results.length;a++)this._results[a].index&&o.push(this._results[a].index);e.Utils.shuffle(o);for(var h=1;h<this._results.length;h++)this._results[h].index=o[h-1];this.paste(t,i,this._results,r)}},fill:function(t,e,i,n,s,r){if(r=this.getLayer(r),this.copy(e,i,n,s,r),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index=t;this.paste(e,i,this._results,r)}},removeAllLayers:function(){this.layers.length=0,this.currentLayer=0},dump:function(){for(var t="",e=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(var n=0;n<this.layers[this.currentLayer].width;n++)t+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):e.push("background: #ffffff"):e.push("background: rgb(0, 0, 0)");t+="\n"}e[0]=t,console.log.apply(console,e)},destroy:function(){this.removeAllLayers(),this.data=[],this.game=null}},e.Tilemap.prototype.constructor=e.Tilemap,Object.defineProperty(e.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){t!==this.currentLayer&&this.setLayer(t)}}),e.TilemapLayer=function(game,t,i,n,s){this.game=game,this.map=t,this.index=i,this.layer=t.layers[i],this.canvas=e.Canvas.create(n,s,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new e.Frame(0,0,0,n,s,"tilemapLayer",game.rnd.uuid()),e.Image.call(this,this.game,0,0,this.texture,this.textureFrame),this.name="",this.type=e.TILEMAPLAYER,this.fixedToCamera=!0,this.cameraOffset=new e.Point(0,0),this.tileColor="rgb(255, 255, 255)",this.debug=!1,this.debugAlpha=.5,this.debugColor="rgba(0, 255, 0, 1)",this.debugFill=!1,this.debugFillColor="rgba(0, 255, 0, 0.2)",this.debugCallbackColor="rgba(255, 0, 0, 1)",this.scrollFactorX=1,this.scrollFactorY=1,this.dirty=!0,this.rayStepRate=4,this.wrap=!1,this._mc={cw:t.tileWidth,ch:t.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0},this._results=[],this.updateMax()},e.TilemapLayer.prototype=Object.create(e.Image.prototype),e.TilemapLayer.prototype.constructor=e.TilemapLayer,e.TilemapLayer.prototype.postUpdate=function(){e.Image.prototype.postUpdate.call(this),this.scrollX=this.game.camera.x*this.scrollFactorX,this.scrollY=this.game.camera.y*this.scrollFactorY,this.render(),1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)},e.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)},e.TilemapLayer.prototype._fixX=function(t){return 0>t&&(t=0),1===this.scrollFactorX?t:this._mc.x+(t-this._mc.x/this.scrollFactorX)},e.TilemapLayer.prototype._unfixX=function(t){return 1===this.scrollFactorX?t:this._mc.x/this.scrollFactorX+(t-this._mc.x)},e.TilemapLayer.prototype._fixY=function(t){return 0>t&&(t=0),1===this.scrollFactorY?t:this._mc.y+(t-this._mc.y/this.scrollFactorY)},e.TilemapLayer.prototype._unfixY=function(t){return 1===this.scrollFactorY?t:this._mc.y/this.scrollFactorY+(t-this._mc.y)},e.TilemapLayer.prototype.getTileX=function(t){return this.game.math.snapToFloor(this._fixX(t),this.map.tileWidth)/this.map.tileWidth},e.TilemapLayer.prototype.getTileY=function(t){return this.game.math.snapToFloor(this._fixY(t),this.map.tileHeight)/this.map.tileHeight},e.TilemapLayer.prototype.getTileXY=function(t,e,i){return i.x=this.getTileX(t),i.y=this.getTileY(e),i},e.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,n){("undefined"==typeof e||null===e)&&(e=this.rayStepRate),"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1);var s=this.getTiles(t.x,t.y,t.width,t.height,i,n);if(0===s.length)return[];for(var r=t.coordinatesOnLine(e),o=r.length,a=[],h=0;h<s.length;h++)for(var l=0;o>l;l++)if(s[h].containsPoint(r[l][0],r[l][1])){a.push(s[h]);break}return a},e.TilemapLayer.prototype.getTiles=function(t,e,i,n,s,r){"undefined"==typeof s&&(s=!1),"undefined"==typeof r&&(r=!1),t=this._fixX(t),e=this._fixY(e),i>this.layer.widthInPixels&&(i=this.layer.widthInPixels),n>this.layer.heightInPixels&&(n=this.layer.heightInPixels),this._mc.tx=this.game.math.snapToFloor(t,this._mc.cw)/this._mc.cw,this._mc.ty=this.game.math.snapToFloor(e,this._mc.ch)/this._mc.ch,this._mc.tw=(this.game.math.snapToCeil(i,this._mc.cw)+this._mc.cw)/this._mc.cw,this._mc.th=(this.game.math.snapToCeil(n,this._mc.ch)+this._mc.ch)/this._mc.ch,this._results.length=0;for(var o=this._mc.ty;o<this._mc.ty+this._mc.th;o++)for(var a=this._mc.tx;a<this._mc.tx+this._mc.tw;a++)this.layer.data[o]&&this.layer.data[o][a]&&(!s&&!r||this.layer.data[o][a].isInteresting(s,r))&&this._results.push(this.layer.data[o][a]);return this._results},e.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1,this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1,this.dirty=!0},e.TilemapLayer.prototype.render=function(){if(this.layer.dirty&&(this.dirty=!0),this.dirty&&this.visible){this._mc.prevX=this._mc.dx,this._mc.prevY=this._mc.dy,this._mc.dx=-(this._mc.x-this._mc.startX*this.map.tileWidth),this._mc.dy=-(this._mc.y-this._mc.startY*this.map.tileHeight),this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.tileColor;var t,e;this.debug&&(this.context.globalAlpha=this.debugAlpha);for(var i=this._mc.startY,n=this._mc.startY+this._mc.maxY;n>i;i++){if(this._column=null,0>i&&this.wrap?this._column=this.layer.data[i+this.map.height]:i>=this.map.height&&this.wrap?this._column=this.layer.data[i-this.map.height]:this.layer.data[i]&&(this._column=this.layer.data[i]),this._column)for(var s=this._mc.startX,r=this._mc.startX+this._mc.maxX;r>s;s++){var t=null;0>s&&this.wrap?t=this._column[s+this.map.width]:s>=this.map.width&&this.wrap?t=this._column[s-this.map.width]:this._column[s]&&(t=this._column[s]),t&&t.index>-1&&(e=this.map.tilesets[this.map.tiles[t.index][2]],this.debug===!1&&t.alpha!==this.context.globalAlpha&&(this.context.globalAlpha=t.alpha),e.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),t.index),t.debug&&(this.context.fillStyle="rgba(0, 255, 0, 0.4)",this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight))),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}return this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.texture._updateUvs(),this.dirty=!1,this.layer.dirty=!1,!0}},e.TilemapLayer.prototype.renderDebug=function(){this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.strokeStyle=this.debugColor,this.context.fillStyle=this.debugFillColor;for(var t=this._mc.startY,e=this._mc.startY+this._mc.maxY;e>t;t++){if(this._column=null,0>t&&this.wrap?this._column=this.layer.data[t+this.map.height]:t>=this.map.height&&this.wrap?this._column=this.layer.data[t-this.map.height]:this.layer.data[t]&&(this._column=this.layer.data[t]),this._column)for(var i=this._mc.startX,n=this._mc.startX+this._mc.maxX;n>i;i++){var s=null;0>i&&this.wrap?s=this._column[i+this.map.width]:i>=this.map.width&&this.wrap?s=this._column[i-this.map.width]:this._column[i]&&(s=this._column[i]),s&&(s.faceTop||s.faceBottom||s.faceLeft||s.faceRight)&&(this._mc.tx=Math.floor(this._mc.tx),this.debugFill&&this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch),this.context.beginPath(),s.faceTop&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)),s.faceBottom&&(this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),s.faceLeft&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)),s.faceRight&&(this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),this.context.stroke()),this._mc.tx+=this.map.tileWidth}this._mc.tx=this._mc.dx,this._mc.ty+=this.map.tileHeight}},Object.defineProperty(e.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(t){t!==this._mc.x&&(this._mc.x=t,this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth),this.dirty=!0)}}),Object.defineProperty(e.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(t){t!==this._mc.y&&(this._mc.y=t,this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight),this.dirty=!0)}}),Object.defineProperty(e.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=t,this.dirty=!0}}),Object.defineProperty(e.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=t,this.dirty=!0}}),e.TilemapParser={parse:function(game,t,i,n,s,r){if("undefined"==typeof i&&(i=32),"undefined"==typeof n&&(n=32),"undefined"==typeof s&&(s=10),"undefined"==typeof r&&(r=10),"undefined"==typeof t)return this.getEmptyData();if(null===t)return this.getEmptyData(i,n,s,r);var o=game.cache.getTilemapData(t);if(o){if(o.format===e.Tilemap.CSV)return this.parseCSV(t,o.data,i,n);if(!o.format||o.format===e.Tilemap.TILED_JSON)return this.parseTiledJSON(o.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+t)},parseCSV:function(t,i,n,s){var r=this.getEmptyData();i=i.trim();for(var o=[],a=i.split("\n"),h=a.length,l=0,c=0;c<a.length;c++){o[c]=[];for(var u=a[c].split(","),d=0;d<u.length;d++)o[c][d]=new e.Tile(r.layers[0],parseInt(u[d],10),d,c,n,s);0===l&&(l=u.length)}return r.format=e.Tilemap.CSV,r.name=t,r.width=l,r.height=h,r.tileWidth=n,r.tileHeight=s,r.widthInPixels=l*n,r.heightInPixels=h*s,r.layers[0].width=l,r.layers[0].height=h,r.layers[0].widthInPixels=r.widthInPixels,r.layers[0].heightInPixels=r.heightInPixels,r.layers[0].data=o,r},getEmptyData:function(t,e,i,n){var s={};s.width=0,s.height=0,s.tileWidth=0,s.tileHeight=0,"undefined"!=typeof t&&null!==t&&(s.tileWidth=t),"undefined"!=typeof e&&null!==e&&(s.tileHeight=e),"undefined"!=typeof i&&null!==i&&(s.width=i),"undefined"!=typeof n&&null!==n&&(s.height=n),s.orientation="orthogonal",s.version="1",s.properties={},s.widthInPixels=0,s.heightInPixels=0;var r=[],o={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]};return r.push(o),s.layers=r,s.images=[],s.objects={},s.collision={},s.tilesets=[],s.tiles=[],s},parseTiledJSON:function(t){function i(t,e){var i={};for(var n in e){var s=e[n];i[s]=t[s]}return i}if("orthogonal"!==t.orientation)return console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser"),null;var n={};n.width=t.width,n.height=t.height,n.tileWidth=t.tilewidth,n.tileHeight=t.tileheight,n.orientation=t.orientation,n.format=e.Tilemap.TILED_JSON,n.version=t.version,n.properties=t.properties,n.widthInPixels=n.width*n.tileWidth,n.heightInPixels=n.height*n.tileHeight;for(var s=[],r=0;r<t.layers.length;r++)if("tilelayer"===t.layers[r].type){var o={name:t.layers[r].name,x:t.layers[r].x,y:t.layers[r].y,width:t.layers[r].width,height:t.layers[r].height,widthInPixels:t.layers[r].width*t.tilewidth,heightInPixels:t.layers[r].height*t.tileheight,alpha:t.layers[r].opacity,visible:t.layers[r].visible,properties:{},indexes:[],callbacks:[],bodies:[]};t.layers[r].properties&&(o.properties=t.layers[r].properties);for(var a=0,h=[],l=[],c=0,u=t.layers[r].data.length;u>c;c++)t.layers[r].data[c]>0?h.push(new e.Tile(o,t.layers[r].data[c],a,l.length,t.tilewidth,t.tileheight)):h.push(new e.Tile(o,-1,a,l.length,t.tilewidth,t.tileheight)),a++,a===t.layers[r].width&&(l.push(h),a=0,h=[]);o.data=l,s.push(o)}n.layers=s;for(var d=[],r=0;r<t.layers.length;r++)if("imagelayer"===t.layers[r].type){var A={name:t.layers[r].name,image:t.layers[r].image,x:t.layers[r].x,y:t.layers[r].y,alpha:t.layers[r].opacity,visible:t.layers[r].visible,properties:{}};t.layers[r].properties&&(A.properties=t.layers[r].properties),d.push(A)}n.images=d;for(var p=[],r=0;r<t.tilesets.length;r++){var m=t.tilesets[r],f=new e.Tileset(m.name,m.firstgid,m.tilewidth,m.tileheight,m.margin,m.spacing,m.properties);m.tileproperties&&(f.tileProperties=m.tileproperties),f.rows=Math.round((m.imageheight-m.margin)/(m.tileheight+m.spacing)),f.columns=Math.round((m.imagewidth-m.margin)/(m.tilewidth+m.spacing)),f.total=f.rows*f.columns,f.rows%1!==0||f.columns%1!==0?console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height."):p.push(f)}n.tilesets=p;for(var g={},_={},r=0;r<t.layers.length;r++)if("objectgroup"===t.layers[r].type){g[t.layers[r].name]=[],_[t.layers[r].name]=[];for(var y=0,u=t.layers[r].objects.length;u>y;y++)if(t.layers[r].objects[y].gid){var v={gid:t.layers[r].objects[y].gid,name:t.layers[r].objects[y].name,x:t.layers[r].objects[y].x,y:t.layers[r].objects[y].y,visible:t.layers[r].objects[y].visible,properties:t.layers[r].objects[y].properties};g[t.layers[r].name].push(v)}else if(t.layers[r].objects[y].polyline){var v={name:t.layers[r].objects[y].name,type:t.layers[r].objects[y].type,x:t.layers[r].objects[y].x,y:t.layers[r].objects[y].y,width:t.layers[r].objects[y].width,height:t.layers[r].objects[y].height,visible:t.layers[r].objects[y].visible,properties:t.layers[r].objects[y].properties};v.polyline=[];for(var T=0;T<t.layers[r].objects[y].polyline.length;T++)v.polyline.push([t.layers[r].objects[y].polyline[T].x,t.layers[r].objects[y].polyline[T].y]);_[t.layers[r].name].push(v),g[t.layers[r].name].push(v)}else if(t.layers[r].objects[y].polygon){var v=i(t.layers[r].objects[y],["name","type","x","y","visible","properties"]);v.polygon=[];for(var T=0;T<t.layers[r].objects[y].polygon.length;T++)v.polygon.push([t.layers[r].objects[y].polygon[T].x,t.layers[r].objects[y].polygon[T].y]);g[t.layers[r].name].push(v)}else if(t.layers[r].objects[y].ellipse){var v=i(t.layers[r].objects[y],["name","type","ellipse","x","y","width","height","visible","properties"]);g[t.layers[r].name].push(v)}else{var v=i(t.layers[r].objects[y],["name","type","x","y","width","height","visible","properties"]);v.rectangle=!0,g[t.layers[r].name].push(v)}}n.objects=g,n.collision=_,n.tiles=[];for(var r=0;r<n.tilesets.length;r++)for(var m=n.tilesets[r],a=m.tileMargin,b=m.tileMargin,w=0,x=0,C=0,c=m.firstgid;c<m.firstgid+m.total&&(n.tiles[c]=[a,b,r],a+=m.tileWidth+m.tileSpacing,w++,w!==m.total)&&(x++,x!==m.columns||(a=m.tileMargin,b+=m.tileHeight+m.tileSpacing,x=0,C++,C!==m.rows));c++);var r,S,P,o,I,M,m;for(r=0;r<n.layers.length;r++)for(o=n.layers[r],S=0;S<o.data.length;S++)for(h=o.data[S],P=0;P<h.length;P++)I=h[P],I.index<0||(M=n.tiles[I.index][2],m=n.tilesets[M],m.tileProperties&&m.tileProperties[I.index-m.firstgid]&&(I.properties=m.tileProperties[I.index-m.firstgid]));return n}},e.Tileset=function(t,e,i,n,s,r,o){("undefined"==typeof i||0>=i)&&(i=32),("undefined"==typeof n||0>=n)&&(n=32),"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=0),this.name=t,this.firstgid=e,this.tileWidth=i,this.tileHeight=n,this.tileMargin=s,this.tileSpacing=r,this.properties=o,this.image=null,this.rows=0,this.columns=0,this.total=0,this.drawCoords=[]},e.Tileset.prototype={draw:function(t,e,i,n){this.image&&this.drawCoords[n]&&t.drawImage(this.image,this.drawCoords[n][0],this.drawCoords[n][1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)},setImage:function(t){this.image=t,this.rows=Math.round((t.height-this.tileMargin)/(this.tileHeight+this.tileSpacing)),this.columns=Math.round((t.width-this.tileMargin)/(this.tileWidth+this.tileSpacing)),this.total=this.rows*this.columns,this.drawCoords.length=0;for(var e=this.tileMargin,i=this.tileMargin,n=this.firstgid,s=0;s<this.rows;s++){for(var r=0;r<this.columns;r++)this.drawCoords[n]=[e,i],e+=this.tileWidth+this.tileSpacing,n++;e=this.tileMargin,i+=this.tileHeight+this.tileSpacing}},setSpacing:function(t,e){this.tileMargin=t,this.tileSpacing=e,this.setImage(this.image)}},e.Tileset.prototype.constructor=e.Tileset,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=e),exports.Phaser=e):"undefined"!=typeof define&&define.amd?define("Phaser",function(){return t.Phaser=e}()):t.Phaser=e}.call(this),define("phaser",function(t){return function(){var e;return e||t.Phaser}}(this)),define("gt/tweaks/Pixi/Graphics",["bottom_line","phaser","pixi"],function(t){t.extend(PIXI.Graphics.prototype,{enumerable:!1},{arc:{overwriteaction:"ignore",value:function(t,e,i,n,s,r){var o=t+Math.cos(n)*i,a=e+Math.sin(n)*i,h=[];if((0!==h.length&&h[h.length-2]!==o||h[h.length-1]!==a)&&(this.moveTo(o,a),h=this.currentPath.shape.points),n===s)return this;!r&&n>=s?s+=2*Math.PI:r&&s>=n&&(n+=2*Math.PI);var l=r?-1*(n-s):s-n,c=Math.abs(l)/(2*Math.PI)*40;if(0===l)return this;for(var u=l/(2*c),d=2*u,A=Math.cos(u),p=Math.sin(u),m=c-1,f=m%1/m,g=0;m>=g;g++){var _=g+f*g,y=u+n+d*_,v=Math.cos(y),T=-Math.sin(y);h.push((A*v+p*T)*i+t,(A*-T+p*v)*i+e)}return this.dirty=!0,this}}})}),define("gt/tweaks/Pixi/WebGLRenderer",["bottom_line","pixi"],function(t){t.extend(PIXI.WebGLRenderer.prototype,{updateTexture:{overwriteaction:"ignore",value:function(t){if(t.hasLoaded){var e=this.gl;return t._glTextures[e.id]||(t._glTextures[e.id]=e.createTexture()),e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),t.source&&e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===PIXI.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===PIXI.scaleModes.LINEAR?e.LINEAR:e.NEAREST),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),t._dirty[e.id]=!1,t._glTextures[e.id]}}}})}),define("gt/tweaks/Pixi/Texture",["bottom_line","pixi"],function(t){t.extend(PIXI.Texture.prototype,{setFrame:{overwriteaction:"ignore",value:function(t){if(this.noFrame=!1,this.frame=t,this.width=0|t.width,this.height=0|t.height,this.crop.x=0|t.x,this.crop.y=0|t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()}}})}),define("gt/math/ScalePoint",["phaser","bottom_line"],function(t,e){function i(t,e,i){this.scale=t,this.scaleX=e||this.scale.x,this.scaleY=i||this.scale.y}return e.extend(i.prototype,{
enumerable:!1},{set:{overrideaction:"ignore",value:function(t,e){return this.x=t||0,this.y=e||(0!==e?t:0),this}},get x(){return this.scale.x/this.scaleX},set x(t){this.scale.x=t*this.scaleX},get y(){return this.scale.y/this.scaleY},set y(t){this.scale.y=t*this.scaleY}}),i}),define("gt/math/GlobalPosition",["bottom_line","phaser"],function(t,e){function i(t){this.owner=t}return t.extend(i.prototype,{enumerable:!1},{globalPosition:function(){for(var t=this.owner,i=new e.Point(0,0);t;){i.x+=t.x-(t.pivot?t.pivot.x:0),i.y+=t.y-(t.pivot?t.pivot.y:0),t=t.parent;var n=t&&t.scale.x||1,s=t&&t.scale.y||1;i.x*=n,i.y*=s}return i},get x(){return this.globalPosition().x},get y(){return this.globalPosition().y}}),i}),define("gt/gui/Sprite",["bottom_line","phaser","gt/math/ScalePoint","gt/math/GlobalPosition"],function(t,e,i,n){function s(t,e,r,o,a,h){var l=o,c=r||game.spritesheets.sprites[l].spritesheet;s._super.constructor.call(this,game,t,e,c,l),this.id=a,this.scaler=new i(this.scale),this.global=new n(this),this.anchor.set(.5),game.scale.updateElement(this,game.spritesheets[c],game.viewport,h)}return t.inherit(s,e.Sprite),t.extend(s,{factoryName:"sprite"}),t.extend(s.prototype,{get scalar(){return this.scaler.x},set scalar(t){this.scaler.set(t)},revive:{wrap:!0,value:function(){return this.init.apply(this,arguments),this}},setImage:function(t){var e=this._game.spritesheets.sprites[t].spritesheet;this.key===e?this.frameName=t:this.loadTexture(e,t)}}),s}),define("gt/tweaks/Pixi/Spine",["bottom_line","pixi","gt/gui/Sprite"],function(t,e,i){PIXI.Spine=function(t){if(PIXI.DisplayObjectContainer.call(this),this.name=t,this.spineData=game.cache.getSpineAnimation(t),!this.spineData)throw new Error("No spine data found with key: "+t);this.updateSkeleton(),this.stateData=new spine.AnimationStateData(this.spineData),this.state=new spine.AnimationState(this.stateData),this.state.onSetAnimation.add(this.updateSkeleton,this)},PIXI.Spine.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),PIXI.Spine.prototype.constructor=PIXI.Spine,t.extend(PIXI.Spine.prototype,{updateSkeleton:function(){this.skeleton&&this._removeSlots(),this.skeleton=new spine.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this._createSlots()},_createSlots:function(){this.slotContainers=[];for(var t=0,e=this.skeleton.drawOrder.length;e>t;t++){var i=this.skeleton.drawOrder[t],n=i.attachment,s=new PIXI.DisplayObjectContainer;if(this.slotContainers.push(s),this.addChild(s),n instanceof spine.RegionAttachment){var r=n.rendererObject.name,o=this.createSprite(i,n.rendererObject);i.currentSprite=o,i.currentSpriteName=r,s.addChild(o)}}},_removeSlots:function(){for(var t=0;t<this.slotContainers.length;t++){var e=this.slotContainers[t];e.children.forEach(function(t){e.removeChild(t)}.bind(this)),this.removeChild(e)}},createSprite:function(t,e){var n=PIXI.TextureCache[e.name]?e.name:e.name+".png",s=new i(0,0,null,n);return s.scale.x=e.scale.x,s.scale.y=e.scale.y,s.rotation=e.rotation,s.anchor.x=.5,s.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[e.name]=s,s},preUpdate:function(){},update:function(){},postUpdate:function(){},updateTransform:function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var e=this.skeleton.drawOrder,i=0,n=e.length;n>i;i++){var s=e[i],r=s.attachment,o=this.slotContainers[i];if(r instanceof spine.RegionAttachment){if(r.rendererObject&&(!s.currentSpriteName||s.currentSpriteName!=r.name)){var a=r.rendererObject.name;if(void 0!==s.currentSprite&&(s.currentSprite.visible=!1),s.sprites=s.sprites||{},void 0!==s.sprites[a])s.sprites[a].visible=!0;else{var h=this.createSprite(s,r.rendererObject);o.addChild(h)}s.currentSprite=s.sprites[a],s.currentSpriteName=a}o.visible=!0;var l=s.bone;o.position.x=l.worldX+r.x*l.m00+r.y*l.m01,o.position.y=l.worldY+r.x*l.m10+r.y*l.m11,o.position.x*=game.viewport.scale,o.position.y*=game.viewport.scale,o.scale.x=l.worldScaleX/game.viewport.spritesheetScale*game.viewport.scale,o.scale.y=l.worldScaleY/game.viewport.spritesheetScale*game.viewport.scale,o.rotation=-(s.bone.worldRotation*Math.PI/180),o.alpha=s.a,s.currentSprite.tint=PIXI.rgb2hex([s.r,s.g,s.b])}else o.visible=!1}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)}})}),spine.AnimationState=function(t){this.data=t,this.queue=[],this.paused=!1,this.onSetAnimation=new Phaser.Signal},spine.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,backward:!1,mixTime:0,mixDuration:0,update:function(t){if(!this.paused&&(this.currentTime+=t*this.animationSpeed,this.previousTime+=t,this.mixTime+=t,this.queue.length>0)){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop,e.backward),this.queue.shift())}},apply:function(t){if(this.current){var e=this.backward?this.current.duration-this.currentTime:this.currentTime;if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var i=this.mixTime/this.mixDuration;i>=1&&(i=1,this.previous=null),this.current.mix(t,e,this.currentLoop,i)}else this.current.apply(t,e,this.currentLoop)}},pauseAnimation:function(){this.paused=!0},resumeAnimation:function(){this.paused=!1},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e,i){this.backward=i,this.onSetAnimation.dispatch(),this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e,i){var n=this.data.skeletonData.findAnimation(t);if(!n)throw"Animation not found: "+t;this.queue.length=0,this._setAnimation(n,e,i)},setAnimation:function(t,e,i){this.queue.length=0,this._setAnimation(t,e,i)},addAnimationByName:function(t,e,i,n){var s=this.data.skeletonData.findAnimation(t);if(!s)throw"Animation not found: "+t;this.addAnimation(s,e,i,n)},addAnimation:function(t,e,i,n){var s={};if(s.animation=t,s.loop=e,s.backward=n,!i||0>=i){var r=this.queue.length?this.queue[this.queue.length-1].animation:this.current;i=null!=r?r.duration-this.data.getMix(r,t)+(i||0):0}s.delay=i,this.queue.push(s)},isComplete:function(){var t=this.backward?this.current.duration-this.currentTime<=0:this.currentTime>=this.current.duration,e=!this.current||t;return e}},define("gt/tweaks/Pixi/SpineAnimationState",function(){}),define("gt/rendering/viewport/ViewportScaleMode",[],function(){var t={};return t.Fill="fill",t.Letterbox="letterbox",t}),define("gt/scenes/BackgroundSize",[],function(){var t={};return t.Game="game",t.Viewport="viewport",t.World="world",t}),define("settings",["bottom_line","phaser","gt/rendering/viewport/ViewportScaleMode","gt/scenes/BackgroundSize"],function(t,e,i,n){var settings={drawFps:!0,version:"0.1.0",bm:{},designWidth:1080,desktopDesignWidth:2160,designWidthMax:2160,designHeight:1620,desktopDesignHeight:1620,designHeightMax:1620,orientations:{desktop:"landscape",mobile:"portrait"},storage:{levelId:{"default":1,compare:Math.max},muteAudio:{"default":0,save:!1},_highScore$:{"default":0,compare:Math.max},_star_0$:{"default":!1},_star_1$:{"default":!1},_star_2$:{"default":!1},total_stars:{"default":0,compare:Math.max},marathon_unlocked:{"default":!1}},fontMap:{en:{"rounded-x-mplus-1m-bold":{font:"rounded-x-mplus-1m-bold",scale:1},"jiyucho-webfont":{font:"jiyucho-webfont",scale:1}},jp:{"rounded-x-mplus-1m-bold":{font:"rounded-x-mplus-1m-bold",scale:1},"jiyucho-webfont":{font:"jiyucho-webfont",scale:1}}},volume:t.extend(new Number(.5),{music:.4,effects:1}),dev:{debug:!0},viewportConfig:{scaleType:i.Fill,stretchWorldHeight:!0,stretchWorldWidth:!0},backgroundSize:n.Viewport};return Object.freeze(settings),settings}),define("utils/quality",["gt/utils/device","gt/utils/browser"],function(t,e){var i={maxParallelLoads:5,deviceScale:1,webglFilters:!0};return t.galaxyS3&&(i.webglFilters=!1,e.chrome||(i.deviceScale=.8)),t.iOS&&(i.deviceScale=.8,i.webglFilters=!1),t.desktop&&e.safari&&(i.maxParallelLoads=1),i}),function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function i(t){return"object"==typeof t&&null!==t}function n(){}function s(){return function(){process.nextTick(h)}}function r(){var t=0,e=new R(h),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function o(){var t=new MessageChannel;return t.port1.onmessage=h,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(h,1)}}function h(){for(var t=0;O>t;t+=2){var e=N[t],i=N[t+1];e(i),N[t]=void 0,N[t+1]=void 0}O=0}function l(){}function c(){return new TypeError("You cannot resolve a promise with itself")}function u(){return new TypeError("A promises callback cannot return that same promise.")}function d(t){try{return t.then}catch(e){return j.error=e,j}}function A(t,e,i,n){try{t.call(e,i,n)}catch(s){return s}}function p(t,e,i){L(function(t){var n=!1,s=A(i,e,function(i){n||(n=!0,e!==i?g(t,i):y(t,i))},function(e){n||(n=!0,v(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&s&&(n=!0,v(t,s))},t)}function m(t,e){e._state===X?y(t,e._result):t._state===H?v(t,e._result):T(e,void 0,function(e){g(t,e)},function(e){v(t,e)})}function f(t,i){if(i.constructor===t.constructor)m(t,i);else{var n=d(i);n===j?v(t,j.error):void 0===n?y(t,i):e(n)?p(t,i,n):y(t,i)}}function g(e,i){e===i?v(e,c()):t(i)?f(e,i):y(e,i)}function _(t){t._onerror&&t._onerror(t._result),b(t)}function y(t,e){t._state===U&&(t._result=e,t._state=X,0===t._subscribers.length||L(b,t))}function v(t,e){t._state===U&&(t._state=H,t._result=e,L(_,t))}function T(t,e,i,n){var s=t._subscribers,r=s.length;t._onerror=null,s[r]=e,s[r+X]=i,s[r+H]=n,0===r&&t._state&&L(b,t)}function b(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n,s,r=t._result,o=0;o<e.length;o+=3)n=e[o],s=e[o+i],n?C(i,n,s,r):s(r);t._subscribers.length=0}}function w(){this.error=null}function x(t,e){try{return t(e)}catch(i){return W.error=i,W}}function C(t,i,n,s){var r,o,a,h,l=e(n);if(l){if(r=x(n,s),r===W?(h=!0,o=r.error,r=null):a=!0,i===r)return void v(i,u())}else r=s,a=!0;i._state!==U||(l&&a?g(i,r):h?v(i,o):t===X?y(i,r):t===H&&v(i,r))}function S(t,e){try{e(function(e){g(t,e)},function(e){v(t,e)})}catch(i){v(t,i)}}function P(t,e,i,n){this._instanceConstructor=t,this.promise=new t(l,n),this._abortOnReject=i,this._validateInput(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._init(),0===this.length?y(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&y(this.promise,this._result))):v(this.promise,this._validationError())}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function k(t){this._id=J++,this._state=void 0,this._result=void 0,this._subscribers=[],l!==t&&(e(t)||I(),this instanceof k||M(),S(this,t))}var B;B=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var D,E=B,O=(Date.now||function(){return(new Date).getTime()},Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return n.prototype=t,new n},0),L=function(t,e){N[O]=t,N[O+1]=e,O+=2,2===O&&D()},F="undefined"!=typeof window?window:{},R=F.MutationObserver||F.WebKitMutationObserver,G="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3);D="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?s():R?r():G?o():a();var U=void 0,X=1,H=2,j=new w,W=new w;P.prototype._validateInput=function(t){return E(t)},P.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},P.prototype._init=function(){this._result=new Array(this.length)};var Q=P;P.prototype._enumerate=function(){for(var t=this.length,e=this.promise,i=this._input,n=0;e._state===U&&t>n;n++)this._eachEntry(i[n],n)},P.prototype._eachEntry=function(t,e){var n=this._instanceConstructor;i(t)?t.constructor===n&&t._state!==U?(t._onerror=null,this._settledAt(t._state,e,t._result)):this._willSettleAt(n.resolve(t),e):(this._remaining--,this._result[e]=this._makeResult(X,e,t))},P.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===U&&(this._remaining--,this._abortOnReject&&t===H?v(n,i):this._result[e]=this._makeResult(t,e,i)),0===this._remaining&&y(n,this._result)},P.prototype._makeResult=function(t,e,i){return i},P.prototype._willSettleAt=function(t,e){var i=this;T(t,void 0,function(t){i._settledAt(X,e,t)},function(t){i._settledAt(H,e,t)})};var Y=function(t,e){return new Q(this,t,!0,e).promise},V=function(t,e){function i(t){g(r,t)}function n(t){v(r,t)}var s=this,r=new s(l,e);if(!E(t))return v(r,new TypeError("You must pass an array to race.")),r;for(var o=t.length,a=0;r._state===U&&o>a;a++)T(s.resolve(t[a]),void 0,i,n);return r},z=function(t,e){var i=this;if(t&&"object"==typeof t&&t.constructor===i)return t;var n=new i(l,e);return g(n,t),n},K=function(t,e){var i=this,n=new i(l,e);return v(n,t),n},J=0,Z=k;k.all=Y,k.race=V,k.resolve=z,k.reject=K,k.prototype={constructor:k,then:function(t,e){var i=this,n=i._state;if(n===X&&!t||n===H&&!e)return this;var s=new this.constructor(l),r=i._result;if(n){var o=arguments[n-1];L(function(){C(n,s,o,r)})}else T(i,s,t,e);return s},"catch":function(t){return this.then(null,t)}};var q=function(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var i="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var i;return new t.Promise(function(t){i=t}),e(i)}();i||(t.Promise=Z)},$={Promise:Z,polyfill:q};"function"==typeof define&&define.amd?define("promise",[],function(){return $}):"undefined"!=typeof module&&module.exports?module.exports=$:"undefined"!=typeof this&&(this.ES6Promise=$)}.call(this),define("gt/extras/Promise",["promise"],function(t){return window.Promise||t.Promise}),define("gt/extras/ajax",["bottom_line","gt/extras/Promise","gt/utils/device.info"],function(t,e){function i(t,e){var i=e||n(t);switch(i){case"json":return JSON.parse(t.response);default:return t.response}}function n(t){var e=t.getResponseHeader("Content-Type");return e._.has("application/json")?"json":"text"}function s(e){var i="";return"object"===t.typeOf(e)?e._each(function(t,e){i+=(i?"&":"")+e+"="+t}):null!==e&&(i=e._toString()),i}function r(n,r){return new e(function(e,o){var a=r||{};a.async=a.async!==!1,a.method=(a.method||"GET").toUpperCase(),a.parse=a.parse!==!1;var h,l="data"in a?s(a.data):"",c="POST"===a.method,u=c&&"object"===t.typeOf(a.data);l&&(c?h=l:n+="?"+l);var d=new XMLHttpRequest;d.open(a.method,n,a.async),d.onload=function(){if(200==d.status){var t=a.parse?i(d,a.dataType):d.response;e(t,d)}else o.call(Error(d.statusText),d)},d.onerror=function(){o(Error("Network Error"))},a.accepts&&d.setRequestHeader("Accept",a.accepts),a.contentType&&d.setRequestHeader("Content-type",a.contentType),u&&d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),device.desktop&&browser.safari&&(d.setRequestHeader("Pragma","no-cache"),d.setRequestHeader("Cache-Control","no-cache"),d.setRequestHeader("Expires",0)),"withCredentials"in a&&"withCredentials"in d&&(d.withCredentials=a.withCredentials),d.send(h)})}return r}),define("gt/tweaks/Phaser/Loader",["bottom_line","phaser","settings","utils/quality","gt/utils/device","gt/utils/browser","gt/extras/ajax"],function(t,e,settings,i,n,s,r){t.extend(e.Loader.prototype,{ajax:r,jsonLoadComplete:{overwriteaction:"ignore",value:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader jsonLoadComplete invalid index "+t);var e=this._fileList[t];if(this._ajax&&this._ajax[t]&&this._ajax[t].responseText)var i=JSON.parse(this._ajax[t].responseText);else var i=JSON.parse(e._xhr.responseText);if(i.bones){var n=new spine.SkeletonJson,s=n.readSkeletonData(i);this.game.cache.addSpineAnimation(e.key,e.url,s)}e.loaded=!0,"tilemap"===e.type?this.game.cache.addTilemap(e.key,e.url,i,e.format):"json"===e.type?this.game.cache.addJSON(e.key,e.url,i):this.game.cache.addTextureAtlas(e.key,e.url,e.data,i,e.format),i.meta&&(i.meta.scale&&(i.meta.scale=parseFloat(i.meta.scale)),i.meta.image&&(i.meta.name=i.meta.image._.before(".")),this.game.cache.getFrameData(e.key)&&(this.game.cache.getFrameData(e.key).metaData=i.meta)),this.nextFile(t,!0)}},nextFile:{overwriteaction:"ignore",value:function(t,e){this.progressFloat+=this._progressChunk,this.progress=Math.round(this.progressFloat),this.progress>100&&(this.progress=100),null!==this.preloadSprite&&(0===this.preloadSprite.direction?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.updateCrop()),this.onFileComplete.dispatch(this.progress,this._fileList[t].key,e,this.totalLoadedFiles(),this._fileList.length,t),this.progress<100&&this._fileIndex<this._fileList.length?this.loadFile(this._fileIndex++):100===this.progress&&(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())}},loadFile:{overwriteaction:"ignore",value:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader loadFile invalid index "+t);var i=this._fileList[t];i._xhr=new XMLHttpRequest;var n=this;switch(this.onFileStart.dispatch(this.progress,i.key,i.url),i.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":i.data=new Image,i.data.name=i.key,i.data.onload=function(){return n.fileComplete(t)},i.data.onerror=function(){return n.fileError(t)},this.crossOrigin&&(i.data.crossOrigin=this.crossOrigin),i.data.src=this.baseURL+i.url;break;case"audio":i.url=this.getAudioURL(i.url),null!==i.url?this.game.sound.usingWebAudio?this.xhrLoad(t,this.baseURL+i.url,"arraybuffer","fileComplete","fileError"):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(i.data=new Audio,i.data.name=i.key,i.data.preload="auto",i.data.src=this.baseURL+i.url,this.fileComplete(t)):(i.data=new Audio,i.data.name=i.key,i.data.onerror=function(){return n.fileError(t)},i.data.preload="auto",i.data.src=this.baseURL+i.url,i.data.addEventListener("canplaythrough",function(){e.GAMES[n.game.id].load.fileComplete(t)},!1),i.data.load())):this.fileError(t);break;case"json":this.useXDomainRequest&&window.XDomainRequest?(this._ajax||(this._ajax=[]),this._ajax[t]=new window.XDomainRequest,this._ajax[t].timeout=3e3,this._ajax[t].onerror=function(){return n.dataLoadError(t)},this._ajax[t].ontimeout=function(){return n.dataLoadError(t)},this._ajax[t].onprogress=function(){},this._ajax[t].onload=function(){return n.jsonLoadComplete(t)},this._ajax[t].open("GET",this.baseURL+i.url,!0),setTimeout(function(){this._ajax[t].send()},0)):this.xhrLoad(t,this.baseURL+i.url,"text","jsonLoadComplete","dataLoadError");break;case"xml":this.xhrLoad(t,this.baseURL+i.url,"text","xmlLoadComplete","dataLoadError");break;case"tilemap":if(i.format===e.Tilemap.TILED_JSON)this.xhrLoad(t,this.baseURL+i.url,"text","jsonLoadComplete","dataLoadError");else{if(i.format!==e.Tilemap.CSV)throw new Error("Phaser.Loader. Invalid Tilemap format: "+i.format);this.xhrLoad(t,this.baseURL+i.url,"text","csvLoadComplete","dataLoadError")}break;case"text":case"script":case"physics":this.xhrLoad(t,this.baseURL+i.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(t,this.baseURL+i.url,"arraybuffer","fileComplete","fileError")}}},fileComplete:{overwriteaction:"ignore",value:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader fileComplete invalid index "+t);var i=this._fileList[t];i.loaded=!0;var n=!0;switch(i.type){case"image":this.game.cache.addImage(i.key,i.url,i.data);break;case"spritesheet":this.game.cache.addSpriteSheet(i.key,i.url,i.data,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"textureatlas":if(null==i.atlasURL)this.game.cache.addTextureAtlas(i.key,i.url,i.data,i.atlasData,i.format);else if(n=!1,i.format==e.Loader.TEXTURE_ATLAS_JSON_ARRAY||i.format==e.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(t,this.baseURL+i.atlasURL,"text","jsonLoadComplete","dataLoadError");else{if(i.format!=e.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+i.format);this.xhrLoad(t,this.baseURL+i.atlasURL,"text","xmlLoadComplete","dataLoadError")}break;case"bitmapfont":null==i.xmlURL?this.game.cache.addBitmapFont(i.key,i.url,i.data,i.xmlData,i.xSpacing,i.ySpacing):(n=!1,this.xhrLoad(t,this.baseURL+i.xmlURL,"text","xmlLoadComplete","dataLoadError"));break;case"audio":if(this.game.sound.usingWebAudio){if(i.data=i._xhr.response,this.game.cache.addSound(i.key,i.url,i.data,!0,!1),i.autoDecode){var s=this,r=i.key;this.game.cache.updateSound(r,"isDecoding",!0),this.game.sound.context.decodeAudioData(i.data,function(t){t&&(s.game.cache.decodedSound(r,t),s.game.sound.onSoundDecode.dispatch(r,s.game.cache.getSound(r)))})}}else i.data.removeEventListener("canplaythrough",e.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(i.key,i.url,i.data,!1,!0);break;case"text":i.data=i._xhr.responseText,this.game.cache.addText(i.key,i.url,i.data);break;case"physics":var o=JSON.parse(i._xhr.responseText);this.game.cache.addPhysicsData(i.key,i.url,o,i.format);break;case"script":i.data=document.createElement("script"),i.data.language="javascript",i.data.type="text/javascript",i.data.defer=!1,i.data.text=i._xhr.responseText,document.head.appendChild(i.data),i.callback&&(i.data=i.callback.call(i.callbackContext,i.key,i._xhr.responseText));break;case"binary":i.callback?i.data=i.callback.call(i.callbackContext,i.key,i._xhr.response):i.data=i._xhr.response,this.game.cache.addBinary(i.key,i.data)}n&&this.nextFile(t,!0)}},beginLoad:{overwriteaction:"ignore",value:function(){if(!this.isLoading)if(this.progress=0,this.progressFloat=0,this.hasLoaded=!1,this.isLoading=!0,this.onLoadStart.dispatch(this._fileList.length),this.maxLoadingFiles=Math.min(this._fileList.length,i.maxParallelLoads),this._fileList.length>0)for(this._progressChunk=100/this._fileList.length,this._fileIndex=0;this._fileIndex<this.maxLoadingFiles;this._fileIndex++)this.loadFile(this._fileIndex);else this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.onLoadComplete.dispatch()}},xhrLoad:{overwriteaction:"ignore",value:function(t,e,i,r,o){var a=this._fileList[t];a._xhr.open("GET",e,!0),a._xhr.responseType=i,n.desktop&&s.safari&&(a._xhr.setRequestHeader("Pragma","no-cache"),a._xhr.setRequestHeader("Cache-Control","no-cache"),a._xhr.setRequestHeader("Expires",0));var h=this;a._xhr.onload=function(){return h[r](t)},a._xhr.onerror=function(){return h[o](t)},a._xhr.send()}},csvLoadComplete:{overwriteaction:"ignore",value:function(t){if(!this._fileList[t])return void console.warn("Phaser.Loader csvLoadComplete invalid index "+t);var e=this._fileList[t],i=e._xhr.responseText;e.loaded=!0,this.game.cache.addTilemap(e.key,e.url,i,e.format),this.nextFile(t,!0)}},xmlLoadComplete:{overwriteaction:"ignore",value:function(t){var e=this._fileList[t];""!==e._xhr.responseType&&"text"!==e._xhr.responseType&&(console.warn("Invalid XML Response Type",this._fileList[t]),console.warn(e._xhr));var i,n=e._xhr.responseText;try{if(window.DOMParser){var s=new DOMParser;i=s.parseFromString(n,"text/xml")}else i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n)}catch(r){i=void 0}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");var e=this._fileList[t];e.loaded=!0,"bitmapfont"===e.type?this.game.cache.addBitmapFont(e.key,e.url,e.data,i,e.xSpacing,e.ySpacing):"textureatlas"===e.type?this.game.cache.addTextureAtlas(e.key,e.url,e.data,i,e.format):"xml"===e.type&&this.game.cache.addXML(e.key,e.url,i),this.nextFile(t,!0)}}})}),require(["phaser","bottom_line","gt/math/GlobalPosition"],function(t,e,i){t.Group=function(){var e=t.Group,n=function(){this.global=new i(this),e.apply(this,arguments)};return n.prototype=e.prototype,n.prototype.constructor=n,n}(),e.extend(t.Group.prototype,{get scalar(){return this.scale.x},set scalar(t){this.scale.set(t)}})}),define("gt/tweaks/Phaser/Group",function(){}),define("gt/tweaks/Phaser/Easing",["phaser","bottom_line","settings"],function(t,e,settings){e.extend(t.Easing.Bounce,{InSubtle:function(e){return 1-t.Easing.Bounce.Out(1-e)},InOutSubtle:function(e){return.5>e?.5*t.Easing.Bounce.InSubtle(2*e):.5*t.Easing.Bounce.OutSubtle(2*e-1)+.5}}),e.extend(t.Easing.Sinusoidal,{BounceOut:function(t){return Math.sin(t*Math.PI*4)*(1-t)},BounceIn:function(t){return-Math.sin(t*Math.PI*4)*(1-t)},BounceOnceOut:function(t){return Math.sin(Math.PI*t)*(1-t)},BounceOnceIn:function(t){return-Math.sin(Math.PI*t)*(1-t)}}),e.extend(t.Easing.Elastic,{ExtraOut:function(t){var e,i=3,n=.1,s=.4;return 0===t?0:1===t?1:(!n||1>n?(n=1,e=s/4):e=s*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-(10-i)*t)*Math.sin((t-e)*(2*Math.PI)/s)+1)}})}),require(["phaser","bottom_line"],function(t,e){Phaser.Pointer.prototype.start=function(){var t=Phaser.Pointer.prototype.start;return function(e){return e.target.id===game.canvas.id?t.call(this,e):void 0}}(),Phaser.Pointer.prototype.stop=function(){var t=Phaser.Pointer.prototype.stop;return function(e){return e.target.id===game.canvas.id?t.call(this,e):void 0}}(),Phaser.Pointer.__swipeBound=50,Phaser.Pointer.isSwipe=function(){var t=game.input.activePointer,e=Phaser.Point.distance(t.position,t.positionDown)>Phaser.Pointer.__swipeBound;return e}}),define("gt/tweaks/Phaser/Pointer",function(){}),define("gt/tweaks/Phaser/ScaleManager",["bottom_line","phaser"],function(t,e){t.extend(e.ScaleManager.prototype,{enumerable:!1},{updateElement:function(t,e,viewportManager,i){var n=e?e.metaData.scale:1,s=viewportManager?viewportManager.scale:1,r=s/n,o=1,a=1;i&&(o=i.width/s/(t.width/n),a=i.height/s/(t.height/n));var h=1,l=1;if(t.hasOwnProperty("frameName")){var c=e.getFrameByName(t.frameName);c.trimmed&&(h=c.spriteSourceSizeW/c.sourceSizeW,l=c.spriteSourceSizeH/c.sourceSizeH)}t.scale.x=r*o*h,t.scale.y=r*a*l,t.scaler.scaleX=t.scale.x,t.scaler.scaleY=t.scale.y}})}),define("gt/tweaks/Phaser/Canvas",["phaser"],function(t){t.Canvas.getOffset=function(e,i){i=i||new t.Point;var n=e.getBoundingClientRect(),s=e.clientTop||document.body.clientTop||0,r=e.clientLeft||document.body.clientLeft||0,o=0,a=0;return"CSS1Compat"===document.compatMode?(o=window.pageYOffset||document.documentElement.scrollTop||e.scrollTop||0,a=window.pageXOffset||document.documentElement.scrollLeft||e.scrollLeft||0):(o=window.pageYOffset||document.body.scrollTop||e.scrollTop||0,a=window.pageXOffset||document.body.scrollLeft||e.scrollLeft||0),i.x=n.left+a-r,i.y=n.top+o-s,i}}),define("gt/tweaks/Phaser/BitmapText",["bottom_line","phaser"],function(t,e){t.extend(e.BitmapText.prototype,{enumerable:!1},{setAnchor:function(t,e){this._anchor||(this._anchor={}),this._anchor.x=t||0,this._anchor.y=e||0,this.updateAnchor()},getAnchor:function(){return this._anchor},updateAnchor:function(){if(this._anchor){if(!this._originalPositions||this.dirty){this._originalPositions=[];for(var t=0,e=this.children.length;e>t;t++)this._originalPositions.push({x:this.children[t].x,y:this.children[t].y})}for(var t=0,e=this.children.length;e>t;t++)this.children[t].x=this._originalPositions[t].x-this.textWidth*this._anchor.x,this.children[t].y=this._originalPositions[t].y-this.textHeight*this._anchor.y}},postUpdate:{overwriteaction:"ignore",value:function(){1===this._cache[7]&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)}},updateText:{overrideaction:"ignore",value:function(){for(var t=PIXI.BitmapText.fonts[this.fontName],e=new PIXI.Point,i=null,n=[],s=0,r=[],o=0,a=this.fontSize/t.size,h=0;h<this.text.length;h++){var l=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h))||-1!==this.wordWrapWidth&&e.x>this.wordWrapWidth&&" "===this.text.charAt(h))r.push(e.x),s=Math.max(s,e.x),o++,e.x=0,e.y+=t.lineHeight,i=null;else{var c=t.chars[l];c&&(i&&c[i]&&(e.x+=c.kerning[i]),n.push({texture:c.texture,line:o,charCode:l,position:new PIXI.Point(e.x+c.xOffset,e.y+c.yOffset)}),e.x+=c.xAdvance,i=l)}}r.push(e.x),s=Math.max(s,e.x);var u=[];for(h=0;o>=h;h++){var d=0;"right"===this.style.align?d=s-r[h]:"center"===this.style.align&&(d=(s-r[h])/2),u.push(d)}var A=this.children.length,p=n.length,m=this.tint||16777215;for(h=0;p>h;h++){var f=A>h?this.children[h]:this._pool.pop();f?f.setTexture(n[h].texture):f=new PIXI.Sprite(n[h].texture),f.position.x=(n[h].position.x+u[n[h].line])*a,f.position.y=n[h].position.y*a,f.scale.x=f.scale.y=a,f.tint=m,f.parent||this.addChild(f)}for(;this.children.length>p;){var g=this.getChildAt(this.children.length-1);this._pool.push(g),this.removeChild(g)}this.textWidth=s*a,this.textHeight=(e.y+t.lineHeight)*a,this.updateAnchor()}},setText:{overrideaction:"ignore",value:function(){var t=PIXI.BitmapText.prototype.setText;return function(e){return t.call(this,e._.toString())}}()},get wordWrapWidth(){return this._wordWrapWidth||-1},set wordWrapWidth(t){this._wordWrapWidth=t,this.updateText()},get scalar(){return this.scale.x},set scalar(t){this.scale.set(t)}})}),require(["phaser","bottom_line"],function(t,e){t.Tween.prototype.stop=function(){var e=t.Tween.prototype.stop;return function(){return this.inUse=!1,e.apply(this,arguments)}}()}),define("gt/tweaks/Phaser/Tween",function(){}),define("gt/tweaks/Phaser/Label",["bottom_line","phaser"],function(t,e){t.extend(e.Text.prototype,{enumerable:!1},{updateText:function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.runWordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],n=0,s=this.determineFontProperties(this.style.font),r=0;r<e.length;r++){var o=this.context.measureText(e[r]).width;i[r]=o,n=Math.max(n,o)}if(1===e.length){var a=this.context.measureText(e[0]).width,h=0;switch(this.style.align){case"left":h=a/2;break;case"right":h=-a/2}this.x=this.rect.x+h,this.x+=.035*this.rect.width}var l=n+this.style.strokeThickness;this.canvas.width=(l+this.context.lineWidth)*this.resolution;var c=s.fontSize+this.style.strokeThickness+20*game.viewport.scale,u=c*e.length;this.canvas.height=u*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round";var d,A;for(this._charCount=0,r=0;r<e.length;r++)if(d=this.style.strokeThickness/2,A=this.style.strokeThickness+13*game.viewport.scale+r*c+s.ascent,"right"===this.style.align?d+=n-i[r]:"center"===this.style.align&&(d+=(n-i[r])/2),A+=this._lineSpacing,this.colors.length>0)this.updateLine(e[r],d,A);else{if(this.style.stroke&&this.style.strokeThickness){var p=device.iOS?A+2*game.viewport.scale:A;this.context.strokeText(e[r],d,p)}this.style.fill&&this.context.fillText(e[r],d,A)}this.updateTexture();
}})}),define("gt/tweaks/Phaser/Cache",["bottom_line","pixi"],function(t,e){Phaser.Cache=function(game){this.game=game,this._canvases={},this._images={},this._textures={},this._sounds={},this._text={},this._json={},this._xml={},this._spineAnimations={},this._physics={},this._tilemaps={},this._binary={},this._bitmapDatas={},this._bitmapFont={},this._urlMap={},this._urlResolver=new Image,this._urlTemp=null,this.addDefaultImage(),this.addMissingImage(),this.onSoundUnlock=new Phaser.Signal,this._cacheMap=[],this._cacheMap[Phaser.Cache.CANVAS]=this._canvases,this._cacheMap[Phaser.Cache.IMAGE]=this._images,this._cacheMap[Phaser.Cache.TEXTURE]=this._textures,this._cacheMap[Phaser.Cache.SOUND]=this._sounds,this._cacheMap[Phaser.Cache.TEXT]=this._text,this._cacheMap[Phaser.Cache.PHYSICS]=this._physics,this._cacheMap[Phaser.Cache.TILEMAP]=this._tilemaps,this._cacheMap[Phaser.Cache.BINARY]=this._binary,this._cacheMap[Phaser.Cache.BITMAPDATA]=this._bitmapDatas,this._cacheMap[Phaser.Cache.BITMAPFONT]=this._bitmapFont,this._cacheMap[Phaser.Cache.JSON]=this._json,this._cacheMap[Phaser.Cache.XML]=this._xml,this._cacheMap[Phaser.Cache.SPINEANIM]=this._spineAnimations},Phaser.Cache.CANVAS=1,Phaser.Cache.IMAGE=2,Phaser.Cache.TEXTURE=3,Phaser.Cache.SOUND=4,Phaser.Cache.TEXT=5,Phaser.Cache.PHYSICS=6,Phaser.Cache.TILEMAP=7,Phaser.Cache.BINARY=8,Phaser.Cache.BITMAPDATA=9,Phaser.Cache.BITMAPFONT=10,Phaser.Cache.JSON=11,Phaser.Cache.XML=12,Phaser.Cache.SPINEANIM=13,Phaser.Cache.prototype={addCanvas:function(t,e,i){this._canvases[t]={canvas:e,context:i}},addBinary:function(t,e){this._binary[t]=e},addBitmapData:function(t,e,i){return e.key=t,this._bitmapDatas[t]={data:e,frameData:i},e},addRenderTexture:function(t,e){var i=new Phaser.Frame(0,0,0,e.width,e.height,"","");this._textures[t]={texture:e,frame:i}},addSpriteSheet:function(t,e,i,n,s,r,o,a){this._images[t]={url:e,data:i,frameWidth:n,frameHeight:s,margin:o,spacing:a},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),this._images[t].frameData=Phaser.AnimationParser.spriteSheet(this.game,t,n,s,r,o,a),this._urlMap[this._resolveUrl(e)]=this._images[t]},addTilemap:function(t,e,i,n){this._tilemaps[t]={url:e,data:i,format:n},this._urlMap[this._resolveUrl(e)]=this._tilemaps[t]},addTextureAtlas:function(t,e,i,n,s){this._images[t]={url:e,data:i},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),s==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[t].frameData=Phaser.AnimationParser.JSONData(this.game,n,t):s==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[t].frameData=Phaser.AnimationParser.JSONDataHash(this.game,n,t):s==Phaser.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[t].frameData=Phaser.AnimationParser.XMLData(this.game,n,t)),this._urlMap[this._resolveUrl(e)]=this._images[t]},addBitmapFont:function(t,e,i,n,s,r){this._images[t]={url:e,data:i},PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),Phaser.LoaderParser.bitmapFont(this.game,n,t,s,r),this._bitmapFont[t]=PIXI.BitmapText.fonts[t],this._urlMap[this._resolveUrl(e)]=this._bitmapFont[t]},addPhysicsData:function(t,e,i,n){this._physics[t]={url:e,data:i,format:n},this._urlMap[this._resolveUrl(e)]=this._physics[t]},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==",this._images.__default={url:null,data:t},this._images.__default.frame=new Phaser.Frame(0,0,0,32,32,"",""),this._images.__default.frameData=new Phaser.FrameData,this._images.__default.frameData.addFrame(new Phaser.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(t),PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==",this._images.__missing={url:null,data:t},this._images.__missing.frame=new Phaser.Frame(0,0,0,32,32,"",""),this._images.__missing.frameData=new Phaser.FrameData,this._images.__missing.frameData.addFrame(new Phaser.Frame(0,0,0,32,32,null,this.game.rnd.uuid())),PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(t),PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(t,e,i){this._text[t]={url:e,data:i},this._urlMap[this._resolveUrl(e)]=this._text[t]},addJSON:function(t,e,i){this._json[t]={url:e,data:i},this._urlMap[this._resolveUrl(e)]=this._json[t]},addXML:function(t,e,i){this._xml[t]={url:e,data:i}},addImage:function(t,e,i){this._images[t]={url:e,data:i},this._images[t].frame=new Phaser.Frame(0,0,0,i.width,i.height,t,this.game.rnd.uuid()),this._images[t].frameData=new Phaser.FrameData,this._images[t].frameData.addFrame(new Phaser.Frame(0,0,0,i.width,i.height,e,this.game.rnd.uuid())),PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(i),PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]),this._urlMap[this._resolveUrl(e)]=this._images[t]},addSound:function(t,e,i,n,s){n=n||!0,s=s||!1;var r=!1;s&&(r=!0),this._sounds[t]={url:e,data:i,isDecoding:!1,decoded:r,webAudio:n,audioTag:s,locked:this.game.sound.touchLocked},this._urlMap[this._resolveUrl(e)]=this._sounds[t]},reloadSound:function(t){var e=this;this._sounds[t]&&(this._sounds[t].data.src=this._sounds[t].url,this._sounds[t].data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},!1),this._sounds[t].data.load())},reloadSoundComplete:function(t){this._sounds[t]&&(this._sounds[t].locked=!1,this.onSoundUnlock.dispatch(t))},updateSound:function(t,e,i){this._sounds[t]&&(this._sounds[t][e]=i)},decodedSound:function(t,e){this._sounds[t].data=e,this._sounds[t].decoded=!0,this._sounds[t].isDecoding=!1},getCanvas:function(t){return this._canvases[t]?this._canvases[t].canvas:void console.warn('Phaser.Cache.getCanvas: Invalid key: "'+t+'"')},getBitmapData:function(t){return this._bitmapDatas[t]?this._bitmapDatas[t].data:void console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+t+'"')},getBitmapFont:function(t){return this._bitmapFont[t]?this._bitmapFont[t]:void console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+t+'"')},getPhysicsData:function(t,e,i){if("undefined"==typeof e||null===e){if(this._physics[t])return this._physics[t].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+t+'"')}else if(this._physics[t]&&this._physics[t].data[e]){var n=this._physics[t].data[e];if(!n||!i)return n;for(var s in n)if(s=n[s],s.fixtureKey===i)return s;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"');return null},checkKey:function(t,e){return this._cacheMap[t][e]?!0:!1},checkCanvasKey:function(t){return this.checkKey(Phaser.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(Phaser.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(Phaser.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(Phaser.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(Phaser.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(Phaser.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(Phaser.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(Phaser.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(Phaser.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(Phaser.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(Phaser.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(Phaser.Cache.XML,t)},checkUrl:function(t){return this._urlMap[this._resolveUrl(t)]?!0:!1},getImage:function(t){return this._images[t]?this._images[t].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+t+'"'),null)},getTilemapData:function(t){return this._tilemaps[t]?this._tilemaps[t]:void console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+t+'"')},getFrameData:function(t,e){return"undefined"==typeof e&&(e=Phaser.Cache.IMAGE),this._cacheMap[e][t]?this._cacheMap[e][t].frameData:null},updateFrameData:function(t,e){this._images[t]&&(this._images[t].frameData=e)},getFrameByIndex:function(t,e){return this._images[t]?this._images[t].frameData.getFrame(e):null},getFrameByName:function(t,e){return this._images[t]?this._images[t].frameData.getFrameByName(e):null},getFrame:function(t){return this._images[t]?this._images[t].frame:null},getTextureFrame:function(t){return this._textures[t]?this._textures[t].frame:null},getTexture:function(t){return this._textures[t]?this._textures[t]:void console.warn('Phaser.Cache.getTexture: Invalid key: "'+t+'"')},getSound:function(t){return this._sounds[t]?this._sounds[t]:void console.warn('Phaser.Cache.getSound: Invalid key: "'+t+'"')},getSoundData:function(t){return this._sounds[t]?this._sounds[t].data:void console.warn('Phaser.Cache.getSoundData: Invalid key: "'+t+'"')},isSoundDecoded:function(t){return this._sounds[t]?this._sounds[t].decoded:void 0},isSoundReady:function(t){return this._sounds[t]&&this._sounds[t].decoded&&this.game.sound.touchLocked===!1},getFrameCount:function(t){return this._images[t]?this._images[t].frameData.total:0},getText:function(t){return this._text[t]?this._text[t].data:void console.warn('Phaser.Cache.getText: Invalid key: "'+t+'"')},getJSON:function(t){return this._json[t]?this._json[t].data:void console.warn('Phaser.Cache.getJSON: Invalid key: "'+t+'"')},getXML:function(t){return this._xml[t]?this._xml[t].data:void console.warn('Phaser.Cache.getXML: Invalid key: "'+t+'"')},getBinary:function(t){return this._binary[t]?this._binary[t]:void console.warn('Phaser.Cache.getBinary: Invalid key: "'+t+'"')},getUrl:function(t){return this._urlMap[this._resolveUrl(t)]?this._urlMap[this._resolveUrl(t)]:void console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'"')},addSpineAnimation:function(t,e,i){this._spineAnimations[t]={url:e,data:i},this._urlMap[this._resolveUrl(e)]=this._spineAnimations[t]},checkSpineAnimation:function(t){return this.checkKey(Phaser.Cache.SPINEANIM,t)},getSpineAnimation:function(t){return this._spineAnimations[t]?this._spineAnimations[t].data:void console.warn('Phaser.Cache.getSPINEANIM: Invalid key: "'+t+'"')},removeSpineAnimation:function(t){delete this._spineAnimations[t]},getKeys:function(t){var e=null;switch(t){case Phaser.Cache.CANVAS:e=this._canvases;break;case Phaser.Cache.IMAGE:e=this._images;break;case Phaser.Cache.TEXTURE:e=this._textures;break;case Phaser.Cache.SOUND:e=this._sounds;break;case Phaser.Cache.TEXT:e=this._text;break;case Phaser.Cache.PHYSICS:e=this._physics;break;case Phaser.Cache.TILEMAP:e=this._tilemaps;break;case Phaser.Cache.BINARY:e=this._binary;break;case Phaser.Cache.BITMAPDATA:e=this._bitmapDatas;break;case Phaser.Cache.BITMAPFONT:e=this._bitmapFont;break;case Phaser.Cache.JSON:e=this._json;break;case Phaser.Cache.XML:e=this._xml;break;case Phaser.Cache.SPINEANIM:e=this._spineAnimations}if(e){var i=[];for(var n in e)"__default"!==n&&"__missing"!==n&&i.push(n);return i}},removeCanvas:function(t){delete this._canvases[t]},removeImage:function(t,e){"undefined"==typeof e&&(e=!0),delete this._images[t],e&&PIXI.BaseTextureCache[t].destroy()},removeSound:function(t){delete this._sounds[t]},removeText:function(t){delete this._text[t]},removeJSON:function(t){delete this._json[t]},removeXML:function(t){delete this._xml[t]},removePhysics:function(t){delete this._physics[t]},removeTilemap:function(t){delete this._tilemaps[t]},removeBinary:function(t){delete this._binary[t]},removeBitmapData:function(t){delete this._bitmapDatas[t]},removeBitmapFont:function(t){delete this._bitmapFont[t]},_resolveUrl:function(t){return this._urlResolver.src=this.game.load.baseURL+t,this._urlTemp=this._urlResolver.src,this._urlResolver.src="",this._urlTemp},destroy:function(){for(var t in this._canvases)delete this._canvases[t];for(var t in this._images)"__default"!==t&&"__missing"!==t&&delete this._images[t];for(var t in this._sounds)delete this._sounds[t];for(var t in this._text)delete this._text[t];for(var t in this._json)delete this._json[t];for(var t in this._xml)delete this._xml[t];for(var t in this._textures)delete this._textures[t];for(var t in this._physics)delete this._physics[t];for(var t in this._tilemaps)delete this._tilemaps[t];for(var t in this._binary)delete this._binary[t];for(var t in this._bitmapDatas)delete this._bitmapDatas[t];for(var t in this._bitmapFont)delete this._bitmapFont[t];for(var t in this._spineAnimations)delete this._spineAnimations[t];this._urlMap=null,this._urlResolver=null,this._urlTemp=null}},Phaser.Cache.prototype.constructor=Phaser.Cache}),define("gt/managers/SpritesheetManager",["bottom_line"],function(t){function e(localizationManager,game,bootInfo){this.sprites={},this._localizationManager=localizationManager,this._game=game,this._bootInfo=bootInfo}return t.extend(e.prototype,{init:function(){console.log("SpritesheetManager.init");var platform=device.getPlatformString(),t=this._bootInfo.spritesheets[platform];return t._.each(function(t,e){t.files._.each(function(t){if(!t._.has("loader")){var i=t._.before("."),n="atlases"!==e?e+"_"+i:i;(!i._.has("localization")||i._.has(this._localizationManager.language))&&this.add(n)}},this)},this),this},add:function(t){console.log("SpritesheetManager.add ("+t+")"),t=t._.before(".")||t;var e=this._game.cache.getFrameData(t);return this[t]=e,e._frames._.each(function(e){this.sprites[e.name]&&this.sprites[e.name].spritesheet!==t?console.warn("duplicate key: "+e.name+" in spritesheet: "+t+". Image keys should be unique"):this.sprites[e.name]={spritesheet:t,data:e}},this),this},remove:function(t){t=t._.before(".");var e=this._game.cache.getFrameData(t);e._frames._.each(function(t){delete this.sprites[t.name]},this),delete this[t],this._game.cache.removeImage(t)}}),e}),define("gt/gui/Image",["bottom_line","phaser","settings","gt/managers/SpritesheetManager","gt/tweaks/Phaser/ScaleManager","gt/math/ScalePoint","gt/math/GlobalPosition"],function(t,e,settings,i,n,s,r){function o(t,e,i,n,a,h){var l=n,c=i||game.spritesheets.sprites[l].spritesheet;o._super.constructor.call(this,game,t,e,c,l),this.id=a,this.scaler=new s(this.scale),this.global=new r(this);var u=null;game.spritesheets&&game.spritesheets[c]&&(u=game.spritesheets[c]),game.scale.updateElement(this,u,game.viewport,h)}return t.inherit(o,e.Image),t.extend(o,{factoryName:"image"}),t.extend(o.prototype,{init:function(t,e){this.x=t,this.y=e},get scalar(){return this.scaler.x},set scalar(t){this.scaler.set(t)},revive:function(){return o._super.revive.call(this),this.init.apply(this,arguments),this}}),o}),define("gt/gui/Placeholder",["bottom_line","phaser","settings","gt/math/GlobalPosition"],function(t,e,settings,i){function n(t,e,s){n._super.constructor.call(this,game,t,e),this.x=s.x,this.y=s.y,this.dimensions=new Phaser.Rectangle(this.x,this.y,s.width,s.height),this.id=s.name,this.angle=-s.rotation,this.visible=s.visible,this.anchor={x:s.anchorX,y:1-s.anchorY},this.global=new i(this)}return t.inherit(n,e.Group),t.extend(n,{factoryName:"placeholder"}),t.extend(n.prototype,{enumerable:!1},{add:function(t,e){return e===!0&&this._reset(t),n._super.add.call(this,t),t},set:{overrideaction:"ignore",value:function(t){return this.clear(),this.add(t)}},project:function(t){t.x=this.x,t.y=this.y,t.angle=this.angle},clear:function(){this.removeAll(!1,!0)},_reset:function(t){t.x=0,t.y=0,t.angle=0}}),n}),define("gt/gui/ButtonGroup",["bottom_line","phaser","settings"],function(t,e,settings){function i(t,e,n){i._super.constructor.call(this,game,t,e),this.x=n.x,this.y=n.y,this.dimensions={width:n.width,height:n.height},this.id=n.name,this.visible=n.visible,this.button=null,this.label=null,this.icon=null}return t.inherit(i,e.Group),t.extend(i,{factoryName:"buttonGroup"}),t.extend(i.prototype,{get scalar(){return this.button.scaler.x},set scalar(t){this.button.scaler.set(t);for(var e=0;e<this.children.length;e++)this.children[e].scaler&&this.children[e].scaler.set(t)},get callbackFnc(){return this.button.callbackFnc},get callbackCont(){return this.button.callbackCont},addButton:function(t){return this.add(t),this.button=t,this},addLabel:function(t){return this.add(t),this.label=t,this},addIcon:function(t){return this.add(t),this.icon=t,this},setVisible:function(t){this.visible=t,this.button.setVisible(t);for(var e=0;e<this.children.length;e++)this.children[e].visible=t;return this},setActive:function(t){return this.button.setActive(t),this},setCallback:function(t,e,i){return this.button.setCallback(t,e,i),this},removeCallback:function(){this.button.callback=null,this.button.callbackFnc=null,this.button.callbackCont=null},onInputUpHandler:function(t,e,i){this.button.onInputUpHandler(t,e,i)},setText:function(t){return this.label.setText(t),this},setStyle:function(t){return this.label.setStyle(t),this}}),i}),define("gt/gui/ProgressBar",["bottom_line"],function(t){function e(t,e,i,n){n=n||{},this.start=t,this.fill=e,this.end=i,this.direction=t.y===i.y?"horizontal":"vertical",this.size="horizontal"===this.direction?this.end.x-this.start.x:this.start.y-this.end.y,this.init(n.max,n.reverse)}return t.extend(e,{factoryName:"progressbar"}),t.extend(e.prototype,{enumerable:!1},{init:function(t,e){this.max=t||100,this.current=e?this.max:0,this.reverse=!!e,this._updateFill()},update:function(t){t=t||1,this.reverse&&(t=-t),this.current+=t,this._updateFill()},set:function(t){this.current=t,this._updateFill()},_updateFill:function(){this.current._.bound(0,this.max),"horizontal"===this.direction?(this.fill.width=this.current/this.max*this.size,this.end.x=Math.floor(this.fill.x+this.fill.width)):(this.fill.height=this.current/this.max*this.size,this.end.y=Math.ceil(this.fill.y-this.fill.height))}}),e}),define("factories/GameObjects",["bottom_line","phaser","gt/gui/Image","gt/gui/Sprite","gt/gui/Placeholder","gt/gui/ButtonGroup","gt/gui/ProgressBar"],function(t,e){var i=function(t,e){var i;return t.pool?i=t.rescue.apply(t,e):(i=Object.create(t.prototype),t.apply(i,e)),i},n=function(t,n){var s=n||t.factoryName||t.className;s&&(e.GameObjectCreator.prototype[s._.decapitalize()]=function(){return i(t,arguments)})};t.extend(e.GameObjectCreator.prototype,{add:n});for(var s=2;s<arguments.length;s++)n(arguments[s]);return e.GameObjectCreator}),define("gt/rendering/filters/BlurX",["bottom_line","phaser","settings"],function(t,e,settings){function i(game){e.Filter.call(this,game),this.uniforms.blur={type:"1f",value:1/512},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"]}return e.Filter.BlurX=i,t.inherit(i,e.Filter),t.extend(i.prototype,{enumerable:!1},{get blur(){return this.uniforms.blur.value/(1/7e3)},set blur(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),i}),define("gt/rendering/filters/BlurY",["bottom_line","phaser","settings"],function(t,e,settings){function i(game){e.Filter.call(this,game),this.uniforms.blur={type:"1f",value:1/512},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","gl_FragColor = sum;","}"]}return e.Filter.BlurY=i,t.inherit(i,e.Filter),t.extend(i.prototype,{enumerable:!1},{get blur(){return this.uniforms.blur.value/(1/7e3)},set blur(t){this.dirty=!0,this.uniforms.blur.value=1/7e3*t}}),i}),define("gt/rendering/filters/Blur",["bottom_line","phaser","settings","gt/rendering/filters/BlurX","gt/rendering/filters/BlurY"],function(t,e,settings,i,n){function s(){this.blurXFilter=new i,this.blurYFilter=new n,this.passes=[this.blurXFilter,this.blurYFilter]}return e.Filter.Blur=s,t.inherit(s,e.Filter),t.extend(s.prototype,{enumerable:!1},{get blur(){return this.blurXFilter.blur},set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t},get blurX(){return this.blurXFilter.blur},set blurX(t){this.blurXFilter.blur=t},get blurY(){return this.blurYFilter.blur},set blurY(t){this.blurYFilter.blur=t}}),s}),define("gt/rendering/filters/Glow",["bottom_line","phaser","settings"],function(t,e,settings){function i(game){e.Filter.call(this,game),this.uniforms.glow={type:"1f",value:.03},this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float     glow;","void main() {","vec4 sum = vec4(0);","vec2 texcoord = vTextureCoord;","for(int xx = -4; xx <= 4; xx++) {","for(int yy = -3; yy <= 3; yy++) {","float dist = sqrt(float(xx*xx) + float(yy*yy));","float factor = 0.0;","if (dist == 0.0) {","factor = 2.0;","} else {","factor = 2.0/abs(float(dist));","}","sum += texture2D(uSampler, texcoord + vec2(xx, yy) * 0.002) * factor;","}","}","gl_FragColor = sum * glow + texture2D(uSampler, texcoord);","}"]}return e.Filter.Glow=i,t.inherit(i,e.Filter),t.extend(i.prototype,{enumerable:!1},{get glow(){return this.uniforms.glow.value},set glow(t){this.uniforms.glow.value=t}}),i}),function(t){"use strict";function e(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1}t.version="0.7.0";var i=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,n=/,/,s=/^\s*(_?)(\S+?)\1\s*$/,r=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;t.InjectorError={MAPPING_BAD_PROP:"[Error infuse.Injector.mapClass/mapValue] the first parameter is invalid, a string is expected",MAPPING_BAD_VALUE:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, it can't null or undefined, with property: ",MAPPING_BAD_CLASS:"[Error infuse.Injector.mapClass/mapValue] the second parameter is invalid, a function is expected, with property: ",MAPPING_BAD_SINGLETON:"[Error infuse.Injector.mapClass] the third parameter is invalid, a boolean is expected, with property: ",MAPPING_ALREADY_EXISTS:"[Error infuse.Injector.mapClass/mapValue] this mapping already exists, with property: ",CREATE_INSTANCE_INVALID_PARAM:"[Error infuse.Injector.createInstance] invalid parameter, a function is expected",NO_MAPPING_FOUND:"[Error infuse.Injector.getInstance] no mapping found",INJECT_INSTANCE_IN_ITSELF_PROPERTY:"[Error infuse.Injector.getInjectedValue] A matching property has been found in the target, you can't inject an instance in itself",INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR:"[Error infuse.Injector.getInjectedValue] A matching constructor parameter has been found in the target, you can't inject an instance in itself"};var o=function(t,e,i,n){this.prop=t,this.value=e,this.cl=i,this.singleton=n||!1},a=function(e){if("string"!=typeof e)throw new Error(t.InjectorError.MAPPING_BAD_PROP)},h=function(e,i){if(void 0===i||null===i)throw new Error(t.InjectorError.MAPPING_BAD_VALUE+e)},l=function(e,i){if("function"!=typeof i)throw new Error(t.InjectorError.MAPPING_BAD_CLASS+e)},c=function(e,i){if("boolean"!=typeof i)throw new Error(t.InjectorError.MAPPING_BAD_SINGLETON+e)},u=function(i,n){var s=t.getConstructorParams(n);if(e(s,i))throw new Error(t.InjectorError.INJECT_INSTANCE_IN_ITSELF_CONSTRUCTOR)},d=function(e,i){if(i.hasOwnProperty(e))throw new Error(t.InjectorError.INJECT_INSTANCE_IN_ITSELF_PROPERTY)};t.Injector=function(){this.mappings={},this.parent=null},t.getConstructorParams=function(t){function e(t,e,i){a.push(i)}var o,a=[];t.hasOwnProperty("inject")&&"[object Array]"===toString.call(t.inject)&&t.inject.length>0&&(o=t.inject);for(var h=t.toString().replace(r,""),l=h.match(i),c=l[1].split(n),u=0;u<c.length;u++){var d=o&&o[u]?o[u]:c[u];d.replace(s,e)}return a},t.Injector.prototype={createChild:function(){var injector=new t.Injector;return injector.parent=this,injector},getMappingVo:function(t){return this.mappings?this.mappings[t]?this.mappings[t]:this.parent?this.parent.getMappingVo(t):null:null},mapValue:function(e,i){if(this.mappings[e])throw new Error(t.InjectorError.MAPPING_ALREADY_EXISTS+e);return a(e),h(e,i),this.mappings[e]=new o(e,i,void 0,void 0),this},mapClass:function(e,i,n){if(this.mappings[e])throw new Error(t.InjectorError.MAPPING_ALREADY_EXISTS+e);return a(e),l(e,i),n&&c(e,n),this.mappings[e]=new o(e,null,i,n),this},removeMapping:function(t){return this.mappings[t]=null,delete this.mappings[t],this},hasMapping:function(t){return!!this.mappings[t]},hasInheritedMapping:function(t){return!!this.getMappingVo(t)},getMapping:function(t){for(var e in this.mappings)if(this.mappings.hasOwnProperty(e)){var i=this.mappings[e];if(i.value===t||i.cl===t)return i.prop}},getValue:function(e){var i=this.mappings[e];if(!i){if(this.parent)return this.parent.getValue.apply(this.parent,arguments);throw new Error(t.InjectorError.NO_MAPPING_FOUND)}if(i.cl){var n=Array.prototype.slice.call(arguments);return n[0]=i.cl,i.singleton?(i.value||(i.value=this.createInstance.apply(this,n)),i.value):this.createInstance.apply(this,n)}return i.value},getClass:function(t){var e=this.mappings[t];return e?e.cl?e.cl:void 0:this.parent?this.parent.getClass(t):void 0},instantiate:function(e){if("function"!=typeof e)throw new Error(t.InjectorError.CREATE_INSTANCE_INVALID_PARAM);for(var i=[null],n=t.getConstructorParams(e),s=0;s<n.length;s++)if(void 0!==arguments[s+1]&&null!==arguments[s+1])i.push(arguments[s+1]);else{var r=n[s],o=this.getMappingVo(r);if(o){var a=this.getInjectedValue(o,r);i.push(a)}else i.push(void 0)}return new(Function.prototype.bind.apply(e,i))},inject:function(t,e){this.parent&&this.parent.inject(t,!0);for(var i in this.mappings)if(this.mappings.hasOwnProperty(i)){var n=this.getMappingVo(i);(t.hasOwnProperty(n.prop)||t.constructor&&t.constructor.prototype&&t.constructor.prototype.hasOwnProperty(n.prop))&&(t[i]=this.getInjectedValue(n,i))}return"function"!=typeof t.postConstruct||e||t.postConstruct(),this},getInjectedValue:function(t,e){var i,n=t.value;return t.cl&&(t.singleton?(t.value||(u(e,t.cl),t.value=this.instantiate(t.cl),i=t.value),n=t.value):(u(e,t.cl),n=this.instantiate(t.cl),i=n)),i&&(d(e,i),this.inject(i)),n},createInstance:function(){var instance=this.instantiate.apply(this,arguments);return this.inject(instance),instance},getValueFromClass:function(e){for(var i in this.mappings)if(this.mappings.hasOwnProperty(i)){var n=this.mappings[i];if(n.cl===e)return n.singleton?(n.value||(n.value=this.createInstance.apply(this,arguments)),n.value):this.createInstance.apply(this,arguments)}if(this.parent)return this.parent.getValueFromClass.apply(this.parent,arguments);throw new Error(t.InjectorError.NO_MAPPING_FOUND)},dispose:function(){this.mappings={}}},Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new Error("Error, you must bind a function.");var i=Array.prototype.slice.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=e.prototype;var r=new s,o=e.apply(r,i.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:r}return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))};return n}),"function"==typeof define&&"undefined"!=typeof define.amd&&define("infuse",t),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=t),"undefined"!=typeof exports&&(exports=t)}(this.infuse=this.infuse||{}),function(t){"use strict";t.SINGLETON=!0,t.events={},t.events.version="0.5.6",Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;if("function"!=typeof e)throw new Error("Error, you must bind a function.");var i=Array.prototype.slice.call(arguments,1),n=function(){if(this instanceof n){var s=function(){};s.prototype=e.prototype;var r=new s,o=e.apply(r,i.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:r}return e.apply(t,i.concat(Array.prototype.slice.call(arguments)))};return n}),t.Event=function(e,i,n,s){var r=t.Event.createGenericEvent(e,n,s);return null!==i&&void 0!==i&&(r.params=i),r.isCloned=!1,r.clone=this.clone.bind(r),r.isIE9orIE10=this.isIE9orIE10,r.isDefaultPrevented=this.isDefaultPrevented,(this.isIE9orIE10()||!r.preventDefault||void 0===r.getDefaultPrevented&&void 0===r.defaultPrevented)&&(r.preventDefault=this.preventDefault.bind(r)),this.isIE9orIE10()&&(r.IE9or10PreventDefault=!1),r},t.Event.prototype.clone=function(){var e=t.Event.createGenericEvent(this.type,this.bubbles,this.cancelable);return e.params=this.params,e.isCloned=!0,e.clone=this.clone,e.isDefaultPrevented=this.isDefaultPrevented,e.isIE9orIE10=this.isIE9orIE10,this.isIE9orIE10()&&(e.IE9or10PreventDefault=this.IE9or10PreventDefault),e},t.Event.prototype.preventDefault=function(){return this.cancelable?(this.isIE9orIE10()?this.IE9or10PreventDefault=!0:this.defaultPrevented=!0,this):!1},t.Event.prototype.isDefaultPrevented=function(){return this.cancelable?this.isIE9orIE10()?this.IE9or10PreventDefault:void 0!==this.defaultPrevented?this.defaultPrevented:void 0!==this.getDefaultPrevented?this.getDefaultPrevented():!1:!1},t.Event.createGenericEvent=function(t,i,n){var s;return i=void 0!==i?i:!0,"object"==typeof document&&document.createEvent?(s=document.createEvent("Event"),s.initEvent(t,!!i,!!n)):"object"==typeof document&&document.createEventObject?(s=document.createEventObject(),s.type=t,s.bubbles=!!i,s.cancelable=!!n):s=new e(t,!!i,!!n),s},t.Event.prototype.isIE9orIE10=function(){return"object"!=typeof document?!1:void 0!==document.body.style.scrollbar3dLightColor&&void 0!==document.body.style.opacity||void 0!==document.body.style.msTouchAction},t.Event.prototype.toString=function(){return"[soma.Event]"};var e=function(t,e,i){this.type=t,this.bubbles=!!e,this.cancelable=!!i,this.defaultPrevented=!1,this.currentTarget=null,this.target=null};t.EventDispatcher=function(){this.listeners=[]},t.EventDispatcher.prototype.addEventListener=function(t,e,i){if(this.listeners&&t&&e){isNaN(i)&&(i=0);for(var n=0;n<this.listeners.length;n++){var s=this.listeners[n];if(s.type===t&&s.listener===e)return}this.listeners.push({type:t,listener:e,priority:i,scope:this})}},t.EventDispatcher.prototype.removeEventListener=function(t,e){if(this.listeners&&t&&e)for(var i=this.listeners.length;i-- >0;){
var n=this.listeners[i];n.type===t&&n.listener===e&&this.listeners.splice(i,1)}},t.EventDispatcher.prototype.hasEventListener=function(t){if(!this.listeners||!t)return!1;for(var e=0,i=this.listeners.length;i>e;++e){var n=this.listeners[e];if(n.type===t)return!0}return!1},t.EventDispatcher.prototype.dispatchEvent=function(t){if(!this.listeners||!t)throw new Error("Error in EventDispatcher (dispatchEvent), one of the parameters is null or undefined.");var e,i=[];for(e=0;e<this.listeners.length;e++){var n=this.listeners[e];n.type===t.type&&i.push(n)}for(i.sort(function(t,e){return e.priority-t.priority}),e=0;e<i.length;e++)i[e].listener.apply(t.srcElement?t.srcElement:t.currentTarget,[t]);return!t.isDefaultPrevented()},t.EventDispatcher.prototype.dispatch=function(e,i,n,s){if(!this.listeners||!e||""===e)throw new Error("Error in EventDispatcher (dispatch), one of the parameters is null or undefined.");var r=new t.Event(e,i,n,s);return this.dispatchEvent(r),r},t.EventDispatcher.prototype.dispose=function(){this.listeners=null},t.EventDispatcher.prototype.toString=function(){return"[soma.EventDispatcher]"},"function"==typeof define&&"undefined"!=typeof define.amd&&define("soma-events",t),"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports=t),"undefined"!=typeof exports&&(exports=t)}(this.soma=this.soma||{}),function(t,e){"use strict";t.version="2.1.1",t.applyProperties=function(t,e,i,n){if("[object Array]"===Object.prototype.toString.apply(n))for(var s=0,r=n.length;r>s;s++)(void 0===t[n[s]]||null===t[n[s]])&&(i&&"function"==typeof e[n[s]]?t[n[s]]=e[n[s]].bind(e):t[n[s]]=e[n[s]]);else for(var o in e)i&&"function"==typeof e[o]?t[o]=e[o].bind(e):t[o]=e[o]},t.augment=function(t,e,i){if(e.prototype&&t.prototype)if("[object Array]"===Object.prototype.toString.apply(i))for(var n=0,s=i.length;s>n;n++)t.prototype[i[n]]||(t.prototype[i[n]]=e.prototype[i[n]]);else for(var r in e.prototype)t.prototype[r]||(t.prototype[r]=e.prototype[r])},t.inherit=function(e,i){var n;n=i&&i.hasOwnProperty("constructor")?i.constructor:function(){return e.apply(this,arguments)};var s=function(){};return s.prototype=e.prototype,n.prototype=new s,i&&t.applyProperties(n.prototype,i),n.prototype.constructor=n,n.parent=e.prototype,n.extend=function(e){return t.inherit(n,e)},n},t.extend=function(e){return t.inherit(function(){},e)};var i=[];t.plugins=t.plugins||{},t.plugins.add=function(t){i.push(t)},t.plugins.remove=function(t){for(var e=i.length-1,n=0;e>=n;e--)t===i[e]&&i.splice(e,1)},t.Application=t.extend({constructor:function(){function r(){o.injector=new e.Injector(o.dispatcher),o.dispatcher=new t.EventDispatcher,o.injector.mapValue("injector",o.injector),o.injector.mapValue("instance",o),o.injector.mapValue("dispatcher",o.dispatcher),o.injector.mapClass("mediators",n,!0),o.mediators=o.injector.getValue("mediators"),o.injector.mapClass("commands",s,!0),o.commands=o.injector.getValue("commands");for(var r=0,a=i.length;a>r;r++)o.createPlugin(i[r])}var o=this;r.bind(this)(),this.init(),this.start()},createPlugin:function(){if(0===arguments.length||!arguments[0])throw new Error("Error creating a plugin, plugin class is missing.");for(var t=e.getConstructorParams(arguments[0]),i=[arguments[0]],n=0,s=t.length;s>n;n++)this.injector.hasMapping(t[n])||this.injector.hasInheritedMapping(t[n])?i.push(this.injector.getValue(t[n])):i.push(void 0);var r=i.length-1;for(i.length;r>=0&&"undefined"==typeof i[r];r--)i.splice(r,1);for(var o=1,a=arguments.length;a>o;o++)i.push(arguments[o]);return this.injector.createInstance.apply(this.injector,i)},init:function(){},start:function(){},dispose:function(){this.injector&&(this.injector.removeMapping("injector"),this.injector.removeMapping("dispatcher"),this.injector.removeMapping("mediators"),this.injector.removeMapping("commands"),this.injector.removeMapping("instance")),this.injector&&this.injector.dispose(),this.dispatcher&&this.dispatcher.dispose(),this.mediators&&this.mediators.dispose(),this.commands&&this.commands.dispose(),this.injector=void 0,this.dispatcher=void 0,this.mediators=void 0,this.commands=void 0,this.instance=void 0}});var n=t.extend({constructor:function(){this.injector=null,this.dispatcher=null},create:function(t,e){if(!t||"function"!=typeof t)throw new Error("Error creating a mediator, the first parameter must be a function.");if(void 0===e||null===e)throw new Error("Error creating a mediator, the second parameter cannot be undefined or null.");var i=[],n=[];e.length>0?i=e:i.push(e);for(var s=0,r=i.length;r>s;s++){var injector=this.injector.createChild();injector.mapValue("target",i[s]);var o=injector.createInstance(t);if(1===i.length)return o;n.push(o)}return n},dispose:function(){this.injector=void 0,this.dispatcher=void 0}}),s=t.extend({constructor:function(){this.boundHandler=this.handler.bind(this),this.dispatcher=null,this.injector=null,this.list={}},has:function(t){return null!==this.list[t]&&void 0!==this.list[t]},get:function(t){return this.has(t)?this.list[t]:void 0},getAll:function(){var t={};for(var e in this.list)this.list.hasOwnProperty(e)&&(t[e]=this.list[e]);return t},add:function(t,e){if("string"!=typeof t)throw new Error("Error adding a command, the first parameter must be a string.");if("function"!=typeof e)throw new Error('Error adding a command with the name "'+e+'", the second parameter must be a function, and must contain an "execute" public method.');if(this.has(t))throw new Error('Error adding a command with the name: "'+t+'", already registered.');this.list[t]=e,this.addInterceptor(t)},remove:function(t){this.has(t)&&(this.list[t]=void 0,delete this.list[t],this.removeInterceptor(t))},addInterceptor:function(t){this.dispatcher.addEventListener(t,this.boundHandler,-Number.MAX_VALUE)},removeInterceptor:function(t){this.dispatcher.removeEventListener(t,this.boundHandler)},handler:function(t){t.isDefaultPrevented&&!t.isDefaultPrevented()&&this.executeCommand(t)},executeCommand:function(t){var e=t.type;if(this.has(e)){var i=this.injector.createInstance(this.list[e]);if(!i.hasOwnProperty("execute")&&"function"===i.execute)throw new Error("Error in "+this+" Command "+i+" must contain an execute public method.");i.execute(t)}},dispose:function(){for(var t in this.list)this.list.hasOwnProperty(t)&&this.remove(t);this.boundHandler=void 0,this.dispatcher=void 0,this.injector=void 0,this.list=void 0}});t.EventDispatcher.extend=function(e){return t.inherit(t.EventDispatcher,e)},t.Event.extend=function(e){return t.inherit(t.Event,e)},e.Injector.extend=function(i){return t.inherit(e.Injector,i)},"function"==typeof define&&"undefined"!=typeof define.amd&&define("soma",t),"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t:window.soma=t}(this.soma=this.soma||{},this.infuse),define("gt/utils/orientation",["bottom_line","settings","gt/utils/device"],function(t,settings,e){var i={desired:null,current:window.innerWidth>window.innerHeight?"landscape":"portrait",onchange:t.wrap(function(){i.current=window.innerWidth>window.innerHeight?"landscape":"portrait"})};i.calculateCurrent=function(){return window.innerWidth>window.innerHeight?"landscape":"portrait"},window.on("orientationchange",i.onchange,!1),window.on("resize",i.onchange,!1);var n=settings.orientations;return i.desired=e.desktop?n.desktop:n.mobile||n.tablet||n.portable,i.desired="both"===i.desired?i.current:i.desired,i}),define("gt/utils/Chainable",[],function(){var t=function(t,e){this.func=t||null,this.context=e||null,this.previous=null,this.args=Array.prototype.slice.call(arguments),this.args.splice(0,2),this.nextFunc=null};return t.prototype.then=function(e,i){return this.nextFunc=Object.create(t.prototype),t.apply(this.nextFunc,arguments),this.nextFunc.previous=this,this.nextFunc},t.prototype.execute=function(){if(this.previous){var t=this.previous;return this.previous=null,void t.execute()}if(this.func){var e=this.args.slice();e.unshift(this.executeNext,this),this.func.apply(this.context,e)}else this.executeNext()},t.prototype.executeNext=function(){this.nextFunc.execute()},t}),define("gt/utils/StringUtil",[],function(){var t={};return t.csvToArray=function(t){var e=/^\s*(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,"\s\\]*(?:\s+[^,"\s\\]+)*)\s*(?:,\s*(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*"|[^,"\s\\]*(?:\s+[^,"\s\\]+)*)\s*)*$/,i=/(?!\s*$)\s*(?:"([^"\\]*(?:\\[\S\s][^"\\]*)*)"|([^,"\s\\]*(?:\s+[^,"\s\\]+)*))\s*(?:,|$)/g;if(!e.test(t))return console.warn("CSVtoArray: Invalid csv text.\n\nSee http://stackoverflow.com/questions/8493195/how-can-i-parse-a-csv-string-with-javascript for help."),console.warn(t),null;var n=[];return t.replace(i,function(t,e,i,s){return void 0!==e&&""!==e?n.push(e.replace(/\\'/g,"'")):void 0!==i&&""!==i?n.push(i.replace(/\\"/g,'"')):void 0!==s&&""!==s&&n.push(s),""}),/,\s*$/.test(t)&&n.push(""),n},t.format=function(){for(var t=arguments[0],e=1;e<arguments.length;e++){var i=new RegExp("\\{"+(e-1)+"\\}","gm");t=t.replace(i,arguments[e])}return t},t.toMMSS=function(e){var i=Math.floor(e/60)%60,n=Math.floor(e)%60;return t.pad(i,2)+":"+t.pad(n,2)},t.pad=function(t,e){for(var i=t+"";i.length<e;)i="0"+i;return i},t}),define("gt/localization/LocalizationManager",["bottom_line","settings","gt/utils/StringUtil","gt/extras/ajax","gt/utils/device"],function(t,settings,e,i,n){var s=function(){console.log("LocalizationManager.ctor"),this.defaultLanguage="en",this.localization={},this.missingStrings={},this.debugMode=!1};return s.prototype.load=function(t,n,s){var r=this;i("assets/loc/"+t+".csv").then(function(i){for(var o=i.split("\n"),a=0;a<o.length;a++){var h=e.csvToArray(o[a]);h&&h[0]&&h[1]?(r.put(h[0],h[1]),h[2]&&console.log("Comment on key: "+h[0]+"\n -- "+h[2])):console.warn("Found dud line in "+t+".csv on line "+(a+1)+". Source: "+o[a])}r.language=t,n&&n.call(s)},function(e){t!=r.defaultLanguage?(console.warn("Language '"+t+"' not found. Loading '"+r.defaultLanguage+"' instead. Error: "+e.message),r.load(r.defaultLanguage,n,s)):console.error("Unable to load any language file.")})},s.prototype.get=function(t){if(void 0===this.language)return console.error("Language not yet loaded, exiting"),null;n.desktop&&this.localization[t+"_PC"]&&(t+="_PC");var i=this.localization[t],s=i;if(!i)return this.missing(t),null;if(0!==arguments.length){var r=Array.prototype.slice.call(arguments);r.splice(0,1,i),s=e.format.apply(this,r)}if(this.debugMode){for(var o=!1,a=0,h=s.split("");!o;)/\s/gi.test(h[a])||h.splice(a,1,"W"),a+=1,a>=h.length&&(o=!0);s=h.join("")}return s},s.prototype.put=function(t,e){this.localization[t]=e},s.prototype.missing=function(t){this.missingStrings[t]=t},s}),define("gt/storage/StorageManager",["bottom_line","settings","gt/utils/browser"],function(t,settings,e){var i=function(gameConfig){console.log("StorageManager.ctor"),this._gameConfig=gameConfig,this._storage={},window.addEventListener("message",function(t){this.handleMessage(t)}.bind(this),!1),window.parent.postMessage({command:"init"},"*"),this.canWriteToLocalStorage=!0};return i.prototype.clear=function(){for(var t in this._storage)t._.startsWith(this._gameConfig.storagePrefix)&&delete this._storage[t]},i.prototype.serialize=function(t){var e,i,n={},s=t||{};for(var r in this._storage)if(r._.startsWith(this._gameConfig.storagePrefix)){e=r._.after("_"),i=!0;for(var o in s)if(this.getProperty(e,o)!==s[o]){i=!1;break}i&&(n[e]=this.get(e))}return n},i.prototype.set=function(t,e,i){return i&&(e=this.getProperty(t,"compare")(e,this.get(t))),this._storage[this._gameConfig.storagePrefix+t]=e,this._writeToStorage(),e},i.prototype.get=function(t,e){var i=e!==!1,n=this._storage[this._gameConfig.storagePrefix+t];return i&&(void 0===n&&(n=this.getProperty(t,"default")),"string"!==this.getProperty(t,"type")&&(n=this.convert(n))),n},i.prototype.getProperty=function(t,e){var i;for(var n in settings.storage)if(n===t||n._.startsWith("^")&&t._.startsWith(n._.after("^"))||n._.endsWith("$")&&t._.endsWith(n._.before("$"))){i=settings.storage[n];break}var s=i&&i[e];switch(e){case"save":return s!==!1;case"compare":return s||function(t,e){return t};default:return s}},i.prototype.convert=function(t){try{t=JSON.parse(t)}catch(e){}return t},i.prototype.each=function(t,e){for(var i in this._storage)if(i._.startsWith(this._gameConfig.storagePrefix)&&t.call(e,this._storage[i],i._.after(this._gameConfig.storagePrefix))===!1)break},i.prototype.find=function(t,e){var i;return this.each(function(n,s){return t.call(e,n,s)?(i=n,!1):void 0}),i},i.prototype.loadSaveData=function(){this._portSaveData();var t=localStorage[this._gameConfig.storagePrefix+"gameData"];this._processLoadedData(t),this.useParentWindowCommunication&&window.parent.postMessage({command:"getItem",key:this._gameConfig.storagePrefix+"gameData"},"*")},i.prototype.handleMessage=function(t){var e=t.data,i=e.command;"init"===i?this.useParentWindowCommunication="ok"===e.result:"getItem"===i&&this._processLoadedData(e.value)},i.prototype._writeToStorage=function(){if(this.canWriteToLocalStorage)try{var t=JSON.stringify(this._storage),e=btoa(t);localStorage[this._gameConfig.storagePrefix+"gameData"]=e,this.useParentWindowCommunication&&window.parent.postMessage({command:"setItem",key:this._gameConfig.storagePrefix+"gameData",value:e},"*")}catch(i){this.canWriteToLocalStorage=!1}},i.prototype._portSaveData=function(){for(var t in localStorage)t._.startsWith(this._gameConfig.storagePrefix)&&-1===t.indexOf("gameData")&&(this._storage[t]=localStorage[t],delete localStorage[t])},i.prototype._processLoadedData=function(t){if(t){var e=atob(t);this._storage=JSON.parse(e)}},i}),define("gt/utils/GameConfigUtil",[],function(){var t={};return t.selectConfigBasedOnReferrer=function(t){var e=decodeURIComponent((new RegExp("[?|&]utm_referrer=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null,i=t["default"];if(e&&t[e])for(var n in t[e])i[n]=t[e][n];return i.client=e,Object.freeze(i),i},t}),define("gt/constants/ConsoleCSS",[],function(){var t={};return t.MODULE_TAG="background: #00289b; color: #ffff00",t.MODULE_TEXT="background: #4674e7; color: #ffff00",t}),define("gt/resources/ResourceType",[],function(){var t={};return t.AUDIO="audio",t.JSON="json",t.ATLAS="atlas",t.BITMAP_FONT="bitmapFont",t.TTF_FONT="ttfFont",t}),define("gt/resources/LoadInfo",["phaser"],function(t){var e=function(i,n,s,r,o){this.key=i,this.url=n,this.resourceType=s,this.callback=r,this.context=o,this.progress=0,this.result=null,this.status=e.NOT_STARTED,this.completedEvent=new t.Signal};return e.NOT_STARTED="not_started",e.IN_PROGRESS="in_progress",e.COMPLETED="completed",e.prototype.startLoading=function(){console.log("Load '"+this.key+"' from '"+this.url+"'"),this.status=e.IN_PROGRESS,this.progress=0},e.prototype.finishLoading=function(t){console.log(" ...finished loading '"+this.key+"'."),this.result=t,this.status=e.COMPLETED,this.progress=1,this.callback.call(this.context,this),this.completedEvent.dispatch(this)},e}),define("gt/resources/ResourceManager",["gt/resources/ResourceType","gt/resources/LoadInfo"],function(t,e){var i=function(){console.log("ResourceManager.ctor"),this._loadInfos={},this._loaders={}};return i.prototype.addLoader=function(t){var e=t.resourceType;this._loaders[e]&&console.warn("ResourceManager is overriding loader for resource type "+e),this._loaders[e]=t},i.prototype.load=function(t,i,n,s,r){var o=this._loaders[n];if(!o)throw"ResourceManager doesn't have a loader for resource type "+n;var a=new e(t,i,n,s,r);return this._loadInfos[t]=a,o.load(a),a},i.prototype.get=function(t){var e=this._loadInfos[t];if(!e)throw"ResourceManager doesn't have key "+t;if(!e.result)throw"ResourceManager hasn't finished loading resource with key "+t;return e.result},i.prototype.loadFromManifest=function(t,e,i){throw"not implemented"},i}),define("gt/resources/ResourceLoader",[],function(){var t=function(t){this.resourceType=t};return t.prototype.load=function(t){throw"Not implemented. This is an abstract class, don't call this function."},t}),define("gt/resources/loaders/JsonLoader",["bottom_line","gt/resources/ResourceLoader","gt/resources/ResourceType","gt/resources/LoadInfo","gt/extras/ajax"],function(t,e,i,n,s){var r=function(){r._super.constructor.call(this,i.JSON),console.log("JsonLoader.ctor")};return t.inherit(r,e),r.prototype.load=function(t){t.startLoading(),s(t.url).then(function(e){t.finishLoading(e)})},r}),define("gt/partners/Platform",["bottom_line","gt/utils/Chainable","gt/utils/device"],function(t,e,i){"use strict";var n=function(gameConfig,injector){this._gameConfig=gameConfig,this._injector=injector,this._modules=[],this._lastAdTime=0};return n.prototype.initPartners=function(t,e){this._gameConfig.modules.forEach(function(t){this._modules.push(this._injector.getValue(t))},this),this._callOnAll("init",t,e)},n.prototype.sendDeviceAnalytics=function(e,n){console.log("Platform.sendDeviceAnalytics");var s=t.clone(i.info),r="device_"+s.device.type+"_"+s.os.name;r=r.toLowerCase().replace(" ","_"),s["browser.info"]=s.browser;var o=s.browser.version.split("."),a=o._.size(Math.min(o._.size(),3)).join(".");s["browser.version"]=a,s.browser=s.browser.name,s["browser.info"].engine=s.engine.name,s["browser.info"]["engine.version"]=s.engine.version,s["os.version"]=s.os.version,s.device.cpu=s.cpu.architecture,delete s.cpu,delete s.os,delete s.engine,this.analytics(r,s),e.call(n)},n.prototype._callOnAll=function(t,i,n){for(var s=this._modules[0],r=new e(s[t],s),o=1;o<this._modules.length;o++){var a=this._modules[o];r=r.then(a[t],a)}r=r.then(i,n),r.execute()},n.prototype._canShowAd=function(){if(this._gameConfig.ads===!1)return console.log("Ads off"),!1;var t=Date.now();return this._gameConfig.adTimeout&&t-this._lastAdTime<1e3*this._gameConfig.adTimeout?(console.log("Ad too soon"),!1):this._gameConfig.ads?!0:void 0},n.prototype.showAd=function(t,e){this._canShowAd()?(this._lastAdTime=Date.now(),this._callOnAll("showAd",t,e)):t.call(e)},n.prototype.resetAdTimer=function(){this._lastAdTime=Date.now()},n.prototype.score=function(t,i,n,s){for(var r=this._modules[0],o=new e(r.score,r,n,s),a=1;a<this._modules.length;a++){var h=this._modules[a];o=o.then(h.score,h,n,s)}o=o.then(t,i),o.execute()},n.prototype.analytics=function(t,e){var i=this._modifyAnalyticsData(e);this._modules.forEach(function(e){e.analytics(t,i)},this)},n.prototype._modifyAnalyticsData=function(e){var i="object"===t.typeOf(e)?e:{data:e};return i},n.prototype.moreGames=function(){this._callOnAll("moreGames",function(){},this)},n.prototype.award=function(t,i,n,s){for(var r=this._modules[0],o=new e(r.award,r,t,i),a=1;a<this._modules.length;a++){var h=this._modules[a];o=o.then(h.award,h,t,i)}o=o.then(n,s),o.execute()},n.prototype.loadUserData=function(t,e){this._callOnAll("loadUserData",t,e)},n.prototype.saveUserData=function(t,e){this._callOnAll("saveUserData",t,e)},n}),define("gt/partners/BasePartner",[],function(){"use strict";var t=function(gameConfig,storageManager){this._gameConfig=gameConfig,this._storageManager=storageManager,this.lastAdTime=0};return t.prototype.init=function(t,e){t.call(e)},t.prototype.loadUserData=function(t,e){t.call(e)},t.prototype.saveUserData=function(t,e){t.call(e)},t.prototype._addToIndex=function(t,e,i,n){var s=document.createElement("script");n&&(s.id=n),s.src=i,s.onload=function(){t.call(e)},document.body.appendChild(s)},t.prototype.showAd=function(t,e){t.call(e)},t.prototype.score=function(t,e,i,n){t.call(e)},t.prototype.analytics=function(t,e){},t.prototype._modifyAnalyticsData=function(t){var e="object"===_.typeOf(t)?t:{data:t};return e["bm.source"]=this.source,e},t.prototype.moreGames=function(){var t=this._gameConfig.moreGamesUrl||"http://coolgames.com";window.open(t,"_blank")},t.prototype.award=function(t,e,i,n){t.call(e)},t}),define("gt/partners/BoosterSdk",["bottom_line","gt/partners/BasePartner","gt/utils/orientation","gt/utils/Chainable"],function(t,e,i,n){"use strict";var s=function(gameConfig,storageManager){s._super.constructor.call(this,gameConfig,storageManager)};return s._instantiated=!1,t.inherit(s,e),s.prototype.init=function(t,e){console.assert(!s._instantiated,"Booster SDK should not already be created!!! This could be due to adding 2 modules that inherit from BoosterSDK to your partnerConfig"),new n(this._checkBoosterBarReady,this).then(this._configureSdk,this).then(t,e).execute()},s.prototype._configureSdk=function(t,e){if(!this._gameConfig.gameName||!this._gameConfig.gameCode)return void console.error("Game name and code not defined in gameConfig. Needs to be something like: \n	gameName : 'Dr. Atom & Quark: I do what i want'\n in your gameConfig.json");var n={splash:!0,addMetaTags:!1,orientation:i.desired,rotationImage:this._gameConfig.rotationImage,tabIcon:this._gameConfig.tabIcon,splashImage:this._gameConfig.splashImage};s._instantiated=!0,new Booster.Init(n);var r={position:this._gameConfig.tabPosition||1,gameCode:this._gameConfig.gameCode,rotationImage:this._gameConfig.rotationImage,tabIcon:this._gameConfig.tabIcon,splashImage:this._gameConfig.splashImage};this._community=new Booster.Community(r),this._moregames=new Booster.Moregames,this._ads=new Booster.Ad({type:"adsense",size:"300x250",channelID:this._gameConfig.client+"_"+this._gameConfig.gameCode+"_preroll"}),this._analytics=new Booster.Analytics({gameName:this._gameConfig.gameName,gameId:this._gameConfig.gameCode.replace(/_/g,"-"),gameCategory:this._gameConfig.gameCategory,developer:"0001",gameAnalyticsId:this._gameConfig.analyticsId}),t.call(e)},s.prototype._checkBoosterBarReady=function(t,e){if(this._boosterReady=window.Booster.__initialized,this._boosterReady)t.call(e);else{var i=this;Booster.ready=function(){i._boosterReady=!0,t.call(e)}}},s.prototype.showAd=function(t,e){this._ads.showAdvertising({callback:function(){t.call(e)}})},s.prototype.analytics=function(t,e){var i=["menu","score"];t=t.replace(/_/g,"-"),console.log("BoosterSdk.analytics ("+t+")");var n=Array.prototype.slice.call(arguments);n[1]=e._.toString();var s=[];n.forEach(function(t){s.push(t.replace(/_/g,"-"))}),this._analytics[i._.has(t)?t:"customEvent"].apply(this._analytics,s)},s.prototype.moreGames=function(){s._super.moreGames.call(this)},s}),define("gt/partners/BoosterWhiteLabel",["bottom_line","gt/partners/BoosterSdk"],function(t,e){"use strict";var i=function(gameConfig,storageManager){i._super.constructor.call(this,gameConfig,storageManager)};return t.inherit(i,e),i.prototype.score=function(t,e,i,n){this._community.submitScore({score:i,callback:function(){t.call(e)}})},i.prototype.moreGames=function(){this._moregames.redirect()},i}),define("gt/partners/Flurry",["bottom_line","gt/partners/BasePartner","gt/utils/Chainable"],function(t,e,i){"use strict";var n=function(gameConfig,storageManager){n._super.constructor.call(this,gameConfig,storageManager)};return t.inherit(n,e),n.prototype.init=function(t,e){new i(this._addToIndex,this,"https://cdn.flurry.com/js/flurry.js","flurry").then(this._configureSdk,this).then(t,e).execute()},n.prototype._configureSdk=function(t,e){if(this._flurry=window.FlurryAgent,!this._gameConfig.flurryId)return void console.error("Flurry Id not defined in gameConfig. Needs to be something like: \n\flurryId : XXXXXXX\n in your gameConfig.json");this._flurry.startSession(this._gameConfig.flurryId);var i=this._storageManager.get("user");i||(i=Date.now(),this._storageManager.set("user",i)),this._flurry.setUserId(i),this._flurry.setAppVersion(this._gameConfig.client),t.call(e)},n.prototype.analytics=function(t,e){var i={};for(var n in e){var s=e[n];i[n]=(s?s._.toString():s)+""}this._flurry.logEvent(t,i)},n}),define("gt/partners/Spil",["bottom_line","gt/partners/BasePartner","gt/utils/Chainable"],function(t,e,i){"use strict";var n=function(gameConfig,storageManager){n._super.constructor.call(this,gameConfig,storageManager),this._define=window.define};return t.inherit(n,e),n.prototype.init=function(t,e){window.define=null,new i(this._addToIndex,this,"http://cdn.gameplayer.io/api/js/game.js").then(this._addToIndex,this,"http://cdn.gameplayer.io/api/js/developer.js").then(this._configureSdk,this).then(t,e).execute()},n.prototype._configureSdk=function(t,e){return window.define=this._define,this._gameConfig.spilId?void GameAPI.loadAPI(function(){t.call(e)},this._gameConfig.spilId):void console.error("Spil Id not defined in gameConfig. Needs to be something like: \n	gameName : 'Dr. Atom & Quark: I do what i want'\n in your gameConfig.json")},n.prototype.score=function(t,e,i,n){GameAPI.Score.submit(i),t.call(e)},n}),define("gt/partners/YahooJP",["bottom_line","gt/partners/BoosterSdk"],function(t,e){"use strict";var i=function(gameConfig,storageManager){i._super.constructor.call(this,gameConfig,storageManager),this._authenticated=!1};return t.inherit(i,e),i.prototype.init=function(t,e){this._injectAnalytics(),this._injectMoreGames(),i._super.init.call(this,function(){this._authenticate(t,e)},this)},i.prototype._authenticate=function(t,e){this._stateApi=new Booster.StateApi({readyCallback:function(){this._authenticated=!0},popupClosedCallback:function(){t.call(e)},context:this,gameCode:this._gameConfig.gameCode}),this._stateApi.login()},i.prototype.loadUserData=function(t,e){this._authenticated?this._stateApi.load(function(i){i&&this._handleLoadData(i),t.call(e)},function(i){console.error("Error in loading user data: "+i.status+": "+i.statusText),t.call(e)},this):t.call(e)},i.prototype.saveUserData=function(t,e){this._authenticated?this._stateApi.save(this._storageManager.serialize({save:!0}),function(i){t.call(e)},function(i){t.call(e),console.error("Error Saving User data to Yahoo JP State Api: "+i)},this):t.call(e)},i.prototype._handleLoadData=function(t){var e,i;for(var n in t)e=n,i=t[n],this._storageManager.set(e,i)},i.prototype.score=function(t,e,i,n){this._community.submitSessionScore({score:i,level:n,callback:function(){t.call(e)}})},i.prototype._getUserDevice=function(){return decodeURI((RegExp("bm.userdevice=(.+?)(&|$)").exec(location.search)||[,null])[1])},i.prototype._injectAnalytics=function(){var t=this._getUserDevice();window.pageData={navigation:{gameID:this._gameConfig.gameId,device:t}};var e=document.createElement("script"),i=document.getElementsByTagName("script")[0];e.async=!0,e.src="//s.yjtag.jp/tag.js#site=jdvwBAD",i.parentNode.insertBefore(e,i)},i.prototype._injectMoreGames=function(){var t=document.createElement("script");t.id="more-games-api",t.src="/shared/booster/moregames.js",t["moregames-config"]='{"x":0, "y":1}',t.async=!0,document.body.appendChild(t)},i}),define("gt/modules/BootSetup",["soma","bottom_line","settings","gt/extras/ajax","gt/utils/orientation","gt/utils/Chainable","gt/localization/LocalizationManager","gt/storage/StorageManager","gt/utils/GameConfigUtil","gt/constants/ConsoleCSS","gt/resources/ResourceManager","gt/resources/loaders/JsonLoader","gt/resources/ResourceType","gt/partners/Platform","gt/partners/BoosterSdk","gt/partners/BoosterWhiteLabel","gt/partners/Flurry","gt/partners/Spil","gt/partners/YahooJP"],function(t,e,i,n,s,r,o,a,h,l,c,u,d,A,p,m,f,g,_){var y=function(injector){this._injector=injector};return y.prototype.run=function(e,n){console.log("%c [DI module] %c BootSetup ",l.MODULE_TAG,l.MODULE_TEXT),this._injector.mapValue("settings",i),this._injector.mapClass("resourceManager",c,t.SINGLETON),this._injector.mapClass("jsonLoader",u,t.SINGLETON),this._injector.mapClass("localizationManager",o,t.SINGLETON),this._injector.mapClass("platform",A,t.SINGLETON),this._injector.mapClass("boosterSdk",p),this._injector.mapClass("boosterWhiteLabel",m),this._injector.mapClass("flurry",f),this._injector.mapClass("spil",g),this._injector.mapClass("yahooJP",_);var resourceManager=this._injector.getValueFromClass(c),jsonLoader=this._injector.getValueFromClass(u);resourceManager.addLoader(jsonLoader),new r(this.loadGameConfig,this,resourceManager).then(this._loadSaveData,this,resourceManager).then(this.initPartners,this).then(this.loadBootInfo,this,resourceManager).then(this.initLocalization,this).then(this.checkOrientationCorrect,this).then(this.delayCallback,this).then(function(){console.log(" ...finished booting."),e.call(n)},this).execute()},y.prototype.loadGameConfig=function(t,e,resourceManager){resourceManager.load("gameConfig","assets/json/gameConfig.json",d.JSON,function(i){var gameConfig=h.selectConfigBasedOnReferrer(i.result);this._injector.mapValue("gameConfig",gameConfig),t.call(e)},this)},y.prototype._loadSaveData=function(e,i){this._injector.mapClass("storageManager",a,t.SINGLETON);var storageManager=this._injector.getValueFromClass(a);storageManager.loadSaveData(),e.call(i)},y.prototype.initPartners=function(t,e){var platform=this._injector.getValueFromClass(A);new r(platform.initPartners,platform).then(platform.sendDeviceAnalytics,platform).then(t,e).execute()},y.prototype.loadBootInfo=function(t,e,resourceManager){resourceManager.load("bootInfo","assets/json/boot.json",d.JSON,function(i){this._injector.mapValue("bootInfo",i.result),t.call(e)},this)},y.prototype.initLocalization=function(t,e){console.log("BootSetup.initLocalization");var gameConfig=this._injector.getValue("gameConfig"),i=gameConfig.lang,localizationManager=this._injector.getValueFromClass(o);localizationManager.load(i,function(){console.log(" ...initialized."),t.call(e)},this)},y.prototype.checkOrientationCorrect=function(t,e){s.current===s.desired?t.call(e):s.onchange.addOnce(function(){t.call(e)})},y.prototype.delayCallback=function(t,i){e.delay(1e3,function(){t.call(i)})},y}),define("gt/modules/GeoLocking",["soma","gt/extras/ajax","gt/constants/ConsoleCSS"],function(t,e,i){var n=function(injector,gameConfig){this._injector=injector,this._gameConfig=gameConfig};return n.prototype.run=function(t,n){console.log("%c [DI module] %c GeoLocking ",i.MODULE_TAG,i.MODULE_TEXT),e("http://geoip.api.boostermedia.com/").then(function(e){var i=this._gameConfig.allowedIPs&&-1!==this._gameConfig.allowedIPs.indexOf(e.ip),s=this._gameConfig.allowedCountries&&-1!==this._gameConfig.allowedCountries.indexOf(e.country_code);if(i||s)t.call(n);else{console.error("Accessing from wrong location: "+e.country_code);var r=document.getElementById("geolocking");r&&(r.style.display="block")}}.bind(this),function(e){t.call(n),console.warn("Couldn't access location service")}.bind(this))},n}),define("gt/utils/URLData",[],function(){return{get vars(){var t={};return window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,i,n){t[i]=n}),t}}}),define("gt/modules/PasswordProtect",["soma","gt/extras/ajax","gt/constants/ConsoleCSS","gt/utils/URLData"],function(t,e,i,n){var s=function(injector,gameConfig){this._injector=injector,this._gameConfig=gameConfig,this._gameConfig.passwordUrl||console.error("Password url not defined in game config. Please define the base URL in the gameConfig.json")};return s.prototype.run=function(t,e){console.log("%c [DI module] %c PasswordProtect ",i.MODULE_TAG,i.MODULE_TEXT);var s=document.createElement("div");s.style.position="relative",s.style.zIndex="1",s.style.width="340px",s.style.height="80px",s.style.margin="auto",s.style.marginTop="20%",s.style.backgroundColor="#DEDEDE",s.style.border="1px solid #D0D0D0",s.style.borderRadius="5px",s.style.padding="20px",s.id="passwordContainer",document.body.appendChild(s);var r=document.createElement("label");r.type="text",r.innerText="Please type your password: ",r.style.position="relative",r.style.fontFamily="Arial, Helvetica, sans-serif",r.style.color="#000",s.appendChild(r);var o=document.createElement("div");o.style.position="relative",o.style.width="100%",o.style.height="50%",o.style.marginTop="10px",o.style.border="none",s.appendChild(o);var a=document.createElement("input");a.type="text",a.style.position="relative",a.style.height="20px",a.style.padding="5px",a.style.margin="5px",a.style.backgroundColor="#fff",a.style.color="#000",a.id="passwordEntry",o.appendChild(a);var h=document.createElement("button");h.type="submit",h.value="Enter",h.style.position="relative",h.style.right="0px",h.style.margin="15px",h.style.backgroundColor="#CCC",
h.style.width="100px",h.style.height="38px",h.style.border="1px solid #999",h.innerText="submit",h.onclick=function(){this._formSubmit(t,e)}.bind(this),o.appendChild(h);var l=n.vars.password;l&&(a.value=l,this._formSubmit(t,e))},s.prototype._formSubmit=function(t,i){var n=document.getElementById("passwordEntry").value,s=document.getElementById("passwordContainer");e(this._gameConfig.passwordUrl+"?password="+n).then(function(e){e?(s.parentNode.removeChild(s),t.call(i)):console.log("Error")})},s}),define("gt/rendering/viewport/ViewportManager",["bottom_line","phaser","settings","utils/quality","gt/rendering/viewport/ViewportScaleMode"],function(t,e,settings,i,n){function s(bootInfo){console.log("ViewportManager.ctor"),this.screenChangedEventStarted=new e.Signal,this.screenChangedEvent=new e.Signal,this._config=settings.viewportConfig||{},this.devicePixelRatio=window.devicePixelRatio||1,this.game={x:0,y:0,width:0,height:0},this.world={x:0,y:0,width:0,height:0},this.width=0,this.height=0,this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight,this.fitScale=1,this.spritesheetScale=device.desktop?bootInfo.spritesheets.desktop.atlases.maxScale:bootInfo.spritesheets.mobile.atlases.maxScale,this.qualityScale=i.deviceScale,this.scale=1,this.portrait=null,this.landscape=null,this.scaleType=this._config.scaleType||n.Fill,this.stretchWorldHeight=this._config.stretchWorldHeight||!1,this.stretchWorldWidth=this._config.stretchWorldWidth||!1,this.view=null,this.calculateSize(),device.desktop&&this.initFullscreen()}return t.extend(s.prototype,{enumerable:!1},{init:function(){console.log("ViewportManager.init"),game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.setShowAll(),game.scale.setScreenSize(!0),this.view=game.add.group(game.world,"viewport"),this.view.x=this.world.x+this.world.width/2,this.view.y=this.world.y+this.world.height/2,game.world.bounds.setTo(this.world.x,this.world.y,this.world.width,this.world.height),game.onResume.add(this._refocusFrame,this),this._refocusFrame()},_refocusFrame:function(){window.focus&&window.focus()},getBounds:function(){return this.view.getBounds()},calculateSize:function(){var t=device.screen.width,e=device.screen.height,i=window.innerWidth*this.devicePixelRatio,s=window.innerHeight*this.devicePixelRatio,r=i/s,o=device.portable?settings.designWidth:settings.desktopDesignWidth,a=device.portable?settings.designHeight:settings.desktopDesignHeight,h=o/a;this.portrait=1>=h,this.landscape=!this.portrait;var l=o,c=a;device.desktop?this.fitScale=Math.min(t/o,e/a,1):r>=h?(this.fitScale=s/a,l=i/this.fitScale):h>r&&(this.fitScale=i/o,c=s/this.fitScale),this.scaleType===n.Letterbox&&(l=Math.min(settings.designWidthMax,l),c=Math.min(settings.designHeightMax,c)),this.scale=Math.min(this.spritesheetScale,this.fitScale)*this.qualityScale,this.width=this.game.width=l*this.scale,this.height=this.game.height=c*this.scale,this.world.width=this.stretchWorldWidth?this.width:o*this.scale,this.world.height=this.stretchWorldHeight?this.height:a*this.scale,this.game.x=(this.width-this.game.width)/2,this.game.y=(this.height-this.game.height)/2,this.world.x=(this.width-this.world.width)/2,this.world.y=(this.height-this.world.height)/2},initFullscreen:function(){document.addEventListener("fullscreenchange",this.onScreenChanged),document.addEventListener("mozfullscreenchange",this.onScreenChanged),document.addEventListener("webkitfullscreenchange",this.onScreenChanged),document.addEventListener("msfullscreenchange",this.onScreenChanged),window.onresize=this.onResize.bind(this)},isFullscreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?!0:!1},toggleFullscreen:function(){var t=document.documentElement;game.viewport.isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},onResize:function(){this.screenChangedEventStarted.dispatch(),t.delay(800,function(){game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.setShowAll(),game.scale.refresh();var t=dom("#game_background");t.style.marginLeft=game.canvas.style.marginLeft,game.device.ie&&(t.style.marginTop=game.canvas.style.marginTop),t.style.height=game.canvas.style.height,t.style.width=game.canvas.style.width,t.style.height=game.canvas.style.height,t.style.left=game.canvas.style.left,t.style.top=game.canvas.style.top;var e=this.isFullscreen();this.screenChangedEvent.dispatch(e)},this)}}),s}),define("gt/core/PhaserEvents",["phaser"],function(t){var e=function(){console.log("PhaserEvents.ctor"),this.preloadEvent=new t.Signal,this.createEvent=new t.Signal,this.updateEvent=new t.Signal,this.renderEvent=new t.Signal};return e.prototype.preload=function(){console.log("PhaserEvents.preload"),this.preloadEvent.dispatch()},e.prototype.create=function(){console.log("PhaserEvents.create"),this.createEvent.dispatch()},e.prototype.update=function(){this.updateEvent.dispatch()},e.prototype.render=function(){this.renderEvent.dispatch()},e}),define("gt/core/GameFactory",["phaser"],function(t){var e=function(viewportManager,phaserEvents,gameConfig){console.log("GameFactory.ctor"),this._viewportManager=viewportManager,this._gameConfig=gameConfig,this._phaserEvents=phaserEvents};return e.prototype.construct=function(){console.log("GameFactory.construct");var e=this._viewportManager.width,i=this._viewportManager.height,n=this.getRenderer(),s="",r=this._phaserEvents,o=this.getTransparent();return new t.Game(e,i,n,s,r,o)},e.prototype.getRenderer=function(){var e=this._gameConfig.renderer;return e&&"webgl"===e?t.WEBGL:e&&"canvas"===e?t.CANVAS:device.desktop&&!browser.firefox&&!browser.ie||browser.chrome||device.iOS?t.AUTO:t.CANVAS},e.prototype.getTransparent=function(){return browser.bad&&device.android?!1:!0},e}),define("gt/core/GameTimer",[],function(){var t=function(game,phaserEvents){this._game=game,this._timeScale=1,this._paused=!1,this._timer=this._game.time.create(!1),this._timer.timeCap=t.MAX_DELTA,this._timer.start(),this._phaserEvents=phaserEvents,this._phaserEvents.updateEvent.add(this._update,this),this.events=[]};return t.MIN_DELTA=.016666666,t.MAX_DELTA=.066666666,t.prototype._update=function(){this.events._.removeFn(function(t){return t.expired})},t.prototype._clampedDelta=function(e){return e=Math.min(e,t.MAX_DELTA),e=Math.max(e,t.MIN_DELTA)},Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this._paused?0:this._clampedDelta(this._timer.elapsed/1e3)*this._timeScale}}),Object.defineProperty(t.prototype,"elapsedSeconds",{get:function(){return this._timer.seconds}}),Object.defineProperty(t.prototype,"now",{get:function(){return this._timer.ms}}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(t){this._paused=t,t?(this._timer.pause(),this.events.forEach(function(t){t.pause()})):(this._timer.resume(),this.events.forEach(function(t){t.resume()}))}}),Object.defineProperty(t.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t}}),t.prototype.add=function(t,e,i){var n=this._game.time.create(!0);return n.add.apply(n,arguments),n.start(),this.events.push(n),n},t.prototype.repeat=function(t,e,i,n){var s=this._game.time.create(!0);return s.repeat.apply(s,arguments),s.start(),this.events.push(s),s},t.prototype.remove=function(t){t.stop(),t.destroy()},t}),define("gt/modules/PhaserSetup",["soma","gt/rendering/viewport/ViewportManager","gt/core/PhaserEvents","gt/core/GameFactory","gt/core/GameTimer","gt/constants/ConsoleCSS"],function(t,e,i,n,s,r){var o=function(injector){this._injector=injector};return o.prototype.run=function(o,a){console.log("%c [DI module] %c PhaserSetup ",r.MODULE_TAG,r.MODULE_TEXT),this._injector.mapClass("viewportManager",e,t.SINGLETON),this._injector.mapClass("phaserEvents",i,t.SINGLETON),this._injector.mapClass("gameFactory",n,t.SINGLETON);var gameFactory=this._injector.getValueFromClass(n),game=gameFactory.construct();this._injector.mapValue("game",game),this._injector.mapClass("gameTimer",s,t.SINGLETON),window.game=game;var phaserEvents=this._injector.getValueFromClass(i);phaserEvents.createEvent.addOnce(function(){this.onCreate(),o.call(a)},this)},o.prototype.onCreate=function(){var game=this._injector.getValue("game");game.stage.backgroundColor=16711680,window.addEventListener("mousedown",function(){game.gameResumed()}),window.addEventListener("touchstart",function(){game.gameResumed()}),window.addEventListener("click",function(){game.gameResumed()});var viewportManager=this._injector.getValueFromClass(e);viewportManager.init(),game.viewport=viewportManager,game.physics.startSystem(Phaser.Physics.ARCADE)},o}),define("gt/utils/SettingsUtil",["settings"],function(t){var e=function(){};return e.prototype.getTextStyle=function(e){var i=t.text.style;return _.isString(e)?i[e]:i._.find(function(t){return t.tag===e})},e}),define("gt/extras/PartialInjectionFactory",[],function(){var t=function(injector,t){this._injector=injector,this._ctor=t};return t.prototype.construct=function(){var t=Array.prototype.slice.call(arguments);return t.splice(0,0,this._ctor),this._injector.createInstance.apply(this._injector,t)},t}),define("gt/mixins/Poolable",["bottom_line"],function(t){function e(){this.drownable=!0}return t.extend(e,{pool:{value:{value:[],clone:!0},clone:!0},rescue:function(){var t;return this.pool.length?(t=this.pool.pop(),t.revive.apply(t,arguments)):(t=Object.create(this.prototype),this.apply(t,arguments),t)},fillPool:function(e,i){var n,s=this,r=e-s.pool.length;t.repeat(r,function(){n=Object.create(s.prototype),s.apply(n,i),n.drown()})}}),t.extend(e.prototype,{drown:function(t){if(this.drownable){var pool=this.constructor.pool;this.kill(),t&&this.parent&&this.parent.remove(this),pool._.not.has(this)&&pool.push(this)}}}),e}),define("gt/gui/Label",["bottom_line","phaser","settings","gt/mixins/Poolable","gt/utils/StringUtil"],function(t,e,settings,i,n){function s(t,e,n,gameConfig,viewportManager,settingsUtil,textCounter){this._gameConfig=gameConfig,this._viewportManager=viewportManager,this._settingsUtil=settingsUtil,s._super.constructor.call(this,game),s._mixin(i).constructor.call(this),this._counter=textCounter,this.init.call(this,t,e,n)}return t.inherit(s,e.Text),t.mixin(s,[i]),t.extend(s.prototype,{enumerable:!1},{init:function(t,e,i){i&&i.add(this),this.setBoundingBox(e);var n=this.constructStyle(e);return this.setStyle(n),this.visible=!0,this.scale.set(1),this.setText(t),this},constructStyle:function(t){var e={},i=t.fontName,n=t.fontSize;return e.font=n+"px "+i,e.fill=t.color,e.align=t.hAlignment,e.wordWrap=!0,this.angle=t.rotation,this.x=this.rect.x,this.y=this.rect.y,e.wordWrapWidth=this.rect.width,e},adaptStyle:function(e){e=t.clone(e);var i=e.font._.after("px "),n=settings.fontMap[this._gameConfig.lang][i],s=parseInt(e.font._.before("px"))*this._viewportManager.scale;return e.strokeThickness&&(e.strokeThickness*=this._viewportManager.scale),n||console.error("Font mapping not found for font: "+i+" with language: "+this._gameConfig.lang),i=n?n.font:i,s=n?s*n.scale:s,e.font=s+"px "+i,e},get scalar(){return this.scale.x},set scalar(t){this.scale.set(t)},setStyle:function(e){return t.isEmpty(e)?void 0:("object"!=typeof e&&(e=this._settingsUtil.getTextStyle(e)),e=this.adaptStyle(e),s._super.setStyle.call(this,e),this)},kill:function(){return this.visible=!1,this},revive:function(){return this.init.apply(this,arguments),this},setText:function(t){return t._.toString(),t=n.format.apply(null,arguments),s._super.setText.call(this,t)},countTo:function(t,e,i,n){this._counter.countTo(this,t,e,i,n)},setBoundingBox:function(t){var e={x:.5,y:.5};switch(t.hAlignment){case"left":e.x=0;break;case"right":e.x=1}var i={x:t.x-t.width/2+t.width*e.x,y:t.y,width:t.width,height:t.height};this.rect=i}}),s}),define("gt/gui/Button",["bottom_line","phaser","settings","gt/math/ScalePoint","gt/math/GlobalPosition"],function(t,e,settings,i,n){function s(t,e,r,o,a,h,l,soundManager,spritesheetManager,sceneManager,game,viewportManager){this.id=t,this.active=!0,this.wasVisible=!0,this.scaler=null,this.global=null,this.effect="button_select",this._soundManager=soundManager,this._spritesheetManager=spritesheetManager,this._sceneManager=sceneManager,this._game=game,this._viewportManager=viewportManager;var c=this._spritesheetManager.sprites[h].spritesheet;o=o||c.metaData.image._.before("."),s._super.constructor.call(this,game,e,r,o,null,null,a,h,l),this.scaler=new i(this.scale),this.global=new n(this),this._game.scale.updateElement(this,this._spritesheetManager[o],this._viewportManager)}return t.inherit(s,e.Button),t.extend(s,{factoryName:"button"}),t.extend(s.prototype,{get scalar(){return this.scaler.x},set scalar(t){this.scaler.set(t)},setVisible:function(t){return this.wasVisible=t,this.visible=t,this},setActive:function(t){return this.callbackFnc&&this.callbackCont&&(t?(this.visible=this.wasVisible&&this.callbackCont.view.visible,this.onInputUp.add(this.callbackFnc,this.callbackCont),this.setState(2)):this.onInputUp.remove(this.callbackFnc,this.callbackCont),this.freezeFrames=!t),this},setCallback:function(t,e,i){return i&&(this.effect=i),this.callback=function(){e.isVisible()&&e.active&&this.active&&this._sceneManager.inputEnabled?(this.setState(3),this._sceneManager.inputEnabled=!1,t.call(e,this.id),this._sceneManager.inputEnabled=!0):this.setState(1)}.bind(this),this.onInputUp.add(this.callback,e),this.callbackFnc=this.callback,this.callbackCont=e,this},onInputUpHandler:function(t,i,n){var s={x:this.global.x-this.width*this.anchor.x,y:this.global.y-this.height*this.anchor.y,width:this.global.x+this.width*(1-this.anchor.x),height:this.global.y+this.height*(1-this.anchor.y)};this._game.input.x>s.x&&this._game.input.x<s.width&&this._game.input.y>s.y&&this._game.input.y<s.height&&(this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&!e.Pointer.isSwipe()&&this.onInputUp.dispatch(this,i,n),this.forceOut?this.setState(2):this._onUpFrameName||this._onUpFrameID?this.setState(4):n?this.setState(1):this.setState(2)),this._soundManager.effect(this.effect)}}),s}),define("gt/entities/Entity",["bottom_line","phaser"],function(t,e){function i(t,e,n,s){t=t||null,e=e||null,i._super.constructor.call(this,game,t,e),this.name=e||null,this.sprite=null,(n||s)&&this.addSprite(n,s),this.debugging=!1}return t.inherit(i,e.Group),t.extend(i,{factoryName:"entity"}),t.extend(i.prototype,{enumerable:!1},{addSprite:function(t,e){this.sprite=this.add(game.make.sprite(0,0,t,e))},removeSprite:function(t){this.sprite=null,this.remove(t)},update:function(){if(this.debugging){var t=this.getBounds();this.g&&this.g.clear(),this.g.beginFill(8453888,1),this.g.drawRect(t.x,t.y,t.width,t.height),this.g.alpha=.5,this.g.endFill()}i._super.update.apply(this,arguments)},enableDebug:function(t){if(!this.debugging||!t)if(!this.debugging&&t){var e=this.getBounds();this.g=game.add.graphics(0,0),this.g.beginFill(8453888,1),this.g.drawRect(e.x,e.y,e.width,e.height),this.g.alpha=.5,this.g.endFill(),this.debugging=!0}else this.debugging=!1,this.g&&this.g.clear(),this.g=null}}),i}),define("gt/animation/AnimationSprite",["phaser","bottom_line","gt/entities/Entity","gt/mixins/Poolable"],function(t,e,i,n){function s(t,game,spritesheetManager,viewportManager){s._super.constructor.call(this,t,!0),s._mixin(n).constructor.call(this),this._game=game,this._spritesheetManager=spritesheetManager,this._viewportManager=viewportManager}return e.inherit(s,i),e.mixin(s,[n]),e.extend(s,{factoryName:"animationSprite"}),e.extend(s.prototype,{enumerable:!1},{revive:function(t){return s._super.revive.call(this),t!==this.key&&(this.loadTexture(t),this._game.scale.updateElement(this,this._spritesheetManager[t],this._viewportManager)),this.animation=null,this.scalar=1,this}}),s}),define("gt/rendering/fx/StaticRenderTexture",["bottom_line","phaser"],function(t,e){function i(t,e,n,s,r,viewportManager,game){this._viewportManager=viewportManager,this._game=game;var o=e||0,a=n||0;o+=this._viewportManager.width/2,a-=this._viewportManager.height/2;var h=s||this._game.world.width,l=r||this._game.world.height,c=this._game.add.renderTexture(h,l,"myRenderTexture");i._super.constructor.call(this,this._game,o,a,c),this.name=t,this.id=t,this.texture=c,this.debug=!1}return t.inherit(i,e.Sprite),t.extend(i.prototype,{enumerable:!1},{addToRender:function(t,e){if(this.texture.renderXY(t,e.x,e.y,!1),this.debug){var i=this.texture.baseTexture.source.toDataURL("image/png");document.write("<img src="+i+">")}}}),i}),define("gt/animation/SpineAnimation",["phaser","bottom_line"],function(t,e){function i(e){i._super.constructor.call(this,e),game.onPause.add(this._pause,this),game.onResume.add(this._resume,this),this._pausedByCode=!1,this._isPlaying=!1,this.onComplete=new t.Signal,this.state.onSetAnimation.add(this.resetTime,this)}return e.inherit(i,PIXI.Spine),e.extend(i,{factoryName:"spineAnimation"}),e.extend(i.prototype,{_pause:function(){this.state&&this.state.pauseAnimation()},_resume:function(){this._pausedByCode||this.state.resumeAnimation()},get animationSpeed(){return this.state.animationSpeed},set animationSpeed(t){this.state.animationSpeed=t},addAnimation:function(t,e,i){this.state.addAnimationByName(t,e,i),this._isPlaying=!0},startAnimation:function(t,e,i,n){this._destroyOnComplete=e||!1,this.state.setAnimationByName(t,i,n),this.resumeAnimation(),this._isPlaying=!0},resetTime:function(){this.lastTime=0},pauseAnimation:function(){this._pausedByCode=!0,this._pause()},resumeAnimation:function(){this._pausedByCode=!1,this._resume()},stopAnimation:function(){this.state&&this.state.clearAnimation(),this._isPlaying=!1},update:function(){i._super.update.call(this),this._isPlaying&&this.state.isComplete()&&(this._isPlaying=!1,this.onComplete.dispatch(),this._destroyOnComplete&&(this.destroy(),this._destroyOnComplete=!1))},destroy:function(){this.parent&&this.parent.removeChild(this),this.stopAnimation(),game.onPause.remove(this._pause,this),game.onResume.remove(this._resume,this),this.state=null,this.onComplete.removeAll()}}),i}),define("gt/modules/FactorySetup",["soma","gt/utils/SettingsUtil","gt/extras/PartialInjectionFactory","gt/gui/Label","gt/gui/Button","gt/animation/AnimationSprite","gt/rendering/fx/StaticRenderTexture","gt/constants/ConsoleCSS","gt/animation/SpineAnimation"],function(t,e,i,n,s,r,o,a,h){var l=function(injector){this._injector=injector};return l.prototype.run=function(l,c){console.log("%c [DI module] %c FactorySetup ",a.MODULE_TAG,a.MODULE_TEXT);var labelFactory=new i(this._injector,n),buttonFactory=new i(this._injector,s),animationSpriteFactory=new i(this._injector,r),staticRenderTextureFactory=new i(this._injector,o),spineAnimationFactory=new i(this._injector,h);this._injector.mapClass("settingsUtil",e,t.SINGLETON),this._injector.mapValue("labelFactory",labelFactory),this._injector.mapValue("buttonFactory",buttonFactory),this._injector.mapValue("animationSpriteFactory",animationSpriteFactory),this._injector.mapValue("staticRenderTextureFactory",staticRenderTextureFactory),this._injector.mapValue("spineAnimationFactory",spineAnimationFactory),l.call(c)},l}),define("gt/modules/ShowFPSCounter",["gt/constants/ConsoleCSS"],function(t){var e=function(settings,game,phaserEvents,labelFactory,viewportManager){this._settings=settings,this._game=game,this._phaserEvents=phaserEvents,this._labelFactory=labelFactory,this._viewportManager=viewportManager};return e.prototype.run=function(e,i){if(console.log("%c [DI module] %c ShowFPSCounter ",t.MODULE_TAG,t.MODULE_TEXT),this._settings.drawFps){this._game.time.advancedTiming=!0;var n=this._labelFactory.construct("fps: --","debug");this._fpsCounter=this._game.world.add(n),this._fpsCounter.fontSize=35;var s="version: "+this._settings.version,r=this._labelFactory.construct(s,"debug");this._versionNumber=this._game.world.add(r),this._versionNumber.y=60*this._viewportManager.scale,this._phaserEvents.updateEvent.add(this.onUpdate,this)}e.call(i)},e.prototype.onUpdate=function(){this._settings.drawFps&&(this._fpsCounter.x=20*this._viewportManager.scale,this._fpsCounter.y=150*this._viewportManager.scale,this._fpsCounter.text="fps: "+this._game.time.fps)},e}),define("gt/patterns/messaging/Publisher",[],function(){function t(){this._messages={}}return t.prototype.subscribe=function(t,e,i){this._addSubscriber(t,e,i,!1)},t.prototype.subscribeOnce=function(t,e,i){this._addSubscriber(t,e,i,!0)},t.prototype.publish=function(t){console.assert(t,"Expected a message parameter for publish() function.");var e=this._messages[t];if(e&&e.length){var i=Array.prototype.slice.call(arguments);i=i._.del(0);for(var n=e.length-1;n>=0;n--){var s=e[n],r=s.listener,o=s.context,a=r.apply(o,i);if(s.once&&this.unsubscribe(t,r,o),a===!1)break}}},t.prototype.unsubscribe=function(t,e,i){this._removeSubscriber(i,e,t)},t.prototype.unsubscribeAll=function(t){this._removeSubscriber(t)},t.prototype._addSubscriber=function(t,e,i,n){this._messages[t]||(this._messages[t]=[]);var s=this._messages[t],r={message:t,listener:e,context:i,once:n};s.unshift(r)},t.prototype._removeSubscriber=function(t,e,i){var n=this._messages[i];if(n)this._removeSubscriberFromList(n,t,e);else for(var s in this._messages)this._messages.hasOwnProperty(s)&&(n=this._messages[s],this._removeSubscriberFromList(n,t,e))},t.prototype._removeSubscriberFromList=function(t,e,i){for(var n=void 0===i,s=t.length-1;s>=0;s--){var r=t[s];r.context===e&&n?t._.del(s):r.context===e&&r.listener===i&&t._.del(s)}},t}),define("gt/modules/PublisherSetup",["soma","gt/patterns/messaging/Publisher"],function(t,e){"use strict";var i=function(injector){this._injector=injector};return i.prototype.run=function(i,n){this._injector.mapClass("gameInfoPublisher",e,t.SINGLETON),i.call(n)},i}),define("gt/audio/SoundManager",["bottom_line","phaser","settings"],function(t,e,settings){function i(storageManager){console.log("SoundManager.ctor"),this.sounds={},this.markers={},this.isPlaying={},this.queued={},this.loopingButMuted={},this._storageManager=storageManager}return t.extend(i.prototype,{loadSprite:function(t){function e(){this.sounds[i]=game.add.sound(i),this.sounds[i].allowMultiple=game.sound.usingWebAudio,this._populateSoundMarkers(i,this.sounds[i])}var i=t._.before(".");game.load.audio(i,i+".mp3"),game.load.json(i+"_json",i+".json"),game.load.onLoadComplete.add(e,this)},_populateSoundMarkers:function(t,e){var i=game.cache.getJSON(t+"_json");for(var n in i.spritemap){this.markers[n]=t,this.isPlaying[n]=!1;var s=i.spritemap[n];e.addMarker(n,s.start,s.end-s.start,1,s.loop)}},getSoundInstance:function(t){var e=this.markers[t],i=game.add.sound(e);return i.allowMultiple=game.sound.usingWebAudio,this._populateSoundMarkers(e,i),i},play:function(t,e,i,n,s,r,o){s=void 0===s?100:s;var a=this.markers[t];if(a||console.warn(t+" not found in audiosprite"),this.mute&&i){var h=Array.prototype.slice.call(arguments,0);return void(this.loopingButMuted[t]=h)}if(a&&!browser.bad&&!this.mute){var l=i||!1,c=n||!1,u=settings.volume;void 0!==e&&(e*settings.volume>1&&console.warn("volume is capped for sfx: "+t),u=Math.min(e*settings.volume,1));var d=this.sounds[a];return r?(console.log("stopping channel",a,"from marker",t),this.stopChannel(a)):s>0&&(this.isPlaying[t]=!0,game.time.events.add(s,function(){this.isPlaying[t]=!1},this)),i&&s>0?(d.onMarkerComplete.add(function(){this.queued[t]=game.time.events.add(s,function(){d.play(t,0,u,!1,c)})},this),d.play(t,0,u,!1,c)):d.play(t,0,u,l,c),this.isPlaying[t]=!0,d.isPositionalAudio=o,d}},effect:function(t,e,i,n,s,r,o){e=e||settings.volume.effects,this.play(t,e,i,n,s,r,o)},music:function(t,e,i,n){e=e||settings.volume.music,this.play(t,e,i,n,0,!0,!1)},stop:function(t){this.loopingButMuted[t]&&delete this.loopingButMuted[t];var e=this.markers[t];if(e){var i=this.sounds[e];i.isPlaying&&i.stop(),i.onMarkerComplete.removeAll();var n=this.queued[t];n&&(game.time.events.remove(n),delete this.queued[t]),i.isPositionalAudio=!1,this.isPlaying[t]=!1}},stopAll:function(){this.loopingButMuted={},this.sounds._.each(function(t){t.stop()},this)},pauseAll:function(){this.sounds._.each(function(t){t.pause()},this)},resumeAll:function(){this.sounds._.each(function(t){t.resume()},this)},stopChannel:function(t){var e=this.sounds[t];e.stop(),e.markers._.each(function(t,e){this.isPlaying[e]=!1},this)},get mute(){return!!this._storageManager.get("muteAudio")},set mute(t){if(this._storageManager.set("muteAudio",t?1:0),t)this.pauseAll();else{this.resumeAll();for(var e in this.loopingButMuted)this.play.apply(this,this.loopingButMuted[e])}}}),i}),define("gt/scenes/ViewCreator",["bottom_line","phaser"],function(t,e){var i=function(spritesheetManager,localizationManager,soundManager,viewportManager,settingsUtil,labelFactory,buttonFactory,staticRenderTextureFactory){this._spritesheetManager=spritesheetManager,this._localizationManager=localizationManager,this._soundManager=soundManager,this._viewportManager=viewportManager,this._settingsUtil=settingsUtil,this._labelFactory=labelFactory,this._buttonFactory=buttonFactory,this._staticRenderTextureFactory=staticRenderTextureFactory};return i.addToNode=function(t,i,n){if(i){switch(i.id=n.name,i.myType=n.type,t.myType){case"RenderTexture":t.addToRender(i,i.x,i.y),t.parent.add(i),i.visible=!1;break;case"Button":("Label"===i.myType||"BitmapFont"===i.myType)&&t.addLabel(i),"Image"===i.myType&&t.addIcon(i);break;default:t.add(i),i.visible=n.visible}i.type===e.BITMAPTEXT?i.setAnchor(n.anchorX,1-n.anchorY):i.anchor&&i.anchor.set(n.anchorX,1-n.anchorY)}},i.prototype.addImage=function(t,e){var n,s=e.image._.afterLast("/");return n=game.make[e.name._.startsWith("spr_")?"sprite":"image"](e.x,e.y,void 0,s,e.name,e),n.angle=e.rotation,i.addToNode(t,n,e),n},i.prototype.addRenderTexture=function(t,e){var n;return n=this._staticRenderTextureFactory.construct(e.name,e.x,e.y,e.width,e.width),n.angle=e.rotation,i.addToNode(t,n,e),n},i.prototype.addButton=function(t,e,n){var s=n.image._.afterLast("/"),r=n.highlightedState._.afterLast("/")||s,o=n.pressedState._.afterLast("/")||s,a=this._spritesheetManager.sprites[s].spritesheet,h=this._buttonFactory.construct(n.name,0,0,a,r,s,o);return h.width=n.width,h.height=n.height,i.addToNode(t,h,n),h.setVisible(n.visible),h},i.prototype.addText=function(t,e,n,s){var r,o=e.text.replace(/\\n/g,"\n");o=o.replace(/^\n+|\n+$/g,"");var a=/^[0-9\/ -%]+$/;if(o||console.warn("empty text label: ",e.id),o&&this._localizationManager&&!a.test(o)&&(o=this._localizationManager.get(o)||"",o||(o="Missing text in csv !")),n){var h=e.name.split("_")[1];r=game.add.bitmapText(e.x,e.y,h,o,e.fontSize*this._viewportManager.scale),r.angle=e.rotation,r.wordWrapWidth=s?e.width:e.areaWidth}else r=this._labelFactory.construct(o,e),r.context.lineJoin="round";return r.id=e.name,i.addToNode(t,r,e),r},i.prototype.addGroup=function(t,e,i){var n=game.add.group(e,i.name);return n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.id=i.name,n.angle=i.rotation,n.visible=i.visible,n},i.prototype.addPlaceholder=function(t,e){return game.make.placeholder(t,e.name,e)},i.prototype.addButtonGroup=function(t,e,n){var s=this.addButton(t,e,n),r=game.make.buttonGroup(t,n.name,n);return r.addButton(s),i.addToNode(t,r,n),r},i}),define("gt/scenes/Scene",["bottom_line"],function(t){function e(t,game,sceneManager,platform,sceneInput,e){this.name=t,this._game=game,this._sceneManager=sceneManager,this._platform=platform,this.data=null,this.view=this._game.make.group(),this.view.id="view_"+t,this._sceneManager.add(this),this.setVisible(!1),this.placeHolders={},this.components={},this.buttons={},this.images={},this.labels={},this.groups={buttons:{}},this.events={},this._sceneInput=sceneInput,this._inputManager=e,this._activateButton=null,this._parent=null}return t.extend(e.prototype,{get width(){return this.view.width},get height(){return this.view.height},get x(){return this.view.x},set x(t){this.view.x=t},get y(){return this.view.y},set y(t){this.view.y=t},init:function(){this.setActive(!1)},enter:function(){this._sceneInput&&(this._sceneInput.bindAll(this),this._inputManager.startCapturing()),this.view.parent&&this.view.parent!==this._parent&&(this._parent=this.view.parent),this._parent.add(this.view),this.setVisible(!0),this.setActive(!0),this.view.id._.endsWith("Pp")?this._platform.analytics("popupEntered",this.view.id):this.view.id._.endsWith("Cp")||this._platform.analytics("screenEntered",this.view.id)},leave:function(){this._parent&&this._parent.remove(this.view),this._sceneInput&&(this._inputManager.stopCapturing(),this._sceneInput.unbindAll()),this.setVisible(!1),this.setActive(!1);for(var t in this.components)this.components[t].leave()},update:function(){return this},setVisible:function(t){this.view.visible=t,this.view.exists=t},isVisible:function(){return this.view.visible},setActive:function(t){this.active=t,this.view.active=t;for(var e in this.components)this.components[e].setActive(t);var i=null;for(var n in this.buttons){var s=this.buttons[n];s.setActive(t),!i&&s.visible&&(i=s)}this._activateButton=i},getElementById:function(t){var e=this._getElementById(t,this.view);return e||console.warn("cannot find element with id: "+t),e},_getElementById:function(t,e){if(e.id===t||e.name===t)return e;for(var i,n=e.children,s=0;s<n.length&&(i=this._getElementById(t,n[s]),!i||i.id!==t&&i.name!==t);s++);return i},addComponent:function(t,e,i){var n;return n=i?i:t._.decapitalize(),this.components[n]=this._sceneManager.createComponent(t,e),this.components[n]},screenChanged:function(){},add:function(t,i,n){var s=t;t instanceof e&&(s=t.view);var r=this.groups.container||this.view;n&&(r=this.view),"number"==typeof i?r.addAt(s,i):r.add(s)},_selectButton:function(t){this._activateButton.scalar=1,this._activateButton=t,this._activateButton.scalar=1.1},selectNextButton:function(){var t=!1;for(var e in this.buttons){var i=this.buttons[e];if(t&&i.visible){this._selectButton(i);break}i===this._activateButton&&(t=!0)}},selectPreviousButton:function(){var t=!1,e=this._activateButton;for(var i in this.buttons){var n=this.buttons[i];if(t)break;n===e&&(t=!0),n.visible&&!t&&this._selectButton(n)}},activateCurrentButton:function(){this._activateButton&&this._activateButton.callbackFnc&&this._activateButton.callbackCont&&this._activateButton.callbackFnc.call(this._activateButton.callbackCont)},close:function(){}}),e}),define("scenes/Game",["bottom_line","phaser","gt/scenes/Scene","gt/utils/device"],function(t,e,i,n){function s(game,sceneManager,platform,gameManager,tetrisInput,gameInfoPublisher,soundManager,gameVarManager,storageManager){s._super.constructor.call(this,s.staticSceneName,game,sceneManager,platform),this._gameManager=gameManager,this._soundManager=soundManager,this._tetrisInput=tetrisInput,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._storageManager=storageManager}return t.inherit(s,i),s.staticSceneName="Game",s.prototype.init=function(){s._super.init.call(this),n.desktop?this.gameCp=this.addComponent("GameDesktopCp",null,"gameCp"):this.gameCp=this.addComponent("GameMobileCp",null,"gameCp"),this.add(this.gameCp.view),this._gameManager.init(),this._addEvents(),this._enableFocusEvents()},s.prototype.enter=function(t){this.gameCp.enter(t),this._gameManager.start(t),this._storageManager.get("first_time_enter_done")&&this._soundManager.effect(this._gameVarManager.audioConstants.level_start_sfx),s._super.enter.call(this)},s.prototype.leave=function(){this._disableFocusEvents(),s._super.leave.call(this),this._gameManager.cleanUp(),this._removeEvents()},s.prototype._wentOutOfFocus=function(){if(this._gameManager.hasStarted){
var t="GameDesktopCp"!==this.gameCp.name?"controlsMobilePp":"controlsDesktopPp";this._sceneManager.showPopup(t)}},s.prototype._enableFocusEvents=function(){this._game.onPause.add(this._wentOutOfFocus,this),this._game.onResume.add(this._disableFocusEvents,this),n.desktop||this._game.scale.enterLandscape.add(this._wentOutOfFocus,this)},s.prototype._disableFocusEvents=function(){this._game.onPause.remove(this._wentOutOfFocus,this),this._game.onResume.remove(this._disableFocusEvents,this),n.desktop||this._game.scale.enterLandscape.remove(this._wentOutOfFocus,this)},s.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("countdownBegin",this._enableFocusEvents,this),this._gameInfoPublisher.subscribe("adFinished",this._enableFocusEvents,this),this._gameInfoPublisher.subscribe("gamePaused",this._disableFocusEvents,this),this._gameInfoPublisher.subscribe("levelEndPpEnter",this._disableFocusEvents,this),this._gameInfoPublisher.subscribe("lastHurrahTriggered",this._disableFocusEvents,this),this._gameInfoPublisher.subscribe("rewardedAdsOver",this._enableFocusEvents,this),this._gameInfoPublisher.subscribe("levelGoalAnimBegin",this._enableFocusEvents,this)},s.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("countdownBegin",this._enableFocusEvents,this),this._gameInfoPublisher.unsubscribe("gamePaused",this._disableFocusEvents,this),this._gameInfoPublisher.unsubscribe("adFinished",this._enableFocusEvents,this),this._gameInfoPublisher.unsubscribe("levelEndPpEnter",this._disableFocusEvents,this),this._gameInfoPublisher.unsubscribe("rewardedAdsOver",this._enableFocusEvents,this),this._gameInfoPublisher.unsubscribe("levelGoalAnimBegin",this._enableFocusEvents,this)},s}),define("scenes/Loader",["bottom_line","phaser","settings","gt/scenes/Scene"],function(t,e,settings,i){function n(game,sceneManager,platform,gameInfoPublisher,injector){console.log("Loader.ctor"),n._super.constructor.call(this,n.staticSceneName,game,sceneManager,platform),this._gameInfoPublisher=gameInfoPublisher,this._injector=injector,this._loadingBarMinosIndex=0}return t.inherit(n,i),t.extend(n,{staticSceneName:"Loader"}),n.FINISHED_DELAY=250,t.extend(n.prototype,{init:function(){console.log("Loader.init"),this._gameInfoPublisher.subscribe("loadProgressed",this._onLoadProgressed,this),this._gameInfoPublisher.subscribeOnce("tetrisGameReady",this._loadingDone,this),n._super.init.call(this),this.groups.tetromino.children.forEach(function(t){t.visible=!1},this),this.buttons.btnGr_Play.visible=!1},enter:function(){console.log("Loader.enter"),n._super.enter.call(this),this._platform.analytics("menu")},_getNewLoadingBarMinosIndex:function(t){var e=this.groups.tetromino.children,i=.01*e.length,n=i*t,s=Math.floor(n),r=s;return s>0&&(r=s-1),r},_onLoadProgressed:function(t){var e=this._getNewLoadingBarMinosIndex(t),i=this.groups.tetromino.children;if(e>this._loadingBarMinosIndex){for(var n=this._loadingBarMinosIndex;e>=n;n++)i[n].visible=!0;this._loadingBarMinosIndex=e}},_loadingDone:function(){this._injector.getValue("levelManager");this._showPlayButton()},_showPlayButton:function(){this.groups.loading.visible=!1,this.buttons.btnGr_Play.visible=!0,this.buttons.btnGr_Play.setCallback(this._startGame,this)},_startGame:function(){this._gameInfoPublisher.publish("levelStart"),this._sceneManager.show("game",0)}}),n}),define("enums/UIPanelType",[],function(){function t(){}return t.TIME="timeLimit",t.HOURGLASS="hourglass",t.GRAVITY="gravitySwitch",t.JUNKSPAWN="clearJunk",t}),define("scenes/components/GameUIComponent",["bottom_line","phaser","gt/scenes/Scene","enums/UIPanelType","gt/utils/device"],function(t,e,i,n,s){function r(t,game,sceneManager,platform,gameUIController,tetrisInput,tetriminoHolderController,timeUIPanel,gravityUIPanel,hourglassUIPanel,gameInfoPublisher,junkspawnUIPanel,soundManager,gameVarManager){r._super.constructor.call(this,t||r.staticSceneName,game,sceneManager,platform),this._gameUIController=gameUIController,this._tetrisInput=tetrisInput,this._tetriminoHolderController=tetriminoHolderController,this._gameInfoPublisher=gameInfoPublisher,this._timeUIPanel=timeUIPanel,this._gravityUIPanel=gravityUIPanel,this._hourglassUIPanel=hourglassUIPanel,this._junkspawnUIPanel=junkspawnUIPanel,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._uiPanels={},this._uiPanelNames=[],this._panelPlaceHolders=[],this.paused=!1}return t.inherit(r,i),r.staticSceneName="GameUIComponent",r.prototype.init=function(){r._super.init.call(this),this._gameUIController.init(this),this._setButtonCallbacks(),this.labels.score.text=0},r.prototype.enter=function(t){r._super.enter.call(this),this._gameUIController.activate(t),this.resumeControl(),this._addEvents(),this._setAudioButtonVisibility(),this.groups.levelGoal&&(this.groups.levelGoal.visible=!1)},r.prototype.leave=function(){r._super.leave.call(this),this._gameUIController.deActivate(),this._tetrisInput.pauseSignal.remove(this._pause,this),this._removeEvents()},r.prototype.showPanels=function(t){var e=0;this._uiPanelNames.forEach(function(i){var n=this._uiPanels[i],s=t.indexOf(i),r=s>-1;if(r){n||(n=this._createPanelComponent(i));var o=this._panelPlaceHolders[e++];n.visible=!0,this._positionComponentAtPlaceholder(n,o),n.enter()}else n&&(n.visible=!1)},this)},r.prototype.pauseControl=function(){this.paused=!0},r.prototype.resumeControl=function(){this.paused=!1},r.prototype._createPanelComponent=function(t){var e=this._getUIPanel(t),i=r.DESKTOP_PANEL_CP_NAME;s.portable&&(i=r.MOBILE_PANEL_CP_NAME);var n=this.addComponent(i,null,t);return n.setPanel(e),this._uiPanels[t]=n,this.add(n.view),n},r.prototype._setPanelPlaceHolders=function(){this._panelPlaceHolders.push(this.placeHolders.textPanel1),this._panelPlaceHolders.push(this.placeHolders.textPanel2),this._panelPlaceHolders.push(this.placeHolders.textPanel3),this._panelPlaceHolders.push(this.placeHolders.textPanel4)},r.prototype._positionComponentAtPlaceholder=function(t,e){t.view.pivot.x=.5*e.dimensions.width,t.view.pivot.y=.5*-e.dimensions.height,t.x=e.x,t.y=e.y},r.prototype._holdButtonPressed=function(){this._tetriminoHolderController.holdTetrimino()},r.prototype._pause=function(){if(!this.paused){var t="GameDesktopCp"!==this.name?"controlsMobilePp":"controlsDesktopPp";this._sceneManager.showPopup(t)}},r.prototype._showHelpPopup=function(){},r.prototype._activatePauseButton=function(){this._tetrisInput.pauseSignal.addOnce(this._pause,this)},r.prototype._setButtonCallbacks=function(){this.buttons.pause.setCallback(this._pause,this),this.buttons.holdTetrimino.setCallback(this._holdButtonPressed,this),this.buttons.audioOff.setCallback(this._toggleAudio,this),this.buttons.audioOn.setCallback(this._toggleAudio,this)},r.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("lastHurrahTriggered",this.pauseControl,this),this._gameInfoPublisher.subscribe("countdownFinished",this._activatePauseButton,this)},r.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("lastHurrahTriggered",this.pauseControl,this),this._gameInfoPublisher.unsubscribe("countdownFinished",this._activatePauseButton,this)},r.prototype._toggleAudio=function(){this._soundManager.mute=!this._soundManager.mute,this._soundManager.mute?this._soundManager.stopAll():this._soundManager.music(this._gameVarManager.audioConstants.ingame_bgm,null,!0),this._setAudioButtonVisibility()},r.prototype._setAudioButtonVisibility=function(){var t=this._soundManager.mute;this.buttons.audioOff.setVisible(t),this.buttons.audioOn.setVisible(!t)},r}),define("scenes/components/GameDesktopCp",["bottom_line","phaser","scenes/components/GameUIComponent"],function(t,e,i){function n(game,sceneManager,platform,gameUIController,tetrisInput,tetriminoHolderController,gameInfoPublisher,timeUIPanel,gravityUIPanel,hourglassUIPanel,junkspawnUIPanel,soundManager,gameVarManager){n._super.constructor.call(this,n.staticSceneName,game,sceneManager,platform,gameUIController,tetrisInput,tetriminoHolderController,timeUIPanel,gravityUIPanel,hourglassUIPanel,gameInfoPublisher,junkspawnUIPanel,soundManager,gameVarManager)}return t.inherit(n,i),n.staticSceneName="GameDesktopCp",n.prototype.init=function(){n._super.init.call(this)},n}),define("scenes/components/GameMobileCp",["bottom_line","phaser","scenes/components/GameUIComponent","settings"],function(t,e,i){function n(game,sceneManager,platform,gameUIController,tetrisInput,tetriminoHolderController,timeUIPanel,gravityUIPanel,hourglassUIPanel,gameInfoPublisher,junkspawnUIPanel,soundManager,gameVarManager){n._super.constructor.call(this,n.staticSceneName,game,sceneManager,platform,gameUIController,tetrisInput,tetriminoHolderController,timeUIPanel,gravityUIPanel,hourglassUIPanel,gameInfoPublisher,junkspawnUIPanel,soundManager,gameVarManager)}return t.inherit(n,i),n.staticSceneName="GameMobileCp",n}),define("gt/scenes/Popup",["bottom_line","gt/scenes/Scene"],function(t,e){function i(t,game,sceneManager,platform,soundManager,spineUtil,gameVarManager){i._super.constructor.call(this,t,game,sceneManager,platform),this.bottomGroup=null,this.topGroup=null,this._gameVarManager=gameVarManager,this._spineUtil=spineUtil,this.tweenTimes={"in":1e3,out:1e3},this.onTweenInComplete=new Phaser.Signal,this.sfxString="02_pop-up",this.onEnter=new Phaser.Signal,this.onLeave=new Phaser.Signal,this._soundManager=soundManager}return t.inherit(i,e),i.ENTER_SOUND=null,i.EXIT_SOUND=null,t.extend(i.prototype,{init:function(){i._super.init.call(this),this.darkLayer=this._game.add.graphics(0,0),this.darkLayer.beginFill(null,.5),this.darkLayer.drawRect(this._game.viewport.world.x-this._game.viewport.width,0,this._game.width,this._game.height),this.darkLayer.endFill(),this.darkLayer.name="darkLayer",this.groups.bottom?console.error("Popup "+this.name+' already has a "bottom" group! Please rename your "bottom" group...'):(this.bottomGroup=this._game.make.group("bottom"),this.bottomGroup.pivot.x=-this._game.viewport.world.width/2,this.bottomGroup.pivot.y=this._game.viewport.world.height/2,this.bottomGroup.add(this.darkLayer),this.view.add(this.bottomGroup)),this.groups.top?console.error("Popup "+this.name+' already has a "top" group! Please rename your "top" group...'):(this.topGroup=this._game.make.group("top"),this.view.children.forEach(function(t){t.name._.has("darkLayer")||this.topGroup.add(t)},this),this.view.add(this.topGroup)),this._spineAnimation=this._spineUtil.replacePlaceholder(this.topGroup,"popup_flash"),this._spineAnimation.x=0,this._spineAnimation.y=0,i.ENTER_SOUND=this._gameVarManager.audioConstants.popup_open_sfx,i.EXIT_SOUND=this._gameVarManager.audioConstants.popup_close_sfx},enter:function(){this._game.input.disabled=!0,i._super.enter.call(this),this._spineAnimation.scale.y=1,this._spineAnimation.startAnimation("popup_in",!1,!1),this._spineAnimation.onComplete.addOnce(this.enterComplete,this),this.topGroup.visible=!1;var t=this._game.add.tween(this.bottomGroup);t.alpha=0,t.to({alpha:1},this.tweenTimes.out),t.start(),i.ENTER_SOUND&&this._soundManager.effect(i.ENTER_SOUND)},enterComplete:function(){this._spineAnimation.startAnimation("popup_flash",!1,!1),this.topGroup.visible=!0,this.onTweenInComplete.dispatch(),this._game.input.disabled=!1,this.onEnter.dispatch()},closePopup:function(){this._game.input.disabled=!0,this._spineAnimation.startAnimation("popup_flash",!1,!1,!0),this._spineAnimation.onComplete.addOnce(this.startExit,this)},startExit:function(){this.topGroup.visible=!1,this._spineAnimation.scale.y=-1,this._spineAnimation.startAnimation("popup_in",!1,!1,!0),this._spineAnimation.onComplete.addOnce(this.exitComplete,this);var t=this._game.add.tween(this.bottomGroup);t.to({alpha:0},this.tweenTimes.out),t.start(),i.EXIT_SOUND&&this._soundManager.effect(i.EXIT_SOUND)},exitComplete:function(){this._sceneManager.leavePopup(this),this.onLeave.dispatch(),this._game.input.disabled=!1}}),i}),define("scenes/popups/ControlsDesktopPp",["bottom_line","gt/scenes/Popup"],function(t,e){function i(game,sceneManager,platform,soundManager,spineUtil,gameInfoPublisher,gameVarManager,storageManager,controlScheme,localizationManager,worldProgress,tetrisInput){i._super.constructor.call(this,i.staticSceneName,game,sceneManager,platform,soundManager,spineUtil,gameVarManager),this._gameInfoPublisher=gameInfoPublisher,this._storageManager=storageManager,this._controlScheme=controlScheme,this._localizationManager=localizationManager,this._worldProgress=worldProgress,this._tetrisInput=tetrisInput}return t.inherit(i,e),i.staticSceneName="controlsDesktopPp",i.prototype.init=function(){i._super.init.call(this),this.buttons["continue"].setCallback(this._continuePressed,this)},i.prototype.enter=function(){i._super.enter.call(this),this.resumeSignal=this._tetrisInput.resumeSignal,this._gameInfoPublisher.publish("gamePaused"),this._soundManager.music(this._gameVarManager.audioConstants.pause_bgm,null,!0)},i.prototype.enterComplete=function(){i._super.enterComplete.call(this),this.resumeSignal.addOnce(this._continuePressed,this),this.resumeSignal.active=!0},i.prototype.leave=function(){i._super.leave.call(this),this.resumeSignal.remove(this._continuePressed,this)},i.prototype._continuePressed=function(){this.onLeave.addOnce(function(){this._soundManager.stop(this._gameVarManager.audioConstants.pause_bgm),this._gameInfoPublisher.publish("countdownBegin",null,null,!0)},this),this.closePopup()},i}),define("data/ControlScheme",[],function(){function t(storageManager,gameVarManager){this._storageManager=storageManager,this._gameVarManager=gameVarManager}return t.CURRENT_SCHEME_KEY="CURRENT_SCHEME_KEY",t.SMART=2,t.SWIPE=1,t.DESKTOP=0,Object.defineProperty(t.prototype,t.CURRENT_SCHEME_KEY,{get:function(){var e=this._gameVarManager.constants.controlSchemeType,i=this._storageManager.get(t.CURRENT_SCHEME_KEY);return i?i:e},set:function(e){this._storageManager.set(t.CURRENT_SCHEME_KEY,e)}}),t}),define("scenes/popups/ControlsMobilePp",["bottom_line","gt/scenes/Popup","data/ControlScheme"],function(t,e,i){function n(game,sceneManager,platform,soundManager,spineUtil,gameInfoPublisher,gameVarManager,controlScheme,storageManager,localizationManager,worldProgress){n._super.constructor.call(this,n.staticSceneName,game,sceneManager,platform,soundManager,spineUtil,gameVarManager),this._gameInfoPublisher=gameInfoPublisher,this._controlScheme=controlScheme,this._storageManager=storageManager,this._localizationManager=localizationManager,this._worldProgress=worldProgress}return t.inherit(n,e),n.staticSceneName="controlsMobilePp",n.prototype.init=function(){n._super.init.call(this),this._setButtonCallbacks()},n.prototype.enter=function(){n._super.enter.call(this),this._gameInfoPublisher.publish("gamePaused"),this.labels.headerfont_header.text=this._localizationManager.get("Controls"),this._soundManager.music(this._gameVarManager.audioConstants.pause_bgm,null,!0),this._showCurrentScheme()},n.prototype.leave=function(){this._sendChosenControlsAnalytics(!1),n._super.leave.call(this)},n.prototype._setButtonCallbacks=function(){this.buttons["continue"].setCallback(this._continuePressed,this),this.buttons.activateSmartControls.setCallback(this._activateSmart,this),this.buttons.activateClassicControls.setCallback(this._activateClassic,this)},n.prototype._activateSmart=function(){this.groups.classiccontrols.visible&&this._changeControlsTo(i.SMART)},n.prototype._activateClassic=function(){this.groups.smartcontrols.visible&&this._changeControlsTo(i.SWIPE)},n.prototype._changeControlsTo=function(controlScheme){var t=controlScheme===i.SMART;this.groups.smartcontrols.visible=t,this.groups.classiccontrols.visible=!t,this._gameInfoPublisher.publish("controlSchemeChanged",controlScheme)},n.prototype._showCurrentScheme=function(){var t=this._controlScheme[i.CURRENT_SCHEME_KEY],e=t===i.SMART;this.groups.smartcontrols.visible=e,this.groups.classiccontrols.visible=!e},n.prototype._continuePressed=function(){this.onLeave.addOnce(function(){this._gameInfoPublisher.publish("countdownBegin",null,null,!0),this._soundManager.stop(this._gameVarManager.audioConstants.pause_bgm)},this),this.closePopup()},n.prototype._sendChosenControlsAnalytics=function(t){var e="firstTimeChosenControls_";t||(e="controlsSwitchedTo_");var n="Smart_Mobile";this._controlScheme[i.CURRENT_SCHEME_KEY]===i.SWIPE&&(n="Swipe"),this._platform.analytics(e+n)},n}),define("ReadWriteDataHandler",["bottom_line"],function(t){function e(){}return e.prototype.readGET_Parameters=function(){var t=window.location.search.slice(1),e=unescape(t).replace(/amp;/g,"").replace(/\+/g," "),i=e.split("&"),n={};return i.forEach(function(t){var e=t._.before("="),i=t._.after("=");n[e]=i}),n},e.prototype.writePOST_Message=function(t,e){var i=document.createElement("form");i.setAttribute("method","post"),i.setAttribute("action",t),i.setAttribute("target","_parent");for(var n in e)if(e.hasOwnProperty(n)){var s=document.createElement("input");s.setAttribute("type","hidden"),s.setAttribute("name",n),s.setAttribute("value",e[n]),i.appendChild(s)}document.body.appendChild(i),i.submit()},e}),define("scenes/popups/MarathonModePp",["bottom_line","gt/utils/StringUtil","gt/scenes/Popup","ReadWriteDataHandler"],function(t,e,i,n){function s(game,sceneManager,platform,soundManager,spineUtil,gameVarManager,gameManager,gameInfoPublisher,scoreManager,gameStateManager,neededLineClearsToWin,lineClearCounter,marathonProgress,scoreAdController){s._super.constructor.call(this,s.staticSceneName,game,sceneManager,platform,soundManager,spineUtil,gameVarManager),this._sceneManager=sceneManager,this._gameManager=gameManager,this._gameInfoPublisher=gameInfoPublisher,this._scoreManager=scoreManager,this._gameStateManager=gameStateManager,this._neededLineClearsToWin=neededLineClearsToWin,this._lineClearCounter=lineClearCounter,this._marathonProgress=marathonProgress,this._platform=platform,this._scoreAdController=scoreAdController,this._levelData=null,this._gameInfoPublisher.subscribe("gameEnded",this._onGameOver,this),this.readWriteDataHandler=new n,this.paramsGET=this.readWriteDataHandler.readGET_Parameters()}return t.inherit(s,i),s.staticSceneName="marathonModePp",s.prototype.init=function(){s._super.init.call(this),this._setUIText(this.paramsGET)},s.prototype.enter=function(){s._super.enter.call(this),this._gameInfoPublisher.publish("levelEndPpEnter"),this._hideUI(),this._setLevelReachedText(),this._setHighScoreText(),this._setScoreText(this._showButtons,this),this._setLineClearsText(),this._platform.saveUserData(function(){},this)},s.prototype._hideUI=function(){for(var t in this.buttons){var e=this.buttons[t];e.setVisible(!1)}this.labels.endOfGameMsg.text=""},s.prototype._setUIText=function(t){this.labels.headerfont_header.text=t.t||"",this.labels.btn1.text=t.o1||"",this.labels.btn2.text=t.o2||"",this.labels.btn3.text=t.o3||"",this.buttons.btnGr_btn1.setCallback(function(){this._sendPOST_request.call(this,this.paramsGET.o1p)},this),this.buttons.btnGr_btn2.setCallback(function(){this._sendPOST_request.call(this,this.paramsGET.o2p)},this),this.buttons.btnGr_btn3.setCallback(function(){this._sendPOST_request.call(this,this.paramsGET.o3p)},this)},s.prototype._showButtons=function(){var e=this.paramsGET;this.labels.endOfGameMsg.text=e.m||"";var i=this;t.callAfter(200,function(){i.buttons.btnGr_btn1.setVisible(e.no>0),i.buttons.btnGr_btn2.setVisible(e.no>1),i.buttons.btnGr_btn3.setVisible(e.no>2)})},s.prototype._sendPOST_request=function(t){var e=this.paramsGET,i={u:e.u,g:e.g,p:e.p,s:e.s,tl:e.tl,fl:e.fl,o:t};this.readWriteDataHandler.writePOST_Message(e.url,i)},s.prototype._replayPressed=function(){this.onLeave.addOnce(function(){this._gameInfoPublisher.publish("levelStart"),this._sceneManager.show("game",0)},this),this.closePopup()},s.prototype._setHighScoreText=function(){var t=this._scoreManager.isNewHighScore();this.labels.highScore.visible=!t,this.labels.highScoreNew.visible=t;var e=this._scoreManager.getHighScoreForLevel(this._levelData.levelId);this.labels.highscoreValue.text=e},s.prototype._setScoreText=function(t,e){var i=this._scoreManager.getScore();this.labels.scoreValue.text=0,this.labels.scoreValue.countTo(i,this._gameVarManager.constants.score_count_timer,t,e),this.paramsGET.s=i},s.prototype._setLevelReachedText=function(){var t=this._marathonProgress.getAchievedLevel(),e=this._gameVarManager.constants.marathonMaxLevel;t>e&&(t=e),this.labels.speedlvlValue.text=t,this.paramsGET.fl=t},s.prototype._setLineClearsText=function(){var t=this._marathonProgress.getAchievedLinesCleared();this.labels.lineClearsValue.text=t,this.paramsGET.tl=t},s.prototype._onGameOver=function(t,e){this._levelData=e},s}),define("scenes/SceneList",["bottom_line","scenes/Game","scenes/Loader","scenes/components/GameDesktopCp","scenes/components/GameMobileCp","scenes/popups/ControlsDesktopPp","scenes/popups/ControlsMobilePp","scenes/popups/MarathonModePp"],function(t){var e={};e.getScene=function(t){var i=e[t];return console.assert(i,"Scene with name "+t+" was not found in SceneList."),i},e.addScene=function(t){var i=t.staticSceneName._.decapitalize();console.assert(i,"Scene does not have a staticSceneName defined: "+t),e[i]=t};for(var i=1;i<arguments.length;++i)e.addScene(arguments[i]);return e}),define("gt/scenes/SceneFactory",["scenes/SceneList"],function(t){var e=function(injector){this._injector=injector};return e.prototype.construct=function(e){var i=[],n=t.getScene(e);if(i.push(n),arguments.length>1)for(var s=1;s<arguments.length;++s)i.push(arguments[s]);return this._injector.createInstance.apply(this._injector,i)},e}),define("gt/scenes/SceneLoader",["bottom_line"],function(t){var e=function(viewCreator,viewportManager,sceneFactory){this._viewCreator=viewCreator,this._viewportManager=viewportManager,this._sceneFactory=sceneFactory};return e.prototype.calculatePosition=function(t){var e=0,i=0;if(t.relativePosition){var n;switch(t.relativeTo){case"Viewport":n=game.viewport;break;case"World":n=game.viewport.world;break;default:n=game.viewport.world}e=n.width*parseFloat(t.positionPercentX)-n.width/2,i=n.height*(1-parseFloat(t.positionPercentY))-n.height/2}return e+=parseFloat(t.x)*game.viewport.scale,i+=-parseFloat(t.y)*game.viewport.scale,{x:e,y:i}},e.prototype.loadElements=function(e,i,n){for(var s,r,o=0,a=n.length;a>o;o++){var h=this._viewportManager.scale;s=null,r=t.clone(n[o]);var l=this.calculatePosition(r);switch(r.x=l.x,r.y=l.y,r.scaleX*=h,r.scaleY*=h,r.width*=r.scaleX,r.height*=r.scaleY,r.rotation=-r.rotation,r.type){case"Image":s=this._viewCreator.addImage(i,r),e.images[s.id._.after("img_")]=s;break;case"Sprite":s=this._viewCreator.addImage(i,r),e.images[s.id._.after("spr_")]=s;break;case"RenderTexture":s=this._viewCreator.addRenderTexture(i,r),this.loadElements(e,s,n[o].children),e.images[s.id._.after("rtex_")]=s;break;case"PlaceHolder":s=this._viewCreator.addPlaceholder(i,r),e.placeHolders[r.name._.after("ph_")]=s;break;case"Button":s=this._viewCreator.addButtonGroup(i,e,r),this.loadElements(e,s,r.children),e.buttons[s.id._.after("btn_")]=s;break;case"Label":s=this._viewCreator.addText(i,r,!1),e.labels[s.id._.after("lbl_")]=s;break;case"BitmapFont":s=this._viewCreator.addText(i,r,!0),e.labels[s.id._.after("bmf_")]=s;break;case"Group":s=this._viewCreator.addGroup(e,i,r),this.loadElements(e,s,n[o].children),s.id._.has("Btn")?e.groups.buttons[s.id]=s:r.name._.startsWith("ph_")?e.placeHolders[r.name._.after("ph_")]=s:e.groups[s.id._.after("grp_")]=s}}},e.prototype.loadScene=function(t,e,i){e=e._.decapitalize(),console.log("SceneLoader.loadScene ("+e+")");var n=this._sceneFactory.construct(e),s=t.children;return n.data=t,this.loadElements(n,n.view,s,n.data),n.init.apply(n,i),n},e.prototype.loadAllScenes=function(){console.log("SceneLoader.loadAllScenes");var t=game.cache.getJSON("scenes");t._.each(function(t,e){var i=e;i._.startsWith("cp_")||i._.endsWith("Cp")||(i=i._.decapitalize(),"loader"!==i&&this.loadScene(t,i))},this)},e.prototype.createComponent=function(t,e){var i=t._.decapitalize(),n=game.cache.getJSON("scenes");return n[i]?this.loadScene(n[i],t,e):void 0},e}),define("gt/scenes/Background",["bottom_line","phaser","settings","gt/scenes/BackgroundSize"],function(t,e,settings,i){function n(game,spritesheetManager,viewportManager){this._game=game,this._spritesheetManager=spritesheetManager,this._viewportManager=viewportManager,this.canvas=dom("#game_background"),this.ctx=this.canvas.getContext("2d"),this.style=this.canvas.style,this.size=settings.backgroundSize,this.options=null,this.backgroundImageName="",this.imageData=null,this.scaleX=1,this.scaleY=1,this.drawRect=null,this.setup()}return t.extend(n.prototype,{setup:function(){switch(this.size){case i.Viewport:this.drawRect=new e.Rectangle(0,0,this._viewportManager.width,this._viewportManager.height);break;case i.World:this.drawRect=new e.Rectangle(this._viewportManager.world.x,this._viewportManager.world.y,this._viewportManager.world.width,this._viewportManager.world.height);break;case i.Game:default:this.drawRect=new e.Rectangle(this._viewportManager.game.x,this._viewportManager.game.y,this._viewportManager.game.width,this._viewportManager.game.height)}this.init()},init:function(){var t=this._game.canvas.style;this.ctx.globalAlpha=1,this.style.marginLeft=t.marginLeft,this.style.marginTop=t.marginTop,this.style.width=t.width,this.style.height=t.height,this.style.display="block",this.canvas.width=this._game.canvas.width,this.canvas.height=this._game.canvas.height},set:function(t,e){this.options=e||{},this.backgroundImageName=t,this.imageData=null,this.backgroundImageName&&this.drawBackgroundImage(this.backgroundImageName,this.options),this.options.vignette&&this.drawVignette(this.options.vignette),this.options.borderRects&&this.drawBorderRects(),this.options.borderLines&&this.drawBorderLines(),this.options.color&&(dom("body").style.backgroundColor=this.options.color)},drawBorderLines:function(){var t=this.ctx;t.beginPath(),t.moveTo(this._viewportManager.world.x,0),t.lineTo(this._viewportManager.world.x,this._game.world.height),t.moveTo(this._viewportManager.world.x+this._viewportManager.world.width,0),t.lineTo(this._viewportManager.world.x+this._viewportManager.world.width,this._game.world.height),t.lineWidth=1,t.strokeStyle="#ffffff",t.stroke()},drawBorderRects:function(){var t=this.ctx;t.globalAlpha=.2,t.fillStyle="#000000",t.fillRect(0,0,this._viewportManager.world.x,this._game.height),t.fillRect(this._viewportManager.world.x+this._viewportManager.world.width,0,this._viewportManager.world.x,this._game.height),t.globalAlpha=1},drawBackgroundImage:function(t,e){var i=this._spritesheetManager.sprites[t],n=this._game.cache.getImage(i.spritesheet),s=i.data,r=this.drawRect.width/this.drawRect.height,o=s.width/s.height;switch(!0){case e.repeat:for(var a=s.width*this._viewportManager.scale,h=s.height*this._viewportManager.scale,l=Math.ceil(this.drawRect.height/h),c=Math.ceil(this.drawRect.width/a),u=0;l>u;u++)for(var d=0;c>d;d++)this.ctx.drawImage(n,s.x,s.y,s.width,s.height,this.drawRect.x+d*a,this.drawRect.y+u*h,a,h);break;case e.stretch:this.ctx.drawImage(n,s.x,s.y,s.width,s.height,this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height);break;default:var A,p,m=1;o>r?(m=this.drawRect.height/s.height,A=this.drawRect.width/m,p=s.height):r>=o&&(m=this.drawRect.width/s.width,A=s.width,p=this.drawRect.height/m);var f=s.x+s.width/2-A/2,g=s.y+s.height/2-p/2;this.ctx.drawImage(n,f,g,A,p,this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height)}},drawVignette:function(t){var e,i=this._spritesheetManager.sprites[t],n=i?i.spritesheet:t,s=this._game.cache.getImage(n);e=i?i.data:{x:0,y:0,width:s.width,height:s.height},this.ctx.drawImage(s,e.x,e.y,e.width,e.height,this.drawRect.x,this.drawRect.y,this.drawRect.width,this.drawRect.height)},refresh:function(){this.setup(),this.set(this.backgroundImageName,this.options)}}),n}),define("gt/scenes/Foreground",["bottom_line","phaser"],function(t,e){function i(t){i._super.constructor.call(this,game,null,t),this.groups={images:this.add(game.make.group("foreground_images")),components:this.add(game.make.group("foreground_components"))}}return t.inherit(i,e.Group),i}),define("gt/scenes/SceneManager",["bottom_line","gt/scenes/Background","gt/scenes/Foreground"],function(t,e,i){var n=function(viewportManager,game,sceneLoader,spritesheetManager,phaserEvents){console.log("SceneManager.ctor"),this.inputEnabled=!0,this.view={},this.filters={},this._viewportManager=viewportManager,this._game=game,this._sceneLoader=sceneLoader,this._spritesheetManager=spritesheetManager,this._phaserEvents=phaserEvents,this._scenes={},this._popups={},this._components={},this._current=null,this._previous=null,this._activePopups=[],this._queuedPopups=[],this._viewportManager.screenChangedEvent.add(this.onScreenChanged,this)};return n.prototype.init=function(){this.filters.blur=this._game.add.filter("Blur",800,600),this.filters.blur.blur=0,this.view.background=new e(this._game,this._spritesheetManager,this._viewportManager),this.view.scenes=this._viewportManager.view.add(this._game.make.group("view_scenes")),this.view.components=this._viewportManager.view.add(this._game.make.group("view_components")),this.view.foreground=this._viewportManager.view.add(new i("view_foreground")),this.view.popups=this._viewportManager.view.add(this._game.make.group("view_popups")),this._phaserEvents.updateEvent.add(this.onUpdate,this)},n.prototype.getScene=function(t){t=t._.decapitalize();var e="scenes";t._.endsWith("Pp")?e="popups":t._.endsWith("Cp")&&(e="components");var i;switch(e){case"scenes":i=this._scenes;break;case"popups":i=this._popups;break;case"components":i=this._components}return console.assert(i[t],"SceneManager does not contain scene with name "+t),i[t]},n.prototype.onScreenChanged=function(){t.delay(800,function(){this.view.background.refresh()},this),this._current&&this._current.screenChanged()},n.prototype.add=function(t){var e=t.name._.decapitalize(),i="scenes";e._.endsWith("Pp")?i="popups":e._.endsWith("Cp")&&(i="components"),this.view[i].add(t.view);var n;switch(i){case"scenes":n=this._scenes;break;case"popups":n=this._popups;break;case"components":n=this._components}if("components"!=i&&n[e])throw"a scene with the name "+e+" already exists!";n[e]=t},n.prototype.onUpdate=function(){this._current&&this._current.update();var t=this._popups[this._activePopups[0]];t&&t.update&&t.update()},n.prototype.createLoader=function(){var t=this._game.cache.getJSON("loader");this._current=this._sceneLoader.loadScene(t,"Loader")},n.prototype.createScenes=function(){this._sceneLoader.loadAllScenes()},n.prototype.createComponent=function(t,e){return this._sceneLoader.createComponent(t,e)},n.prototype.show=function(t,e){t=t._.decapitalize(),this._previous=this._current,this._previous&&this._previous.leave(),this._activePopups.length&&(this._activePopups._.each(function(t){this._popups[t].setVisible(!1),this._popups[t].setActive(!1)},this),this._activePopups.length=0),this._current=this._scenes[t],this._current.enter.apply(this._current,Array.prototype.slice.call(arguments,1))},n.prototype.showPopup=function(t){var e=t;"string"==typeof t&&(t=t._.decapitalize(),e=this._popups[t]),this._current.setActive(!1),this._activePopups.length>0?this._queuedPopups.push(Array.prototype.slice.call(arguments,0)):(Array.prototype.shift.apply(arguments),e.isVisible()&&e.leave(),e.enter.apply(e,arguments),this._activePopups.push(e.name._.decapitalize()))},n.prototype.leavePopup=function(t){if("string"==typeof t&&(t=t._.decapitalize(),t=this._popups[t]),t.setVisible(!1),t.setActive(!1),t.leave(),this._activePopups.splice(this._activePopups.indexOf(this._activePopups[t.name._.decapitalize()])),0===this._queuedPopups.length)this._current.setActive(!0);else{var e=this._queuedPopups.shift();this.showPopup.apply(this,e)}},n}),define("gt/input/KeyboardInput",["bottom_line","phaser"],function(t,e){var i=function(game,t){console.log("KeyboardInput.ctor"),this._game=game,this._inputMapper=t,this.currentKeyboardState={},this.previousKeyboardState={},this.keyJustReleasedEvent=new e.Signal,
this.keyPressedEvent=new e.Signal,this.keyJustPressedEvent=new e.Signal,this.keyboardStateChangedEvent=new e.Signal};return i.JUST_RELEASED="just_released",i.PRESS="press",i.JUST_PRESSED="just_pressed",i.cloneKeyboardState=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},i.prototype.mapInputs=function(){this._inputMapper.map(i.JUST_RELEASED,this.keyJustReleasedEvent,function(t){return t}),this._inputMapper.map(i.PRESS,this.keyPressedEvent,function(t){return t}),this._inputMapper.map(i.JUST_PRESSED,this.keyJustPressedEvent,function(t){return t})},i.prototype.startCapturing=function(){this._game.input.keyboard.callbackContext=this,this._game.input.keyboard.onDownCallback=this.onKeyDown,this._game.input.keyboard.onUpCallback=this.onKeyUp},i.prototype.stopCapturing=function(){this._game.input.keyboard.callbackContext=null,this._game.input.keyboard.onDownCallback=null,this._game.input.keyboard.onUpCallback=null},i.prototype.onKeyDown=function(t){this.previousKeyboardState=i.cloneKeyboardState(this.currentKeyboardState);var e=t.keyCode;this.currentKeyboardState[e]=!0,this.currentKeyboardState[e]!=this.previousKeyboardState[e]&&this.keyJustPressedEvent.dispatch(e),this.keyPressedEvent.dispatch(e),this.keyboardStateChangedEvent.dispatch(this.currentKeyboardState,this.previousKeyboardState)},i.prototype.onKeyUp=function(t){this.previousKeyboardState=i.cloneKeyboardState(this.currentKeyboardState);var e=t.keyCode;this.currentKeyboardState[e]=!1,this.keyJustReleasedEvent.dispatch(e),this.keyboardStateChangedEvent.dispatch(this.currentKeyboardState,this.previousKeyboardState)},i}),define("gt/input/GamepadInput",["bottom_line","phaser"],function(t,e){var i=function(game,t){console.log("GamepadInput.ctor"),this._game=game,this._inputMapper=t,this.currentGamepadState={},this.previousGamepadState={},this.buttonJustReleasedEvent=new e.Signal,this.buttonPressedEvent=new e.Signal,this.buttonJustPressedEvent=new e.Signal,this.buttonStateChangedEvent=new e.Signal,this.leftStickMovedEvent=new e.Signal,this.rightStickMovedEvent=new e.Signal};return i.JUST_RELEASED="just_released",i.PRESS="press",i.LEFT_STICK="left_stick",i.RIGHT_STICK="right_stick",i.LEFT="left",i.RIGHT="right",i.UP="up",i.DOWN="down",i.A=0,i.B=1,i.X=2,i.Y=3,i.DEAD_ZONE=.5,i.cloneGamepadState=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},i.prototype.mapInputs=function(){this._inputMapper.map(i.JUST_RELEASED,this.buttonJustReleasedEvent,function(t){return t}),this._inputMapper.map(i.PRESS,this.buttonPressedEvent,function(t){return t}),this._inputMapper.map(i.JUST_PRESSED,this.buttonJustPressedEvent,function(t){return t}),this._inputMapper.map(i.LEFT_STICK,this.leftStickMovedEvent,function(t){return t}),this._inputMapper.map(i.RIGHT_STICK,this.rightStickMovedEvent,function(t){return t})},i.prototype.startCapturing=function(){this._game.input.gamepad.start(),this._game.input.gamepad.callbackContext=this,this._game.input.gamepad.onDownCallback=this.onButtonDown,this._game.input.gamepad.onUpCallback=this.onButtonUp,this._game.input.gamepad.onAxisCallback=this.onAxisChanged},i.prototype.stopCapturing=function(){this._game.input.gamepad.callbackContext=null,this._game.input.gamepad.onDownCallback=null,this._game.input.gamepad.onUpCallback=null,this._game.input.gamepad.onAxisCallback=null},i.prototype.onAxisChanged=function(t,e,n){var s=2>e?this.leftStickMovedEvent:this.rightStickMovedEvent,r=e%2,o=null;0===r?n<-i.DEAD_ZONE?o=i.LEFT:n>i.DEAD_ZONE&&(o=i.RIGHT):n<-i.DEAD_ZONE?o=i.UP:n>i.DEAD_ZONE&&(o=i.DOWN),null!==o&&s.dispatch(o)},i.prototype.onButtonDown=function(t){this.previousGamepadState=i.cloneGamepadState(this.currentGamepadState),this.currentGamepadState[t]=!0,this.currentGamepadState[t]!=this.previousGamepadState[t]&&this.buttonJustPressedEvent.dispatch(t),this.buttonPressedEvent.dispatch(t),this.buttonStateChangedEvent.dispatch(this.currentGamepadState,this.previousGamepadState)},i.prototype.onButtonUp=function(t){this.previousGamepadState=i.cloneGamepadState(this.currentGamepadState),this.currentGamepadState[t]=!1,this.buttonJustReleasedEvent.dispatch(t),this.buttonStateChangedEvent.dispatch(this.currentGamepadState,this.previousGamepadState)},i}),define("gt/scenes/SceneInput",["phaser","gt/input/KeyboardInput","gt/input/GamepadInput"],function(t,e,i){var n=function(game,t){console.log("SceneInput.ctor"),this._game=game,this._inputMapper=t};return n.prototype.bindAll=function(n){var s=n.selectNextButton;this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.DOWN,s,n),this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.RIGHT,s,n),this._inputMapper.bind(i.LEFT_STICK,i.DOWN,s,n),this._inputMapper.bind(i.LEFT_STICK,i.RIGHT,s,n);var r=n.selectPreviousButton;this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.UP,r,n),this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.LEFT,r,n),this._inputMapper.bind(i.LEFT_STICK,i.UP,r,n),this._inputMapper.bind(i.LEFT_STICK,i.LEFT,r,n);var o=n.activateCurrentButton;this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.SPACEBAR,o,n),this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.ENTER,o,n),this._inputMapper.bind(i.JUST_PRESSED,i.A,o,n);var a=n.close;this._inputMapper.bind(e.JUST_PRESSED,t.Keyboard.ESC,a,n),this._inputMapper.bind(i.JUST_PRESSED,i.B,a,n)},n.prototype.unbindAll=function(){this._inputMapper.unbindAll()},n}),define("gt/gui/TextCounter",["bottom_line","phaser"],function(t,e){function i(phaserEvents,game,gameVarManager,soundManager){this._phaserEvents=phaserEvents,this._game=game,this._gameVarManager=gameVarManager,this._soundManager=soundManager,this.onCountComplete=new e.Signal}return t.extend(i,{UPWARDS:1,DOWNWARDS:2}),t.extend(i.prototype,{overwrite:!1,override:!1},{countTo:function(t,e,n,s,r){this._label=t;var o=Math.round(1e3*this._game.time.physicsElapsed);this.countTemp=parseInt(this._label.text)||0,this.countTarget=e||10,this.countTime=n||1e3,this.countStep=(this.countTarget-this.countTemp)/this.countTime*o,this.countDirection=Math.max(this.countTemp,this.countTarget)==this.countTarget?i.UPWARDS:i.DOWNWARDS,this.counting=!0,this.countOnComplete=s&&s.bind(r),this.counting&&this._phaserEvents.updateEvent.remove(this.updateCounter,this),this._phaserEvents.updateEvent.add(this.updateCounter,this)},updateCounter:function(){this.counting&&(this.countTemp+=this.countStep,this.countDirection===i.UPWARDS&&this.countTemp>this.countTarget?this.countTemp=this.countTarget:this.countDirection===i.DOWNWARDS&&this.countTemp<this.countTarget&&(this.countTemp=this.countTarget),this._label.setText(Math.round(this.countTemp)),this.countTemp==this.countTarget&&(this.counting=!1,this._phaserEvents.updateEvent.remove(this.updateCounter,this),this.countOnComplete&&this.countOnComplete(),this.onCountComplete.dispatch()))}}),i}),define("gt/modules/SystemsSetup",["soma","gt/audio/SoundManager","gt/scenes/ViewCreator","gt/scenes/SceneFactory","gt/scenes/SceneLoader","gt/scenes/SceneManager","gt/scenes/SceneInput","gt/managers/SpritesheetManager","gt/constants/ConsoleCSS","gt/gui/TextCounter"],function(t,e,i,n,s,r,o,a,h,l){var c=function(injector){this._injector=injector};return c.prototype.run=function(c,u){console.log("%c [DI module] %c SystemsSetup ",h.MODULE_TAG,h.MODULE_TEXT),this._injector.mapClass("soundManager",e,t.SINGLETON),this._injector.mapClass("spritesheetManager",a,t.SINGLETON),this._injector.mapClass("viewCreator",i,t.SINGLETON),this._injector.mapClass("sceneFactory",n,t.SINGLETON),this._injector.mapClass("sceneLoader",s,t.SINGLETON),this._injector.mapClass("sceneManager",r,t.SINGLETON),this._injector.mapClass("sceneInput",o,t.SINGLETON),this._injector.mapClass("textCounter",l);var sceneManager=this._injector.getValueFromClass(r);sceneManager.init();var spritesheetManager=this._injector.getValueFromClass(a);game.spritesheets=spritesheetManager,c.call(u)},c}),function(t,e){"function"==typeof define&&define.amd?define("fontloader",[],e):"object"==typeof exports?module.exports=e():t.FontLoader=e()}(window,function(){function t(t,e,i){this.delegate=e,this.timeout="undefined"!=typeof i?i:3e3,this._fontFamiliesArray=t.slice(0),this._testContainer=null,this._adobeBlankSizeWatcher=null,this._timeoutId=null,this._intervalId=null,this._intervalDelay=50,this._numberOfLoadedFonts=0,this._numberOfFontFamilies=this._fontFamiliesArray.length,this._fontsMap={},this._finished=!1}function e(t,e){this.width=t,this.height=e}function i(t,e){this._element=t,this._delegate=e.delegate,this._size=null,this._continuous=!!e.continuous,this._direction=e.direction?e.direction:i.directions.both,this._dimension=e.dimension?e.dimension:i.dimensions.both,this._sizeIncreaseWatcherContentElm=null,this._sizeDecreaseWatcherElm=null,this._sizeIncreaseWatcherElm=null,this._state=i.states.initialized,this._scrollAmount=2,this._generateScrollWatchers(e.size),this._appendScrollWatchersToElement(e.container)}var n=/MSIE/i.test(navigator.userAgent),s=null;if(n){var r,o;r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),o=r.exec(navigator.userAgent),null!==o&&(s=parseFloat(o[1]))}return t.testDiv=null,t.useAdobeBlank=!n||s>=11,t.useResizeEvent=n&&11>s&&"undefined"!=typeof document.attachEvent,t.useIntervalChecking=window.opera||n&&11>s&&!t.useResizeEvent,t.referenceText=" !\"\\#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",t.referenceFontFamilies=t.useAdobeBlank?["AdobeBlank"]:["serif","cursive"],t.referenceFontFamiliesSizes=[],t.adobeBlankFontFaceRule="@font-face{ font-family:AdobeBlank; src:url('data:font/opentype;base64,T1RUTwAKAIAAAwAgQ0ZGIM6ZbkwAAEPEAAAZM0RTSUcAAAABAABtAAAAAAhPUy8yAR6vMwAAARAAAABgY21hcDqI98oAACjEAAAa4GhlYWT+BQILAAAArAAAADZoaGVhCCID7wAAAOQAAAAkaG10eAPoAHwAAFz4AAAQBm1heHAIAVAAAAABCAAAAAZuYW1lD/tWxwAAAXAAACdScG9zdP+4ADIAAEOkAAAAIAABAAAAAQj1Snw1O18PPPUAAwPoAAAAAM2C2p8AAAAAzYLanwB8/4gDbANwAAAAAwACAAAAAAAAAAEAAANw/4gAyAPoAHwAfANsAAEAAAAAAAAAAAAAAAAAAAACAABQAAgBAAAABAAAAZAABQAAAooCWAAAAEsCigJYAAABXgAyANwAAAAAAAAAAAAAAAD3/67/+9///w/gAD8AAAAAQURCRQHAAAD//wNw/4gAyANwAHhgLwH/AAAAAAAAAAAAAAAgAAAAAAARANIAAQAAAAAAAQALAAAAAQAAAAAAAgAHAAsAAQAAAAAAAwAbABIAAQAAAAAABAALAAAAAQAAAAAABQA5AC0AAQAAAAAABgAKAGYAAwABBAkAAABuAHAAAwABBAkAAQAWAN4AAwABBAkAAgAOAPQAAwABBAkAAwA2AQIAAwABBAkABAAWAN4AAwABBAkABQByATgAAwABBAkABgAUAaoAAwABBAkACAA0Ab4AAwABBAkACwA0AfIAAwABBAkADSQSAiYAAwABBAkADgBIJjhBZG9iZSBCbGFua1JlZ3VsYXIxLjAzNTtBREJFO0Fkb2JlQmxhbms7QURPQkVWZXJzaW9uIDEuMDM1O1BTIDEuMDAzO2hvdGNvbnYgMS4wLjcwO21ha2VvdGYubGliMi41LjU5MDBBZG9iZUJsYW5rAKkAIAAyADAAMQAzACAAQQBkAG8AYgBlACAAUwB5AHMAdABlAG0AcwAgAEkAbgBjAG8AcgBwAG8AcgBhAHQAZQBkAC4AIABBAGwAbAAgAFIAaQBnAGgAdABzACAAUgBlAHMAZQByAHYAZQBkAC4AQQBkAG8AYgBlACAAQgBsAGEAbgBrAFIAZQBnAHUAbABhAHIAMQAuADAAMwA1ADsAQQBEAEIARQA7AEEAZABvAGIAZQBCAGwAYQBuAGsAOwBBAEQATwBCAEUAVgBlAHIAcwBpAG8AbgAgADEALgAwADMANQA7AFAAUwAgADEALgAwADAAMwA7AGgAbwB0AGMAbwBuAHYAIAAxAC4AMAAuADcAMAA7AG0AYQBrAGUAbwB0AGYALgBsAGkAYgAyAC4ANQAuADUAOQAwADAAQQBkAG8AYgBlAEIAbABhAG4AawBBAGQAbwBiAGUAIABTAHkAcwB0AGUAbQBzACAASQBuAGMAbwByAHAAbwByAGEAdABlAGQAaAB0AHQAcAA6AC8ALwB3AHcAdwAuAGEAZABvAGIAZQAuAGMAbwBtAC8AdAB5AHAAZQAvAEEAZABvAGIAZQAgAEIAbABhAG4AawAgAGkAcwAgAHIAZQBsAGUAYQBzAGUAZAAgAHUAbgBkAGUAcgAgAHQAaABlACAAUwBJAEwAIABPAHAAZQBuACAARgBvAG4AdAAgAEwAaQBjAGUAbgBzAGUAIAAtACAAcABsAGUAYQBzAGUAIAByAGUAYQBkACAAaQB0ACAAYwBhAHIAZQBmAHUAbABsAHkAIABhAG4AZAAgAGQAbwAgAG4AbwB0ACAAZABvAHcAbgBsAG8AYQBkACAAdABoAGUAIABmAG8AbgB0AHMAIAB1AG4AbABlAHMAcwAgAHkAbwB1ACAAYQBnAHIAZQBlACAAdABvACAAdABoAGUAIAB0AGgAZQAgAHQAZQByAG0AcwAgAG8AZgAgAHQAaABlACAAbABpAGMAZQBuAHMAZQA6AA0ACgANAAoAQwBvAHAAeQByAGkAZwBoAHQAIACpACAAMgAwADEAMwAgAEEAZABvAGIAZQAgAFMAeQBzAHQAZQBtAHMAIABJAG4AYwBvAHIAcABvAHIAYQB0AGUAZAAgACgAaAB0AHQAcAA6AC8ALwB3AHcAdwAuAGEAZABvAGIAZQAuAGMAbwBtAC8AKQAsACAAdwBpAHQAaAAgAFIAZQBzAGUAcgB2AGUAZAAgAEYAbwBuAHQAIABOAGEAbQBlACAAQQBkAG8AYgBlACAAQgBsAGEAbgBrAA0ACgANAAoAVABoAGkAcwAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUAIABpAHMAIABsAGkAYwBlAG4AcwBlAGQAIAB1AG4AZABlAHIAIAB0AGgAZQAgAFMASQBMACAATwBwAGUAbgAgAEYAbwBuAHQAIABMAGkAYwBlAG4AcwBlACwAIABWAGUAcgBzAGkAbwBuACAAMQAuADEALgANAAoADQAKAFQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAaQBzACAAYwBvAHAAaQBlAGQAIABiAGUAbABvAHcALAAgAGEAbgBkACAAaQBzACAAYQBsAHMAbwAgAGEAdgBhAGkAbABhAGIAbABlACAAdwBpAHQAaAAgAGEAIABGAEEAUQAgAGEAdAA6ACAAaAB0AHQAcAA6AC8ALwBzAGMAcgBpAHAAdABzAC4AcwBpAGwALgBvAHIAZwAvAE8ARgBMAA0ACgANAAoALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAA0ACgBTAEkATAAgAE8AUABFAE4AIABGAE8ATgBUACAATABJAEMARQBOAFMARQAgAFYAZQByAHMAaQBvAG4AIAAxAC4AMQAgAC0AIAAyADYAIABGAGUAYgByAHUAYQByAHkAIAAyADAAMAA3AA0ACgAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ADQAKAA0ACgBQAFIARQBBAE0AQgBMAEUADQAKAFQAaABlACAAZwBvAGEAbABzACAAbwBmACAAdABoAGUAIABPAHAAZQBuACAARgBvAG4AdAAgAEwAaQBjAGUAbgBzAGUAIAAoAE8ARgBMACkAIABhAHIAZQAgAHQAbwAgAHMAdABpAG0AdQBsAGEAdABlACAAdwBvAHIAbABkAHcAaQBkAGUAIABkAGUAdgBlAGwAbwBwAG0AZQBuAHQAIABvAGYAIABjAG8AbABsAGEAYgBvAHIAYQB0AGkAdgBlACAAZgBvAG4AdAAgAHAAcgBvAGoAZQBjAHQAcwAsACAAdABvACAAcwB1AHAAcABvAHIAdAAgAHQAaABlACAAZgBvAG4AdAAgAGMAcgBlAGEAdABpAG8AbgAgAGUAZgBmAG8AcgB0AHMAIABvAGYAIABhAGMAYQBkAGUAbQBpAGMAIABhAG4AZAAgAGwAaQBuAGcAdQBpAHMAdABpAGMAIABjAG8AbQBtAHUAbgBpAHQAaQBlAHMALAAgAGEAbgBkACAAdABvACAAcAByAG8AdgBpAGQAZQAgAGEAIABmAHIAZQBlACAAYQBuAGQAIABvAHAAZQBuACAAZgByAGEAbQBlAHcAbwByAGsAIABpAG4AIAB3AGgAaQBjAGgAIABmAG8AbgB0AHMAIABtAGEAeQAgAGIAZQAgAHMAaABhAHIAZQBkACAAYQBuAGQAIABpAG0AcAByAG8AdgBlAGQAIABpAG4AIABwAGEAcgB0AG4AZQByAHMAaABpAHAAIAB3AGkAdABoACAAbwB0AGgAZQByAHMALgANAAoADQAKAFQAaABlACAATwBGAEwAIABhAGwAbABvAHcAcwAgAHQAaABlACAAbABpAGMAZQBuAHMAZQBkACAAZgBvAG4AdABzACAAdABvACAAYgBlACAAdQBzAGUAZAAsACAAcwB0AHUAZABpAGUAZAAsACAAbQBvAGQAaQBmAGkAZQBkACAAYQBuAGQAIAByAGUAZABpAHMAdAByAGkAYgB1AHQAZQBkACAAZgByAGUAZQBsAHkAIABhAHMAIABsAG8AbgBnACAAYQBzACAAdABoAGUAeQAgAGEAcgBlACAAbgBvAHQAIABzAG8AbABkACAAYgB5ACAAdABoAGUAbQBzAGUAbAB2AGUAcwAuACAAVABoAGUAIABmAG8AbgB0AHMALAAgAGkAbgBjAGwAdQBkAGkAbgBnACAAYQBuAHkAIABkAGUAcgBpAHYAYQB0AGkAdgBlACAAdwBvAHIAawBzACwAIABjAGEAbgAgAGIAZQAgAGIAdQBuAGQAbABlAGQALAAgAGUAbQBiAGUAZABkAGUAZAAsACAAcgBlAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAGEAbgBkAC8AbwByACAAcwBvAGwAZAAgAHcAaQB0AGgAIABhAG4AeQAgAHMAbwBmAHQAdwBhAHIAZQAgAHAAcgBvAHYAaQBkAGUAZAAgAHQAaABhAHQAIABhAG4AeQAgAHIAZQBzAGUAcgB2AGUAZAAgAG4AYQBtAGUAcwAgAGEAcgBlACAAbgBvAHQAIAB1AHMAZQBkACAAYgB5ACAAZABlAHIAaQB2AGEAdABpAHYAZQAgAHcAbwByAGsAcwAuACAAVABoAGUAIABmAG8AbgB0AHMAIABhAG4AZAAgAGQAZQByAGkAdgBhAHQAaQB2AGUAcwAsACAAaABvAHcAZQB2AGUAcgAsACAAYwBhAG4AbgBvAHQAIABiAGUAIAByAGUAbABlAGEAcwBlAGQAIAB1AG4AZABlAHIAIABhAG4AeQAgAG8AdABoAGUAcgAgAHQAeQBwAGUAIABvAGYAIABsAGkAYwBlAG4AcwBlAC4AIABUAGgAZQAgAHIAZQBxAHUAaQByAGUAbQBlAG4AdAAgAGYAbwByACAAZgBvAG4AdABzACAAdABvACAAcgBlAG0AYQBpAG4AIAB1AG4AZABlAHIAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAgAGQAbwBlAHMAIABuAG8AdAAgAGEAcABwAGwAeQAgAHQAbwAgAGEAbgB5ACAAZABvAGMAdQBtAGUAbgB0ACAAYwByAGUAYQB0AGUAZAAgAHUAcwBpAG4AZwAgAHQAaABlACAAZgBvAG4AdABzACAAbwByACAAdABoAGUAaQByACAAZABlAHIAaQB2AGEAdABpAHYAZQBzAC4ADQAKAA0ACgBEAEUARgBJAE4ASQBUAEkATwBOAFMADQAKACIARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAiACAAcgBlAGYAZQByAHMAIAB0AG8AIAB0AGgAZQAgAHMAZQB0ACAAbwBmACAAZgBpAGwAZQBzACAAcgBlAGwAZQBhAHMAZQBkACAAYgB5ACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAdQBuAGQAZQByACAAdABoAGkAcwAgAGwAaQBjAGUAbgBzAGUAIABhAG4AZAAgAGMAbABlAGEAcgBsAHkAIABtAGEAcgBrAGUAZAAgAGEAcwAgAHMAdQBjAGgALgAgAFQAaABpAHMAIABtAGEAeQAgAGkAbgBjAGwAdQBkAGUAIABzAG8AdQByAGMAZQAgAGYAaQBsAGUAcwAsACAAYgB1AGkAbABkACAAcwBjAHIAaQBwAHQAcwAgAGEAbgBkACAAZABvAGMAdQBtAGUAbgB0AGEAdABpAG8AbgAuAA0ACgANAAoAIgBSAGUAcwBlAHIAdgBlAGQAIABGAG8AbgB0ACAATgBhAG0AZQAiACAAcgBlAGYAZQByAHMAIAB0AG8AIABhAG4AeQAgAG4AYQBtAGUAcwAgAHMAcABlAGMAaQBmAGkAZQBkACAAYQBzACAAcwB1AGMAaAAgAGEAZgB0AGUAcgAgAHQAaABlACAAYwBvAHAAeQByAGkAZwBoAHQAIABzAHQAYQB0AGUAbQBlAG4AdAAoAHMAKQAuAA0ACgANAAoAIgBPAHIAaQBnAGkAbgBhAGwAIABWAGUAcgBzAGkAbwBuACIAIAByAGUAZgBlAHIAcwAgAHQAbwAgAHQAaABlACAAYwBvAGwAbABlAGMAdABpAG8AbgAgAG8AZgAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUAIABjAG8AbQBwAG8AbgBlAG4AdABzACAAYQBzACAAZABpAHMAdAByAGkAYgB1AHQAZQBkACAAYgB5ACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApAC4ADQAKAA0ACgAiAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AIgAgAHIAZQBmAGUAcgBzACAAdABvACAAYQBuAHkAIABkAGUAcgBpAHYAYQB0AGkAdgBlACAAbQBhAGQAZQAgAGIAeQAgAGEAZABkAGkAbgBnACAAdABvACwAIABkAGUAbABlAHQAaQBuAGcALAAgAG8AcgAgAHMAdQBiAHMAdABpAHQAdQB0AGkAbgBnACAALQAtACAAaQBuACAAcABhAHIAdAAgAG8AcgAgAGkAbgAgAHcAaABvAGwAZQAgAC0ALQAgAGEAbgB5ACAAbwBmACAAdABoAGUAIABjAG8AbQBwAG8AbgBlAG4AdABzACAAbwBmACAAdABoAGUAIABPAHIAaQBnAGkAbgBhAGwAIABWAGUAcgBzAGkAbwBuACwAIABiAHkAIABjAGgAYQBuAGcAaQBuAGcAIABmAG8AcgBtAGEAdABzACAAbwByACAAYgB5ACAAcABvAHIAdABpAG4AZwAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAHQAbwAgAGEAIABuAGUAdwAgAGUAbgB2AGkAcgBvAG4AbQBlAG4AdAAuAA0ACgANAAoAIgBBAHUAdABoAG8AcgAiACAAcgBlAGYAZQByAHMAIAB0AG8AIABhAG4AeQAgAGQAZQBzAGkAZwBuAGUAcgAsACAAZQBuAGcAaQBuAGUAZQByACwAIABwAHIAbwBnAHIAYQBtAG0AZQByACwAIAB0AGUAYwBoAG4AaQBjAGEAbAAgAHcAcgBpAHQAZQByACAAbwByACAAbwB0AGgAZQByACAAcABlAHIAcwBvAG4AIAB3AGgAbwAgAGMAbwBuAHQAcgBpAGIAdQB0AGUAZAAgAHQAbwAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAuAA0ACgANAAoAUABFAFIATQBJAFMAUwBJAE8ATgAgACYAIABDAE8ATgBEAEkAVABJAE8ATgBTAA0ACgBQAGUAcgBtAGkAcwBzAGkAbwBuACAAaQBzACAAaABlAHIAZQBiAHkAIABnAHIAYQBuAHQAZQBkACwAIABmAHIAZQBlACAAbwBmACAAYwBoAGEAcgBnAGUALAAgAHQAbwAgAGEAbgB5ACAAcABlAHIAcwBvAG4AIABvAGIAdABhAGkAbgBpAG4AZwAgAGEAIABjAG8AcAB5ACAAbwBmACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACwAIAB0AG8AIAB1AHMAZQAsACAAcwB0AHUAZAB5ACwAIABjAG8AcAB5ACwAIABtAGUAcgBnAGUALAAgAGUAbQBiAGUAZAAsACAAbQBvAGQAaQBmAHkALAAgAHIAZQBkAGkAcwB0AHIAaQBiAHUAdABlACwAIABhAG4AZAAgAHMAZQBsAGwAIABtAG8AZABpAGYAaQBlAGQAIABhAG4AZAAgAHUAbgBtAG8AZABpAGYAaQBlAGQAIABjAG8AcABpAGUAcwAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAsACAAcwB1AGIAagBlAGMAdAAgAHQAbwAgAHQAaABlACAAZgBvAGwAbABvAHcAaQBuAGcAIABjAG8AbgBkAGkAdABpAG8AbgBzADoADQAKAA0ACgAxACkAIABOAGUAaQB0AGgAZQByACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACAAbgBvAHIAIABhAG4AeQAgAG8AZgAgAGkAdABzACAAaQBuAGQAaQB2AGkAZAB1AGEAbAAgAGMAbwBtAHAAbwBuAGUAbgB0AHMALAAgAGkAbgAgAE8AcgBpAGcAaQBuAGEAbAAgAG8AcgAgAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AcwAsACAAbQBhAHkAIABiAGUAIABzAG8AbABkACAAYgB5ACAAaQB0AHMAZQBsAGYALgANAAoADQAKADIAKQAgAE8AcgBpAGcAaQBuAGEAbAAgAG8AcgAgAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AcwAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAG0AYQB5ACAAYgBlACAAYgB1AG4AZABsAGUAZAAsACAAcgBlAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAGEAbgBkAC8AbwByACAAcwBvAGwAZAAgAHcAaQB0AGgAIABhAG4AeQAgAHMAbwBmAHQAdwBhAHIAZQAsACAAcAByAG8AdgBpAGQAZQBkACAAdABoAGEAdAAgAGUAYQBjAGgAIABjAG8AcAB5ACAAYwBvAG4AdABhAGkAbgBzACAAdABoAGUAIABhAGIAbwB2AGUAIABjAG8AcAB5AHIAaQBnAGgAdAAgAG4AbwB0AGkAYwBlACAAYQBuAGQAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAuACAAVABoAGUAcwBlACAAYwBhAG4AIABiAGUAIABpAG4AYwBsAHUAZABlAGQAIABlAGkAdABoAGUAcgAgAGEAcwAgAHMAdABhAG4AZAAtAGEAbABvAG4AZQAgAHQAZQB4AHQAIABmAGkAbABlAHMALAAgAGgAdQBtAGEAbgAtAHIAZQBhAGQAYQBiAGwAZQAgAGgAZQBhAGQAZQByAHMAIABvAHIAIABpAG4AIAB0AGgAZQAgAGEAcABwAHIAbwBwAHIAaQBhAHQAZQAgAG0AYQBjAGgAaQBuAGUALQByAGUAYQBkAGEAYgBsAGUAIABtAGUAdABhAGQAYQB0AGEAIABmAGkAZQBsAGQAcwAgAHcAaQB0AGgAaQBuACAAdABlAHgAdAAgAG8AcgAgAGIAaQBuAGEAcgB5ACAAZgBpAGwAZQBzACAAYQBzACAAbABvAG4AZwAgAGEAcwAgAHQAaABvAHMAZQAgAGYAaQBlAGwAZABzACAAYwBhAG4AIABiAGUAIABlAGEAcwBpAGwAeQAgAHYAaQBlAHcAZQBkACAAYgB5ACAAdABoAGUAIAB1AHMAZQByAC4ADQAKAA0ACgAzACkAIABOAG8AIABNAG8AZABpAGYAaQBlAGQAIABWAGUAcgBzAGkAbwBuACAAbwBmACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACAAbQBhAHkAIAB1AHMAZQAgAHQAaABlACAAUgBlAHMAZQByAHYAZQBkACAARgBvAG4AdAAgAE4AYQBtAGUAKABzACkAIAB1AG4AbABlAHMAcwAgAGUAeABwAGwAaQBjAGkAdAAgAHcAcgBpAHQAdABlAG4AIABwAGUAcgBtAGkAcwBzAGkAbwBuACAAaQBzACAAZwByAGEAbgB0AGUAZAAgAGIAeQAgAHQAaABlACAAYwBvAHIAcgBlAHMAcABvAG4AZABpAG4AZwAgAEMAbwBwAHkAcgBpAGcAaAB0ACAASABvAGwAZABlAHIALgAgAFQAaABpAHMAIAByAGUAcwB0AHIAaQBjAHQAaQBvAG4AIABvAG4AbAB5ACAAYQBwAHAAbABpAGUAcwAgAHQAbwAgAHQAaABlACAAcAByAGkAbQBhAHIAeQAgAGYAbwBuAHQAIABuAGEAbQBlACAAYQBzACAAcAByAGUAcwBlAG4AdABlAGQAIAB0AG8AIAB0AGgAZQAgAHUAcwBlAHIAcwAuAA0ACgANAAoANAApACAAVABoAGUAIABuAGEAbQBlACgAcwApACAAbwBmACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAbwByACAAdABoAGUAIABBAHUAdABoAG8AcgAoAHMAKQAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAHMAaABhAGwAbAAgAG4AbwB0ACAAYgBlACAAdQBzAGUAZAAgAHQAbwAgAHAAcgBvAG0AbwB0AGUALAAgAGUAbgBkAG8AcgBzAGUAIABvAHIAIABhAGQAdgBlAHIAdABpAHMAZQAgAGEAbgB5ACAATQBvAGQAaQBmAGkAZQBkACAAVgBlAHIAcwBpAG8AbgAsACAAZQB4AGMAZQBwAHQAIAB0AG8AIABhAGMAawBuAG8AdwBsAGUAZABnAGUAIAB0AGgAZQAgAGMAbwBuAHQAcgBpAGIAdQB0AGkAbwBuACgAcwApACAAbwBmACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAYQBuAGQAIAB0AGgAZQAgAEEAdQB0AGgAbwByACgAcwApACAAbwByACAAdwBpAHQAaAAgAHQAaABlAGkAcgAgAGUAeABwAGwAaQBjAGkAdAAgAHcAcgBpAHQAdABlAG4AIABwAGUAcgBtAGkAcwBzAGkAbwBuAC4ADQAKAA0ACgA1ACkAIABUAGgAZQAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUALAAgAG0AbwBkAGkAZgBpAGUAZAAgAG8AcgAgAHUAbgBtAG8AZABpAGYAaQBlAGQALAAgAGkAbgAgAHAAYQByAHQAIABvAHIAIABpAG4AIAB3AGgAbwBsAGUALAAgAG0AdQBzAHQAIABiAGUAIABkAGkAcwB0AHIAaQBiAHUAdABlAGQAIABlAG4AdABpAHIAZQBsAHkAIAB1AG4AZABlAHIAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAsACAAYQBuAGQAIABtAHUAcwB0ACAAbgBvAHQAIABiAGUAIABkAGkAcwB0AHIAaQBiAHUAdABlAGQAIAB1AG4AZABlAHIAIABhAG4AeQAgAG8AdABoAGUAcgAgAGwAaQBjAGUAbgBzAGUALgAgAFQAaABlACAAcgBlAHEAdQBpAHIAZQBtAGUAbgB0ACAAZgBvAHIAIABmAG8AbgB0AHMAIAB0AG8AIAByAGUAbQBhAGkAbgAgAHUAbgBkAGUAcgAgAHQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAZABvAGUAcwAgAG4AbwB0ACAAYQBwAHAAbAB5ACAAdABvACAAYQBuAHkAIABkAG8AYwB1AG0AZQBuAHQAIABjAHIAZQBhAHQAZQBkACAAdQBzAGkAbgBnACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlAC4ADQAKAA0ACgBUAEUAUgBNAEkATgBBAFQASQBPAE4ADQAKAFQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAYgBlAGMAbwBtAGUAcwAgAG4AdQBsAGwAIABhAG4AZAAgAHYAbwBpAGQAIABpAGYAIABhAG4AeQAgAG8AZgAgAHQAaABlACAAYQBiAG8AdgBlACAAYwBvAG4AZABpAHQAaQBvAG4AcwAgAGEAcgBlACAAbgBvAHQAIABtAGUAdAAuAA0ACgANAAoARABJAFMAQwBMAEEASQBNAEUAUgANAAoAVABIAEUAIABGAE8ATgBUACAAUwBPAEYAVABXAEEAUgBFACAASQBTACAAUABSAE8AVgBJAEQARQBEACAAIgBBAFMAIABJAFMAIgAsACAAVwBJAFQASABPAFUAVAAgAFcAQQBSAFIAQQBOAFQAWQAgAE8ARgAgAEEATgBZACAASwBJAE4ARAAsACAARQBYAFAAUgBFAFMAUwAgAE8AUgAgAEkATQBQAEwASQBFAEQALAAgAEkATgBDAEwAVQBEAEkATgBHACAAQgBVAFQAIABOAE8AVAAgAEwASQBNAEkAVABFAEQAIABUAE8AIABBAE4AWQAgAFcAQQBSAFIAQQBOAFQASQBFAFMAIABPAEYAIABNAEUAUgBDAEgAQQBOAFQAQQBCAEkATABJAFQAWQAsACAARgBJAFQATgBFAFMAUwAgAEYATwBSACAAQQAgAFAAQQBSAFQASQBDAFUATABBAFIAIABQAFUAUgBQAE8AUwBFACAAQQBOAEQAIABOAE8ATgBJAE4ARgBSAEkATgBHAEUATQBFAE4AVAAgAE8ARgAgAEMATwBQAFkAUgBJAEcASABUACwAIABQAEEAVABFAE4AVAAsACAAVABSAEEARABFAE0AQQBSAEsALAAgAE8AUgAgAE8AVABIAEUAUgAgAFIASQBHAEgAVAAuACAASQBOACAATgBPACAARQBWAEUATgBUACAAUwBIAEEATABMACAAVABIAEUAIABDAE8AUABZAFIASQBHAEgAVAAgAEgATwBMAEQARQBSACAAQgBFACAATABJAEEAQgBMAEUAIABGAE8AUgAgAEEATgBZACAAQwBMAEEASQBNACwAIABEAEEATQBBAEcARQBTACAATwBSACAATwBUAEgARQBSACAATABJAEEAQgBJAEwASQBUAFkALAAgAEkATgBDAEwAVQBEAEkATgBHACAAQQBOAFkAIABHAEUATgBFAFIAQQBMACwAIABTAFAARQBDAEkAQQBMACwAIABJAE4ARABJAFIARQBDAFQALAAgAEkATgBDAEkARABFAE4AVABBAEwALAAgAE8AUgAgAEMATwBOAFMARQBRAFUARQBOAFQASQBBAEwAIABEAEEATQBBAEcARQBTACwAIABXAEgARQBUAEgARQBSACAASQBOACAAQQBOACAAQQBDAFQASQBPAE4AIABPAEYAIABDAE8ATgBUAFIAQQBDAFQALAAgAFQATwBSAFQAIABPAFIAIABPAFQASABFAFIAVwBJAFMARQAsACAAQQBSAEkAUwBJAE4ARwAgAEYAUgBPAE0ALAAgAE8AVQBUACAATwBGACAAVABIAEUAIABVAFMARQAgAE8AUgAgAEkATgBBAEIASQBMAEkAVABZACAAVABPACAAVQBTAEUAIABUAEgARQAgAEYATwBOAFQAIABTAE8ARgBUAFcAQQBSAEUAIABPAFIAIABGAFIATwBNACAATwBUAEgARQBSACAARABFAEEATABJAE4ARwBTACAASQBOACAAVABIAEUAIABGAE8ATgBUACAAUwBPAEYAVABXAEEAUgBFAC4ADQAKAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBhAGQAbwBiAGUALgBjAG8AbQAvAHQAeQBwAGUALwBsAGUAZwBhAGwALgBoAHQAbQBsAAAAAAAFAAAAAwAAADgAAAAEAAABUAABAAAAAAAsAAMAAQAAADgAAwAKAAABUAAGAAwAAAAAAAEAAAAEARgAAABCAEAABQACB/8P/xf/H/8n/y//N/8//0f/T/9X/1//Z/9v/3f/f/+H/4//l/+f/6f/r/+3/7//x//P/9f/5//v//f//c///f//AAAAAAgAEAAYACAAKAAwADgAQABIAFAAWABgAGgAcAB4AIAAiACQAJgAoACoALAAuADAAMgA0ADgAOgA8AD4AP3w//8AAfgB8AHoAeAB2AHQAcgBwAG4AbABqAGgAZgBkAGIAYABeAFwAWgBYAFYAVABSAFAATgBMAEgARgBEAEIAQgBAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAZkAAAAAAAAAIgAAAAAAAAB/8AAAABAAAIAAAAD/8AAAABAAAQAAAAF/8AAAABAAAYAAAAH/8AAAABAAAgAAAAJ/8AAAABAAAoAAAAL/8AAAABAAAwAAAAN/8AAAABAAA4AAAAP/8AAAABAABAAAAAR/8AAAABAABIAAAAT/8AAAABAABQAAAAV/8AAAABAABYAAAAX/8AAAABAABgAAAAZ/8AAAABAABoAAAAb/8AAAABAABwAAAAd/8AAAABAAB4AAAAf/8AAAABAACAAAAAh/8AAAABAACIAAAAj/8AAAABAACQAAAAl/8AAAABAACYAAAAn/8AAAABAACgAAAAp/8AAAABAACoAAAAr/8AAAABAACwAAAAt/8AAAABAAC4AAAAv/8AAAABAADAAAAAx/8AAAABAADIAAAAz/8AAAABAADQAAAA1/8AAAABAADgAAAA5/8AAAABAADoAAAA7/8AAAABAADwAAAA9/8AAAABAAD4AAAA/c8AAAABAAD98AAA//0AAAXxAAEAAAABB/8AAAABAAEIAAABD/8AAAABAAEQAAABF/8AAAABAAEYAAABH/8AAAABAAEgAAABJ/8AAAABAAEoAAABL/8AAAABAAEwAAABN/8AAAABAAE4AAABP/8AAAABAAFAAAABR/8AAAABAAFIAAABT/8AAAABAAFQAAABV/8AAAABAAFYAAABX/8AAAABAAFgAAABZ/8AAAABAAFoAAABb/8AAAABAAFwAAABd/8AAAABAAF4AAABf/8AAAABAAGAAAABh/8AAAABAAGIAAABj/8AAAABAAGQAAABl/8AAAABAAGYAAABn/8AAAABAAGgAAABp/8AAAABAAGoAAABr/8AAAABAAGwAAABt/8AAAABAAG4AAABv/8AAAABAAHAAAABx/8AAAABAAHIAAABz/8AAAABAAHQAAAB1/8AAAABAAHYAAAB3/8AAAABAAHgAAAB5/8AAAABAAHoAAAB7/8AAAABAAHwAAAB9/8AAAABAAH4AAAB//0AAAABAAIAAAACB/8AAAABAAIIAAACD/8AAAABAAIQAAACF/8AAAABAAIYAAACH/8AAAABAAIgAAACJ/8AAAABAAIoAAACL/8AAAABAAIwAAACN/8AAAABAAI4AAACP/8AAAABAAJAAAACR/8AAAABAAJIAAACT/8AAAABAAJQAAACV/8AAAABAAJYAAACX/8AAAABAAJgAAACZ/8AAAABAAJoAAACb/8AAAABAAJwAAACd/8AAAABAAJ4AAACf/8AAAABAAKAAAACh/8AAAABAAKIAAACj/8AAAABAAKQAAACl/8AAAABAAKYAAACn/8AAAABAAKgAAACp/8AAAABAAKoAAACr/8AAAABAAKwAAACt/8AAAABAAK4AAACv/8AAAABAALAAAACx/8AAAABAALIAAACz/8AAAABAALQAAAC1/8AAAABAALYAAAC3/8AAAABAALgAAAC5/8AAAABAALoAAAC7/8AAAABAALwAAAC9/8AAAABAAL4AAAC//0AAAABAAMAAAADB/8AAAABAAMIAAADD/8AAAABAAMQAAADF/8AAAABAAMYAAADH/8AAAABAAMgAAADJ/8AAAABAAMoAAADL/8AAAABAAMwAAADN/8AAAABAAM4AAADP/8AAAABAANAAAADR/8AAAABAANIAAADT/8AAAABAANQAAADV/8AAAABAANYAAADX/8AAAABAANgAAADZ/8AAAABAANoAAADb/8AAAABAANwAAADd/8AAAABAAN4AAADf/8AAAABAAOAAAADh/8AAAABAAOIAAADj/8AAAABAAOQAAADl/8AAAABAAOYAAADn/8AAAABAAOgAAADp/8AAAABAAOoAAADr/8AAAABAAOwAAADt/8AAAABAAO4AAADv/8AAAABAAPAAAADx/8AAAABAAPIAAADz/8AAAABAAPQAAAD1/8AAAABAAPYAAAD3/8AAAABAAPgAAAD5/8AAAABAAPoAAAD7/8AAAABAAPwAAAD9/8AAAABAAP4AAAD//0AAAABAAQAAAAEB/8AAAABAAQIAAAED/8AAAABAAQQAAAEF/8AAAABAAQYAAAEH/8AAAABAAQgAAAEJ/8AAAABAAQoAAAEL/8AAAABAAQwAAAEN/8AAAABAAQ4AAAEP/8AAAABAARAAAAER/8AAAABAARIAAAET/8AAAABAARQAAAEV/8AAAABAARYAAAEX/8AAAABAARgAAAEZ/8AAAABAARoAAAEb/8AAAABAARwAAAEd/8AAAABAAR4AAAEf/8AAAABAASAAAAEh/8AAAABAASIAAAEj/8AAAABAASQAAAEl/8AAAABAASYAAAEn/8AAAABAASgAAAEp/8AAAABAASoAAAEr/8AAAABAASwAAAEt/8AAAABAAS4AAAEv/8AAAABAATAAAAEx/8AAAABAATIAAAEz/8AAAABAATQAAAE1/8AAAABAATYAAAE3/8AAAABAATgAAAE5/8AAAABAAToAAAE7/8AAAABAATwAAAE9/8AAAABAAT4AAAE//0AAAABAAUAAAAFB/8AAAABAAUIAAAFD/8AAAABAAUQAAAFF/8AAAABAAUYAAAFH/8AAAABAAUgAAAFJ/8AAAABAAUoAAAFL/8AAAABAAUwAAAFN/8AAAABAAU4AAAFP/8AAAABAAVAAAAFR/8AAAABAAVIAAAFT/8AAAABAAVQAAAFV/8AAAABAAVYAAAFX/8AAAABAAVgAAAFZ/8AAAABAAVoAAAFb/8AAAABAAVwAAAFd/8AAAABAAV4AAAFf/8AAAABAAWAAAAFh/8AAAABAAWIAAAFj/8AAAABAAWQAAAFl/8AAAABAAWYAAAFn/8AAAABAAWgAAAFp/8AAAABAAWoAAAFr/8AAAABAAWwAAAFt/8AAAABAAW4AAAFv/8AAAABAAXAAAAFx/8AAAABAAXIAAAFz/8AAAABAAXQAAAF1/8AAAABAAXYAAAF3/8AAAABAAXgAAAF5/8AAAABAAXoAAAF7/8AAAABAAXwAAAF9/8AAAABAAX4AAAF//0AAAABAAYAAAAGB/8AAAABAAYIAAAGD/8AAAABAAYQAAAGF/8AAAABAAYYAAAGH/8AAAABAAYgAAAGJ/8AAAABAAYoAAAGL/8AAAABAAYwAAAGN/8AAAABAAY4AAAGP/8AAAABAAZAAAAGR/8AAAABAAZIAAAGT/8AAAABAAZQAAAGV/8AAAABAAZYAAAGX/8AAAABAAZgAAAGZ/8AAAABAAZoAAAGb/8AAAABAAZwAAAGd/8AAAABAAZ4AAAGf/8AAAABAAaAAAAGh/8AAAABAAaIAAAGj/8AAAABAAaQAAAGl/8AAAABAAaYAAAGn/8AAAABAAagAAAGp/8AAAABAAaoAAAGr/8AAAABAAawAAAGt/8AAAABAAa4AAAGv/8AAAABAAbAAAAGx/8AAAABAAbIAAAGz/8AAAABAAbQAAAG1/8AAAABAAbYAAAG3/8AAAABAAbgAAAG5/8AAAABAAboAAAG7/8AAAABAAbwAAAG9/8AAAABAAb4AAAG//0AAAABAAcAAAAHB/8AAAABAAcIAAAHD/8AAAABAAcQAAAHF/8AAAABAAcYAAAHH/8AAAABAAcgAAAHJ/8AAAABAAcoAAAHL/8AAAABAAcwAAAHN/8AAAABAAc4AAAHP/8AAAABAAdAAAAHR/8AAAABAAdIAAAHT/8AAAABAAdQAAAHV/8AAAABAAdYAAAHX/8AAAABAAdgAAAHZ/8AAAABAAdoAAAHb/8AAAABAAdwAAAHd/8AAAABAAd4AAAHf/8AAAABAAeAAAAHh/8AAAABAAeIAAAHj/8AAAABAAeQAAAHl/8AAAABAAeYAAAHn/8AAAABAAegAAAHp/8AAAABAAeoAAAHr/8AAAABAAewAAAHt/8AAAABAAe4AAAHv/8AAAABAAfAAAAHx/8AAAABAAfIAAAHz/8AAAABAAfQAAAH1/8AAAABAAfYAAAH3/8AAAABAAfgAAAH5/8AAAABAAfoAAAH7/8AAAABAAfwAAAH9/8AAAABAAf4AAAH//0AAAABAAgAAAAIB/8AAAABAAgIAAAID/8AAAABAAgQAAAIF/8AAAABAAgYAAAIH/8AAAABAAggAAAIJ/8AAAABAAgoAAAIL/8AAAABAAgwAAAIN/8AAAABAAg4AAAIP/8AAAABAAhAAAAIR/8AAAABAAhIAAAIT/8AAAABAAhQAAAIV/8AAAABAAhYAAAIX/8AAAABAAhgAAAIZ/8AAAABAAhoAAAIb/8AAAABAAhwAAAId/8AAAABAAh4AAAIf/8AAAABAAiAAAAIh/8AAAABAAiIAAAIj/8AAAABAAiQAAAIl/8AAAABAAiYAAAIn/8AAAABAAigAAAIp/8AAAABAAioAAAIr/8AAAABAAiwAAAIt/8AAAABAAi4AAAIv/8AAAABAAjAAAAIx/8AAAABAAjIAAAIz/8AAAABAAjQAAAI1/8AAAABAAjYAAAI3/8AAAABAAjgAAAI5/8AAAABAAjoAAAI7/8AAAABAAjwAAAI9/8AAAABAAj4AAAI//0AAAABAAkAAAAJB/8AAAABAAkIAAAJD/8AAAABAAkQAAAJF/8AAAABAAkYAAAJH/8AAAABAAkgAAAJJ/8AAAABAAkoAAAJL/8AAAABAAkwAAAJN/8AAAABAAk4AAAJP/8AAAABAAlAAAAJR/8AAAABAAlIAAAJT/8AAAABAAlQAAAJV/8AAAABAAlYAAAJX/8AAAABAAlgAAAJZ/8AAAABAAloAAAJb/8AAAABAAlwAAAJd/8AAAABAAl4AAAJf/8AAAABAAmAAAAJh/8AAAABAAmIAAAJj/8AAAABAAmQAAAJl/8AAAABAAmYAAAJn/8AAAABAAmgAAAJp/8AAAABAAmoAAAJr/8AAAABAAmwAAAJt/8AAAABAAm4AAAJv/8AAAABAAnAAAAJx/8AAAABAAnIAAAJz/8AAAABAAnQAAAJ1/8AAAABAAnYAAAJ3/8AAAABAAngAAAJ5/8AAAABAAnoAAAJ7/8AAAABAAnwAAAJ9/8AAAABAAn4AAAJ//0AAAABAAoAAAAKB/8AAAABAAoIAAAKD/8AAAABAAoQAAAKF/8AAAABAAoYAAAKH/8AAAABAAogAAAKJ/8AAAABAAooAAAKL/8AAAABAAowAAAKN/8AAAABAAo4AAAKP/8AAAABAApAAAAKR/8AAAABAApIAAAKT/8AAAABAApQAAAKV/8AAAABAApYAAAKX/8AAAABAApgAAAKZ/8AAAABAApoAAAKb/8AAAABAApwAAAKd/8AAAABAAp4AAAKf/8AAAABAAqAAAAKh/8AAAABAAqIAAAKj/8AAAABAAqQAAAKl/8AAAABAAqYAAAKn/8AAAABAAqgAAAKp/8AAAABAAqoAAAKr/8AAAABAAqwAAAKt/8AAAABAAq4AAAKv/8AAAABAArAAAAKx/8AAAABAArIAAAKz/8AAAABAArQAAAK1/8AAAABAArYAAAK3/8AAAABAArgAAAK5/8AAAABAAroAAAK7/8AAAABAArwAAAK9/8AAAABAAr4AAAK//0AAAABAAsAAAALB/8AAAABAAsIAAALD/8AAAABAAsQAAALF/8AAAABAAsYAAALH/8AAAABAAsgAAALJ/8AAAABAAsoAAALL/8AAAABAAswAAALN/8AAAABAAs4AAALP/8AAAABAAtAAAALR/8AAAABAAtIAAALT/8AAAABAAtQAAALV/8AAAABAAtYAAALX/8AAAABAAtgAAALZ/8AAAABAAtoAAALb/8AAAABAAtwAAALd/8AAAABAAt4AAALf/8AAAABAAuAAAALh/8AAAABAAuIAAALj/8AAAABAAuQAAALl/8AAAABAAuYAAALn/8AAAABAAugAAALp/8AAAABAAuoAAALr/8AAAABAAuwAAALt/8AAAABAAu4AAALv/8AAAABAAvAAAALx/8AAAABAAvIAAALz/8AAAABAAvQAAAL1/8AAAABAAvYAAAL3/8AAAABAAvgAAAL5/8AAAABAAvoAAAL7/8AAAABAAvwAAAL9/8AAAABAAv4AAAL//0AAAABAAwAAAAMB/8AAAABAAwIAAAMD/8AAAABAAwQAAAMF/8AAAABAAwYAAAMH/8AAAABAAwgAAAMJ/8AAAABAAwoAAAML/8AAAABAAwwAAAMN/8AAAABAAw4AAAMP/8AAAABAAxAAAAMR/8AAAABAAxIAAAMT/8AAAABAAxQAAAMV/8AAAABAAxYAAAMX/8AAAABAAxgAAAMZ/8AAAABAAxoAAAMb/8AAAABAAxwAAAMd/8AAAABAAx4AAAMf/8AAAABAAyAAAAMh/8AAAABAAyIAAAMj/8AAAABAAyQAAAMl/8AAAABAAyYAAAMn/8AAAABAAygAAAMp/8AAAABAAyoAAAMr/8AAAABAAywAAAMt/8AAAABAAy4AAAMv/8AAAABAAzAAAAMx/8AAAABAAzIAAAMz/8AAAABAAzQAAAM1/8AAAABAAzYAAAM3/8AAAABAAzgAAAM5/8AAAABAAzoAAAM7/8AAAABAAzwAAAM9/8AAAABAAz4AAAM//0AAAABAA0AAAANB/8AAAABAA0IAAAND/8AAAABAA0QAAANF/8AAAABAA0YAAANH/8AAAABAA0gAAANJ/8AAAABAA0oAAANL/8AAAABAA0wAAANN/8AAAABAA04AAANP/8AAAABAA1AAAANR/8AAAABAA1IAAANT/8AAAABAA1QAAANV/8AAAABAA1YAAANX/8AAAABAA1gAAANZ/8AAAABAA1oAAANb/8AAAABAA1wAAANd/8AAAABAA14AAANf/8AAAABAA2AAAANh/8AAAABAA2IAAANj/8AAAABAA2QAAANl/8AAAABAA2YAAANn/8AAAABAA2gAAANp/8AAAABAA2oAAANr/8AAAABAA2wAAANt/8AAAABAA24AAANv/8AAAABAA3AAAANx/8AAAABAA3IAAANz/8AAAABAA3QAAAN1/8AAAABAA3YAAAN3/8AAAABAA3gAAAN5/8AAAABAA3oAAAN7/8AAAABAA3wAAAN9/8AAAABAA34AAAN//0AAAABAA4AAAAOB/8AAAABAA4IAAAOD/8AAAABAA4QAAAOF/8AAAABAA4YAAAOH/8AAAABAA4gAAAOJ/8AAAABAA4oAAAOL/8AAAABAA4wAAAON/8AAAABAA44AAAOP/8AAAABAA5AAAAOR/8AAAABAA5IAAAOT/8AAAABAA5QAAAOV/8AAAABAA5YAAAOX/8AAAABAA5gAAAOZ/8AAAABAA5oAAAOb/8AAAABAA5wAAAOd/8AAAABAA54AAAOf/8AAAABAA6AAAAOh/8AAAABAA6IAAAOj/8AAAABAA6QAAAOl/8AAAABAA6YAAAOn/8AAAABAA6gAAAOp/8AAAABAA6oAAAOr/8AAAABAA6wAAAOt/8AAAABAA64AAAOv/8AAAABAA7AAAAOx/8AAAABAA7IAAAOz/8AAAABAA7QAAAO1/8AAAABAA7YAAAO3/8AAAABAA7gAAAO5/8AAAABAA7oAAAO7/8AAAABAA7wAAAO9/8AAAABAA74AAAO//0AAAABAA8AAAAPB/8AAAABAA8IAAAPD/8AAAABAA8QAAAPF/8AAAABAA8YAAAPH/8AAAABAA8gAAAPJ/8AAAABAA8oAAAPL/8AAAABAA8wAAAPN/8AAAABAA84AAAPP/8AAAABAA9AAAAPR/8AAAABAA9IAAAPT/8AAAABAA9QAAAPV/8AAAABAA9YAAAPX/8AAAABAA9gAAAPZ/8AAAABAA9oAAAPb/8AAAABAA9wAAAPd/8AAAABAA94AAAPf/8AAAABAA+AAAAPh/8AAAABAA+IAAAPj/8AAAABAA+QAAAPl/8AAAABAA+YAAAPn/8AAAABAA+gAAAPp/8AAAABAA+oAAAPr/8AAAABAA+wAAAPt/8AAAABAA+4AAAPv/8AAAABAA/AAAAPx/8AAAABAA/IAAAPz/8AAAABAA/QAAAP1/8AAAABAA/YAAAP3/8AAAABAA/gAAAP5/8AAAABAA/oAAAP7/8AAAABAA/wAAAP9/8AAAABAA/4AAAP//0AAAABABAAAAAQB/8AAAABABAIAAAQD/8AAAABABAQAAAQF/8AAAABABAYAAAQH/8AAAABABAgAAAQJ/8AAAABABAoAAAQL/8AAAABABAwAAAQN/8AAAABABA4AAAQP/8AAAABABBAAAAQR/8AAAABABBIAAAQT/8AAAABABBQAAAQV/8AAAABABBYAAAQX/8AAAABABBgAAAQZ/8AAAABABBoAAAQb/8AAAABABBwAAAQd/8AAAABABB4AAAQf/8AAAABABCAAAAQh/8AAAABABCIAAAQj/8AAAABABCQAAAQl/8AAAABABCYAAAQn/8AAAABABCgAAAQp/8AAAABABCoAAAQr/8AAAABABCwAAAQt/8AAAABABC4AAAQv/8AAAABABDAAAAQx/8AAAABABDIAAAQz/8AAAABABDQAAAQ1/8AAAABABDYAAAQ3/8AAAABABDgAAAQ5/8AAAABABDoAAAQ7/8AAAABABDwAAAQ9/8AAAABABD4AAAQ//0AAAABAAMAAAAAAAD/tQAyAAAAAAAAAAAAAAAAAAAAAAAAAAABAAQCAAEBAQtBZG9iZUJsYW5rAAEBATD4G/gciwwe+B0B+B4Ci/sM+gD6BAUeGgA/DB8cCAEMIvdMD/dZEfdRDCUcGRYMJAAFAQEGDk1YZ0Fkb2JlSWRlbnRpdHlDb3B5cmlnaHQgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5BZG9iZSBCbGFua0Fkb2JlQmxhbmstMjA0OQAAAgABB/8DAAEAAAAIAQgBAgABAEsATABNAE4ATwBQAFEAUgBTAFQAVQBWAFcAWABZAFoAWwBcAF0AXgBfAGAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AHsAfAB9AH4AfwCAAIEAggCDAIQAhQCGAIcAiACJAIoAiwCMAI0AjgCPAJAAkQCSAJMAlACVAJYAlwCYAJkAmgCbAJwAnQCeAJ8AoAChAKIAowCkAKUApgCnAKgAqQCqAKsArACtAK4ArwCwALEAsgCzALQAtQC2ALcAuAC5ALoAuwC8AL0AvgC/AMAAwQDCAMMAxADFAMYAxwDIAMkAygDLAMwAzQDOAM8A0ADRANIA0wDUANUA1gDXANgA2QDaANsA3ADdAN4A3wDgAOEA4gDjAOQA5QDmAOcA6ADpAOoA6wDsAO0A7gDvAPAA8QDyAPMA9AD1APYA9wD4APkA+gD7APwA/QD+AP8BAAEBAQIBAwEEAQUBBgEHAQgBCQEKAQsBDAENAQ4BDwEQAREBEgETARQBFQEWARcBGAEZARoBGwEcAR0BHgEfASABIQEiASMBJAElASYBJwEoASkBKgErASwBLQEuAS8BMAExATIBMwE0ATUBNgE3ATgBOQE6ATsBPAE9AT4BPwFAAUEBQgFDAUQBRQFGAUcBSAFJAUoBSwFMAU0BTgFPAVABUQFSAVMBVAFVAVYBVwFYAVkBWgFbAVwBXQFeAV8BYAFhAWIBYwFkAWUBZgFnAWgBaQFqAWsBbAFtAW4BbwFwAXEBcgFzAXQBdQF2AXcBeAF5AXoBewF8AX0BfgF/AYABgQGCAYMBhAGFAYYBhwGIAYkBigGLAYwBjQGOAY8BkAGRAZIBkwGUAZUBlgGXAZgBmQGaAZsBnAGdAZ4BnwGgAaEBogGjAaQBpQGmAacBqAGpAaoBqwGsAa0BrgGvAbABsQGyAbMBtAG1AbYBtwG4AbkBugG7AbwBvQG+Ab8BwAHBAcIBwwHEAcUBxgHHAcgByQHKAcsBzAHNAc4BzwHQAdEB0gHTAdQB1QHWAdcB2AHZAdoB2wHcAd0B3gHfAeAB4QHiAeMB5AHlAeYB5wHoAekB6gHrAewB7QHuAe8B8AHxAfIB8wH0AfUB9gH3AfgB+QH6AfsB/AH9Af4B/wIAAgECAgIDAgQCBQIGAgcCCAIJAgoCCwIMAg0CDgIPAhACEQISAhMCFAIVAhYCFwIYAhkCGgIbAhwCHQIeAh8CIAIhAiICIwIkAiUCJgInAigCKQIqAisCLAItAi4CLwIwAjECMgIzAjQCNQI2AjcCOAI5AjoCOwI8Aj0CPgI/AkACQQJCAkMCRAJFAkYCRwJIAkkCSgJLAkwCTQJOAk8CUAJRAlICUwJUAlUCVgJXAlgCWQJaAlsCXAJdAl4CXwJgAmECYgJjAmQCZQJmAmcCaAJpAmoCawJsAm0CbgJvAnACcQJyAnMCdAJ1AnYCdwJ4AnkCegJ7AnwCfQJ+An8CgAKBAoICgwKEAoUChgKHAogCiQKKAosCjAKNAo4CjwKQApECkgKTApQClQKWApcCmAKZApoCmwKcAp0CngKfAqACoQKiAqMCpAKlAqYCpwKoAqkCqgKrAqwCrQKuAq8CsAKxArICswK0ArUCtgK3ArgCuQK6ArsCvAK9Ar4CvwLAAsECwgLDAsQCxQLGAscCyALJAsoCywLMAs0CzgLPAtAC0QLSAtMC1ALVAtYC1wLYAtkC2gLbAtwC3QLeAt8C4ALhAuIC4wLkAuUC5gLnAugC6QLqAusC7ALtAu4C7wLwAvEC8gLzAvQC9QL2AvcC+AL5AvoC+wL8Av0C/gL/AwADAQMCAwMDBAMFAwYDBwMIAwkDCgMLAwwDDQMOAw8DEAMRAxIDEwMUAxUDFgMXAxgDGQMaAxsDHAMdAx4DHwMgAyEDIgMjAyQDJQMmAycDKAMpAyoDKwMsAy0DLgMvAzADMQMyAzMDNAM1AzYDNwM4AzkDOgM7AzwDPQM+Az8DQANBA0IDQwNEA0UDRgNHA0gDSQNKA0sDTANNA04DTwNQA1EDUgNTA1QDVQNWA1cDWANZA1oDWwNcA10DXgNfA2ADYQNiA2MDZANlA2YDZwNoA2kDagNrA2wDbQNuA28DcANxA3IDcwN0A3UDdgN3A3gDeQN6A3sDfAN9A34DfwOAA4EDggODA4QDhQOGA4cDiAOJA4oDiwOMA40DjgOPA5ADkQOSA5MDlAOVA5YDlwOYA5kDmgObA5wDnQOeA58DoAOhA6IDowOkA6UDpgOnA6gDqQOqA6sDrAOtA64DrwOwA7EDsgOzA7QDtQO2A7cDuAO5A7oDuwO8A70DvgO/A8ADwQPCA8MDxAPFA8YDxwPIA8kDygPLA8wDzQPOA88D0APRA9ID0wPUA9UD1gPXA9gD2QPaA9sD3APdA94D3wPgA+ED4gPjA+QD5QPmA+cD6APpA+oD6wPsA+0D7gPvA/AD8QPyA/MD9AP1A/YD9wP4A/kD+gP7A/wD/QP+A/8EAAQBBAIEAwQEBAUEBgQHBAgECQQKBAsEDAQNBA4EDwQQBBEEEgQTBBQEFQQWBBcEGAQZBBoEGwQcBB0EHgQfBCAEIQQiBCMEJAQlBCYEJwQoBCkEKgQrBCwELQQuBC8EMAQxBDIEMwQ0BDUENgQ3BDgEOQQ6BDsEPAQ9BD4EPwRABEEEQgRDBEQERQRGBEcESARJBEoESwRMBE0ETgRPBFAEUQRSBFMEVARVBFYEVwRYBFkEWgRbBFwEXQReBF8EYARhBGIEYwRkBGUEZgRnBGgEaQRqBGsEbARtBG4EbwRwBHEEcgRzBHQEdQR2BHcEeAR5BHoEewR8BH0EfgR/BIAEgQSCBIMEhASFBIYEhwSIBIkEigSLBIwEjQSOBI8EkASRBJIEkwSUBJUElgSXBJgEmQSaBJsEnASdBJ4EnwSgBKEEogSjBKQEpQSmBKcEqASpBKoEqwSsBK0ErgSvBLAEsQSyBLMEtAS1BLYEtwS4BLkEugS7BLwEvQS+BL8EwATBBMIEwwTEBMUExgTHBMgEyQTKBMsEzATNBM4EzwTQBNEE0gTTBNQE1QTWBNcE2ATZBNoE2wTcBN0E3gTfBOAE4QTiBOME5ATlBOYE5wToBOkE6gTrBOwE7QTuBO8E8ATxBPIE8wT0BPUE9gT3BPgE+QT6BPsE/AT9BP4E/wUABQEFAgUDBQQFBQUGBQcFCAUJBQoFCwUMBQ0FDgUPBRAFEQUSBRMFFAUVBRYFFwUYBRkFGgUbBRwFHQUeBR8FIAUhBSIFIwUkBSUFJgUnBSgFKQUqBSsFLAUtBS4FLwUwBTEFMgUzBTQFNQU2BTcFOAU5BToFOwU8BT0FPgU/BUAFQQVCBUMFRAVFBUYFRwVIBUkFSgVLBUwFTQVOBU8FUAVRBVIFUwVUBVUFVgVXBVgFWQVaBVsFXAVdBV4FXwVgBWEFYgVjBWQFZQVmBWcFaAVpBWoFawVsBW0FbgVvBXAFcQVyBXMFdAV1BXYFdwV4BXkFegV7BXwFfQV+BX8FgAWBBYIFgwWEBYUFhgWHBYgFiQWKBYsFjAWNBY4FjwWQBZEFkgWTBZQFlQWWBZcFmAWZBZoFmwWcBZ0FngWfBaAFoQWiBaMFpAWlBaYFpwWoBakFqgWrBawFrQWuBa8FsAWxBbIFswW0BbUFtgW3BbgFuQW6BbsFvAW9Bb4FvwXABcEFwgXDBcQFxQXGBccFyAXJBcoFywXMBc0FzgXPBdAF0QXSBdMF1AXVBdYF1wXYBdkF2gXbBdwF3QXeBd8F4AXhBeIF4wXkBeUF5gXnBegF6QXqBesF7AXtBe4F7wXwBfEF8gXzBfQF9QX2BfcF+AX5BfoF+wX8Bf0F/gX/BgAGAQYCBgMGBAYFBgYGBwYIBgkGCgYLBgwGDQYOBg8GEAYRBhIGEwYUBhUGFgYXBhgGGQYaBhsGHAYdBh4GHwYgBiEGIgYjBiQGJQYmBicGKAYpBioGKwYsBi0GLgYvBjAGMQYyBjMGNAY1BjYGNwY4BjkGOgY7BjwGPQY+Bj8GQAZBBkIGQwZEBkUGRgZHBkgGSQZKBksGTAZNBk4GTwZQBlEGUgZTBlQGVQZWBlcGWAZZBloGWwZcBl0GXgZfBmAGYQZiBmMGZAZlBmYGZwZoBmkGagZrBmwGbQZuBm8GcAZxBnIGcwZ0BnUGdgZ3BngGeQZ6BnsGfAZ9Bn4GfwaABoEGggaDBoQGhQaGBocGiAaJBooGiwaMBo0GjgaPBpAGkQaSBpMGlAaVBpYGlwaYBpkGmgabBpwGnQaeBp8GoAahBqIGowakBqUGpganBqgGqQaqBqsGrAatBq4GrwawBrEGsgazBrQGtQa2BrcGuAa5BroGuwa8Br0Gvga/BsAGwQbCBsMGxAbFBsYGxwbIBskGygbLBswGzQbOBs8G0AbRBtIG0wbUBtUG1gbXBtgG2QbaBtsG3AbdBt4G3wbgBuEG4gbjBuQG5QbmBucG6AbpBuoG6wbsBu0G7gbvBvAG8QbyBvMG9Ab1BvYG9wb4BvkG+gb7BvwG/Qb+Bv8HAAcBBwIHAwcEBwUHBgcHBwgHCQcKBwsHDAcNBw4HDwcQBxEHEgcTBxQHFQcWBxcHGAcZBxoHGwccBx0HHgcfByAHIQciByMHJAclByYHJwcoBykHKgcrBywHLQcuBy8HMAcxBzIHMwc0BzUHNgc3BzgHOQc6BzsHPAc9Bz4HPwdAB0EHQgdDB0QHRQdGB0cHSAdJB0oHSwdMB00HTgdPB1AHUQdSB1MHVAdVB1YHVwdYB1kHWgdbB1wHXQdeB18HYAdhB2IHYwdkB2UHZgdnB2gHaQdqB2sHbAdtB24HbwdwB3EHcgdzB3QHdQd2B3cHeAd5B3oHewd8B30Hfgd/B4AHgQeCB4MHhAeFB4YHhweIB4kHigeLB4wHjQeOB48HkAeRB5IHkweUB5UHlgeXB5gHmQeaB5sHnAedB54HnwegB6EHogejB6QHpQemB6cHqAepB6oHqwesB60HrgevB7AHsQeyB7MHtAe1B7YHtwe4B7kHuge7B7wHvQe+B78HwAfBB8IHwwfEB8UHxgfHB8gHyQfKB8sHzAfNB84HzwfQB9EH0gfTB9QH1QfWB9cH2AfZB9oH2wfcB90H3gffB+AH4QfiB+MH5AflB+YH5wfoB+kH6gfrB+wH7QfuB+8H8AfxB/IH8wf0B/UH9gf3B/gH+Qf6B/sH/Af9B/4H/wgACAEIAggDCAQIBQgGCAcICAgJCAoICwgMCA0IDggPCBAIEQgSCBMIFAgVCBYIFwgYCBkIGggbCBwIHQgeCB8IIAghCCIIIwgkCCUIJggnCCgIKQgqCCsILAgtCC4ILwgwCDEIMggzCDQINQg2CDcIOAg5CDoIOwg8CD0IPgg/CEAIQQhCCEMIRAhFCEYIRwhICEkISghLIPsMt/oktwH3ELf5LLcD9xD6BBX+fPmE+nwH/Vj+JxX50gf3xfwzBaawFfvF+DcF+PYGpmIV/dIH+8X4MwVwZhX3xfw3Bfz2Bg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgABAQEK+B8MJpocGSQS+46LHAVGiwa9Cr0L+ucVAAPoAHwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAA') format('truetype'); }",
t.prototype={constructor:t,loadFonts:function(){var e=this;return 0===this._numberOfFontFamilies?void this._finish():(null!==this.timeout&&(this._timeoutId=window.setTimeout(function(){e._finish()},this.timeout)),this._testContainer=document.createElement("div"),this._testContainer.style.cssText="position:absolute; left:-10000px; top:-10000px; white-space:nowrap; font-size:20px; line-height:20px; visibility:hidden;",void(null===t.testDiv?this._runOnce():this._loadFonts()))},_runOnce:function(){var n,s,r,o,a=this,h="serif";if(t.testDiv=document.createElement("div"),t.testDiv.style.position="absolute",t.testDiv.appendChild(document.createTextNode(t.referenceText)),t.useAdobeBlank)r=document.createElement("style"),r.setAttribute("type","text/css"),r.appendChild(document.createTextNode(t.adobeBlankFontFaceRule)),document.getElementsByTagName("head")[0].appendChild(r),o=t.testDiv.cloneNode(!0),this._testContainer.appendChild(o),document.body.appendChild(this._testContainer),o.style.fontFamily=h,t.useIntervalChecking?(this._testContainer.appendChild(o),this._intervalId=window.setInterval(function(){a._checkAdobeBlankSize()},this._intervalDelay),this._checkAdobeBlankSize()):(this._adobeBlankSizeWatcher=new i(o,{container:this._testContainer,delegate:this,continuous:!0,direction:i.directions.decrease,dimension:i.dimensions.horizontal}),this._adobeBlankSizeWatcher.prepareForWatch(),this._adobeBlankSizeWatcher.beginWatching()),o.style.fontFamily=t.referenceFontFamilies[0]+", "+h;else{for(n=t.testDiv.cloneNode(!0),this._testContainer.appendChild(n),document.body.appendChild(this._testContainer),s=0;s<t.referenceFontFamilies.length;s++)n.style.fontFamily=t.referenceFontFamilies[s],t.referenceFontFamiliesSizes.push(new e(n.offsetWidth,n.offsetHeight));this._testContainer.parentNode.removeChild(this._testContainer),n.parentNode.removeChild(n),this._loadFonts()}},_checkAdobeBlankSize:function(){var t=this._testContainer.firstChild;this._adobeBlankLoaded(t)},_adobeBlankLoaded:function(i){0===i.offsetWidth&&(t.referenceFontFamiliesSizes.push(new e(i.offsetWidth,i.offsetHeight)),null!==this._adobeBlankSizeWatcher?(this._adobeBlankSizeWatcher.endWatching(),this._adobeBlankSizeWatcher.removeScrollWatchers(),this._adobeBlankSizeWatcher=null):(window.clearInterval(this._intervalId),i.parentNode.removeChild(i)),this._testContainer.parentNode.removeChild(this._testContainer),this._loadFonts())},_loadFonts:function(){var e,n,s,r,o=[],a=this;for(e=0;e<this._numberOfFontFamilies;e++)if(this._fontsMap[this._fontFamiliesArray[e]]=!0,t.useResizeEvent)for(n=0;n<t.referenceFontFamilies.length;n++)s=t.testDiv.cloneNode(!0),s.setAttribute("data-font-family",this._fontFamiliesArray[e]),s.setAttribute("data-ref-font-family-index",String(n)),s.style.fontFamily=t.referenceFontFamilies[n],this._testContainer.appendChild(s);else if(t.useIntervalChecking)for(n=0;n<t.referenceFontFamilies.length;n++)s=t.testDiv.cloneNode(!0),s.setAttribute("data-font-family",this._fontFamiliesArray[e]),s.setAttribute("data-ref-font-family-index",String(n)),s.style.fontFamily="'"+this._fontFamiliesArray[e]+"', "+t.referenceFontFamilies[n],this._testContainer.appendChild(s);else for(n=0;n<t.referenceFontFamilies.length;n++)s=t.testDiv.cloneNode(!0),s.setAttribute("data-font-family",this._fontFamiliesArray[e]),s.setAttribute("data-ref-font-family-index",String(n)),s.style.fontFamily=t.referenceFontFamilies[n],r=new i(s,{container:this._testContainer,delegate:this,size:t.referenceFontFamiliesSizes[n],direction:i.directions.increase,dimension:i.dimensions.horizontal}),o.push(r);if(document.body.appendChild(this._testContainer),t.useResizeEvent){for(n=0;n<this._testContainer.childNodes.length;n++)s=this._testContainer.childNodes[n],s.attachEvent("onresize",function(t,e){return function(){t._elementSizeChanged(e)}}(this,s));window.setTimeout(function(){for(n=0;n<a._testContainer.childNodes.length;n++)s=a._testContainer.childNodes[n],s.style.fontFamily="'"+s.getAttribute("data-font-family")+"', "+t.referenceFontFamilies[s.getAttribute("data-ref-font-family-index")]},0)}else if(t.useIntervalChecking)this._intervalId=window.setInterval(function(){a._checkSizes()},this._intervalDelay),this._checkSizes();else{for(e=0;e<this._numberOfFontFamilies*t.referenceFontFamilies.length;e++)r=o[e],r.prepareForWatch();for(e=0;e<this._numberOfFontFamilies*t.referenceFontFamilies.length;e++)r=o[e],r.beginWatching(),s=r.getWatchedElement(),s.style.fontFamily="'"+s.getAttribute("data-font-family")+"', "+t.referenceFontFamilies[s.getAttribute("data-ref-font-family-index")]}},_checkSizes:function(){var i,n,s,r;for(i=this._testContainer.childNodes.length-1;i>=0;i--)n=this._testContainer.childNodes[i],s=new e(n.offsetWidth,n.offsetHeight),r=t.referenceFontFamiliesSizes[n.getAttribute("data-ref-font-family-index")],r.isEqual(s)||(n.parentNode.removeChild(n),this._elementSizeChanged(n))},_elementSizeChanged:function(t){var e=t.getAttribute("data-font-family");this._finished||"undefined"!=typeof this._fontsMap[e]&&(this._numberOfLoadedFonts++,delete this._fontsMap[e],this.delegate&&"function"==typeof this.delegate.fontLoaded&&this.delegate.fontLoaded(e),this._numberOfLoadedFonts===this._numberOfFontFamilies&&this._finish())},_finish:function(){var t,e,i=[];if(!this._finished){if(this._finished=!0,null!==this._adobeBlankSizeWatcher&&(this._adobeBlankSizeWatcher=null),null!==this._testContainer&&this._testContainer.parentNode.removeChild(this._testContainer),null!==this._timeoutId&&window.clearTimeout(this._timeoutId),null!==this._intervalId&&window.clearInterval(this._intervalId),this._numberOfLoadedFonts<this._numberOfFontFamilies){for(e in this._fontsMap)this._fontsMap.hasOwnProperty(e)&&i.push(e);t={message:"Not all fonts were loaded",notLoadedFontFamilies:i}}else t=null;this.delegate&&"function"==typeof this.delegate.fontsLoaded&&this.delegate.fontsLoaded(t)}},sizeWatcherChangedSize:function(t){var e=t.getWatchedElement();t===this._adobeBlankSizeWatcher?this._adobeBlankLoaded(e):this._elementSizeChanged(e)}},e.prototype.isEqual=function(t){return this.width===t.width&&this.height===t.height},i.states={initialized:0,generatedScrollWatchers:1,appendedScrollWatchers:2,preparedScrollWatchers:3,watchingForSizeChange:4},i.directions={decrease:1,increase:2,both:3},i.dimensions={horizontal:1,vertical:2,both:3},i.prototype={constructor:i,getWatchedElement:function(){return this._element},setSize:function(t){this._size=t,this._direction&i.directions.increase&&(this._sizeIncreaseWatcherContentElm.style.cssText="width: "+(t.width+this._scrollAmount)+"px; height: "+(t.height+this._scrollAmount)+"px;"),this._direction&i.directions.decrease&&(this._sizeDecreaseWatcherElm.style.cssText="position:absolute; left: 0px; top: 0px; overflow: hidden; width: "+(t.width-this._scrollAmount)+"px; height: "+(t.height-this._scrollAmount)+"px;")},_generateScrollWatchers:function(t){this._element.style.position="absolute",this._direction&i.directions.increase&&(this._sizeIncreaseWatcherContentElm=document.createElement("div"),this._sizeIncreaseWatcherElm=document.createElement("div"),this._sizeIncreaseWatcherElm.style.cssText="position: absolute; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden;",this._sizeIncreaseWatcherElm.appendChild(this._sizeIncreaseWatcherContentElm),this._element.appendChild(this._sizeIncreaseWatcherElm)),this._direction&i.directions.decrease&&(this._sizeDecreaseWatcherElm=document.createElement("div"),this._sizeDecreaseWatcherElm.appendChild(this._element)),t&&this.setSize(t),this._state=i.states.generatedScrollWatchers},_appendScrollWatchersToElement:function(t){if(this._state!==i.states.generatedScrollWatchers)throw new Error("SizeWatcher._appendScrollWatchersToElement() was invoked before SizeWatcher._generateScrollWatchers()");this._direction&i.directions.decrease?t.appendChild(this._sizeDecreaseWatcherElm):t.appendChild(this._element),this._state=i.states.appendedScrollWatchers},removeScrollWatchers:function(){this._direction&i.directions.decrease?this._sizeDecreaseWatcherElm.parentNode&&this._sizeDecreaseWatcherElm.parentNode.removeChild(this._sizeDecreaseWatcherElm):this._element.parentNode&&this._element.parentNode.removeChild(this._element)},prepareForWatch:function(){var t,n=!0,s=!0;if(this._state!==i.states.appendedScrollWatchers)throw new Error("SizeWatcher.prepareForWatch() invoked before SizeWatcher._appendScrollWatchersToElement()");if(null===this._size&&this.setSize(new e(this._element.offsetWidth,this._element.offsetHeight)),this._direction&i.directions.decrease&&(n=this._scrollElementToBottomRight(this._sizeDecreaseWatcherElm)),this._direction&i.directions.increase&&(s=this._scrollElementToBottomRight(this._sizeIncreaseWatcherElm)),!n||!s){for(t=this._element.parentNode;t!==window.document&&null!==t;)t=t.parentNode;if(null===t)throw new Error("Can't set scroll position of scroll watchers. SizeWatcher is not in the DOM tree.");console&&"function"==typeof console.warn&&console.warn("SizeWatcher can't set scroll position of scroll watchers.")}this._state=i.states.preparedScrollWatchers},_scrollElementToBottomRight:function(t){var e=!0;return this._dimension&i.dimensions.vertical&&(t.scrollTop=this._scrollAmount,e=e&&t.scrollTop>0),this._dimension&i.dimensions.horizontal&&(t.scrollLeft=this._scrollAmount,e=e&&t.scrollLeft>0),e},beginWatching:function(){if(this._state!==i.states.preparedScrollWatchers)throw new Error("SizeWatcher.beginWatching() invoked before SizeWatcher.prepareForWatch()");this._direction&i.directions.decrease&&this._sizeDecreaseWatcherElm.addEventListener("scroll",this,!1),this._direction&i.directions.increase&&this._sizeIncreaseWatcherElm.addEventListener("scroll",this,!1),this._state=i.states.watchingForSizeChange},endWatching:function(){if(this._state!==i.states.watchingForSizeChange)throw new Error("SizeWatcher.endWatching() invoked before SizeWatcher.beginWatching()");this._direction&i.directions.decrease&&this._sizeDecreaseWatcherElm.removeEventListener("scroll",this,!1),this._direction&i.directions.increase&&this._sizeIncreaseWatcherElm.removeEventListener("scroll",this,!1),this._state=i.states.appendedScrollWatchers},handleEvent:function(t){var n,s;this._state===i.states.watchingForSizeChange&&(n=new e(this._element.offsetWidth,this._element.offsetHeight),s=this._size,s.isEqual(n)||this._delegate&&"function"==typeof this._delegate.sizeWatcherChangedSize&&(this._delegate.sizeWatcherChangedSize(this),this._state!==i.states.watchingForSizeChange)||(this._continuous?(this.setSize(n),this._state=i.states.appendedScrollWatchers,this.prepareForWatch(),this._state=i.states.watchingForSizeChange):this.endWatching()))}},t}),define("gt/utils/FontLoadingUtil",["bottom_line","fontloader"],function(t,e){var i=function(gameConfig,bootInfo,settings,game){console.log("FontLoadingUtil.ctor"),this._gameConfig=gameConfig,this._bootInfo=bootInfo,this._settings=settings,this._game=game};return i.prototype.loadAllFonts=function(t,e){function i(){n&&s&&(console.log(" ...all fonts were loaded."),t.call(e))}console.log("FontLoadingUtil.loadAllFonts");var n=!1,s=!1;this.loadRegularFonts(function(){n=!0,i()},this),this.loadBitmapFonts(function(){s=!0,i()},this)},i.prototype.loadRegularFonts=function(t,i){console.log("FontLoadingUtil.loadRegularFonts");var n=this._gameConfig.lang,s=document.createElement("link");s.href="css/fonts_"+n+".css",s.type="text/css",s.rel="stylesheet",document.getElementsByTagName("head")[0].appendChild(s);var r=this._bootInfo.fonts[n].list;r._.modify(function(t){return this._settings.fontMap[n][t].font},this);var o={};o.fontsLoaded=function(e){e?(console.log(e.message),console.log(e.notLoadedFontFamilies)):console.log(" ...all regular fonts were loaded."),t.call(i)};var a=new e(r,o,3e3);a.loadFonts()},i.prototype.loadBitmapFonts=function(t,e){console.log("FontLoadingUtil.loadBitmapFonts");var i=[],n=this._gameConfig.lang,s=this._bootInfo.bitmapfonts[n].list,r=this._bootInfo.bitmapfonts[n].src+"/";s._.each(function(t){var e=r+t;this._game.load.bitmapFont(t,e+".png",e+".xml"),i.push(t)},this);var o=function(n,s){var r=i.indexOf(s);r>-1&&(i.splice(r,1),0==i.length&&(this._game.load.onFileComplete.remove(o,this),console.log(" ...all bitmap fonts were loaded."),t.call(e)))};this._game.load.onFileComplete.add(o,this),this._game.load.start()},i}),define("gt/modules/StartLoader",["soma","gt/utils/Chainable","gt/utils/device","gt/utils/FontLoadingUtil","gt/constants/ConsoleCSS"],function(t,e,i,n,s){var r=function(injector,game,spritesheetManager,sceneManager){this._injector=injector,this._game=game,this._spritesheetManager=spritesheetManager,this._sceneManager=sceneManager};return r.prototype.run=function(i,r){console.log("%c [DI module] %c StartLoader ",s.MODULE_TAG,s.MODULE_TEXT),this._injector.mapClass("fontLoadingUtil",n,t.SINGLETON),new e(this.loadLoaderAssets,this).then(this.createLoaderScene,this).then(i,r).execute()},r.prototype.loadLoaderAssets=function(t,e){function s(){r&&o&&(console.log(" ...all loader assets were loaded."),t.call(e))}console.log("StartLoader.loadLoaderAssets");var r=!1,o=!1;this._game.load.json("loader","assets/json/loader.json");var platform=i.getPlatformString(),a="assets/images/phaser/spritesheets/"+platform+"/atlases/";this._game.load.atlas("loader",a+"loader_0.png",a+"loader_0.json"),this._game.load.atlas("loader_no_alpha",a+"loader_no_alpha_0.jpg",a+"loader_no_alpha_0.json");var fontLoadingUtil=this._injector.getValueFromClass(n);fontLoadingUtil.loadAllFonts(function(){o=!0,s()},this),this._game.load.onLoadComplete.addOnce(function(){r=!0,s()},this),this._game.load.start()},r.prototype.createLoaderScene=function(t,e){console.log("StartLoader.createLoaderScene"),this._spritesheetManager.add("loader"),this._spritesheetManager.add("loader_no_alpha"),this._sceneManager.createLoader();var i=this._sceneManager.getScene("Loader");i.enter();var n={color:"#000000"};this._sceneManager.view.background.set("bg.jpg",n),t.call(e)},r}),define("gt/managers/GameVarManager",["bottom_line","phaser"],function(t,e){function i(){this.varsLoadedEvent=new e.Signal,this._file=null,game.input.keyboard.onUpCallback=function(t){82===t.keyCode&&this.reload()}.bind(this)}return t.extend(i.prototype,{load:function(t){if(this._file=t,game.cache.checkJSONKey("gameVars")){var e=game.cache.getJSON("gameVars");for(var i in e)delete this[i]}game.load.onLoadComplete.addOnce(function(){var t=game.cache.getJSON("gameVars");for(var e in t)void 0!==this[e]?console.error("The key "+e+" can't be used in gameVars.json, because it is already in use by a built-in variable."):this[e]=t[e];this.varsLoadedEvent.dispatch()},this),game.load.json("gameVars",this._file,!0),game.load.start()},reload:function(){this._file||console.error("Can't reload if load hasn't been called first"),this.load(this._file)}}),i}),define("gt/modules/LoadGameAssets",["soma","gt/utils/Chainable","gt/utils/device","gt/managers/GameVarManager","gt/constants/ConsoleCSS"],function(t,e,i,n,s){var r=function(injector,game,platform,bootInfo,gameConfig,soundManager,spritesheetManager,gameInfoPublisher,localizationManager){this._injector=injector,this._game=game,this._bootInfo=bootInfo,this._platform=platform,this._gameConfig=gameConfig,this._localizationManager=localizationManager,this._soundManager=soundManager,this._spritesheetManager=spritesheetManager,this._gameInfoPublisher=gameInfoPublisher};return r.prototype.run=function(i,r){console.log("%c [DI module] %c LoadGameAssets ",s.MODULE_TAG,s.MODULE_TEXT),this._injector.mapClass("gameVarManager",n,t.SINGLETON),new e(this.loadAllGameAssets,this).then(this.loadGameVars,this).then(this.loadUserData,this).then(i,r).execute()},r.prototype.loadAllGameAssets=function(t,e){console.log("LoadGameAssets.loadAllGameAssets"),this.loadFreemiumData(),this.loadScenes(),this.loadAudio(),this.loadSpritesheets(),this.loadSpineAnimations(),this._game.load.onFileComplete.add(this._fileLoaded,this),this._game.load.onLoadComplete.addOnce(function(){console.log(" ...loaded all game assets."),this._spritesheetManager.init(),this._game.load.onFileComplete.remove(this._fileLoaded,this),t.call(e)},this),this._game.load.start()},r.prototype._fileLoaded=function(t){this._gameInfoPublisher.publish("loadProgressed",.9*t)},r.prototype.loadFreemiumData=function(){console.log("LoadGameAssets.loadFreemiumData"),this._gameConfig.freemium&&this._game.load.json("freemium","assets/json/freemium.json")},r.prototype.loadScenes=function(){console.log("LoadGameAssets.loadScenes"),this._game.load.json("scenes","assets/json/scenes.json")},r.prototype.loadAudio=function(){console.log("LoadGameAssets.loadAudio"),this._soundManager.loadSprite("assets/audio/music.mp3"),this._soundManager.loadSprite("assets/audio/effects.mp3")},r.prototype.loadSpritesheets=function(){console.log("LoadGameAssets.loadSpritesheets");var platform=i.getPlatformString(),t=this._bootInfo.spritesheets[platform];t._.each(function(t,e){var i="assets/images/phaser/spritesheets/"+platform+"/"+e+"/";t.files._.each(function(t){if(!t._.has("loader")){var n=t._.before("."),s=n;"atlases"!==e&&(s=e+"_"+n),(!n._.has("localization")||n._.has(this._localizationManager.language))&&this._game.load.atlas(s,i+t,i+n+".json")}},this)},this)},r.prototype.loadSpineAnimations=function(){var t=this._bootInfo.spineAnimations.src,e=this._bootInfo.spineAnimations.files;e.forEach(function(e){var i=e._.before(".json");this._game.load.json(i,t+e)},this)},r.prototype.loadGameVars=function(t,e){console.log("LoadGameAssets.loadGameVars");var gameVarManager=this._injector.getValueFromClass(n);gameVarManager.varsLoadedEvent.addOnce(function(){console.log(" ...loaded game vars."),t.call(e)},this),gameVarManager.load("assets/json/gameVars.json")},r.prototype.loadUserData=function(t,e){console.log("LoadGameAssets.loadUserData"),this._platform.loadUserData(function(){console.log(" ...loaded user data."),t.call(e)},this)},r}),define("gt/modules/LoaderReady",["gt/constants/ConsoleCSS"],function(t){var e=function(gameInfoPublisher){this._gameInfoPublisher=gameInfoPublisher};return e.prototype.run=function(e,i){console.log("%c [DI module] %c LoaderReady ",t.MODULE_TAG,t.MODULE_TEXT),this._gameInfoPublisher.publish("loadFinished"),e.call(i)},e}),define("configs/MatrixConfig",["gt/utils/device"],function(t){function e(viewportManager){var e=.92,i=.99,n=76;this.SCALE=t.portable?e:i,this.TILE_WIDTH=Math.floor(n*viewportManager.scale),this.TILE_HEIGHT=Math.floor(n*viewportManager.scale),this.HALF_TILE_WIDTH=.5*this.TILE_WIDTH,this.HALF_TILE_HEIGHT=.5*this.TILE_HEIGHT,this.ROWS=40,this.COLS=10,this.HALF_ROWS=.5*this.ROWS,this.HALF_COLS=.5*this.COLS,this.SKYLINE_ROWS_COUNT=21,this.PLAYABLE_ROWS_COUNT=20,this.STARTING_ROW_INDEX=19,this.SPAWNING_ROW_INDEX=18,this.SPAWNING_COL=this.HALF_COLS-1,this.MATRIX_WIDTH=this.TILE_WIDTH*this.COLS,this.MATRIX_HALF_WIDTH=this.MATRIX_WIDTH/2,this.MATRIX_HEIGHT=this.TILE_HEIGHT*this.PLAYABLE_ROWS_COUNT,this.MATRIX_HALF_HEIGHT=this.MATRIX_HEIGHT/2,this.SKYLINE_HEIGHT=.39*this.TILE_HEIGHT,this.BLOCKOUT_ROW=21}return e}),define("enums/TetriminoType",[],function(){function t(){}return t.I=2,t.J=3,t.L=4,t.O=5,t.S=6,t.T=7,t.Z=8,t.NONE=0,t.USABLE_TYPES=[t.O,t.S,t.Z,t.I,t.J,t.L,t.T],t}),define("enums/ShapeMinoType",[],function(){function t(){}return t.NORMAL=1,t.CENTER=2,t}),define("enums/Rotation",[],function(){function t(){}return t.Clockwise=1,t.CounterClockwise=2,t.invert=function(e){var i=null;return i=e===t.Clockwise?t.CounterClockwise:t.Clockwise},t}),define("enums/Orientation",["enums/Rotation"],function(t){function e(){}return e.NORTH=1,e.EAST=2,e.SOUTH=3,e.WEST=4,e.rotateOrientation=function(e,i){return i===t.Clockwise?this.rotateClockwise(e):this.rotateCounterClockwise(e)},e.rotateClockwise=function(t){var i=null;switch(t){case e.NORTH:i=e.EAST;break;case e.EAST:i=e.SOUTH;break;case e.SOUTH:i=e.WEST;break;case e.WEST:i=e.NORTH}return i},e.rotateCounterClockwise=function(t){var i=null;switch(t){case e.NORTH:i=e.WEST;break;case e.EAST:i=e.NORTH;break;case e.SOUTH:i=e.EAST;break;case e.WEST:i=e.SOUTH}return i},e}),define("configs/TetriminosConfig",["enums/TetriminoType","enums/ShapeMinoType","enums/Orientation"],function(t,e,i){function n(){this._configs={},this.setupConfigs()}return n.prototype.setupConfigs=function(){this.createConfig_O(),this.createConfig_I(),this.createConfig_T(),this.createConfig_L(),this.createConfig_J(),this.createConfig_S(),this.createConfig_Z()},n.prototype.getConfigForType=function(t){return this._configs[t]},n.prototype.createConfigObject=function(t,e,i,n){var s={};return s.type=t,s.sprite=e,s.shape=i,s.rotations=n,s},n.prototype.createConfig_O=function(){var e={},n=[[1,1],[1,1]],s=[{row:1,col:0},{row:1,col:0},{row:1,col:0},{row:1,col:0},{row:1,col:0}];e[i.NORTH]=s,e[i.EAST]=s,e[i.SOUTH]=s,e[i.WEST]=s,this._configs[t.O]=this.createConfigObject(t.O,"type_o.png",n,e)},n.prototype.createConfig_I=function(){var e={},n=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]];e[i.NORTH]=[{row:2,col:1},{row:2,col:0},{row:2,col:3},{row:2,col:0},{row:2,col:3}],e[i.EAST]=[{row:2,col:1},{row:2,col:2},{row:2,col:2},{row:3,col:2},{row:0,col:2}],e[i.SOUTH]=[{row:2,col:1},{row:2,col:3},{row:2,col:0},{row:1,col:3},{row:1,col:0}],e[i.WEST]=[{row:2,col:1},{row:2,col:1},{row:2,col:1},{row:0,col:1},{row:3,col:1}],this._configs[t.I]=this.createConfigObject(t.I,"type_i.png",n,e)},n.prototype.createConfig_T=function(){var e={},n=[[0,1,0],[1,1,1],[0,0,0]];e[i.NORTH]=e[i.SOUTH]=[{row:1,col:1},{row:1,col:1},{row:1,col:1},{row:1,col:1},{row:1,col:1}],e[i.EAST]=[{row:1,col:1},{row:1,col:2},{row:0,col:2},{row:3,col:1},{row:3,col:2}],e[i.WEST]=[{row:1,col:1},{row:1,col:0},{row:0,col:0},{row:3,col:1},{row:3,col:0}],this._configs[t.T]=this.createConfigObject(t.T,"type_t.png",n,e)},n.prototype.createConfig_L=function(){var e=this.getConfigForType(t.T).rotations,i=[[0,0,1],[1,1,1],[0,0,0]];this._configs[t.L]=this.createConfigObject(t.L,"type_l.png",i,e)},n.prototype.createConfig_J=function(){var e=this.getConfigForType(t.T).rotations,i=[[1,0,0],[1,1,1],[0,0,0]];this._configs[t.J]=this.createConfigObject(t.J,"type_j.png",i,e)},n.prototype.createConfig_S=function(){var e=this.getConfigForType(t.T).rotations,i=[[0,1,1],[1,1,0],[0,0,0]];this._configs[t.S]=this.createConfigObject(t.S,"type_s.png",i,e)},n.prototype.createConfig_Z=function(){var e=this.getConfigForType(t.T).rotations,i=[[1,1,0],[0,1,1],[0,0,0]];this._configs[t.Z]=this.createConfigObject(t.Z,"type_z.png",i,e)},n}),define("factories/PhaserGroupFactory",[],function(){function t(game,injector){this._phaserGame=game,this._injector=injector}return t.prototype.construct=function(t,e){var i=t,n=e;return void 0===i&&(i=null),void 0===n&&(n=null),this._phaserGame.make.group(i,n)},t}),define("factories/PhaserSpriteFactory",[],function(){function t(game){this._phaserGame=game}return t.prototype.construct=function(t,e,i,n,s){var r=this._phaserGame.make.sprite(t,e,i,n);return void 0!=s&&s.addChild(r),r},t}),define("factories/MatrixFactory",[],function(){function t(injector,matrixCellFactory,matrixConfig){this._injector=injector,this._matrixCellFactory=matrixCellFactory,this._matrixConfig=matrixConfig}return t.prototype.construct=function(t,e){t=t||this._matrixConfig.COLS,e=e||this._matrixConfig.ROWS;for(var i=[],n=0,s=e;s>n;n++)for(var r=0,o=t;o>r;r++)i[n]||(i[n]=[]),i[n][r]=this._matrixCellFactory.construct(i,n,r);return i},t}),define("enums/Enum",[],function(){function t(){}return t.getValues=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.getRandomValue=function(e){return t.getValues(e)._.random()},t}),define("utils/Array2DUtil",[],function(){var t={};return t.rotateClockwise=function(t){for(var e=t.length,i=t[0].length,n=[e,i]._.dimit(),s=0;e>s;s++)for(var r=0;i>r;r++)n[r][e-1-s]=t[s][r];return n},t.rotateCounterClockwise=function(t){for(var e=t.length,i=t[0].length,n=[e,i]._.dimit(),s=0;e>s;s++)for(var r=0;i>r;r++)n[i-1-r][s]=t[s][r];return n},t.forEach=function(t,e,i){for(var n=t.length,s=t[0].length,r=0;n>r;r++)for(var o=0;s>o;o++){var a=e.call(i,t[r][o],r,o);if(a===!1)return}},t.getRowAndColForElement=function(t,e){for(var i={row:0,col:0},n=t.length,s=t[0].length,r=0;n>r;r++)for(var o=0;s>o;o++)if(t[r][o]===e)return i.row=r,i.col=o,i;return i},t}),define("enums/SpecialMinoType",[],function(){function t(){}return t.JUNK=1,t.SHAPE=2,t.SCORECELL=3,t.SPARKLE=4,t.MOVEGHOST=5,t.GHOST=6,t.SHADOW=7,t.NONE=0,t}),define("entities/Tetrimino",["bottom_line","enums/Orientation","enums/Rotation","utils/Array2DUtil","data/ControlScheme","enums/SpecialMinoType","gt/utils/device"],function(t,e,i,n,s,r,o){function a(tetriminoConfig,t,minoFactory,matrixConfig,soundManager,gameVarManager,controlScheme,gameInfoPublisher){this._minoFactory=minoFactory,this._minos=null,this.config=tetriminoConfig,this.tetriminoType=this.config.type,this._visibility=!0,this.orientation=e.NORTH,this.shapeMatrix=this.config.shape,this.justRotated=!1,this.row=0,this.col=0,this._matrixConfig=matrixConfig,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._controlScheme=controlScheme,this._gameInfoPublisher=gameInfoPublisher,this.createMinos(t)}return a.prototype.createMinos=function(t){var e=[],i=null;n.forEach(this.shapeMatrix,function(n,s,o){if(1===n){var a=t?r.GHOST:r.NONE,h=this._minoFactory.get(this.tetriminoType,a);this.shapeMatrix[s][o]=h,i?(i.linkedMino=h,i=h):i=h,h.tetrimino=this,e.push(h)}},this),this._minos=e,t&&this.updateGhostShape()},a.prototype.getMinos=function(){return this._minos},a.prototype.rotate=function(t){t===i.Clockwise?(this.shapeMatrix=n.rotateClockwise(this.shapeMatrix),this.orientation=e.rotateClockwise(this.orientation)):(this.shapeMatrix=n.rotateCounterClockwise(this.shapeMatrix),this.orientation=e.rotateCounterClockwise(this.orientation))},a.prototype.orient=function(t){for(;this.orientation!=t;)this.rotate(i.Clockwise),this.justRotated=!0;o.desktop&&this._gameInfoPublisher.publish("ghostPieceVisibilityChanged",!0)},a.prototype.resetRotation=function(){for(;this.orientation!=e.NORTH;)this.rotate(i.Clockwise)},a.prototype.getCurrentRotationPoints=function(){return this.config.rotations[this.orientation]},a.prototype.move=function(t){this.row+=t.row,this.col+=t.col,t.col&&this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_move_sfx),o.desktop&&this._gameInfoPublisher.publish("ghostPieceVisibilityChanged",!0)},a.prototype.moveTo=function(t){this.row=t.row,this.col=t.col},a.prototype.getBottomRow=function(){for(var t=this.getMinos(),e=this._matrixConfig.ROWS,i=0;i<t.length;i++)t[i].row<e&&(e=t[i].row);return e},a.prototype.getTopRow=function(){for(var t=this.getMinos(),e=0,i=0;i<t.length;i++)t[i].row>e&&(e=t[i].row);return e},a.prototype.getFirstCol=function(){for(var t=this.getMinos(),e=this._matrixConfig.COLS,i=0;i<t.length;i++)t[i].col<e&&(e=t[i].col);return e},a.prototype.getWidth=function(){for(var t=this.getMinos(),e=this._matrixConfig.COLS,i=0,n=0;n<t.length;n++)t[n].col<e&&(e=t[n].col),t[n].col>i&&(i=t[n].col);return i-e+1},a.prototype.destroyMinos=function(){for(var t=this.getMinos(),e=0;e<t.length;e++)t[e].linkedMino=null,t[e].tetrimino=null,this._minoFactory["return"](t[e]);this._minos=[]},a.prototype.addMino=function(t){var e=null;this._minos.length>0&&(e=this._minos[this._minos.length-1]),t.linkedMino=e,t.tetrimino=this,this._minos.push(t)},a.prototype.removeMino=function(t){t.tetrimino=null;var e=this._minos.indexOf(t);e>-1&&this._minos.splice(e,1)},a.prototype.updateGhostShape=function(){this._minos.forEach(function(t){t.updateGhostShape()},this)},a.prototype.setVisible=function(t){var e=this.getMinos();e.forEach(function(e){e.visible=t},this),this._visibility=t},a.prototype.getVisible=function(){return this._visibility},a}),define("factories/TetriminoFactory",["bottom_line","enums/Enum","enums/TetriminoType","gt/extras/PartialInjectionFactory","entities/Tetrimino"],function(t,e,i,n,s){function r(game,injector,tetriminoConfig){this._tetriminoConfig=tetriminoConfig,this._partialInjectionFactory=new n(injector,s)}return r.prototype.construct=function(e,n){var e=e||i.NONE;void 0===e&&(e=i.USABLE_TYPES._.random());var tetriminoConfig=this._tetriminoConfig.getConfigForType(e),s=t.cloneDeep(tetriminoConfig);return this._partialInjectionFactory.construct(s,n)},r}),define("entities/Mino",["bottom_line","gt/gui/Sprite","enums/TetriminoType","enums/SpecialMinoType"],function(t,e,i,n){function s(t,e,r,matrixModel,game,spineAnimationFactory,spineUtil,matrixConfig){s._super.constructor.call(this,0,0,null,t),this.row=0,this.col=0,this.tetrimino=null,this.sticky=!0,this._isActive=!1,this.tetriminoType=e||i.NONE,this.specialMinoType=r||n.NONE,this.linkedMino=null,this.matrixCell=null,this._matrixModel=matrixModel,this._matrixConfig=matrixConfig,this._game=game,this._spineUtil=spineUtil,this._minoGlow=spineAnimationFactory.construct("minoGlow"),this._moveGhostAnimation=null,this._originalImageName=null,this.didSpriteChangeInGravity=!1}return t.inherit(s,e),s.FADE_IN_TIME=50,s.prototype.showMoveGhostAnimation=function(){if(this.specialMinoType===n.MOVEGHOST){this.visible=!1,this._moveGhostAnimation=this._spineUtil.createAnimation("tutorialblocks",this.parent);var t="type_",e="i",s="_flash";switch(this.tetriminoType){case i.I:e="i";break;case i.J:e="j";break;case i.L:e="l";break;case i.O:e="o";break;case i.S:e="s";break;case i.T:e="t";break;case i.Z:e="z"}var r=t+e+s;this._moveGhostAnimation.startAnimation(r,!1,!0)}},s.prototype.animateIn=function(t){t=t||s.FADE_IN_TIME,this.alpha=0;var e=this._game.add.tween(this);e.to({alpha:1},t),e.start()},s.prototype.animateTo=function(t,e,i,n){n=n||1;var s=33;i=i||100;var r=this._game.add.tween(this);return r.to({x:t,y:e},i,Phaser.Easing.Quadratic.Out,!0,n*s),r},s.prototype.animateGlow=function(t,e){return this.parent?(this.parent.add(this._minoGlow),this._minoGlow.x=this.x,this._minoGlow.y=this.y,this._minoGlow.onComplete.addOnce(function(){this.parent.remove(this._minoGlow),t&&e&&t.call(e)},this),void this._minoGlow.startAnimation("minoGlow")):void console.trace()},s.prototype.getLinkedMinos=function(){var t=[];return this.tetrimino?t=this.tetrimino.getLinkedMinos():console.log("There are no linked minos, check if this could should even be run in that case"),t},s.prototype.updateGhostShape=function(){for(var t={up:!1,down:!1,right:!1,left:!1},e=this.tetrimino.shapeMatrix,n={},s=0;s<e.length;s++)for(var r=0;r<e[s].length;r++)if(e[s][r]==this){n={x:s,y:r};break}var o={center:{x:n.x,y:n.y},left:n.x-1,right:n.x+1,up:n.y+1,down:n.y-1},a=0;if(e[o.right]&&e[o.right][o.center.y]&&(this._matrixModel.isFlipped?t.down=!0:t.up=!0,a++),e[o.left]&&e[o.left][n.y]&&(this._matrixModel.isFlipped?t.up=!0:t.down=!0,a++),e[o.center.x][o.up]&&(t.right=!0,a++),e[o.center.x][o.down]&&(t.left=!0,a++),1===a)this.setImage("ghost_part_01.png"),t.right&&(this.rotation=1.5*Math.PI),t.left&&(this.rotation=.5*Math.PI),t.down&&(this.rotation=Math.PI),t.up&&(this.rotation=0);else if(3===a){if(this.setImage("ghost_part_03.png"),t.right&&t.left){var h=Math.PI,l=0;this.rotation=t.down?l:h}else if(t.down&&t.up){var c=1.5*Math.PI,u=.5*Math.PI;this.rotation=t.left?c:u}}else t.down&&t.up?(this.setImage("ghost_part_02.png"),this.rotation=Math.PI/2):t.right&&t.left?(this.setImage("ghost_part_02.png"),this.rotation=0):(this.tetriminoType==i.O?this.setImage("ghost_part_04.png"):this.setImage("ghost_part_05.png"),t.right?this.rotation=t.down?0:.5*Math.PI:t.left&&(this.rotation=t.down?1.5*Math.PI:Math.PI))},s.prototype.setActive=function(t){this._isActive=t},s.prototype.getActive=function(){return this._isActive},s.prototype.getPosition=function(){return{x:this.row,y:this.col}},s.prototype.resetPosition=function(){this.x=0,this.y=0},s.prototype.destroyTutorialAnimation=function(){this._moveGhostAnimation&&(this._moveGhostAnimation.destroy(),this._moveGhostAnimation=null)},s.prototype.setOriginalImageName=function(t){this._originalImageName=t},s.prototype.getOriginalImageName=function(){return this._originalImageName},s}),define("gt/pooling/Pool",[],function(){
var t=function(){console.log("Pool.ctor"),this.capacity=null,this._factory=null,this._constructArguments=null,this._postConstruct=null,this._postConstructContext=null,this._objectsIn=[]};return t.prototype.initialize=function(t,e,i,n,s){this.capacity=t||1,this._factory=e,this._constructArguments=i,this._postConstruct=n,this._postConstructContext=s,this._objectsIn=[],this.fill()},t.prototype.getSize=function(){return this._objectsIn.length},t.prototype.fill=function(){for(var t=0;t<this.capacity;++t){var e=this.constructNewObject();this._objectsIn.push(e)}},t.prototype.take=function(){var t;return this._objectsIn.length>0?t=this._objectsIn.pop():(t=this.constructNewObject(),++this.capacity,console.warn("Creating new ["+t.type+"], this will probably result in visual bugs")),t},t.prototype.give=function(t){this._objectsIn.indexOf(t)>-1||(this._objectsIn.length==this.capacity&&(console.warn("You are giving back more objects than this pool has capacity for, something may have gone wrong."),++this.capacity),this._objectsIn.push(t))},t.prototype.constructNewObject=function(){var t=this._factory.construct.apply(this._factory,this._constructArguments);return this._postConstruct&&this._postConstruct.call(this._postConstructContext,t),t},t.prototype.getObjectsIn=function(){return this._objectsIn},t.prototype.destroy=function(){this._objectsIn.forEach(function(t){t.destroy()}.bind(this)),this._objectsIn=null},t}),define("factories/MinoFactory",["bottom_line","enums/Enum","enums/SpecialMinoType","enums/TetriminoType","gt/extras/PartialInjectionFactory","entities/Mino","gt/pooling/Pool"],function(t,e,i,n,s,r,o){function a(injector,tetriminoConfig,gameInfoPublisher){this._tetriminoConfig=tetriminoConfig,this._partialInjectionFactory=new s(injector,r),this._gameInfoPublisher=gameInfoPublisher,this._gameInfoPublisher.subscribe("returnMino",this["return"],this),this._pools={},n.USABLE_TYPES.forEach(function(t){this._initPool(t,null,a.NORMAL_POOL_SIZE),this._initPool(t,i.GHOST,4),this._initPool(t,i.MOVEGHOST,4)},this),this._initPool(null,i.SPARKLE),this._initPool(null,i.SCORECELL,a.SMALL_POOL_SIZE),this._initPool(null,i.JUNK,a.SMALL_POOL_SIZE),this._initPool(null,i.SHADOW,a.BIG_POOL_SIZE)}return a.BIG_POOL_SIZE=210,a.NORMAL_POOL_SIZE=100,a.SMALL_POOL_SIZE=50,a.TYPE_ID_OFFSET=100,a.prototype._initPool=function(t,e,i){i=i||a.BIG_POOL_SIZE;var n=this._getId(t,e);console.log("Creating Pool "+n),this._pools[n]=new o,this._pools[n].initialize(i,this,[t,e])},a.prototype._getId=function(t,e){var s=a.TYPE_ID_OFFSET,r=t||n.NONE,o=e||i.NONE;o*=s;var h=r+o;return h},a.prototype.get=function(t,e){var i=this._getId(t,e);return this._pools[i].take()},a.prototype["return"]=function(t){var e=this._getId(t.tetriminoType,t.specialMinoType);t.didSpriteChangeInGravity&&(t.setImage(t.getOriginalImageName()),t.didSpriteChangeInGravity=!1),this._pools[e].give(t)},a.prototype.construct=function(e,s){var r=e,o=s,a=null;if(o===i.JUNK)a="junk.png";else if(o===i.SPARKLE)a="typeLastHurrah.png";else if(o===i.SCORECELL)a="scoreCellOn_00.png";else if(o===i.SHADOW)a="minoShadow.png";else{void 0===r&&(r=n.USABLE_TYPES._.random());var tetriminoConfig=this._tetriminoConfig.getConfigForType(r),h=t.cloneDeep(tetriminoConfig);a=h.sprite,void 0!=o&&(a=this._getSpecialMinoImageName(a,s))}return this._partialInjectionFactory.construct(a,r,o)},a.prototype._getSpecialMinoImageName=function(t,e){var n=t.split("."),s=n[0];switch(e){case i.SHAPE:s+="_shape"}return s+"."+n[1]},a}),define("enums/ConditionType",[],function(){function t(){}return t.CLEAR_LINES="clearLines",t.CLEAR_JUNK="clearJunk",t.CLEAR_SIDE_JUNK="clearSideJunk",t.CLEAR_STARTING_JUNK="clearStartingJunk",t.MATCH_SHAPES="matchShapes",t.LOCK_OUT="lockOut",t.TOP_OUT="topOut",t.BLOCK_OUT="blockOut",t.TIME_LIMIT="timeLimit",t.MARATHON="marathon",t}),define("gameplay/conditions/Condition",["bottom_line","phaser"],function(t,e){function i(t){this.conditionValue=parseInt(t),this.currentValue=0,this._reached=!1}return i.prototype.isReached=function(){return this._reached},i.prototype.conditionReached=function(){this._reached=!0},i.prototype.cleanUp=function(){},i.prototype.reset=function(){this._reached=!1},i}),define("gameplay/conditions/LockOut",["bottom_line","gameplay/conditions/Condition"],function(t,e){function i(t,matrixConfig,tetriminoController,i,gameInfoPublisher){this._matrixConfig=matrixConfig,this._tetriminoController=tetriminoController,this._currentTetrimino=i,this._gameInfoPublisher=gameInfoPublisher,this._tetriminoController.lockedDownSignal.add(this.triggerGameOverCondition,this,1),e.call(this,t)}return t.inherit(i,e),i.prototype.triggerGameOverCondition=function(){var t=this._matrixConfig.STARTING_ROW_INDEX,e=this._tetriminoController.getCurrentTetrimino(),i=e.getBottomRow();i>t&&(console.log("LOCK OUT LOSE CONDITION TRIGGERED"),this.conditionReached())},i.prototype.cleanUp=function(){this._tetriminoController.lockedDownSignal.removeAll(this)},i}),define("gameplay/conditions/TopOut",["bottom_line","gameplay/conditions/Condition"],function(t,e){function i(t,junkMode,gameInfoPublisher){e.call(this,t),this._gameInfoPublisher=gameInfoPublisher}return t.inherit(i,e),i.prototype.cleanUp=function(){},i}),define("gameplay/conditions/BlockOut",["bottom_line","gameplay/conditions/Condition"],function(t,e){function i(t,tetriminoController,gameInfoPublisher){this._tetriminoController=tetriminoController,this._tetriminoController.blockOutSignal.add(this.triggerGameOverCondition,this,1),this._gameInfoPublisher=gameInfoPublisher,e.call(this,t)}return t.inherit(i,e),i.prototype.triggerGameOverCondition=function(){console.log("BLOCK OUT LOSE CONDITION TRIGGERED"),this.conditionReached()},i.prototype.cleanUp=function(){this._tetriminoController.blockOutSignal.removeAll(this)},i}),define("gameplay/conditions/Marathon",["bottom_line","gameplay/conditions/Condition"],function(t,e){function i(t,matrixRowMatcher,gameInfoPublisher,gameCheats){e.call(this,t),this._gameCheats=gameCheats,this._matrixRowMatcher=matrixRowMatcher,this._gameInfoPublisher=gameInfoPublisher,this._gameInfoPublisher=gameInfoPublisher,this.init()}return t.inherit(i,e),i.LINES_PER_LEVEL=10,i.NOTIFICATIONS_THRESHOLD=10,i.prototype.init=function(){this._matrixRowMatcher.rowsMatchedSignal.add(this.rowsMatched,this),this.currentLevel=1,this.currentLevel=this._gameCheats.getCheat("marathonlevel",this.currentLevel),this.currentLines=(this.currentLevel-1)*i.LINES_PER_LEVEL,this._gameInfoPublisher.publish("linesClearedChanged",this.currentLines),this._gameInfoPublisher.publish("marathonLevelChanged",this.currentLevel),this._gameInfoPublisher.publish("marathonProgressBarChanged",0),this._gameInfoPublisher.publish("marathonNotificationsOn",!0),this._addEvents()},i.prototype.rowsMatched=function(t){this.currentLines+=t.length,this._gameInfoPublisher.publish("linesClearedChanged",this.currentLines),console.log("Total cleared lines: "+this.currentLines),this._gameInfoPublisher.publish("marathonProgressBarChanged",this.currentLines/i.LINES_PER_LEVEL),this.currentLines>=this.currentLevel*i.LINES_PER_LEVEL&&(this.currentLevel=Math.floor(this.currentLines/i.LINES_PER_LEVEL)+1,this.currentLevel>this.conditionValue?this.conditionReached():(this._gameInfoPublisher.publish("marathonLevelChanged",this.currentLevel),this.currentLevel==i.NOTIFICATIONS_THRESHOLD&&this._gameInfoPublisher.publish("marathonNotificationsOn",!1),console.log("MARATHON LEVEL CHANGED, NOW ON LEVEL: "+this.currentLevel)))},i.prototype._gameOver=function(){this._matrixRowMatcher.rowsMatchedSignal.remove(this.rowsMatched,this),this._removeEvents()},i.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gameEnded",this._gameOver,this)},i.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gameEnded",this._gameOver,this)},i}),define("factories/ConditionFactory",["enums/ConditionType","gameplay/conditions/LockOut","gameplay/conditions/TopOut","gameplay/conditions/BlockOut","gameplay/conditions/Marathon"],function(t,e,i,n,s){function r(injector){this._injector=injector}return r.prototype.construct=function(t,e){return this._injector.createInstance.apply(this._injector,[this.getConstructorForType(t),e])},r.prototype.getConstructorForType=function(r){var o=null;switch(r){case t.LOCK_OUT:o=e;break;case t.TOP_OUT:o=i;break;case t.BLOCK_OUT:o=n;break;case t.MARATHON:o=s;break;default:console.log("no condition with this type exists")}return o},r}),define("enums/GameModeType",[],function(){function t(){}return t.CLEAR_LINES="clearLines",t.CLEAR_JUNK="clearJunk",t.CLEAR_SIDE_JUNK="clearSideJunk",t.CLEAR_STARTING_JUNK="clearStartingJunk",t.MATCH_SHAPES="matchShapes",t.GRAVITY_SWITCH="gravitySwitch",t.HOURGLASS="hourglass",t.CHAOS="chaos",t.INVISIBLE="invisible",t}),define("gameplay/game_modes/GameMode",[],function(){function t(){}return t.prototype.start=function(t,e){},t.prototype.startNewState=function(t,e){t&&t.call(e)},t.prototype.lockedDownInMatrix=function(t,e){t&&t.call(e)},t.prototype.matrixMatched=function(t,e){t&&t.call(e)},t.prototype.endCurrentState=function(t,e){t&&t.call(e)},t.prototype.cleanUp=function(){},t}),define("factories/GameModeFactory",["enums/GameModeType","gameplay/game_modes/GameMode"],function(t,e){function i(injector){this._injector=injector}return i.prototype.construct=function(gameMode){var t=gameMode,i=null;switch(t){default:i=e}return this._injector.getValueFromClass(i)},i}),define("core/LevelManager",[],function(){var t=function(game,levelParser,gameCheats){console.log("LevelManager.ctor"),this._game=game,this._gameCheats=gameCheats,this._levelParser=levelParser,this._levelJsons=null,this._levelDatas=null};return t.prototype.checkForCachedLevelJson=function(){console.log("LevelManager.checkForCachedLevelJson"),this._levelJsons=this._game.cache.getJSON("levels")||{},this._levelDatas={}},t.prototype.getLevelData=function(t,e,i,n){console.log("LevelManager.getLevelData ("+t+")");var s=this._levelDatas[t];s?i.call(n,s):this.loadLevelJson(t,function(s){var r=this._levelParser.parse(t,s);r.fallSpeedLevel=this._gameCheats.getCheat("fallspeed",r.fallSpeedLevel),r.levelId=e,this._levelDatas[t]=r,i.call(n,r)},this)},t.prototype.loadLevelJson=function(t,e,i){console.log("LevelManager.loadLevelJson ("+t+")");var n=this._levelJsons[t];if(n)e.call(i,n);else{var s="assets/levels/"+t+".json";this._game.load.json(t,s),this._game.load.onLoadComplete.addOnce(function(){var n=this._game.cache.getJSON(t);this._levelJsons[t]=n,console.log(" ...loaded."),e.call(i,n)},this),this._game.load.start()}},t}),define("data/LevelData",["enums/GameModeType","enums/TetriminoType"],function(t,e){function i(t){this.name=t,this.gameModes=[],this.fallSpeedLevel=1,this.winConditions=[],this.loseConditions=[],this.startMinos=[],this.otherMinos=[],this.scoreCells=[],this.isJunkLevel=!1,this.isSideJunkLevel=!1,this.isStartingJunkLevel=!1,this.junkWaves=0,this.junkRowsPerWave=0,this.junkPerWave=0,this.movesBetweenJunkWave=0,this.minimalJunkRow=0,this.levelTime=0,this.gravitySwitchCount=0,this.hourglassMoveCount=0,this.starScores=[],this.customTetriminoList=[],this.tutorialIdArray=null}return i.prototype.setFallSpeedLevel=function(t){this.fallSpeedLevel=parseInt(t)},i.prototype.addWinCondition=function(t,e){var i={type:t,value:e};this.winConditions.push(i)},i.prototype.addGameMode=function(gameMode){this.gameModes.push(gameMode)},i.prototype.addLoseCondition=function(t,e){var i={type:t,value:e};this.loseConditions.push(i)},i.prototype.addMinoData=function(t,e,i,n,s){var r={tetriminoType:t,specialMinoType:e,row:i,col:n};s?this.startMinos.push(r):this.otherMinos.push(r)},i.prototype.addScoreCell=function(t,e){var i={row:t,col:e};this.scoreCells.push(i)},i.prototype.addStarScore=function(t){t=parseInt(t),this.starScores.push(t)},i.prototype.addCustomTetrimino=function(t){var i=e[t];this.customTetriminoList.push(i)},i}),define("utils/TSpinUtil",["enums/Orientation","enums/TetriminoType"],function(t,e){var i={};return i.T_SPIN="tSpin",i.MINI_T_SPIN="miniTSpin",i.COLS=10,i.checkTSpinPositions=function(n,s){if(n.tetriminoType!=e.T)return null;var r,o,a,h,l,c,u,d,A=n.shapeMatrix[1][1].row,p=n.shapeMatrix[1][1].col;switch(n.orientation){case t.NORTH:r=A+1,o=p-1,a=A+1,h=p+1,l=A-1,c=p-1,u=A-1,d=p+1;break;case t.EAST:l=A+1,c=p-1,r=A+1,o=p+1,u=A-1,d=p-1,a=A-1,h=p+1;break;case t.SOUTH:u=A+1,d=p-1,l=A+1,c=p+1,a=A-1,h=p-1,r=A-1,o=p+1;break;case t.WEST:a=A+1,h=p-1,u=A+1,d=p+1,r=A-1,o=p-1,l=A-1,c=p+1}if(s[r][o].getPrisoner()&&s[a][h].getPrisoner()){if(0>l||0>c||c>=i.COLS||s[l][c].getPrisoner()||s[u][d].getPrisoner())return i.T_SPIN}else{if(!s[r][o].getPrisoner()&&!s[a][h].getPrisoner())return null;if(0>l||0>c||c>=i.COLS||s[l][c].getPrisoner()&&s[u][d].getPrisoner())return i.MINI_T_SPIN}},i}),define("gameplay/game/ScoreManager",["enums/TetriminoType","enums/Orientation","utils/Array2DUtil","enums/SpecialMinoType","utils/TSpinUtil"],function(t,e,i,n,s){var r=function(matrixRowMatcher,gameStateManager,tetriminoController,matrixModel,gameInfoPublisher,storageManager,matrixConfig,soundManager,matrixAnimator,gameVarManager,marathonProgress){console.log("ScoreManager.ctor"),this._matrixRowMatcher=matrixRowMatcher,this._gameStateManager=gameStateManager,this._tetriminoController=tetriminoController,this._gameInfoPublisher=gameInfoPublisher,this._storageManager=storageManager,this._matrixConfig=matrixConfig,this._matrixModel=matrixModel,this._matrixAnimator=matrixAnimator,this._gameVarManager=gameVarManager,this._soundManager=soundManager,this._marathonProgress=marathonProgress,this._matrix=matrixModel.matrix,this._scoreCellMatrix=matrixModel.scoreCellMatrix,this._firstScoreForLevel=!1,this._addEvents(),this._addSignals(),this._reset()};return r.SINGLE_SCORE=100,r.DOUBLE_SCORE=300,r.TRIPLE_SCORE=500,r.TETRIS_SCORE=800,r.TETRIS_PLUS_BASE_SCORE=50,r.MINI_TSPIN_SCORE=100,r.MINI_TSPIN_CLEAR_SCORE=200,r.TSPIN_SCORE=400,r.TSPIN_SINGLE_SCORE=800,r.TSPIN_DOUBLE_SCORE=1200,r.TSPIN_TRIPLE_SCORE=1600,r.BACK_TO_BACK_MODIFIER=1.5,r.SOFT_DROP=1,r.HARD_DROP=2,r.SINGLE_ALL_CLEAR=800,r.DOUBLE_ALL_CLEAR=1200,r.TRIPLE_ALL_CLEAR=1800,r.TETRIS_ALL_CLEAR=2e3,r.TETRIS_B2B_ALL_CLEAR=3200,r.SCORE_CELL_DEFAULT_SCORE=250,r.SPARKLING_MINO_DEFAULT_SCORE=1,r.TETRIS_CLEAR_LINE_COUNT=4,r.FIRST_MARATHON_LEVEL=1,r.prototype.addStarsForLevel=function(t,e){for(var i=0;e>i;i++){var n=t+"_star_"+i;if(!this._storageManager.get(n)){this._storageManager.set(n,!0);var s=this._storageManager.get(this._gameVarManager.constants.totalStars);this._storageManager.set("total_stars",s+1)}}},r.prototype.getStarsForCurrentLevel=function(t){var e=t.starScores,i=t.levelId;if(i==this._gameVarManager.constants.marathonID){var n=this._marathonProgress.getAchievedLevel();return n>=this._gameVarManager.constants.marathon_3_star?3:n>=this._gameVarManager.constants.marathon_2_star?2:n>=this._gameVarManager.constants.marathon_1_star?1:0}return this._score>=e[2]?3:this._score>=e[1]?2:this._score>=e[0]?1:void 0},r.prototype.getTotalStars=function(){var t="total_stars";return this._storageManager.get(t)||0},r.prototype.isFirstScoreForLevel=function(){return this._firstScoreForLevel},r.prototype.isMarathon=function(t){var e=!1;return t.winConditions.forEach(function(t){t.type==this._gameVarManager.constants.marathonModeName&&(e=!0)},this),e},r.prototype.isStarCollected=function(t,e){var i=t+"_star_"+e;return this._storageManager.get(i)},r.prototype.smartControlDrop=function(t,e){var i=r.HARD_DROP*t+r.SOFT_DROP*e;this._addScore(i)},r.prototype.isNewHighScore=function(){return this._isHighScore},r.prototype.getHighScoreForLevel=function(t){var e=t+"_highScore",i=this._storageManager.get(e)||0;return i},r.prototype.getScore=function(){return this._score},r.prototype.cleanUp=function(){},r.prototype._sendNotifications=function(t,e){var i=!1,n="txt";if(e)n+="PerfectClear",this._soundManager.play(this._gameVarManager.audioConstants.allclear_sfx);else if(n+=this._backToBackActive?"BacktoBack":"",this._tSpin)switch(t){case r.TSPIN_SINGLE_SCORE:n+="TSpinSingle";break;case r.TSPIN_DOUBLE_SCORE:n+="TSpinDouble";break;case r.TSPIN_TRIPLE_SCORE:n+="TSpinTriple";break;case r.TSPIN_SCORE:n="txtTSpin";break;default:i=!0}else this._miniTSpin&&t===r.MINI_TSPIN_SCORE?n="txtMiniTSpin":this._miniTSpin&&t===r.MINI_TSPIN_CLEAR_SCORE?n="txtMiniTSpinSingle":t===r.TETRIS_SCORE?n+="TetrisTM":i=!0;i||this._matrixAnimator.playNotificationAnimation(n)},r.prototype._lineClear=function(t){var e=t.length;this._linesCleared+=e;var i=0;if(this._tSpin||this._miniTSpin)if(this._tSpin){switch(e){case 1:i=r.TSPIN_SINGLE_SCORE,console.log("T-Spin single clear!");break;case 2:i=r.TSPIN_DOUBLE_SCORE,console.log("T-Spin double clear!!");break;case 3:i=r.TSPIN_TRIPLE_SCORE,console.log("T-SPIN TRIPLE CLEAR!!!")}this._soundManager.play(this._gameVarManager.audioConstants.t_spin_sfx)}else this._miniTSpin&&(i=r.MINI_TSPIN_CLEAR_SCORE,console.log("Mini T-Spin single clear"),this._soundManager.play(this._gameVarManager.audioConstants.t_spin_sfx));else switch(e){case 1:i=r.SINGLE_SCORE,this._backToBackActive=!1,console.log("Single clear");break;case 2:i=r.DOUBLE_SCORE,this._backToBackActive=!1,console.log("Double clear!");break;case 3:i=r.TRIPLE_SCORE,this._backToBackActive=!1,console.log("Triple clear!!");break;case 4:i=r.TETRIS_SCORE,console.log("TETRIS CLEAR!!!");break;default:i=r.TETRIS_PLUS_BASE_SCORE*e*e,console.log("Tetris PLUS "+e+" Clear!!")}var n=i;this._backToBackActive&&(n*=r.BACK_TO_BACK_MODIFIER,console.log("^^ with back to back bonus ^^"),this._soundManager.play(this._gameVarManager.audioConstants.back2back_sfx)),n*=this._marathonLevel;var s=this._allClearBonus(t);n+=s,n+=this._scoreCellsScore(t);var o=0;t.forEach(function(t){o+=t[0].row},this),o/=t.length,this._matrixAnimator.showScorePopup(this._matrixConfig.HALF_COLS-.5,o,n),this._sendNotifications(i,s),(4==e||this._miniTSpin||this._tSpin)&&(this._backToBackActive=!0),this._miniTSpin=!1,this._tSpin=!1,this._addScore(n),this._playLineclearAudio(e)},r.prototype._playLineclearAudio=function(t){switch(t){case 1:this._soundManager.effect(this._gameVarManager.audioConstants.lineclear_single_sfx);break;case 2:this._soundManager.effect(this._gameVarManager.audioConstants.lineclear_double_sfx);break;case 3:this._soundManager.effect(this._gameVarManager.audioConstants.lineclear_triple_sfx);break;case 4:this._soundManager.effect(this._gameVarManager.audioConstants.lineclear_tetris_sfx)}},r.prototype._noLineClear=function(){var t=0;this._tSpin?(console.log("T-Spin!"),t=r.TSPIN_SCORE):this._miniTSpin&&(console.log("Mini T-Spin"),t=r.MINI_TSPIN_SCORE),this._sendNotifications(t),t*=this._marathonLevel,this._miniTSpin=!1,this._tSpin=!1,this._addScore(t)},r.prototype._lockedDown=function(e){if(e.tetriminoType===t.T&&e.justRotated){var i=s.checkTSpinPositions(e,this._matrix);i==s.T_SPIN?this._tSpin=!0:i==s.MINI_T_SPIN&&(this._miniTSpin=!0)}},r.prototype._addSparkleScore=function(t){var e=0,s=r.SPARKLING_MINO_DEFAULT_SCORE;i.forEach(t,function(t){t.specialMinoType===n.SPARKLE&&(e+=s)},this),this._addScore(e)},r.prototype._scoreCellsScore=function(t){var e=0,s=this._gameStateManager.getCurrentLevelData(),o=s.scoreCellScore||r.SCORE_CELL_DEFAULT_SCORE;return i.forEach(t,function(t){var i=this._matrixModel.isFlipped?this._matrixConfig.STARTING_ROW_INDEX-t.row:t.row,s=this._scoreCellMatrix[i][t.col],r=s.getPrisoner();r&&t.specialMinoType!=n.JUNK&&(e+=o,s.destroyContents())},this),e},r.prototype._hardDropMove=function(){this._addScore(r.HARD_DROP)},r.prototype._softDropMove=function(){this._tetriminoController.canMoveDown()&&(this._addScore(r.SOFT_DROP),this._soundManager.play(this._gameVarManager.audioConstants.soft_drop_sfx))},r.prototype._allClearBonus=function(t){for(var e=0;e<this._matrix.length;e++)for(var i=0;i<this._matrix[e].length;i++)if(null!=this._matrix[e][i].getPrisoner())return 0;console.log("ALL CLEAR BONUS");var n=t.length;switch(n){case 1:return r.SINGLE_ALL_CLEAR;case 2:return r.DOUBLE_ALL_CLEAR;case 3:return r.TRIPLE_ALL_CLEAR;case 4:}return this._backToBackActive?r.TETRIS_B2B_ALL_CLEAR*this._marathonLevel:r.TETRIS_ALL_CLEAR},r.prototype._addScore=function(t){this._score+=t,this._gameInfoPublisher.publish("scoreChanged",this._score)},r.prototype._marathonLevelChanged=function(t){this._marathonLevel=t,t>r.FIRST_MARATHON_LEVEL&&this._matrixAnimator.playNotificationAnimation("txtLevelUp")},r.prototype._gameOver=function(t,e){var i=e.starScores,n=e.levelId,s=this.isMarathon(e);if(t&&!s)this.addStarsForLevel(n,this.getStarsForCurrentLevel(e));else if(s){var r=this._storageManager.get(this._gameVarManager.constants.totalStars);t?this._storageManager.set("total_stars",r+3):this._linesCleared>=10*(i[2]-1)?this._storageManager.set("total_stars",r+2):this._linesCleared>=10*(i[1]-1)&&this._storageManager.set("total_stars",r+1)}var o=n+"_highScore",a=this._storageManager.get(o);a||(this._firstScoreForLevel=!0),this._isHighScore=!a||a<this._score,this._isHighScore&&this._storageManager.set(o,this._score)},r.prototype._reset=function(){this._score=0,this._linesCleared=0,this._backToBackActive=!1,this._marathonLevel=1,this._firstScoreForLevel=!1,this._isHighScore=!1},r.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("marathonLevelChanged",this._marathonLevelChanged,this),this._gameInfoPublisher.subscribe("smartControlDrop",this.smartControlDrop,this),this._gameInfoPublisher.subscribe("gameEnded",this._gameOver,this),this._gameInfoPublisher.subscribe("gameRestarted",this._reset,this)},r.prototype._addSignals=function(){this._matrixRowMatcher.rowsMatchedScoreSignal.add(this._lineClear,this),this._matrixRowMatcher.lastHurrahScoreSignal.add(this._addSparkleScore,this),this._matrixRowMatcher.rowsNotMatchedSignal.add(this._noLineClear,this),this._gameStateManager.gameStartSignal.add(this._reset,this),this._tetriminoController.lockedDownSignal.add(this._lockedDown,this),this._tetriminoController.hardDropMoveSignal.add(this._hardDropMove,this),this._tetriminoController.softDropMoveSignal.add(this._softDropMove,this)},Object.defineProperty(r.prototype,"totalScore",{get:function(){var t=0;return this._storageManager.each(function(e,i){-1!==i.indexOf("_highScore")&&(t+=parseInt(e)||0)},this),t}}),r}),define("core/LevelParser",["data/LevelData","enums/SpecialMinoType","enums/TetriminoType","enums/GameModeType","gameplay/game/ScoreManager"],function(t,e,i,n,s){function r(matrixConfig,matrixView){this._matrixConfig=matrixConfig,this._matrixView=matrixView}return r.prototype.parse=function(e,i){var n=i.properties,s=new t(e);return this.setupGameModes(n,s),this.setupFallSpeed(n,s),this.setupWinConditions(n,s),this.setupLoseConditions(n,s),this.parseTiledLayers(s,i),this.parseGamemodeSpecificProperties(s,i),n.scoreCellScore&&(s.scoreCellScore=parseInt(n.scoreCellScore)),this.createCustomTetriminoList(i,s),this.parseTutorialId(n,s),s},r.prototype.setupGameModes=function(t,e){if(t.gameMode){e.addGameMode(t.gameMode);for(var i=1;t["gameMode_"+i];)e.addGameMode(t["gameMode_"+i]),i++}else e.addGameMode(t.winCondition)},r.prototype.setupFallSpeed=function(t,e){var i=t.fallSpeed;void 0!=i&&e.setFallSpeedLevel(i)},r.prototype.setupWinConditions=function(t,e){e.addWinCondition(t.winCondition,t.winValue);for(var i=1;t["winCondition_"+i];)e.addWinCondition(t["winCondition_"+i],t["winValue_"+i]),i++},r.prototype.setupLoseConditions=function(t,e){e.addLoseCondition("lockOut",null),e.addLoseCondition("topOut",null),e.addLoseCondition("blockOut",null);for(var i=1;t["loseCondition_"+i];)e.addLoseCondition(t["loseCondition_"+i],t["loseValue_"+i]),i++},r.prototype.parseTiledLayers=function(t,e){this.parseJunkLayer(t,e),this.parseScoreCellLayer(t,e),this.parseMinosLayer(t,e),this.parseMoveGhostLayer(t,e)},r.prototype.parseGamemodeSpecificProperties=function(t,e){for(var i=0;i<=t.gameModes.length;i++)switch(t.gameModes[i]){case n.CLEAR_JUNK:case n.CLEAR_STARTING_JUNK:case n.CLEAR_SIDE_JUNK:this.parseJunkLevelProperties(t,e);break;case n.GRAVITY_SWITCH:this.parseGravitySwitchProperties(t,e);break;case n.HOURGLASS:this.parseHourglassProperties(t,e);break;case n.INVISIBLE:this.parseInvisibleProperties(t,e)}},r.prototype.parseJunkLevelProperties=function(t,e){for(var i=e.properties,s=0;s<=t.gameModes.length;s++)t.gameModes[s]===n.CLEAR_JUNK?(t.isJunkLevel=!0,t.junkWaves=parseInt(i.junkWaves),t.junkPerWave=parseInt(i.junkPerWave),t.junkRowsPerWave=parseInt(i.junkRowsPerWave),t.minimalJunkRow=parseInt(i.minJunkRow),t.movesBetweenJunkWave=parseInt(i.movesBetweenJunkWave)):t.gameModes[s]===n.CLEAR_SIDE_JUNK?t.isSideJunkLevel=!0:t.gameModes[s]===n.CLEAR_STARTING_JUNK&&(t.isStartingJunkLevel=!0)},r.prototype.parseJunkLayer=function(t,n){var s=this.getLayerData(n,"junk");s&&s.data.forEach(function(s,r){if(s>0){var o=this.getRowAndColFromIndex(r,n),a=!0;t.addMinoData(i.NONE,e.JUNK,o.row,o.col,a)}},this)},r.prototype.parseScoreCellLayer=function(t,e){var i=this.getLayerData(e,"scoreCells");i&&i.data.forEach(function(i,n){if(i){var s=this.getRowAndColFromIndex(n,e);t.addScoreCell(s.row,s.col)}},this)},r.prototype.parseMinosLayer=function(t,i){for(var n=this.getLayerData(i,"minos"),s=0;s<n.data.length;s++){var r=n.data[s];if(r>0){var o=this.getRowAndColFromIndex(s,i),a=this.tiledDataToTetriminoType(r),h=!0;t.addMinoData(a,e.NONE,o.row,o.col,h)}}},r.prototype.parseMoveGhostLayer=function(t,i){var n=this.getLayerData(i,"moveGhostMinos");if(n)for(var s=0;s<n.data.length;s++){var r=n.data[s];if(r>0){var o=this.getRowAndColFromIndex(s,i),a=this.tiledDataToTetriminoType(r),h=!0;t.addMinoData(a,e.MOVEGHOST,o.row,o.col,h)}}},r.prototype.tiledDataToTetriminoType=function(t){switch(t){case 2:return i.I;case 3:return i.J;case 4:return i.L;case 5:return i.O;case 6:return i.S;case 7:return i.T;case 8:return i.Z;default:return i.NONE}},r.prototype.parseGravitySwitchProperties=function(t,e){var i=e.properties;t.gravitySwitchCount=parseInt(i.gravitySwitchCount)},r.prototype.parseHourglassProperties=function(t,e){var i=e.properties;t.hourglassMoveCount=parseInt(i.hourglassMoveCount)},r.prototype.parseInvisibleProperties=function(t,e){var i=e.properties;t.invisibleFadeDelay=parseInt(i.invisibleFadeDelay),t.invisibleFadeTime=parseInt(i.invisibleFadeTime)},r.prototype.getRowAndColFromIndex=function(t,e){for(var i={row:0,col:0};t>0&&t>=this._matrixConfig.COLS;)t-=this._matrixConfig.COLS,i.row++;return i.col=t,i.row=e.height-i.row-1,i},r.prototype.getLayerData=function(t,e){for(var i=null,n=0,s=t.layers.length;s>n;n++){var r=t.layers[n];r.name===e&&(i=r)}return i},r.prototype.createCustomTetriminoList=function(t,e){if(t.properties.tetriminolist)for(var i=t.properties.tetriminolist.split(","),n=0;n<i.length;n++){var s=i[n];e.addCustomTetrimino(s)}},r.prototype.parseTutorialId=function(t,e){if(t.tutorialid){var i=t.tutorialid.split(",");e.tutorialIdArray=i}else e.tutorialIdArray=[]},r}),define("gameplay/game/GameManager",[],function(){function t(levelManager,gameStateManager,matrixController,tetrisInput,tetriminoHolderController,tetriminoQueueController,gameCheats,gameVarManager,gameInfoPublisher,platform,scoreManager,smartControls,soundManager,tutorialController,storageManager,game,worldProgress){this._levelManager=levelManager,this._gameStateManager=gameStateManager,this._matrixController=matrixController,this._tetrisInput=tetrisInput,this._tetriminoHolderController=tetriminoHolderController,this._tetriminoQueueController=tetriminoQueueController,this._gameCheats=gameCheats,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._platform=platform,this._scoreManager=scoreManager,this._smartControls=smartControls,this._soundManager=soundManager,this._storageManager=storageManager,this._game=game,this._worldProgress=worldProgress,this._levelId=0,this._levelName="",this._levelData=null,this.hasStarted=!1}return t.DEFAULT_LEVEL="1",t.prototype.init=function(){this._levelManager.checkForCachedLevelJson(),this._gameInfoPublisher.publish("initializationBegin"),this._gameInfoPublisher.subscribe("gameEnded",this._endGame,this),this._gameInfoPublisher.subscribe("gameOver",this._gameOver,this)},t.prototype.start=function(t){this._levelId=t;var e=this._gameVarManager.levelMap[t];e=this._gameCheats.getCheat("level",e),this._levelName=e,this._levelManager.getLevelData(e,t,this.startGame,this),this.hasStarted=!0},t.prototype.startGame=function(t){this._tetrisInput.setup(),this._tetrisInput.start(),this._matrixController.start(t),this._tetriminoHolderController.start(),this._tetriminoQueueController.start(t),this._gameStateManager.start(t),this._levelData=t,this._platform.analytics(this._getAnalyticsLevelName()+"_start"),this._gameInfoPublisher.publish("gameStarted"),this._storageManager.set("lvl_replay",this._levelId)},t.prototype.endGame=function(){this._gameStateManager.endGame(!1)},t.prototype.restartGame=function(t){this.endGame(),this._gameStateManager.gameRestarted(),this.start(this._levelId),this._gameStateManager.pause(),this._platform.analytics(this._getAnalyticsLevelName()+"_restart"),this._gameInfoPublisher.publish("levelStart"),this._worldProgress.progress<=this._gameVarManager.constants.levelsWithoutAds&&this._levelId!=this._gameVarManager.constants.marathonID&&(t=!0),t?this._adSlotFinished():this._platform.showAd(this._adSlotFinished,this)},t.prototype._adSlotFinished=function(){this._game.gameResumed(),this._gameStateManager.resume(null,null,!0),this._gameInfoPublisher.publish("adFinished")},t.prototype.getLevelData=function(){return this._levelData},t.prototype.cleanUp=function(){this._gameStateManager.cleanUp(),this._tetriminoHolderController.cleanUp(),this._tetriminoQueueController.cleanUp(),this._matrixController.cleanUp(),this._tetrisInput.stop(),this._tetrisInput.removeSignals()},t.prototype._getAnalyticsLevelName=function(){var t=this._scoreManager.isMarathon(this._levelData);return t?"marathon":"level_"+this._levelId},t.prototype._endGame=function(t){var e=this._getAnalyticsLevelName();if(t){this._scoreManager.isFirstScoreForLevel()&&this._platform.analytics(e+"_completeonce");var i=this._scoreManager.getStarsForCurrentLevel(this._levelData);this._platform.analytics(e+"_won_"+i)}else this._platform.analytics(e+"_lost");this._gameInfoPublisher.publish("activateInputSignals",!1);var n={playerWon:t,levelId:this._levelId,levelName:this._levelName};this._gameInfoPublisher.publish("levelEnded",n),this.cleanUp()},t.prototype._gameOver=function(){this._soundManager.effect(this._gameVarManager.audioConstants.game_over_sfx)},t}),define("gameplay/game/GameStateManager",["gt/utils/device"],function(t){function e(conditionManager,tetriminoController,matrixRowMatcher,matrixGravity,gameModeFactory,gameInfoPublisher,lastHurrah,sceneManager,matrixAnimator,soundManager,gameVarManager,smartControls,tetrisInput,storageManager,worldProgress){this._conditionManager=conditionManager,this._tetriminoController=tetriminoController,this._matrixRowMatcher=matrixRowMatcher,this._matrixGravity=matrixGravity,this._gameModeFactory=gameModeFactory,this._gameInfoPublisher=gameInfoPublisher,this._lastHurrah=lastHurrah,this._sceneManager=sceneManager,this._matrixAnimator=matrixAnimator,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._smartControls=smartControls,this._tetrisInput=tetrisInput,this._storageManager=storageManager,this._worldProgress=worldProgress,this._currentLevelData=null,this._gameModes=[],this.lastHurrahTriggered=!1,this._levelStartCountdown=!1,this._restartedGame=!1,this._lostByTimeOut=!1,this._loseCount=0,this.gameStartSignal=new Phaser.Signal}return e.prototype.start=function(t){this._addEvents(),this._matrixAnimator.addEvents(),this._tetriminoController.lockedDownSignal.add(this.lockedDown,this),this._tetriminoController.blockOutSignal.add(this.checkForGameOverAfterEndCurrentState,this),this._currentLevelData=t,this._lostByTimeOut=!1;for(var e=0;e<t.gameModes.length;e++){var i=t.gameModes[e],n=this._gameModeFactory.construct(i);n.start(t,e),this._gameModes.push(n)}this._conditionManager.parseConditions(t),this._tetriminoController.start(t),this.gameStartSignal.dispatch(t),
this._levelStartCountdown=!0,this._matrixAnimator.playCountDownAnimation.call(this._matrixAnimator),this._gameInfoPublisher.publish("setButtonsEnabled",!1)},e.prototype.startNewState=function(){var t=0;this.lastHurrahTriggered=!1;var e=function(){"undefined"!=typeof this._gameModes[t]?this._gameModes[t++].startNewState(e,this):this.checkForGameOverAfterStartNewState()};e.call(this)},e.prototype.checkForGameOverAfterStartNewState=function(){this.isGameOver()?(this._loseCount++,this._conditionManager.hasPlayerWon||this._loseCount>1||this._lostByTimeOut?this._startEndLevelFlow(this._conditionManager.hasPlayerWon):this._gameInfoPublisher.publish("startEndLevelFlow",!1)):this.nextTetrimino()},e.prototype.nextTetrimino=function(){this._gameInfoPublisher.publish("gameTimerResumed"),this._tetriminoController.nextTetrimino()},e.prototype.lockedDown=function(){var t=0;this._gameInfoPublisher.publish("gameTimerPaused");var e=function(){"undefined"!=typeof this._gameModes[t]?this._gameModes[t++].lockedDownInMatrix(e,this):this.checkMatrix()};e.call(this)},e.prototype.checkMatrix=function(){this._matrixRowMatcher.checkMatrix(this.matrixRowsMatched,this)},e.prototype.matrixRowsMatched=function(t){var e=0,i=function(){"undefined"!=typeof this._gameModes[e]?this._gameModes[e++].matrixMatched(i,this):(this.moveMatrix(t),t&&this._smartControls.isInputOn(this._smartControls.getCurrentPointer())&&this._tetriminoController.ghostPieceVisibilityChanged(!0))};i.call(this)},e.prototype.moveMatrix=function(t){t?this._matrixGravity.applyGravity(this.endCurrentState,this,!0):this.endCurrentState()},e.prototype.endCurrentState=function(){var t=0,e=function(){this.lastHurrahTriggered||("undefined"!=typeof this._gameModes[t]?this._gameModes[t++].endCurrentState(e,this):this.checkForGameOverAfterEndCurrentState())};e.call(this)},e.prototype.checkForGameOverAfterEndCurrentState=function(){this.isGameOver()?(this._loseCount++,this._conditionManager.hasPlayerWon||this._loseCount>1||this._lostByTimeOut?this._startEndLevelFlow(this._conditionManager.hasPlayerWon):this._gameInfoPublisher.publish("startEndLevelFlow",!1)):this.startNewState()},e.prototype._endGameFlow=function(t){this.endGame(t),this.showEndPopup(t),t||this._soundManager.effect(this._gameVarManager.audioConstants.game_over_sfx)},e.prototype.endGame=function(t){this._loseCount=0,this._tetriminoController.stopTimers(),this._gameInfoPublisher.publish("gameEnded",t,this._currentLevelData)},e.prototype.pause=function(){this._tetriminoController.pause()},e.prototype.resume=function(t,e,i){this._matrixAnimator.playCountDownAnimation(t,e)},e.prototype.continueGame=function(){this._tetriminoController.stopTimers(),this._gameInfoPublisher.publish("enableHold",!0),this._levelStartCountdown=!0,this._conditionManager.resetConditionState(),this.resume()},e.prototype.countdownFinished=function(){this._levelStartCountdown&&(this.startNewState(),this._levelStartCountdown=!1),this._gameInfoPublisher.publish("gameResumed"),this._tetriminoController.resume()},e.prototype.gameRestarted=function(){this._restartedGame=!0},e.prototype.showEndPopup=function(t){var e=null;if(this._currentLevelData.levelId==this._gameVarManager.constants.marathonID){e="marathonModePp";this._sceneManager.showPopup(e)}else e=t?"lvlWinPp":"lvlLosePp",this._sceneManager.showPopup(e,this._currentLevelData,this._lostByTimeOut)},e.prototype.cleanUp=function(){this._removeEvents(),this._matrixAnimator.removeEvents(),this._conditionManager.cleanUp(),this._tetriminoController.cleanUp(),this._tetriminoController.lockedDownSignal.remove(this.lockedDown,this),this._tetriminoController.blockOutSignal.remove(this.checkForGameOverAfterEndCurrentState,this),this._matrixGravity.cleanUp();for(var t=0;t<this._gameModes.length;t++)this._gameModes[t].cleanUp();this._gameModes=[]},e.prototype.getCurrentLevelData=function(){return this._currentLevelData},e.prototype.isGameOver=function(){return this._conditionManager.isGameOver()&&this.lastHurrahTriggered===!1},e.prototype._startEndLevelFlow=function(t){console.log("Game has ended. The player has "+(t?"won":"lost")),t?(this._tetriminoController.stopTimers(),this._tetrisInput.setActive(!1),this.lastHurrahTriggered=!0,this._gameInfoPublisher.publish("lastHurrahTriggered"),this._currentLevelData.levelId!=this._gameVarManager.constants.marathonID?this._lastHurrah.lastHurrahFlow(function(){this._endGameFlow(t)},this):this._endGameFlow(t),this._soundManager.effect(this._gameVarManager.audioConstants.lasthurrah_textappear_sfx)):this._endGameFlow(t),this._soundManager.stop(this._gameVarManager.audioConstants.ingame_bgm)},e.prototype._timeOutGameOver=function(){this._lostByTimeOut=!0},e.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gamePaused",this.pause,this),this._gameInfoPublisher.subscribe("countdownBegin",this.resume,this),this._gameInfoPublisher.subscribe("countdownFinished",this.countdownFinished,this),this._gameInfoPublisher.subscribe("timeOut",this._timeOutGameOver,this),this._gameInfoPublisher.subscribe("startEndLevelFlow",this._startEndLevelFlow,this)},e.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gamePaused",this.pause,this),this._gameInfoPublisher.unsubscribe("countdownBegin",this.resume,this),this._gameInfoPublisher.unsubscribe("countdownFinished",this.countdownFinished,this),this._gameInfoPublisher.unsubscribe("timeOut",this._timeOutGameOver,this),this._gameInfoPublisher.unsubscribe("startEndLevelFlow",this._startEndLevelFlow,this)},e}),define("gameplay/game/GameCheats",["bottom_line","phaser","gt/utils/URLData"],function(t,e,i){function n(){console.log("GameCheats.ctor")}return n.prototype.getCheat=function(t,e){var i=e||null;return i},n}),define("gameplay/game/LastHurrah",["phaser","enums/SpecialMinoType"],function(t,e){function i(game,minoFactory,matrixController,matrixModel,matrixGravity,matrixView,matrixRowMatcher,matrixConfig,matrixAnimator,phaserEvents,screenShaker,soundManager,gameVarManager,gameInfoPublisher){this._game=game,this._minoFactory=minoFactory,this._matrixController=matrixController,this._matrixModel=matrixModel,this._matrixGravity=matrixGravity,this._matrixRowMatcher=matrixRowMatcher,this._matrixConfig=matrixConfig,this._matrixView=matrixView,this._matrixAnimator=matrixAnimator,this._screenShaker=screenShaker,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._minoFillingSpeed=i.FILL_BASE_SPEED,this._currentLastHurrahSpeed=i.LINE_CLEAR_BASE_SPEED,phaserEvents.updateEvent.add(this.update,this),this._state=null,this._randomTimerToReplacePhaserTimer=0}return i.STATES={REMOVE_COINS:0,REMOVE_SCORE_CELLS:1,FILLING:2,FILLING_LAST:3,START_CLEARING:4,CLEARING:5,WAITING_TO_FILL:6,WAITING_TO_CLEAR:7,DONE:-1},i.FILL_BASE_SPEED=30,i.FILL_SPEED_INCREASE=3,i.LINE_CLEAR_BASE_SPEED=2.3,i.LINE_CLEAR_SPEED_INCREASE=1,i.GRAVITY_BASE_TIME=150,i.FILL_START_DELAY=500,i.prototype.lastHurrahFlow=function(t,e){this._state=i.STATES.WAITING_TO_FILL,this._callback=t,this._context=e,this._screenShaker.activate(),this._minoFillingSpeed=i.FILL_BASE_SPEED,this._currentLastHurrahSpeed=i.LINE_CLEAR_BASE_SPEED,this.removeScoreCells(),this._randomTimerToReplacePhaserTimer=0,this._matrixAnimator.playLastHurrahAnimation(),this._gameInfoPublisher.publish("gravitySwitchGlowStop"),this._gameInfoPublisher.publish("hourglassGlowStop"),this._gameInfoPublisher.publish("junkspawnGlowStop")},i.prototype.removeScoreCells=function(){this._matrixController.forEachScoreCellInMatrix(function(t){!t.isEmpty()&&e.SCORECELL&&t.destroyContents()},this)},i.prototype.removeCoinMinos=function(t,i){this.callback=t,this.context=i,this._matrixController.forEachCellInVisibleMatrix(function(t){if(!t.isEmpty()&&e.COIN){var i=this._minoFactory.get(null,e.NONE);t.setPrisoner(i)}},this)},i.prototype.stopTimer=function(t){t&&t.timer.remove(t)},i.prototype.stopFillingSparklingMinos=function(){this._matrixModel.isFlipped&&(this._matrixController.flipGrid(),this._matrixView.resetMatrixPosition()),this._state=i.STATES.START_CLEARING},i.prototype.getEmptyCells=function(){var t=[];return this._matrixController.forEachCellInVisibleMatrixIncludingSkyline(function(e){e.isEmpty()&&t.push(e)},this),t},i.prototype.fillSparklingSingleMino=function(){var t=this.getEmptyCells(),n=this._pickRandomLowerArrayElement(t),s=this._minoFactory.get(null,e.SPARKLE);n.setPrisoner(s),s.animateIn(),1==t.length?(this._state=i.STATES.FILLING_LAST,s.animateGlow(function(){this.stopFillingSparklingMinos()},this)):(s.animateGlow(),this._soundManager.effect("lasthurrah_mino_"+(Math.floor(5*Math.random())+1),.4))},i.prototype.clearLastHurrahLine=function(){this._matrixController.isVisibleMatrixEmpty()?this.endLastHurrahFlow():(this._matrixRowMatcher.onDone.addOnce(function(){this._matrixGravity.applyGravity(),this._state=i.STATES.WAITING_TO_CLEAR},this),this._screenShaker.activate(.2*this._game.viewport.scale),this._matrixRowMatcher.clearBottomRow(!0,this._currentLastHurrahSpeed),this._currentLastHurrahSpeed+=i.LINE_CLEAR_SPEED_INCREASE),this._soundManager.effect(this._gameVarManager.audioConstants.lasthurrah_lineclear_sfx,.4)},i.prototype.endLastHurrahFlow=function(){this._state=i.STATES.DONE,this._callback.call(this._context)},i.prototype.cleanUp=function(){},i.prototype.updateFilling=function(t){for(var e=Math.ceil(t*this._minoFillingSpeed),n=this.getEmptyCells().length,s=0;s<Math.min(e,n);s++)this.fillSparklingSingleMino();this._minoFillingSpeed+=i.FILL_SPEED_INCREASE},i.prototype.update=function(){var t=this._game.time.elapsed,e=t/1e3;switch(this._randomTimerToReplacePhaserTimer+=t,this._state){case i.STATES.WAITING_TO_FILL:this._randomTimerToReplacePhaserTimer>=i.FILL_START_DELAY&&(this._state=i.STATES.FILLING);break;case i.STATES.FILLING:this.updateFilling(e);break;case i.STATES.START_CLEARING:this._randomTimerToReplacePhaserTimer=0,this.clearLastHurrahLine(),this._state=i.STATES.CLEARING;break;case i.STATES.WAITING_TO_CLEAR:var n=i.GRAVITY_BASE_TIME/this._currentLastHurrahSpeed;this._randomTimerToReplacePhaserTimer>=n&&(this._state=i.STATES.START_CLEARING)}},i.prototype._pickRandomLowerArrayElement=function(t){var e=Math.random();return t[Math.floor(e*e*e*e*e*t.length)]},i}),define("gameplay/conditions/ConditionManager",[],function(){function t(conditionFactory){this._conditionFactory=conditionFactory,this.winConditions=[],this.loseConditions=[],this.hasPlayerWon=!1}return t.prototype.parseConditions=function(t){t.winConditions.forEach(function(t){var e=t.type,i=t.value,n=this._conditionFactory.construct(e,i);this.winConditions.push(n)},this),t.loseConditions.forEach(function(t){var e=t.type,i=t.value,n=this._conditionFactory.construct(e,i);this.loseConditions.push(n)},this)},t.prototype.isGameOver=function(){var t=!0,e=!1;return this.winConditions.forEach(function(e){t=t&&e.isReached()},this),t?(this.hasPlayerWon=!0,!0):(this.loseConditions.forEach(function(t){e=e||t.isReached()},this),e?(this.hasPlayerWon=!1,!0):!1)},t.prototype.resetConditionState=function(){this.winConditions.forEach(function(t){t.reset()},this),this.loseConditions.forEach(function(t){t.reset()},this)},t.prototype.cleanUp=function(){this.winConditions.forEach(function(t){t.cleanUp()},this),this.loseConditions.forEach(function(t){t.cleanUp()},this),this.winConditions=[],this.loseConditions=[]},t}),define("gameplay/conditions/ClearLines",["bottom_line","gameplay/conditions/Condition"],function(t,e){function i(t,matrixRowMatcher,gameInfoPublisher){e.call(this,t),this._matrixRowMatcher=matrixRowMatcher,this._matrixRowMatcher.rowsMatchedSignal.add(this.rowsMatched,this),this._gameInfoPublisher=gameInfoPublisher,this._gameInfoPublisher.subscribe("gameEnded",this._gameOver,this)}return t.inherit(i,e),i.prototype.rowsMatched=function(t){this.currentValue<this.conditionValue&&(this.currentValue+=t.length,console.log("We cleared lines ! Progress: "+this.currentValue+"/"+this.conditionValue),this.currentValue>=this.conditionValue&&this.conditionReached())},i.prototype._gameOver=function(){this._matrixRowMatcher.rowsMatchedSignal.remove(this.rowsMatched,this)},i}),define("enums/Direction",[],function(){function t(){}return t.UP=1,t.RIGHT=2,t.DOWN=3,t.LEFT=4,t.invert=function(e){var i;switch(e){case t.UP:i=t.DOWN;break;case t.RIGHT:i=t.LEFT;break;case t.DOWN:i=t.UP;break;case t.LEFT:i=t.RIGHT}return i},t.toVector=function(e){switch(e){case t.UP:return{x:0,y:1};case t.RIGHT:return{x:1,y:0};case t.DOWN:return{x:0,y:-1};case t.LEFT:return{x:-1,y:0}}},t}),define("enums/Messages",[],function(){function t(){}return t.ROTATE="rotate",t.RESET_TETRIMINO="reset_tetrimino",t.EMPTY_MATRIX_CELL="empty_matrix_cell",t.TETRIMINO_DESTROYED="tetrimino_destroyed",t.ENTITY_DESTROYED="entity_destroyed",t}),define("gt/input/TouchInput",["phaser"],function(t){var e=function(game,e){console.log("TouchInput.ctor"),this._game=game,this._inputMapper=e,this.previousTouch={},this.currentTouch={},this.tapEvent=new t.Signal,this.swipeEvent=new t.Signal};return e.MAX_TAP_LENGTH=5,e.MIN_SWIPE_LENGTH=40,e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.TAP="tap",e.SWIPE="swipe",e.getDirectionFromVector=function(t){if(Math.abs(t.x)>Math.abs(t.y)){if(t.x<0)return e.LEFT;if(t.x>0)return e.RIGHT}else if(Math.abs(t.y)>Math.abs(t.x)){if(t.y<0)return e.UP;if(t.y>0)return e.DOWN}return null},e.prototype.mapInputs=function(){this._inputMapper.map(e.TAP,this.tapEvent,function(){return!0}),this._inputMapper.map(e.SWIPE,this.swipeEvent,function(t){return t.direction})},e.prototype.startCapturing=function(){this._game.input.onDown.add(this.startTouch,this),this._game.input.onUp.add(this.completeTouch,this)},e.prototype.stopCapturing=function(){this._game.input.onDown.remove(this.startTouch,this),this._game.input.onUp.remove(this.completeTouch,this)},e.prototype.startTouch=function(e){this.currentTouch.startPoint=new t.Point(e.x,e.y)},e.prototype.completeTouch=function(i){if(this.currentTouch.startPoint){this.currentTouch.endPoint=new t.Point(i.x,i.y);var n=t.Point.subtract(this.currentTouch.endPoint,this.currentTouch.startPoint);this.currentTouch.length=n.getMagnitude(),this.currentTouch.direction=e.getDirectionFromVector(n),this.currentTouch.length<=e.MAX_TAP_LENGTH&&this.tapEvent.dispatch(this.currentTouch),this.currentTouch.length>=e.MIN_SWIPE_LENGTH&&this.swipeEvent.dispatch(this.currentTouch),this.previousTouch=this.currentTouch,this.currentTouch={}}},e}),define("gameplay/input/TetrisInput",["phaser","gt/utils/device","enums/Direction","enums/Messages","enums/Rotation","gt/input/TouchInput","data/ControlScheme"],function(t,e,i,n,s,r,o){function a(game,storageManager,smartControls,gameVarManager,gameInfoPublisher,controlScheme){this._game=game,this._storageManager=storageManager,this._smartControls=smartControls,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._controlScheme=controlScheme,this._gameInfoPublisher.subscribe("initializationBegin",this.init,this),this._flaggedSignals=[]}return a.prototype.init=function(){this._gameInfoPublisher.subscribe("controlSchemeChanged",this._changeControlScheme,this)},a.prototype.setup=function(){this._createSignals(),this._game.input.maxPointers=1,this.setActive(!1)},a.prototype.start=function(){this._addEvents(),e.desktop?(this.enableSmartControlsInput(),this._setupDesktopInput(),this._controlScheme[o.CURRENT_SCHEME_KEY]=o.SMART):(this.enableSmartControlsInput(),this._controlScheme[o.CURRENT_SCHEME_KEY]===o.SWIPE?this._smartControls.activateSwipe():(this._controlScheme[o.CURRENT_SCHEME_KEY]=o.SMART,this._smartControls.activateSmart())),this.inputStartedSignal.dispatch()},a.prototype.stop=function(){this._removeEvents(),e.desktop?(this._disableSmartControlsInput(),this._disableDesktopInput()):this._disableSmartControlsInput()},a.prototype.setActive=function(t){var e=!t;e&&this._endSignals();for(var i=0;i<this._signals.length;i++)this._signals[i].active=t;this.resumeSignal.active=this._game.paused,this.moveStartSignal.remove(this._rememberMoveStartSignal,this),this.startSoftDropSignal.remove(this._rememberStartSoftDropSignal,this),this._dispatchFlaggedSignals()},a.prototype.setKeyDownSignalsInactive=function(){for(var t=0;t<this._keyDownSignals.length;t++)this._keyDownSignals[t].active=!1;this.moveStartSignal.add(this._rememberMoveStartSignal,this,1/0),this.startSoftDropSignal.add(this._rememberStartSoftDropSignal,this,1/0),this.moveStopSignal.add(this._forgetMoveStartSignal,this,1/0),this.endSoftDropSignal.add(this._forgetStartSoftDropSignal,this,1/0)},a.prototype._rememberMoveStartSignal=function(){this._flaggedSignals.push({signal:this.moveStartSignal,argument:arguments}),this.moveStartSignal.remove(this._rememberMoveStartSignal,this),this.moveStartSignal.halt()},a.prototype._rememberStartSoftDropSignal=function(){this._flaggedSignals.push({signal:this.startSoftDropSignal,argument:arguments}),this.startSoftDropSignal.remove(this._rememberStartSoftDropSignal,this),this.startSoftDropSignal.halt()},a.prototype._forgetMoveStartSignal=function(){this.moveStopSignal.remove(this._forgetMoveStartSignal,this);for(var t=0;t<this._flaggedSignals.length;t++)if(this._flaggedSignals[t].signal===this.moveStartSignal){this._flaggedSignals.splice(t,1);break}},a.prototype._forgetStartSoftDropSignal=function(){this.endSoftDropSignal.remove(this._forgetStartSoftDropSignal,this);for(var t=0;t<this._flaggedSignals.length;t++)if(this._flaggedSignals[t].signal===this.startSoftDropSignal){this._flaggedSignals.splice(t,1);break}},a.prototype._dispatchFlaggedSignals=function(){for(var t=this._flaggedSignals.length-1;t>=0;t--){var e=this._flaggedSignals.splice(t,1)[0];e.signal.dispatch.apply(this,e.argument)}},a.prototype.associateRotateSignal=function(t,e){this.rotateSignal.dispatch(t,e)},a.prototype.associateHardDropSignal=function(){this.hardDropSignal.dispatch()},a.prototype.associateStartSoftDropSignal=function(){this.startSoftDropSignal.dispatch()},a.prototype.associateEndSoftDropSignal=function(){this.endSoftDropSignal.dispatch()},a.prototype.associateResumeSignal=function(){console.log("resumed!"),this.resumeSignal.dispatch()},a.prototype.associateHoldSignal=function(){this.holdSignal.dispatch()},a.prototype.associateMoveStartSignal=function(t){this.moveStartSignal.dispatch(t)},a.prototype.associateMoveStopSignal=function(t){this.moveStopSignal.dispatch(t)},a.prototype.enableSmartControlsInput=function(){this._smartControls.start(),e.desktop?this._game.input.onDown.add(this._mouseDownCallback,this):this._game.input.onDown.add(this._smartControls.pointerDown,this._smartControls),this._game.input.onUp.add(this._smartControls.pointerUp,this._smartControls),this._game.input.addMoveCallback(this._smartControls.pointerMoved,this._smartControls)},a.prototype.registerSignalToKey=function(t,e,i,n){this.key=this._game.input.keyboard.addKey(t);var s="onUp";i===!0&&(s="onDown"),void 0!==n?this.key[s].add(function(){e.dispatch(n)},this):this.key[s].add(e.dispatch,e),this.key.onDown.add(this._smartControls.startedUsingKeyboard,this._smartControls)},a.prototype.removeSignals=function(){this._smartControls.startSoftDropSignal.remove(this.associateStartSoftDropSignal,this),this._smartControls.endSoftDropSignal.remove(this.associateEndSoftDropSignal,this),this._smartControls.holdSignal.remove(this.associateHoldSignal,this)},a.prototype._unbindSignalFromKey=function(t,e,i){this.key=this._game.input.keyboard.addKey(t);var n="onUp";i===!0&&(n="onDown"),this.key[n].removeAll(),this.key.onDown.remove(this._smartControls.startedUsingKeyboard,this._smartControls)},a.prototype._mouseDownCallback=function(t){0==t.button&&this._smartControls.pointerDown(this._game.input.mousePointer),2==t.button&&this.holdSignal.dispatch()},a.prototype._endSignals=function(){game.input.keyboard.isDown(t.Keyboard.DOWN)&&this.endSoftDropSignal.dispatch()},a.prototype._disableSmartControlsInput=function(){this._smartControls.pointerCancelled(),this._smartControls.stop(),this._game.input.onDown.remove(this._smartControls.pointerDown,this._smartControls),this._game.input.onDown.remove(this._mouseDownCallback,this),this._game.input.onUp.remove(this._smartControls.pointerUp,this._smartControls),this._game.input.deleteMoveCallback(this._smartControls.pointerMoved,this._smartControls)},a.prototype._setupDesktopInput=function(){this.registerSignalToKey(t.Keyboard.UP,this.rotateSignal,!0,s.Clockwise),this.registerSignalToKey(t.Keyboard.X,this.rotateSignal,!0,s.Clockwise),this.registerSignalToKey(t.Keyboard.CONTROL,this.rotateSignal,!0,s.CounterClockwise),this.registerSignalToKey(t.Keyboard.Z,this.rotateSignal,!0,s.CounterClockwise),this.registerSignalToKey(t.Keyboard.RIGHT,this.moveStartSignal,!0,i.RIGHT),this.registerSignalToKey(t.Keyboard.RIGHT,this.moveStopSignal,!1,i.RIGHT),this.registerSignalToKey(t.Keyboard.LEFT,this.moveStartSignal,!0,i.LEFT),this.registerSignalToKey(t.Keyboard.LEFT,this.moveStopSignal,!1,i.LEFT),this.registerSignalToKey(t.Keyboard.DOWN,this.startSoftDropSignal,!0),this.registerSignalToKey(t.Keyboard.DOWN,this.endSoftDropSignal),this.registerSignalToKey(t.Keyboard.SPACEBAR,this.hardDropSignal,!0),this.registerSignalToKey(t.Keyboard.P,this.pauseSignal,!1),this.registerSignalToKey(t.Keyboard.P,this.resumeSignal,!1),this.registerSignalToKey(t.Keyboard.SHIFT,this.holdSignal,!0),this.registerSignalToKey(t.Keyboard.C,this.holdSignal,!0)},a.prototype._disableDesktopInput=function(){this._unbindSignalFromKey(t.Keyboard.UP,this.rotateSignal,!0,s.Clockwise),this._unbindSignalFromKey(t.Keyboard.X,this.rotateSignal,!0,s.Clockwise),this._unbindSignalFromKey(t.Keyboard.CONTROL,this.rotateSignal,!0,s.CounterClockwise),this._unbindSignalFromKey(t.Keyboard.Z,this.rotateSignal,!0,s.CounterClockwise),this._unbindSignalFromKey(t.Keyboard.RIGHT,this.moveStartSignal,!0,i.RIGHT),this._unbindSignalFromKey(t.Keyboard.RIGHT,this.moveStopSignal,!1,i.RIGHT),this._unbindSignalFromKey(t.Keyboard.LEFT,this.moveStartSignal,!0,i.LEFT),this._unbindSignalFromKey(t.Keyboard.LEFT,this.moveStopSignal,!1,i.LEFT),this._unbindSignalFromKey(t.Keyboard.DOWN,this.startSoftDropSignal,!0),this._unbindSignalFromKey(t.Keyboard.DOWN,this.endSoftDropSignal),this._unbindSignalFromKey(t.Keyboard.SPACEBAR,this.hardDropSignal,!0),this._unbindSignalFromKey(t.Keyboard.P,this.pauseSignal,!1),this._unbindSignalFromKey(t.Keyboard.P,this.resumeSignal,!1),this._unbindSignalFromKey(t.Keyboard.SHIFT,this.holdSignal,!0),this._unbindSignalFromKey(t.Keyboard.C,this.holdSignal,!0)},a.prototype._changeControlScheme=function(t){this.stop(),this._controlScheme[o.CURRENT_SCHEME_KEY]=t,this.start()},a.prototype._gamePaused=function(){this.setActive(!1)},a.prototype._gameResumed=function(){this.setActive(!0)},a.prototype._createSignals=function(){this.rotateSignal=new t.Signal,this.hardDropSignal=new t.Signal,this.startSoftDropSignal=new t.Signal,this.endSoftDropSignal=new t.Signal,this.pauseSignal=new t.Signal,this.resumeSignal=new t.Signal,this.holdSignal=new t.Signal,this.moveStartSignal=new t.Signal,this.moveStopSignal=new t.Signal,this.inputStartedSignal=new t.Signal,this._signals=[this.rotateSignal,this.hardDropSignal,this.startSoftDropSignal,this.endSoftDropSignal,this.pauseSignal,this.holdSignal,this.moveStartSignal,this.moveStopSignal,this.inputStartedSignal],this._keyDownSignals=[this.rotateSignal,this.hardDropSignal,this.pauseSignal,this.resumeSignal,this.holdSignal,this.inputStartedSignal],this._addSignals()},a.prototype._addSignals=function(){this._smartControls.startSoftDropSignal.add(this.associateStartSoftDropSignal,this),this._smartControls.endSoftDropSignal.add(this.associateEndSoftDropSignal,this),this._smartControls.holdSignal.add(this.associateHoldSignal,this)},a.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gamePaused",this._gamePaused,this),this._gameInfoPublisher.subscribe("gameResumed",this._gameResumed,this),this._gameInfoPublisher.subscribe("activateInputSignals",this.setActive,this),this._gameInfoPublisher.subscribe("gameRestarted",this._gamePaused,this)},a.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gamePaused",this._gamePaused,this),this._gameInfoPublisher.unsubscribe("gameResumed",this._gameResumed,this),this._gameInfoPublisher.unsubscribe("activateInputSignals",this.setActive,this),this._gameInfoPublisher.unsubscribe("gameRestarted",this._gamePaused,this)},a}),define("gameplay/RotationController",["bottom_line","utils/Array2DUtil","enums/Messages","enums/Rotation","enums/Orientation"],function(t,e,i,n,s){function r(tetrisInput,smartControls,matrixController,tetriminoConfig,matrixModel,soundManager,gameVarManager){this._currentRotation=0,this._maxRotations=5,this._tetrisInput=tetrisInput,this._smartControls=smartControls,this._matrixController=matrixController,this._tetriminoConfig=tetriminoConfig,this._matrixModel=matrixModel,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this.currentTetrimino=null,this.rotatedSignal=new Phaser.Signal}return r.prototype.start=function(){this._tetrisInput.rotateSignal.add(this.rotate,this)},r.prototype.stop=function(){this._tetrisInput.rotateSignal.remove(this.rotate,this),this.currentTetrimino=null},r.prototype.orient=function(e,i){var i=i||this.currentTetrimino,n=i.orientation,s=i.config.rotations,r=i.getMinos(),o=t.clone(i.shapeMatrix);i.orient(e);var a=t.clone(i.shapeMatrix),h=this.getRotationModifiers(r,o,a);this._currentRotation=0,this.tryRotation(r,h,s[n],s[e])||(i.orient(n),i.justRotated=!1,this._soundManager.effect(this._gameVarManager.audioConstants.rotation_failure_sfx),console.log("No rotation point could be found that was a valid rotation"))},r.prototype.rotate=function(t){this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_rotation_sfx);var e=this.currentTetrimino.orientation;this._matrixModel.isFlipped&&(t=n.invert(t));var i=s.rotateOrientation(e,t);this.orient(i)},r.prototype.tryRotation=function(e,i,n,s){for(var r=n[this._currentRotation].row,o=n[this._currentRotation].col,a=s[this._currentRotation].row,h=s[this._currentRotation].col,l=r-a,c=o-h,u=t.cloneDeep(i),d=0,A=u.length;A>d;d++){var p=u[d];p.row+=l,p.col+=c}return this._matrixController.checkIfMoveIsValid(e,u)?(this._matrixController.moveMinosInMatrix(e,u),e[0].tetrimino&&(e[0].tetrimino.row+=l,e[0].tetrimino.col+=c),this.rotatedSignal.dispatch(),!0):(this._currentRotation++,this._currentRotation===this._maxRotations?!1:this.tryRotation(e,i,n,s))},r.prototype.getRotationModifiers=function(t,i,n){for(var s=[],r=0,o=t.length;o>r;r++){var a=t[r],h=e.getRowAndColForElement(i,a),l=e.getRowAndColForElement(n,a),c={row:h.row-l.row,col:l.col-h.col};s.push(c)}return s},r}),define("utils/TetrisFormulas",["phaser"],function(t){var e={};return e.getFallSpeed=function(e){if(e-=1,1>e)return t.Timer.SECOND;var i=.8-.007*e;return Math.pow(i,e)*t.Timer.SECOND},e.getSoftDropSpeed=function(t){return.05*this.getFallSpeed(t)},e}),define("enums/TutorialType",[],function(){function t(){}return t.GRAVITY_SWITCH="gravity",t.HOLD="hold",t.HOURGLASS="hourglass",t.PLACEMENT_1="placement1",t.PLACEMENT_2="placement2",t.SCORECELLS="scorecells",t.TIME="time",t.STARS="stars",t.JUNK="junk",t.JUNKSPAWN="junkspawn",t}),define("gameplay/TetriminoController",["bottom_line","phaser","enums/Direction","enums/Messages","utils/TetrisFormulas","enums/Orientation","enums/TetriminoType","enums/TutorialType","data/ControlScheme"],function(t,e,i,n,s,r,o,a,h){function l(game,matrixController,tetrisInput,smartControls,tetriminoQueueController,matrixConfig,gameInfoPublisher,rotationController,matrixModel,matrixAnimator,soundManager,gameVarManager,forcedMove,controlScheme,tetriminoFactory,gravityModeMinoHandler){this._game=game,this._matrixController=matrixController,this._tetrisInput=tetrisInput,this._smartControls=smartControls,this._tetriminoQueueController=tetriminoQueueController,this._matrixConfig=matrixConfig,this._rotationController=rotationController,this._matrixModel=matrixModel,this._matrixAnimator=matrixAnimator,this._gameInfoPublisher=gameInfoPublisher,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._forcedMove=forcedMove,this._gameInfoPublisher=gameInfoPublisher,this._controlScheme=controlScheme,this._tetriminoFactory=tetriminoFactory,this._gravityModeMinoHandler=gravityModeMinoHandler,this._currentTetrimino=null,this._previousTetrimino=null,this._ghostTetrimino=null,this._fallSpeed=0,this._fallTimer=null,this._softDropSpeed=0,this._softDropTimer=null,this._moveDelay=130,this._autoRepeatDelay=35,this._tmpMoveTimer=null,this._moveTimer=null,this._moveDirection=null,this._lockDownTimer=null,this._isLockingDown=!1,this._lockdownStarted=!1,this._lockedDown=!1,this._matrixFlipAnimInProgress=!1,this._canAudioPlay=!0,this._tutorialActive=!1,this._inputAllowed=!0,this._currentMovesCounter=0,this._lastTouchDownPosition=-1,this._lowestRowReached=this._matrixConfig.PLAYABLE_ROWS_COUNT,this._matrixController.onScoreCellActivate.add(this._scoreCellActivated,this),this._createSignals()}return l.MOVEMENT_Y=1,l.MOVEMENT_X=1,l.LOCKDOWN_DELAY=500,l.MAX_MOVES_AFTER_TOUCHDOWN=15,l.FIRST_TUTORIAL_ID="placement1",l.prototype.start=function(t){var e=t.fallSpeedLevel;this._enableEvents(),this._setSpeeds(e),this._rotationController.start(),this._smartControls.setTetriminoController(this),this._canFallThisLevel=t.tutorialIdArray[0]!=l.FIRST_TUTORIAL_ID},l.prototype.reset=function(){this.stopTimers()},l.prototype.pause=function(){this._manuallyPaused=!0,this._pauseTimer(this._tmpMoveTimer),this._pauseTimer(this._moveTimer),this._pauseTimer(this._fallTimer),this._pauseTimer(this._softDropTimer),this._pauseTimer(this._lockDownTimer)},l.prototype.resume=function(){game.input.keyboard.reset(!1),this._manuallyPaused=!1,this._resumeTimer(this._tmpMoveTimer),this._resumeTimer(this._moveTimer),this._resumeTimer(this._fallTimer),this._resumeTimer(this._softDropTimer),this._resumeTimer(this._lockDownTimer)},l.prototype.onResume=function(){this._manuallyPaused&&this.pause()},l.prototype.cleanUp=function(){this._disableEvents(),this._currentTetrimino=null,this._ghostTetrimino=null,this._rotationController.stop(),this._tetriminoQueueController.cleanUp(),this._forcedMove.cleanUp(),this._tetrisInput.holdSignal.remove(this.cancelLockdown,this),game.input.keyboard.reset(!1)},l.prototype.startFallTimer=function(){this._stopTimer(this._fallTimer),this._forcedMove.moveGhostMinosCleared&&this._canFallThisLevel&&(this._fallTimer=this._startTimer(this._fallTimer,this._fallSpeed,this.moveDown,this))},l.prototype.stopTimers=function(){this._stopTimer(this._tmpMoveTimer),this._stopTimer(this._moveTimer),this._stopTimer(this._softDropTimer),this.stopFallingTimers()},l.prototype.stopFallingTimers=function(){this._stopTimer(this._fallTimer),this._stopTimer(this._lockDownTimer)},l.prototype.nextTetrimino=function(t){this._lockedDown=!1,this._resumeTimer(this._moveTimer),this._currentMovesCounter=0,this._lastTouchDownPosition=-1,this._lowestRowReached=this._matrixConfig.PLAYABLE_ROWS_COUNT,this._gameInfoPublisher.publish("setButtonsEnabled",!0),t?this._currentTetrimino=t:(this._currentTetrimino=this._tetriminoQueueController.getNext(),this._matrixModel.isFlipped&&(this._currentTetrimino=this._gravityModeMinoHandler.reconstructTetrimino(this._currentTetrimino,!1))),this._currentTetrimino.row=this._matrixConfig.SPAWNING_ROW_INDEX,this._currentTetrimino.col=this._matrixConfig.SPAWNING_COL,this._rotationController.currentTetrimino=this._currentTetrimino;for(var e=!1;!e&&this._currentTetrimino.row<this._matrixConfig.BLOCKOUT_ROW;)e=this._matrixController.isValidTetriminoLocation(this._currentTetrimino,this._currentTetrimino.row,this._currentTetrimino.col),e||this._currentTetrimino.row++;return this._currentTetrimino.row>=this._matrixConfig.BLOCKOUT_ROW?void this.blockOutSignal.dispatch():(e&&(this._matrixController.addTetriminoToMatrix(this._currentTetrimino,this._currentTetrimino.row,this._currentTetrimino.col),this._gameInfoPublisher.publish("newTetriminoSpawned",this._currentTetrimino,this._currentTetrimino.row,this._currentTetrimino.col)),
this.startFallTimer(),void(this._currentTetrimino&&(this.updateGhostToCurrentPosition(),this._gameInfoPublisher.publish("tetriminoSpawnComplete"),this._gameInfoPublisher.publish("activateInputSignals",!0))))},l.prototype.transform=function(e,i,n,s,r){if(this._inputAllowed){if(i>=this._matrixConfig.ROWS)return console.error("Attempted to transform tetrimino to outside of the matrix - ","x: ",e,"y: ",i,"orientation: ",n),void console.trace();var s=s||this._currentTetrimino,o=s.getMinos(),a=[],l={row:i-s.row,col:e-s.col},c=t.clone(s.shapeMatrix),u=s.orientation;s.orient(n),this._controlScheme[h.CURRENT_SCHEME_KEY]!==h.SMART&&this._currentTetrimino.orientation!=n&&this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_rotation_sfx);var d=t.clone(s.shapeMatrix),A=this._rotationController.getRotationModifiers(o,c,d);a=a.concat(A),a.forEach(function(t){t.row+=l.row,t.col+=l.col}),this._matrixController.checkIfMoveIsValid(o,a,!1,this._currentTetrimino)?(this._matrixController.moveMinosInMatrix(o,a,r),s.move(l)):(s.orient(u),s.justRotated=!1,this.transform(e,i+1,n,s,r))}},l.prototype.smartControlsTransform=function(t,e,i,n,s){this._controlScheme[h.CURRENT_SCHEME_KEY]!==h.DESKTOP&&this._inputAllowed&&(this.transform(t,e,i,n,s),this._stopTimer(this._moveTimer),this._stopTimer(this._tmpMoveTimer),this.checkLockdown())},l.prototype.moveTetrimino=function(t){if(this._inputAllowed&&this._currentTetrimino!=this._previousTetrimino){var e={row:0,col:0};switch(t){case i.UP:e.row=l.MOVEMENT_Y;break;case i.RIGHT:e.col=l.MOVEMENT_X;break;case i.DOWN:e.row=-l.MOVEMENT_Y;break;case i.LEFT:e.col=-l.MOVEMENT_X}return this.moveTetriminoBy(e)}},l.prototype.moveTetriminoBy=function(t){if(!this._currentTetrimino||this._currentTetrimino==this._previousTetrimino)return!1;var e=this._currentTetrimino.getMinos();return this._matrixController.checkIfMoveIsValid(e,t)?(this._currentTetrimino.move(t),this._matrixController.moveMinosInMatrix(e,t),this._gameInfoPublisher.publish("tetriminoFell"),this.checkLockdown(),this._canAudioPlay=!!t.col,!0):(this.canMoveDown()||this.startLockdown(),this._canAudioPlay&&!this._lockdownStarted&&(this._soundManager.effect(this._gameVarManager.audioConstants.movement_failure_sfx),this._canAudioPlay=!1),!1)},l.prototype.startMoveTetrimino=function(t){this._currentTetrimino!=this._previousTetrimino&&(this._moveDirection=t,this.moveTetrimino(this._moveDirection),this._currentTetrimino&&(this._stopTimer(this._tmpMoveTimer),this._stopTimer(this._moveTimer),this._tmpMoveTimer=this._startTimer(this._tmpMoveTimer,this._moveDelay,this._startMoveTimer,this),this.updateGhostToCurrentPosition(),this._currentTetrimino.justRotated=!1))},l.prototype.stopMoveTetrimino=function(t){if(this._moveDirection===t){this._stopTimer(this._tmpMoveTimer),this._stopTimer(this._moveTimer);var n=null;n=this._moveDirection===i.RIGHT?game.input.keyboard.addKey(e.Keyboard.LEFT):game.input.keyboard.addKey(e.Keyboard.RIGHT),n.isDown&&this.startMoveTetrimino(i.invert(t))}},l.prototype.startLockdown=function(){return this._lockdownStarted||this._matrixFlipAnimInProgress||this._currentTetrimino==this._previousTetrimino?void 0:(this._gameInfoPublisher.publish("tetriminoTouchDown"),this._stopTimer(this._fallTimer),this._lastTouchDownPosition=this._lowestRowReached,this._lockdownStarted=!0,this._currentMovesCounter>=l.MAX_MOVES_AFTER_TOUCHDOWN?void this.lockDown():void(this._isLockingDown||(this._lockDownTimer=this._startTimer(this._lockDownTimer,l.LOCKDOWN_DELAY,this.lockDown,this),this._isLockingDown=!0)))},l.prototype.lockDown=function(t){this._ghostTetrimino&&this._forcedMove.isMoveLegal(this.ghostTetrimino)&&(this._previousTetrimino=this._currentTetrimino,this._lockedDown=!0,this._isLockingDown=!1,this._tetrisInput.setKeyDownSignalsInactive(),this._gameInfoPublisher.publish("setButtonsEnabled",!1),this.stopFallingTimers(),this._pauseTimer(this._moveTimer),this.transform(this._ghostTetrimino.col,this._ghostTetrimino.row,this._ghostTetrimino.orientation),(t||this._smartControls.isSmartControlActive())&&(this._smartControls.tetriminoLockedDown(),this._currentTetrimino.justRotated=this._smartControls.smartControlsEndedWithRotation()),this._gameInfoPublisher.publish("tetriminoDeactivate"),this.ghostPieceVisibilityChanged(!1),this._ghostTetrimino.destroyMinos(),this._ghostTetrimino=null,this._currentTetrimino.getMinos().forEach(function(t){t.animateGlow()}),this.lockedDownSignal.dispatch(this._currentTetrimino),this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_lockdown_sfx),this._lockdownStarted=!1,this._gameInfoPublisher.publish("tetriminoLockedDown"))},l.prototype.checkLockdown=function(){var t=this._currentTetrimino.row;this._lowestRowReached=Math.min(this._lowestRowReached,t),-1!==this._lastTouchDownPosition&&(t>=this._lastTouchDownPosition?this._currentMovesCounter++:(this._currentMovesCounter=0,this._lastTouchDownPosition=-1)),this._isLockingDown&&(this.startFallTimer(),this.cancelLockdown()),this.canMoveDown()||this.startLockdown()},l.prototype.cancelLockdown=function(){this._stopTimer(this._lockDownTimer),this._isLockingDown=!1,this._lockdownStarted=!1},l.prototype.moveDown=function(){var t=this.moveTetrimino(i.DOWN);t&&this._currentTetrimino&&(this._currentTetrimino.justRotated=!1)},l.prototype.canMoveDown=function(){var t={row:-1,col:0},e=this._currentTetrimino.getMinos();return this._matrixController.checkIfMoveIsValid(e,t)},l.prototype.softDropMoveDown=function(){this.softDropMoveSignal.dispatch(),this.moveDown()},l.prototype.getCurrentTetrimino=function(){return this._currentTetrimino},l.prototype.hardDrop=function(){if(this._forcedMove.isMoveLegal(this.ghostTetrimino)&&this._inputAllowed){for(this._controlScheme[h.CURRENT_SCHEME_KEY]=h.DESKTOP;this.moveTetrimino(i.DOWN);)this.hardDropMoveSignal.dispatch(),this._currentTetrimino.justRotated=!1;this._playHardDropAnimation(),this.cancelLockdown(),this.lockDown()}},l.prototype.startSoftDrop=function(){this._tutorialActive||(this._stopTimer(this._fallTimer),this._softDropTimer=this._startTimer(this._softDropTimer,this._softDropSpeed,this.softDropMoveDown,this))},l.prototype.endSoftDrop=function(){this._stopTimer(this._softDropTimer),this.startFallTimer()},l.prototype.isFallingLocked=function(){return!this._canFallThisLevel},l.prototype.ghostPieceTransformChangedSmart=function(t,e,i,n){this.updateOrCreateGhostTetrimino(t),this.transform(e,i,n,this._ghostTetrimino,this._matrixModel.ghostMatrix),this._ghostTetrimino||console.trace(),this._ghostTetrimino.updateGhostShape()},l.prototype.updateOrCreateGhostTetrimino=function(t){var e=this._currentTetrimino.col,i=this._currentTetrimino.row,n=this._currentTetrimino.orientation;if(this._ghostTetrimino){if(this._ghostTetrimino.tetriminoType!=t){var s=this._ghostTetrimino.getMinos();s.forEach(function(t){t.matrixCell.destroyContents()},this),this._ghostTetrimino=this._matrixController.createGhostTetrimino(t,e,i,n)}}else this._ghostTetrimino=this._matrixController.createGhostTetrimino(t,e,i,n);this._ghostTetrimino.getVisible()||this.ghostPieceVisibilityChanged(!0)},l.prototype.updateGhostToCurrentPosition=function(){this.updateOrCreateGhostTetrimino(this._currentTetrimino.tetriminoType);var t=this._currentTetrimino.getMinos(),e=this.findFallingDistance(t);this.transform(this._currentTetrimino.col,this._currentTetrimino.row-e,this._currentTetrimino.orientation,this._ghostTetrimino,this._matrixModel.ghostMatrix),this._ghostTetrimino||console.trace(),this._ghostTetrimino.updateGhostShape()},l.prototype.ghostPieceVisibilityChanged=function(t){this._ghostTetrimino&&this._ghostTetrimino.setVisible(t)},l.prototype.findFallingDistance=function(t){var e=1/0;return t.forEach(function(t){var i;for(i=t.row-1;i>0;i--){var n=this._matrixModel.matrix[i][t.col].getPrisoner();if(n&&n.tetrimino!=t.tetrimino)break}var s=t.row-i;e>s&&(e=s)},this),e},l.prototype._smartControlDrop=function(){this._forcedMove.isMoveLegal(this.ghostTetrimino)&&this._inputAllowed&&(this._playHardDropAnimation(this._ghostTetrimino||this._currentTetrimino),this.lockDown(!0))},l.prototype._playTrailAnimation=function(t){var t=t||this._currentTetrimino,e=t.getWidth(),i=t.tetriminoType===o.L&&t.orientation===r.EAST,n=t.tetriminoType===o.J&&t.orientation===r.WEST,s=t.getFirstCol()+e/2-.5,a="fastDropTrail";if(this._matrixModel.isFlipped){var h=this._matrixConfig.ROWS/2-1-t.row+.5;(i||n)&&(h+=1);var l=this._matrixAnimator.playAnimationAt(a,s,h);l.rotation=Math.PI}else{var h=t.getTopRow()-.5;(i||n)&&(h-=1);var l=this._matrixAnimator.playAnimationAt(a,s,h);l.rotation=0}l.scale.x=e/4*this._matrixConfig.SCALE},l.prototype._playHardDropAnimation=function(t){var t=t||this._currentTetrimino,e="fastDropParticles";navigator.vibrate(30),this._playTrailAnimation(t),this._matrixModel.isFlipped?this._matrixAnimator.playAnimationAt(e,t.col,this._matrixConfig.ROWS/2-1-t.row):this._matrixAnimator.playAnimationAt(e,t.col,t.row)},l.prototype._startTimer=function(t,e,i,n){return t&&this._stopTimer(t),t=this._game.time.events.loop(e,i,n)},l.prototype._startMoveTimer=function(){this._moveTimer=this._startTimer(this._moveTimer,this._autoRepeatDelay,this._moveAndUpdateGhost,this)},l.prototype._pauseTimer=function(t){t&&t.timer.pause()},l.prototype._resumeTimer=function(t){t&&t.timer.resume()},l.prototype._stopTimer=function(t){t&&(t.callback=function(){console.log("Stopped timer called this callback, it was probably stopped on the same frame it would be fired")},t.timer.remove(t))},l.prototype._moveAndUpdateGhost=function(){this._currentTetrimino!=this._previousTetrimino&&(this.moveTetrimino(this._moveDirection),this._currentTetrimino&&this.updateGhostToCurrentPosition())},l.prototype._marathonLevelChanged=function(t){this._setSpeeds(t),t>1&&this._soundManager.effect(this._gameVarManager.audioConstants.marathon_levelup_sfx)},l.prototype._setSpeeds=function(t){this._fallSpeed=s.getFallSpeed(t),this._softDropSpeed=s.getSoftDropSpeed(t),this._gameInfoPublisher.publish("fallSpeedChanged",this._fallSpeed)},l.prototype._scoreCellActivated=function(){this._lockedDown&&!this._matrixFlipAnimInProgress&&this._soundManager.effect(this._gameVarManager.audioConstants.scorecell_activate_sfx)},l.prototype._exposeCurrentMino=function(){this._currentTetrimino&&this._gameInfoPublisher.publish("newTetriminoSpawned",this._currentTetrimino,this._matrixConfig.PLAYABLE_ROWS_COUNT,this._matrixConfig.SPAWNING_COL)},l.prototype._tutorialStarted=function(t){(t==a.PLACEMENT_1||t==a.HOLD)&&(this._tutorialActive=!0)},l.prototype._levelEnded=function(){this._tutorialActive=!1,this._resumeTimer(this._moveTimer)},l.prototype._createSignals=function(){this.lockedDownSignal=new e.Signal,this.blockOutSignal=new e.Signal,this.hardDropMoveSignal=new e.Signal,this.softDropMoveSignal=new e.Signal},l.prototype._matrixFlipAnim=function(t){this._matrixFlipAnimInProgress=t,t?(this.pause(),this._tetrisInput.setKeyDownSignalsInactive()):(this.resume(),this._tetrisInput.setActive(!0))},l.prototype._setTutorialInputActive=function(t,e){t==a.HOLD?this._inputAllowed=e.tutorialInputActive:t!=a.PLACEMENT_1?(this._canFallThisLevel=e.canDropTetrimino,this.startFallTimer()):this._inputAllowed=!0},l.prototype._enableEvents=function(){this._gameInfoPublisher.subscribe("marathonLevelChanged",this._marathonLevelChanged,this),this._gameInfoPublisher.subscribe("ghostPieceTransformChanged",this.ghostPieceTransformChangedSmart,this),this._gameInfoPublisher.subscribe("ghostPieceVisibilityChanged",this.ghostPieceVisibilityChanged,this),this._gameInfoPublisher.subscribe("showTutorial",this._tutorialStarted,this),this._gameInfoPublisher.subscribe("tutorialFinished",this._levelEnded,this),this._gameInfoPublisher.subscribe("levelEnded",this._levelEnded,this),this._gameInfoPublisher.subscribe("matrixFlipAnim",this._matrixFlipAnim,this),this._gameInfoPublisher.subscribe("controlSchemeChanged",this.ghostPieceVisibilityChanged,this),this._gameInfoPublisher.subscribe("loadTutorial",this._setTutorialInputActive,this),this._gameInfoPublisher.subscribe("tutorialFinished",this._setTutorialInputActive,this),this._tetrisInput.moveStartSignal.add(this.startMoveTetrimino,this),this._tetrisInput.moveStopSignal.add(this.stopMoveTetrimino,this),this._tetrisInput.startSoftDropSignal.add(this.startSoftDrop,this),this._tetrisInput.endSoftDropSignal.add(this.endSoftDrop,this),this._tetrisInput.hardDropSignal.add(this.hardDrop,this),this._tetrisInput.inputStartedSignal.add(this._exposeCurrentMino,this),this._rotationController.rotatedSignal.add(this.updateGhostToCurrentPosition,this),this._rotationController.rotatedSignal.add(this.checkLockdown,this),this._smartControls.onTetriminoLocked.add(this._smartControlDrop,this),this._smartControls.smartControlsTransform.add(this.smartControlsTransform,this),this._smartControls.onLoseControl.add(this.stopTimers,this),this._game.onResume.add(this.onResume,this)},l.prototype._disableEvents=function(){this._gameInfoPublisher.unsubscribe("marathonLevelChanged",this._marathonLevelChanged,this),this._gameInfoPublisher.unsubscribe("ghostPieceTransformChanged",this.ghostPieceTransformChangedSmart,this),this._gameInfoPublisher.unsubscribe("ghostPieceVisibilityChanged",this.ghostPieceVisibilityChanged,this),this._gameInfoPublisher.unsubscribe("showTutorial",this._tutorialStarted,this),this._gameInfoPublisher.unsubscribe("tutorialFinished",this._levelEnded,this),this._gameInfoPublisher.unsubscribe("levelEnded",this._levelEnded,this),this._gameInfoPublisher.unsubscribe("matrixFlipAnim",this._matrixFlipAnim,this),this._gameInfoPublisher.unsubscribe("controlSchemeChanged",this.ghostPieceVisibilityChanged,this),this._gameInfoPublisher.unsubscribe("loadTutorial",this._setTutorialInputActive,this),this._tetrisInput.moveStartSignal.remove(this.startMoveTetrimino,this),this._tetrisInput.moveStopSignal.remove(this.stopMoveTetrimino,this),this._tetrisInput.startSoftDropSignal.remove(this.startSoftDrop,this),this._tetrisInput.endSoftDropSignal.remove(this.endSoftDrop,this),this._tetrisInput.hardDropSignal.remove(this.hardDrop,this),this._tetrisInput.inputStartedSignal.remove(this._exposeCurrentMino,this),this._rotationController.rotatedSignal.remove(this.updateGhostToCurrentPosition,this),this._rotationController.rotatedSignal.remove(this.checkLockdown,this),this._smartControls.onTetriminoLocked.remove(this._smartControlDrop,this),this._smartControls.smartControlsTransform.remove(this.smartControlsTransform,this),this._smartControls.onLoseControl.remove(this.stopTimers,this),this._game.onResume.remove(this.onResume,this)},Object.defineProperty(l.prototype,"ghostTetrimino",{get:function(){return this._ghostTetrimino}}),l}),define("gameplay/matrix/MatrixController",["phaser","bottom_line","utils/Array2DUtil","enums/Messages","enums/TetriminoType","enums/Rotation","enums/SpecialMinoType"],function(t,e,i,n,s,r,o){function a(matrixView,matrixModel,matrixConfig,minoFactory,tetriminoFactory,game,soundManager,gameVarManager,matrixHourglassAnimator,gameInfoPublisher,spineUtil,matrixGlowAnimator){this._matrixView=matrixView,this._matrixModel=matrixModel,this._matrixConfig=matrixConfig,this._minoFactory=minoFactory,this._tetriminoFactory=tetriminoFactory,this._game=game,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._matrixHourglassAnimator=matrixHourglassAnimator,this._gameInfoPublisher=gameInfoPublisher,this._spineUtil=spineUtil,this._matrixGlowAnimator=matrixGlowAnimator,this._currentTetrimino=null,this._hourglassSwitch=!1,this._shadowsOn=!0,this.onScoreCellActivate=new t.Signal,this._gameInfoPublisher.subscribe("initializationBegin",this.init,this)}return a.SCORECELL_ON_IMG="scoreCellOn_00.png",a.SCORECELL_OFF_IMG="scoreCellOff_00.png",a.SCORECELL_JUNK_IMG="scoreCellJunk.png",a.prototype.init=function(){this._matrixView.init(),this._matrixModel.init(),this._populateShadowMatrix()},a.prototype.start=function(t){this._addEvents(),this.addStartMinos(t),this.addScoreCells(t),this.checkScoreCells(),this.toggleShadows(!0),this._matrixGlowAnimator.startUp()},a.prototype.addStartMinos=function(t){t.startMinos.forEach(function(t){var e=this._minoFactory.get(t.tetriminoType,t.specialMinoType);e.row=t.row,e.col=t.col;var i=this._matrixConfig.ROWS;e.row>=i?this._matrixModel.addMinoToBuffer(e):this.addMinoToMatrix(e)},this)},a.prototype.addScoreCells=function(t){t.scoreCells.forEach(function(t){var e=this._minoFactory.get(s.NONE,o.SCORECELL);e.row=t.row,e.col=t.col,this.addScoreCellToMatrix(e)},this)},a.prototype.getMatrixCell=function(t,e,i){var n=i||this._matrixModel.matrix,s=null,r=n[t];return r&&(s=r[e]),s},a.prototype.isValidTetriminoLocation=function(t,e,i){var n=!0,r=t.shapeMatrix,o=t.getCurrentRotationPoints(),a=o._.first().row,h=o._.first().col;t.tetriminoType===s.I&&a--;for(var l=0;l<r.length;l++)for(var c=0;c<r[0].length;c++)if(r[l][c]){var u=this.getMatrixCell(e+a-l,i-h+c,this._matrixModel.matrix);n&=u.isEmpty()}return n},a.prototype.addTetriminoToMatrix=function(t,e,i){this._currentTetrimino=t,this._insertTetrimino(t,this._matrixModel.matrix,e,i)},a.prototype.createGhostTetrimino=function(t,e,i,n){var s=this._tetriminoFactory.construct(t,!0),r={col:e,row:i};return s.moveTo(r),s.orient(n),this._insertTetrimino(s,this._matrixModel.ghostMatrix,i,e),s},a.prototype.updateShadowMatrix=function(){this._shadowsOn&&i.forEach(this._matrixModel.shadowMatrix,function(t){if(!(t.row>this._matrixConfig.PLAYABLE_ROWS_COUNT||this._matrixModel.isFlipped&&0===t.row)){var e=this._matrixModel.isFlipped?t.row-1:t.row+1,i=this._matrixModel.matrix[e][t.col],n=this._matrixModel.matrix[t.row][t.col];t.getPrisoner().visible=n.isEmpty()&&!i.isEmpty()}},this)},a.prototype.gameEnded=function(){this.toggleShadows(!1)},a.prototype.toggleShadows=function(t){this._shadowsOn=t,this._shadowsOn?this.updateShadowMatrix():this._hideShadowMatrix()},a.prototype.addScoreCellToMatrix=function(t){var e=this._matrixModel.scoreCellMatrix[t.row][t.col];e.setPrisoner(t)},a.prototype.addMinoToMatrix=function(t,e,i){var n=t.row,s=t.col;"undefined"!=typeof e&&(n=e),"undefined"!=typeof i&&(s=i);var r=t.specialMinoType===o.MOVEGHOST,a=r?this._matrixModel.moveGhostMatrix:this._matrixModel.matrix,h=this.getMatrixCell(n,s,a);h.setPrisoner(t),t.showMoveGhostAnimation(),this.updateShadowMatrix()},a.prototype.removeTetriminoFromMatrix=function(t){var e=t.getMinos();e.forEach(function(t){t.matrixCell.emptyCell()},this),this.updateShadowMatrix()},a.prototype.forEachCellInMatrix=function(t,e){var n=this._matrixModel.matrix;i.forEach(n,t,e)},a.prototype.forEachScoreCellInMatrix=function(t,e){var n=this._matrixModel.scoreCellMatrix;i.forEach(n,t,e)},a.prototype.forEachCellInVisibleMatrix=function(t,e){var n=this._matrixModel.visibleMatrix();i.forEach(n,t,e)},a.prototype.forEachCellInVisibleMatrixIncludingSkyline=function(t,e){var n=this._matrixModel.visibleMatrixIncludingSkyline();i.forEach(n,t,e)},a.prototype.forEachCellInInvisibleMatrix=function(t,e){var n=this._matrixModel.invisibleMatrix();i.forEach(n,t,e)},a.prototype.isVisibleMatrixEmpty=function(){var t=[];return this.forEachCellInVisibleMatrixIncludingSkyline(function(e){e.isEmpty()||t.push(e)},this),0===t.length},a.prototype.checkIfMoveIsValid=function(t,e,i,n){"undefined"==typeof i&&(i=!1);var s=e;if(!e.length){s=[];for(var r=0;r<t.length;r++)s.push(e)}for(var o=!0,a=0,h=t.length;h>a;a++){var l=t[a],c=s[a],u=this.getMatrixCell(l.row+c.row,l.col+c.col),d=!1;if(u){var A=!u.isEmpty();if(A){var p=l.tetrimino,m=u.getPrisoner().tetrimino;p&&m===p||n&&m===n||(d=!0)}if(i){i<this._matrixConfig.PLAYABLE_ROWS_COUNT&&(i=this._matrixConfig.PLAYABLE_ROWS_COUNT);var f=u.row>i,g=c.row>0;f&&g&&(d=!0)}}else d=!0;if(d){o=!1;break}}return o},a.prototype.moveMinosInMatrix=function(t,i,n){var s=e.clone(t),r=i;if(!i.length){r=[];for(var o=0;o<s.length;o++)r.push(i)}for(var a=0;a<s.length;a++){var h=s[a],l=r[a],c=this.getMatrixCell(h.row+l.row,h.col+l.col,n);c.setPrisoner(h)}this.checkScoreCells(),this.updateShadowMatrix()},a.prototype.checkIfRowIsEmpty=function(t){var e=!0,i=this._matrixModel.matrix[t];return i._.each(function(t){return t.isEmpty()?void 0:(e=!1,!1)},this),e},a.prototype.hourglassMatrixFlip=function(t,e){this._hourglassSwitch=!0,this._matrixHourglassAnimator.animateMinos(this,t,e)},a.prototype.flipGrid=function(){var t=[],e=0;this.forEachCellInMatrix(function(i){if(!i.isEmpty()){var n=i.getPrisoner();n.row>e&&(e=n.row),t.push(n)}},this);for(var i=0;i<t.length;i++){var n=t[i],s=e-n.row;this.addMinoToMatrix(n,s,n.col)}this._matrixModel.flip(),this._matrixView.flipGrid()},a.prototype.checkScoreCells=function(){this._matrixModel.scoreCellMatrix.forEach(function(t){t.forEach(function(t){var e=t.getPrisoner();if(e){var i=this._matrixModel.isFlipped?this._matrixConfig.STARTING_ROW_INDEX-e.row:e.row,n=this._matrixModel.matrix[i][e.col].getPrisoner();n&&n.specialMinoType!==o.JUNK?e.getActive()?e.getActive()&&n.tetrimino==this._currentTetrimino&&this.onScoreCellActivate.dispatch():(this._playScoreCellActiveAnim(e),e.setActive(!0)):n&&n.specialMinoType===o.JUNK?e.getActive()?(this._playScoreCellInactiveAnim(e,a.SCORECELL_JUNK_IMG),e.setActive(!1)):e.setImage(a.SCORECELL_JUNK_IMG):e.getActive()?(this._playScoreCellInactiveAnim(e,a.SCORECELL_ON_IMG),e.setActive(!1)):e.setImage(a.SCORECELL_ON_IMG)}},this)},this)},a.prototype.getFilledRowsInInvisibleMatrix=function(){var t=[],e=null;return this.forEachCellInInvisibleMatrix(function(i){i.isEmpty()||i.row==e||(t.push(i.row+1),e=i.row)},this),t},a.prototype.setHourglassSwitch=function(t){this._hourglassSwitch=t},a.prototype.checkHourglassSwitch=function(){return this._hourglassSwitch},a.prototype.hideMatrix=function(){this._matrixView.setMatrixVisible(!1),this.toggleShadows(!1)},a.prototype.showMatrix=function(){this._matrixView.setMatrixVisible(!0),this.toggleShadows(!0)},a.prototype.cleanUp=function(){this.forEachCellInMatrix(function(t){t.destroyContents()},this),i.forEach(this._matrixModel.scoreCellMatrix,function(t){t.destroyContents()},this),i.forEach(this._matrixModel.ghostMatrix,function(t){t.destroyContents()},this),i.forEach(this._matrixModel.moveGhostMatrix,function(t){var e=t.getPrisoner();e&&e.destroyTutorialAnimation(),t.destroyContents()},this),this._matrixView.cleanUp(),this._matrixGlowAnimator.cleanUp()},a.prototype._insertTetrimino=function(t,e,i,n){var r=t.shapeMatrix,o=t.getCurrentRotationPoints(),a=o._.first().row,h=o._.first().col;t.tetriminoType===s.I&&a--;for(var l=0;l<r.length;l++)for(var c=0;c<r[0].length;c++)if(r[l][c]){var u=r[l][c],d=this.getMatrixCell(i+a-l,n-h+c,e);d.setPrisoner(u)}},a.prototype._populateShadowMatrix=function(){i.forEach(this._matrixModel.shadowMatrix,function(t){var e=this._minoFactory.get(null,o.SHADOW);e.anchor.y=0,e.y=-this._matrixConfig.TILE_HEIGHT/2,t.setPrisoner(e)},this)},a.prototype._hideShadowMatrix=function(){i.forEach(this._matrixModel.shadowMatrix,function(t){t.getPrisoner().visible=!1},this)},a.prototype._playScoreCellActiveAnim=function(t){var e=this._spineUtil.createAnimation("scoreCell",t.parent);e.stopAnimation(),e.startAnimation("scoreCellOn",!0,!1),t.visible=!1,e.onComplete.addOnce(function(){t.getActive()&&(t.setImage(a.SCORECELL_OFF_IMG),t.visible=!0)},this)},a.prototype._playScoreCellInactiveAnim=function(t,e){var i=this._spineUtil.createAnimation("scoreCell",t.parent);i.stopAnimation(),i.startAnimation("scoreCellOff",!0,!1),t.visible=!1,i.onComplete.addOnce(function(){t.getActive()||(t.setImage(e),t.visible=!0)},this)},a.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gameRestarted",this.checkScoreCells,this),this._gameInfoPublisher.subscribe("gamePaused",this.hideMatrix,this),this._gameInfoPublisher.subscribe("gameRestarted",this.hideMatrix,this),this._gameInfoPublisher.subscribe("gameResumed",this.showMatrix,this),this._gameInfoPublisher.subscribe("lastHurrahTriggered",this.gameEnded,this),this._gameInfoPublisher.subscribe("gameEnded",this.gameEnded,this)},a.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gameRestarted",this.checkScoreCells,this),this._gameInfoPublisher.unsubscribe("gamePaused",this.hideMatrix,this),this._gameInfoPublisher.unsubscribe("gameRestarted",this.hideMatrix,this),this._gameInfoPublisher.unsubscribe("gameResumed",this.showMatrix,this),this._gameInfoPublisher.unsubscribe("lastHurrahTriggered",this.gameEnded,this),this._gameInfoPublisher.unsubscribe("gameEnded",this.gameEnded,this)},a}),define("gameplay/matrix/MatrixView",["phaser","enums/Direction"],function(t,e){function i(game,matrixModel,matrixConfig,phaserGroupFactory,phaserSpriteFactory,sceneManager,viewportManager,matrixAnimator,soundManager,gameVarManager){this.MATRIX_BACKGROUND_SCALE=.97,this._game=game,this._matrixModel=matrixModel,this._matrixConfig=matrixConfig,this._phaserGroupFactory=phaserGroupFactory,this._phaserSpriteFactory=phaserSpriteFactory,this._viewportManager=viewportManager,this._sceneManager=sceneManager,this._matrixAnimator=matrixAnimator,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._matrixContainer=null,this._bgMatrix=null,this._layers={},this._tempSkyLine=[];var t=this._matrixModel.matrix;this._bgTiles=[t.length,t[0].length]._.dimit()}return i.MATRIX_GRID_IMG_NAME="matrixGrid.png",i.prototype.init=function(){var t=this._sceneManager._scenes.game,e=t.components.gameCp;this._matrixContainer=e.groups.innerMatrix,this._matrixContainer.children.forEach(function(t){t.name._.has("grp")&&(this._layers[t.name]=t)},this),this.getLayer("tetriminos").scalar=this._matrixConfig.SCALE,this.getLayer("bgTiles").scalar=this._matrixConfig.SCALE,this._bgMatrix=e.images.bgMatrix,this._matrixAnimator.initAnimator(this._matrixContainer,this.getLayer("bgTiles"),this.getStartX()*this._matrixConfig.SCALE,this.getStartY()*this._matrixConfig.SCALE,e.labels.scorePp),this.renderMatrixTiles(this._matrixModel.shadowMatrix),this.renderMatrixTiles(this._matrixModel.ghostMatrix),this.renderMatrixTiles(this._matrixModel.matrix),this.renderMatrixTiles(this._matrixModel.scoreCellMatrix),this.renderMatrixTiles(this._matrixModel.moveGhostMatrix),this.renderMatrixBackground()},i.prototype.getLayer=function(t){var e="grp_",i=this._layers[e+t];return i||(console.log("There was a request for an not existing layer"),i=null),i},i.prototype.getStartX=function(){return this._bgMatrix.x-this._matrixConfig.MATRIX_HALF_WIDTH+this._matrixConfig.HALF_TILE_WIDTH},i.prototype.getStartY=function(){return this._bgMatrix.y+this._matrixConfig.MATRIX_HALF_HEIGHT-this._matrixConfig.HALF_TILE_HEIGHT+.5*this._matrixConfig.SKYLINE_HEIGHT},i.prototype.getX=function(t){return this.getStartX()+t*this._matrixConfig.TILE_WIDTH},i.prototype.getY=function(t){return this.getStartY()-t*this._matrixConfig.TILE_HEIGHT},i.prototype.renderMatrixTiles=function(t){for(var e=this.getLayer("tetriminos"),i=0,n=t.length;n>i;i++)for(var s=0,r=t[0].length;r>s;s++){var o=t[i][s];e.addChild(o),o.x=this.getX(s),o.y=this.getY(i)}},i.prototype.renderMatrixBackground=function(){for(var t=this.getStartX(),e=this.getStartY(),n=this._matrixModel.matrix,s=this.getLayer("bgTiles"),r=0,o=n.length;o>r;r++)for(var a=0,h=n[0].length;h>a;a++){var l=this._phaserSpriteFactory.construct(0,0,null,i.MATRIX_GRID_IMG_NAME,s);l.x=t+a*this._matrixConfig.TILE_WIDTH,l.y=e-r*this._matrixConfig.TILE_HEIGHT,l.scalar=this.MATRIX_BACKGROUND_SCALE,s.add(l),this._bgTiles[r][a]=l}},i.prototype.gravitySwitch=function(t,n,s){var r=this._matrixModel.matrix,o=null;if(!this._tempSkyLine.length)for(var a=this._matrixConfig.COLS,h=r[0][0],l=this.getLayer("bgTiles"),c=0;a>c;c++){var u=this._phaserSpriteFactory.construct(0,0,null,i.MATRIX_GRID_IMG_NAME,l);u.x=h.x+c*this._matrixConfig.TILE_WIDTH,u.y=h.y+this._matrixConfig.TILE_HEIGHT,u.scalar=this.MATRIX_BACKGROUND_SCALE,l.add(u),this._tempSkyLine.push(u)}var d,A=null;d=this._matrixConfig.SKYLINE_HEIGHT,t===e.UP?(A=this._matrixContainer.y+d,o=this._gameVarManager.audioConstants.gravity_up_sfx):(A=this._matrixContainer.y-d,o=this._gameVarManager.audioConstants.gravity_down_sfx);var p=1e3,m=this._game.add.tween(this._matrixContainer);m.to({y:A},p,null,!0),m.onComplete.addOnce(function(){this._soundManager.effect(o),n.call(s)},this)},i.prototype.resetMatrixPosition=function(){this._matrixContainer.y=0},i.prototype.flipGrid=function(){for(var t=this._matrixModel.matrix,e=this._matrixModel.ghostMatrix,i=this._matrixModel.shadowMatrix,n=this.getStartY(),s=n-this._matrixConfig.STARTING_ROW_INDEX*this._matrixConfig.TILE_HEIGHT,r=0;r<t.length;r++)for(var o=0;o<t[0].length;o++){var a=t[r][o],h=e[r][o],l=r*this._matrixConfig.TILE_HEIGHT;l=this._matrixModel.isFlipped?s+l:n-l,a.y=l,h.y=l,i[r]&&(i[r][o].y=l)}},i.prototype.setMatrixVisible=function(t){for(var e=0;e<=this._matrixConfig.SKYLINE_ROWS_COUNT;e++)for(var i=0;i<this._matrixConfig.COLS;i++)this.setCellVisible(e,i,t)},i.prototype.setCellVisible=function(t,e,i){this._matrixModel.matrix[t][e].visible=i,this._matrixModel.scoreCellMatrix[t][e].visible=i,this._matrixModel.ghostMatrix[t][e].visible=i,this._matrixModel.moveGhostMatrix[t][e].visible=i,t<this._matrixConfig.STARTING_ROW_INDEX&&(this._matrixModel.shadowMatrix[t][e].visible=i)},i.prototype.cleanUp=function(){},Object.defineProperty(i.prototype,"matrixGlobals",{get:function(){return{left:this._bgMatrix.global.x-this._bgMatrix.width/2,right:this._bgMatrix.global.x+this._bgMatrix.width/2,top:this._bgMatrix.global.y+this._bgMatrix.height/2,bottom:this._bgMatrix.global.y-this._bgMatrix.height/2,center:{x:this._bgMatrix.global.x,linea:this._bgMatrix.global.x-this._bgMatrix.width/this._matrixConfig.COLS,y:this._bgMatrix.global.y},dividing:{x:this._bgMatrix.global.x,y:this._bgMatrix.global.y}}}}),i}),define("gameplay/matrix/MatrixModel",[],function(){function t(matrixFactory,matrixConfig){this._matrixConfig=matrixConfig,this.matrix=matrixFactory.construct(),this.scoreCellMatrix=matrixFactory.construct(),this.ghostMatrix=matrixFactory.construct(),this.moveGhostMatrix=matrixFactory.construct(),this.shadowMatrix=matrixFactory.construct(matrixConfig.COLS,matrixConfig.PLAYABLE_ROWS_COUNT),this.bufferMino=[],this.isFlipped=!1}return t.prototype.init=function(){},t.prototype.addMinoToBuffer=function(t){for(var e=t.row,i=0,n=!1;!n;){if(this.bufferMino[i]||(this.bufferMino[i]=[]),this.bufferMino[i].length){var s=this.bufferMino[i][0];s.row===e&&(this.bufferMino[i].push(t),n=!0)}else this.bufferMino[i].push(t),n=!0;i++}this.bufferMino.sort(function(t,e){var i=t[0].row,n=e[0].row;return i-n})},t.prototype.flip=function(){this.isFlipped=!this.isFlipped},t.prototype.visibleMatrix=function(){for(var t=[],e=0;e<this._matrixConfig.PLAYABLE_ROWS_COUNT;e++)t.push(this.matrix[e]);return t},t.prototype.visibleMatrixIncludingSkyline=function(){for(var t=[],e=0;e<this._matrixConfig.SKYLINE_ROWS_COUNT;e++)t.push(this.matrix[e]);return t},t.prototype.invisibleMatrix=function(){for(var t=[],e=this._matrixConfig.SKYLINE_ROWS_COUNT;e<this._matrixConfig.ROWS;e++)t.push(this.matrix[e]);return t},t}),define("gameplay/matrix/MatrixRowMatcher",["phaser","enums/Messages","enums/SpecialMinoType"],function(t,e,i){function n(matrixController,matrixModel,matrixConfig,matrixAnimator){this._matrixController=matrixController,this._matrixModel=matrixModel,this._matrixConfig=matrixConfig,this._matrixAnimator=matrixAnimator,this._matrix=matrixModel.matrix,this.rowToInspect=[],this._createSignals()}return n.prototype.checkMatrix=function(t,e){t&&this.onDone.addOnce(t,e),this.scanMatrix()},n.prototype.scanMatrix=function(){for(var t=[],e=0;e<this._matrix.length;e++){for(var i=!0,n=0;n<this._matrix[0].length;n++){var s=this._matrixController.getMatrixCell(e,n),r=s.isEmpty();if(r){i=!1;break}}i&&t.push(e)}t.length?(this.clearedRowsSignal.dispatch(t.length),this.clearRows(t,!0)):(this.rowsNotMatchedSignal.dispatch(),this.onDone.dispatch(!1))},n.prototype.clearBottomRow=function(t,e){var i=[0];this.clearRows(i,t,e)},n.prototype.clearRows=function(t,e,i,n){i=i||1;for(var s=[],r=[],o=0,a=t.length;a>o;o++)for(var h=t[o],l=0,c=this._matrix[0].length;c>l;l++){var u=this._matrixController.getMatrixCell(h,l),d=u.getPrisoner();
if(this.rowToInspect.push(d),d.tetrimino){var A=d.tetrimino.getMinos();A.forEach(function(t){t.tetrimino=null})}r[h]||(r[h]=[]),s.push(o),r[h].push(d),u.destroyContents()}if(this._matrixController.updateShadowMatrix(),r=this.cleanUpClearRowsArray(r),!n){var p=this.specialMinosAreInThisRow(this.rowToInspect);p?(this.rowsMatchedSignal.dispatch(r),this.lastHurrahScoreSignal.dispatch(r)):(this.rowsMatchedScoreSignal.dispatch(r),this.rowsMatchedSignal.dispatch(r))}e?this._matrixAnimator.playRowRemoverAnimation(function(){this.onDone.dispatch(!0)},this,t,i):this.onDone.dispatch(!0),this.rowToInspect=[]},n.prototype.cleanUpClearRowsArray=function(t){var e=[];return t.forEach(function(t){e.push(t)},this),e},n.prototype.specialMinosAreInThisRow=function(t){var e=!1;return t.forEach(function(t){t.specialMinoType===i.SPARKLE&&(e=!0)},this),e},n.prototype._createSignals=function(){this.rowsMatchedSignal=new t.Signal,this.rowsNotMatchedSignal=new t.Signal,this.rowsMatchedScoreSignal=new t.Signal,this.lastHurrahScoreSignal=new t.Signal,this.clearedRowsSignal=new t.Signal,this.onDone=new t.Signal},n}),define("gameplay/matrix/MatrixGravity",["phaser","gameplay/TetriminoController","enums/Direction"],function(t,e,i){function n(matrixController,matrixModel,matrixGravityTweener,matrixConfig,gameInfoPublisher){this._matrixController=matrixController,this._matrix=matrixModel.matrix,this._matrixGravityTweener=matrixGravityTweener,this._gameInfoPublisher=gameInfoPublisher,this._matrixConfig=matrixConfig,this.onDone=new t.Signal}return n.prototype.applyGravity=function(t,e,i){t&&this.onDone.addOnce(function(){i||(this._matrixController.toggleShadows(!0),this._gameInfoPublisher.publish("matrixFlipAnim",!1)),t.call(e)},this);for(var n=0,s=this._matrix.length;s>n;n++){for(var r=!0,o=0;o<this._matrix[0].length;o++){var a=this._matrixController.getMatrixCell(n,o);if(!a.isEmpty()){r=!1;break}}r&&this.moveMatrixDown(n)&&n--}this.onDone.dispatch()},n.prototype.moveMatrixOneRowUp=function(){if(!this._matrixController.checkIfRowIsEmpty(this._matrixConfig.ROWS-1))return!1;for(var t=this._matrix.length-1;t>=0;t--)for(var e=0,i=this._matrix[0].length;i>e;e++){var n=this._matrixController.getMatrixCell(t,e);if(n&&!n.isEmpty()){var s=n.getPrisoner();this._matrixController.addMinoToMatrix(s,n.row+1,n.col)}}return!0},n.prototype.moveMatrixDown=function(t){for(var e=t+1,i=!1,n=e,s=this._matrix.length;s>n;n++)for(var r=0;r<this._matrix[0].length;r++){var o=this._matrixController.getMatrixCell(n,r);if(!o.isEmpty()){i=!0;var a=o.getPrisoner(),h=o.bottom();h.setPrisoner(a)}}return i},n.prototype.switchGravity=function(t,e,i){for(var n=0,s=!0;s;)n++,s=this.moveMinosInMatrix(t);console.log("The while loop was executed "+n+" time(s)"),this._matrixGravityTweener.start(e,i)},n.prototype.moveMinosInMatrix=function(t){var n=!1,s=e.MOVEMENT_Y;t===i.DOWN&&(s=-s);var r=0;return this._matrixController.forEachCellInMatrix(function(t){!t.isEmpty()&&t.row>r&&(r=t.row)},this),this._matrixController.forEachCellInMatrix(function(t){if(!t.isEmpty()){var e=t.getPrisoner(),i=[e];e.tetrimino&&(i=e.tetrimino.getMinos());for(var o={row:0,col:0};this._matrixController.checkIfMoveIsValid(i,{row:o.row+s,col:o.col},r);)n=!0,o.row+=s;n&&(this._matrixGravityTweener.registerTween(i),this._matrixController.moveMinosInMatrix(i,o))}},this),n},n.prototype.cleanUp=function(){this._matrixGravityTweener.cleanUp()},n}),define("gameplay/matrix/MatrixGravityTweener",["phaser"],function(t){function e(game,matrixConfig,matrixController,matrixView,matrixModel,screenShaker,soundManager,gameVarManager){this._game=game,this._matrixController=matrixController,this._matrixConfig=matrixConfig,this._matrixView=matrixView,this._matrixModel=matrixModel,this._screenShaker=screenShaker,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._tweenConfigs=[],this._currentTweens=0,this._maxTweens=0,this.onDone=new t.Signal}return e.TWEEN_TIME=500,e.prototype.start=function(i,n){return this.onDone.addOnce(i,n),this._tweenConfigs.length?void this._tweenConfigs.forEach(function(i){var n=i.mino,s=this._matrixController.getMatrixCell(i.row,i.col),r=n.matrixCell,o=r.row-s.row;this._matrixModel.isFlipped&&(o=-o),r.setPrisoner(n),this._maxTweens++;var a=this._game.add.tween(n).from({y:o*this._matrixConfig.TILE_HEIGHT},e.TWEEN_TIME,t.Easing.Quartic.In,!0);a.onComplete.addOnce(this.onTweenDone,this)},this):void setTimeout(function(){this.onDone.dispatch()}.bind(this),e.HACK_DELAY_FIX)},e.prototype.registerTween=function(t){for(var e=0,i=t.length;i>e;e++){var n=t[e];this.createConfigForMino(n)}},e.prototype.createConfigForMino=function(t){for(var e=null,i=0,n=this._tweenConfigs.length;n>i;i++){var s=this._tweenConfigs[i];if(s.mino===t){e=s;break}}e||this._tweenConfigs.push({mino:t,row:t.row,col:t.col})},e.prototype.onTweenDone=function(){this._screenShaker.activate(),this._currentTweens++,this._currentTweens===this._maxTweens&&(this._matrixController.checkHourglassSwitch()&&(this._soundManager.effect(this._gameVarManager.audioConstants.hourglass_drop_sfx),this._matrixController.setHourglassSwitch(!1)),this.reset(),this.onDone.dispatch())},e.prototype.reset=function(){this._tweenConfigs=[],this._currentTweens=0,this._maxTweens=0},e.prototype.cleanUp=function(){this.reset()},e}),define("gameplay/matrix/MatrixConverter",[],function(){function t(matrixModel,matrixView,matrixConfig,viewportManager){this._matrixModel=matrixModel,this._matrixView=matrixView,this._matrixConfig=matrixConfig,this._viewportManager=viewportManager}return t.prototype.screenToMatrixCoordinate=function(t,e,i){var n=this._matrixView.getStartX(),s=this._matrixView.getStartY();n*=this._matrixConfig.SCALE;var r={row:-1,col:-1},o=this._viewportManager.game.width/2,a=this._viewportManager.game.height/2;return r.col=Math.round((t-n-o)/(this._matrixConfig.TILE_WIDTH*this._matrixConfig.SCALE)),this._matrixModel.isFlipped?r.row=Math.round(this._matrixConfig.SPAWNING_ROW_INDEX-Math.abs(e-s-a+this._matrixConfig.TILE_HEIGHT/2)/(this._matrixConfig.TILE_HEIGHT*this._matrixConfig.SCALE)):r.row=Math.round(Math.abs(e-s-a)/(this._matrixConfig.TILE_HEIGHT*this._matrixConfig.SCALE)),i&&(r.row=Math.max(0,Math.min(r.row,this._matrixConfig.ROWS-1)),r.col=Math.max(0,Math.min(r.col,this._matrixConfig.COLS-1))),r},t.prototype.swipeCoordinates=function(t,e){var i=this._matrixView.getStartX(),n=this._matrixView.getStartY();i*=this._matrixConfig.SCALE;var s={row:-1,col:-1},r=this._viewportManager.game.width/2,o=this._viewportManager.game.height/2;return s.col=(t-i-r)/(this._matrixConfig.TILE_WIDTH*this._matrixConfig.SCALE),this._matrixModel.isFlipped?s.row=this._matrixConfig.SPAWNING_ROW_INDEX-Math.abs(e-n-o+this._matrixConfig.TILE_HEIGHT/2)/(this._matrixConfig.TILE_HEIGHT*this._matrixConfig.SCALE):s.row=Math.abs(e-n-o)/(this._matrixConfig.TILE_HEIGHT*this._matrixConfig.SCALE),s},t}),define("utils/TetriminoScaleToFitUtil",["phaser","utils/Array2DUtil"],function(t,e){var i={};return i.MIN_SCALE=.4,i.MAX_SCALE=.4,i.fitTetriminoInRect=function(t,e,n){n.x=0,n.y=0,e.parent.add(n),i.addTetriminoToParent(t,n);var s=i.makeTetriminoFitInHoldButton(t);i.correctlyPlaceTetriminos(s,e,n)},i.addTetriminoToParent=function(t,i){var n=t.getMinos(),s=t.shapeMatrix,r=n._.first(),o=.5*r.width,a=.5*r.height,h=o,l=a,c=-1,u=-1;e.forEach(s,function(t,e,n){t&&(e>c&&(c=e,u++),t.x=h+t.width*n,t.y=l+t.height*u,i.add(t))},this)},i.makeTetriminoFitInHoldButton=function(i){var n=1/0,s=1/0,r=0,o=0,a=i.shapeMatrix;return e.forEach(a,function(t){t&&(n>t.x&&(n=t.x-.5*t.width),r<t.x&&(r=t.x+.5*t.width),s>t.y&&(s=t.y-.5*t.height),o<t.y&&(o=t.y+.5*t.height))},this),new t.Rectangle(n,s,r-n,o-s)},i.correctlyPlaceTetriminos=function(e,n,s){var r=1,o=new t.Rectangle(e.x,e.y,e.width,e.height),a=null;for(a=n.dimensions?new t.Rectangle(n.x,n.y,n.dimensions.width,n.dimensions.height):new t.Rectangle(n.x,n.y,n.width,n.height);o.width>=a.width||o.height>=a.height;)r-=.1,r<i.MIN_SCALE&&(r=i.MIN_SCALE),r>i.MAX_SCALE&&(r=i.MAX_SCALE),o.width=e.width*r,o.height=e.height*r;var h=a.width-o.width,l=a.height-o.height,c=a.x-.5*a.width+.5*h,u=a.y-.5*a.height+.5*l;s.scalar=r,s.x=c,s.y=u},i}),define("gameplay/tetrimino_queue/TetriminoQueueController",["bottom_line","utils/TetriminoScaleToFitUtil","enums/TetriminoType"],function(t,e,i){function n(tetriminoQueueView,tetriminoQueueModel,tetriminoFactory,gameInfoPublisher){this._tetriminoQueueView=tetriminoQueueView,this._tetriminoQueueModel=tetriminoQueueModel,this._tetriminoFactory=tetriminoFactory,this._gameInfoPublisher=gameInfoPublisher,this._gameInfoPublisher.subscribe("initializationBegin",this.init,this),this._levelData=null,this._customTetrminoList=[]}return n.prototype.init=function(){this._tetriminoQueueView.init()},n.prototype.start=function(t){this._addEvents(),this._tetriminoQueueView.start(),this._levelData=t,this._populateCustomTetriminoList()},n.prototype.getNext=function(){this.checkQueueLength();var t=this._tetriminoQueueModel.getNext();return this._tetriminoQueueView.updateQueueView(),t},n.prototype.checkQueueLength=function(){var e=t.clone(i.USABLE_TYPES);if(this._tetriminoQueueModel.getQueueLength()<e.length){var n=[];this._customTetrminoList.length>0&&(this._levelData.customTetriminoList.forEach(function(t){n.push(this._getNext(t))},this),this._customTetrminoList=[]),e._.shuffle();for(var s=0;s<e.length;s++){var r=e[s],o=n.indexOf(r);0>o&&n.push(this._getNext(r))}this._tetriminoQueueModel.addTetriminosToQueue(n)}},n.prototype.cleanUp=function(){this._tetriminoQueueView.cleanUp(),this._tetriminoQueueModel.cleanUp(),this._removeEvents(),this._customTetrminoList=[]},n.prototype._getNext=function(t){return this._tetriminoFactory.construct(t,!1)},n.prototype._populateCustomTetriminoList=function(){this._levelData.customTetriminoList.length>0&&this._levelData.customTetriminoList.forEach(function(t){this._customTetrminoList.push(this._getNext(t))},this)},n.prototype._hideQueue=function(){this._tetriminoQueueView.reset()},n.prototype._showQueue=function(){this._tetriminoQueueView.updateQueueView()},n.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gamePaused",this._hideQueue,this),this._gameInfoPublisher.subscribe("gameResumed",this._showQueue,this)},n.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gamePaused",this._hideQueue,this),this._gameInfoPublisher.unsubscribe("gameResumed",this._showQueue,this)},n}),define("gameplay/tetrimino_queue/TetriminoQueueView",["utils/TetriminoScaleToFitUtil"],function(t){function e(sceneManager,phaserGroupFactory,tetriminoQueueModel,matrixConfig){this._sceneManager=sceneManager,this._phaserGroupFactory=phaserGroupFactory,this._tetriminoQueueModel=tetriminoQueueModel,this._matrixConfig=matrixConfig,this._placeholder=null,this._tetriminoGroup=null,this._queuePlaceholders=[],this._tetriminoGroups=[]}return e.prototype.init=function(){var t=this._sceneManager._scenes.game,e=t.components.gameCp;this._placeholder=e.placeHolders.nextTetrimino,this._tetriminoGroup=this._phaserGroupFactory.construct(this._placeholder),this._queuePlaceholders=[e.placeHolders.next_1,e.placeHolders.next_2,e.placeHolders.next_3,e.placeHolders.next_4];for(var i=0;i<this._queuePlaceholders.length;i++){var n=this._queuePlaceholders[i];this._tetriminoGroups.push(this._phaserGroupFactory.construct(n))}},e.prototype.start=function(){},e.prototype.updateQueueView=function(){this.reset();var e=this._tetriminoQueueModel.showNext();t.fitTetriminoInRect(e,this._placeholder,this._tetriminoGroup);var i=this._tetriminoQueueModel.findTetriminos(5);i.splice(0,1);for(var n=0;n<this._queuePlaceholders.length;n++){var s=this._queuePlaceholders[n],r=i[n],o=this._tetriminoGroups[n];t.fitTetriminoInRect(r,s,o)}},e.prototype.reset=function(){this._tetriminoGroup.children.forEach(function(t){t.x=0,t.y=0},this),this._tetriminoGroup.removeAll(),this._tetriminoGroups.forEach(function(t){t.removeAll()},this)},e.prototype.cleanUp=function(){this.reset()},e.prototype.setVisible=function(t){this._tetriminoGroup.visible=t},e}),define("gameplay/tetrimino_queue/TetriminoQueueModel",[],function(){function t(){this._queue=[]}return t.prototype.addTetriminosToQueue=function(t){t.forEach(function(t){this._queue.push(t)},this)},t.prototype.getNext=function(){return this._queue.shift()},t.prototype.showNext=function(){return this._queue[0]},t.prototype.findTetriminos=function(t){for(var e=[],i=0;t>i;i++){var n=this._queue[i];if(!n){console.warn("Tried to find "+t+" tetrminos from the queue, but only found "+i);break}e.push(n)}return e},t.prototype.getQueueLength=function(){return this._queue.length},t.prototype.cleanUp=function(){this._queue=[]},t}),define("gameplay/tetrimino_holder/TetriminoHolderController",["enums/TutorialType"],function(t){function e(tetrisInput,tetriminoController,matrixController,tetriminoHolderView,tetriminoHolderModel,soundManager,gameVarManager,gameInfoPublisher,matrixModel,gravityModeMinoHandler){this._tetrisInput=tetrisInput,this._tetriminoController=tetriminoController,this._matrixController=matrixController,this._tetriminoHolderView=tetriminoHolderView,this._tetriminoHolderModel=tetriminoHolderModel,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._matrixModel=matrixModel,this._gravityModeMinoHandler=gravityModeMinoHandler,this._isHoldEnabled=!0,this._gameInfoPublisher.subscribe("initializationBegin",this.init,this)}return e.prototype.init=function(){this._tetriminoHolderView.init()},e.prototype.start=function(){this._addEvents(),this._tetriminoHolderView.reset(),this._tetrisInput.holdSignal.add(this.holdTetrimino,this)},e.prototype.holdTetrimino=function(){if(this._gameInfoPublisher.publish("holdTetriminoPressed",t.HOLD,!0),(!this._tetriminoHolderModel.heldTetrimino||this._tetriminoController.getCurrentTetrimino()!==this._tetriminoHolderModel.currentTetrimino)&&this._isHoldEnabled){this._tetriminoController.cancelLockdown(),this._gameInfoPublisher.publish("tetriminoDeactivate"),this._tetriminoHolderView.reset();var e=this._tetriminoHolderModel.heldTetrimino,i=this._tetriminoController.getCurrentTetrimino();this._matrixModel.isFlipped&&(i=this._gravityModeMinoHandler.reconstructTetrimino(i,!0)),this._tetriminoHolderModel.heldTetrimino=i,this._tetriminoHolderModel.heldTetrimino.resetRotation(),this._matrixController.removeTetriminoFromMatrix(this._tetriminoController.getCurrentTetrimino()),e?(this._matrixModel.isFlipped&&(e=this._gravityModeMinoHandler.reconstructTetrimino(e,!1)),this._tetriminoController.nextTetrimino(e)):this._tetriminoController.nextTetrimino(),this._tetriminoHolderModel.currentTetrimino=this._tetriminoController.getCurrentTetrimino(),this._tetriminoHolderView.updateView(),this._soundManager.effect(this._gameVarManager.audioConstants.hold_tetrimino_sfx)}},e.prototype.hideHeld=function(){this._tetriminoHolderView.setVisible(!1)},e.prototype.showHeld=function(){this._tetriminoHolderView.setVisible(!0)},e.prototype.cleanUp=function(){this._tetriminoHolderView.reset(),this._tetriminoHolderModel.cleanUp(),this._tetrisInput.holdSignal.remove(this.holdTetrimino,this),this._removeEvents()},e.prototype._enableHold=function(t){this._isHoldEnabled=t},e.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gamePaused",this.hideHeld,this),this._gameInfoPublisher.subscribe("gameRestarted",this.hideHeld,this),this._gameInfoPublisher.subscribe("gameResumed",this.showHeld,this),this._gameInfoPublisher.subscribe("enableHold",this._enableHold,this)},e.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gamePaused",this.hideHeld,this),this._gameInfoPublisher.unsubscribe("gameRestarted",this.hideHeld,this),this._gameInfoPublisher.unsubscribe("gameResumed",this.showHeld,this),this._gameInfoPublisher.unsubscribe("enableHold",this._enableHold,this)},e}),define("gameplay/tetrimino_holder/TetriminoHolderView",["utils/TetriminoScaleToFitUtil"],function(t){function e(tetriminoHolderModel,sceneManager,phaserGroupFactory){this._sceneManager=sceneManager,this._tetriminoHolderModel=tetriminoHolderModel,this._phaserGroupFactory=phaserGroupFactory,this._placeholder=null,this._tetriminoGroup=null}return e.prototype.init=function(){var t=this._sceneManager._scenes.game,e=t.components.gameCp;this._placeholder=e.placeHolders.tetriminoHold,this._tetriminoGroup=this._phaserGroupFactory.construct(this._placeholder)},e.prototype.reset=function(){this._tetriminoGroup.children.forEach(function(t){t.x=0,t.y=0},this),this._tetriminoGroup.removeAll()},e.prototype.updateView=function(){var e=this._tetriminoHolderModel.heldTetrimino;t.fitTetriminoInRect(e,this._placeholder,this._tetriminoGroup,this._matrixConfig)},e.prototype.setVisible=function(t){this._tetriminoGroup.visible=t},e}),define("gameplay/tetrimino_holder/TetriminoHolderModel",[],function(){function t(){this.currentTetrimino=null,this.heldTetrimino=null}return t.prototype.cleanUp=function(){this.currentTetrimino=null,this.heldTetrimino=null},t}),define("core/Entity",[],function(){function t(t,phaserGroupFactory,publisher){this._components={},this._componentFactory=t,this.publisher=publisher,this.transform=phaserGroupFactory.construct()}return t.prototype.sendMessage=function(){this.publisher.publish.apply(this.publisher,arguments)},t.prototype.addComponent=function(t){var e=null,i=t.name;if(this._components[i])console.error("This component already exists on the entity: "+i);else{for(var n=[t,this],s=1;s<arguments.length;++s)n.push(arguments[s]);e=this._componentFactory.construct.apply(this._componentFactory,n),this._components[i]=e}return e},t.prototype.getComponent=function(t){var e=t.name;return this._components[e]},t.prototype.removeComponent=function(t){var e=t.name;this._components[e]?delete this._components[e]:console.error("This component does not exist on the entity: "+e)},t}),define("entities/MatrixCell",["bottom_line","phaser"],function(t,e){function i(t,e,n,game,gameInfoPublisher){i._super.constructor.call(this,game,null),this._prisoner=null,this.matrix=t,this.row=e,this.col=n,this._gameInfoPublisher=gameInfoPublisher}return t.inherit(i,e.Group),i.prototype.setPrisoner=function(t){t.matrixCell&&t.matrixCell.getPrisoner()===t&&t.matrixCell.emptyCell(),this._prisoner=t,this._prisoner.matrixCell=this,this._prisoner.row=this.row,this._prisoner.col=this.col,this.add(this._prisoner)},i.prototype.getPrisoner=function(){return this._prisoner},i.prototype.destroyContents=function(){this.isEmpty()||this._gameInfoPublisher.publish("returnMino",this.getPrisoner()),this.emptyCell()},i.prototype.emptyCell=function(){this._prisoner&&(this.removeAll(),this._prisoner.matrixCell=null,this._prisoner=null)},i.prototype.isEmpty=function(){return!this._prisoner},i.prototype.adjacentCells=function(){return[this.top(),this.right(),this.bottom(),this.left()]},i.prototype.neighbourCells=function(){return[this.top(),this.top_right(),this.right(),this.bottom_right(),this.bottom(),this.bottom_left(),this.left(),this.top_left()]},i.prototype.left=function(){return this.matrix[this.row]&&this.matrix[this.row][this.col-1]},i.prototype.right=function(){return this.matrix[this.row]&&this.matrix[this.row][this.col+1]},i.prototype.top=function(){return this.matrix[this.row+1]&&this.matrix[this.row+1][this.col]},i.prototype.bottom=function(){return this.matrix[this.row-1]&&this.matrix[this.row-1][this.col]},i.prototype.top_left=function(){return this.matrix[this.row+1]&&this.matrix[this.row+1][this.col-1]},i.prototype.top_right=function(){return this.matrix[this.row+1]&&this.matrix[this.row+1][this.col+1]},i.prototype.bottom_left=function(){return this.matrix[this.row-1]&&this.matrix[this.row-1][this.col-1]},i.prototype.bottom_right=function(){return this.matrix[this.row-1]&&this.matrix[this.row-1][this.col+1]},i}),define("gameplay/input/TetSmartControlJS",[],function(){function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function e(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}function t(instance,t){if(!(instance instanceof t))throw new TypeError("Cannot call a class as a function")}var n={};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=n.TetAIGameState=function(){function e(i,n,s){t(this,e),this.mMatrixMinos=new Array,this.mMatrixMinosBitGrid=new Array,this.mIsDestroyed=!1,this.mPieceData=i,this.mMatrixWidth=n,this.mMatrixHeight=s;var r=n*s;for(this.mMatrixMinos.length=0;this.mMatrixMinos.length<r;)this.mMatrixMinos.push(0);this.mMatrixMinosBitGridEmptyRow=0,this.mMatrixMinosBitGridFullRow=this.mMatrixMinosBitGridEmptyRow;for(var o=0;n>o;o++)this.mMatrixMinosBitGridFullRow|=1<<o;for(this.mMatrixMinosBitGrid.length=0;this.mMatrixMinosBitGrid.length<s;)this.mMatrixMinosBitGrid.push(this.mMatrixMinosBitGridEmptyRow);this.mLivePieceTypeId=0,this.mLivePieceStartingX=0,this.mLivePieceStartingY=0,this.mLivePieceStartingFacing=0,this.mLivePieceStartingTransformId=b.kInvalidTransformId,this.mLivePieceCurrentX=0,this.mLivePieceCurrentY=0,this.mLivePieceCurrentFacing=0,this.mLivePieceCurrentTransformId=b.kInvalidTransformId,this.mCurrentControlAction=b.kControlAction_none}return s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"getMatrixWidth",value:function(){return this.mMatrixWidth}},{key:"getMatrixHeight",value:function(){return this.mMatrixHeight}},{key:"resetStateWithLivePiece",value:function(t,e,i,n){this.clearMatrix(),this.mLivePieceTypeId=t,this.mLivePieceStartingX=e,this.mLivePieceStartingY=i,this.mLivePieceStartingFacing=n,this.mLivePieceStartingTransformId=this.mPieceData.computeTransformId(e,i,n),this.setLivePieceCurrentTransform(this.mLivePieceStartingTransformId)}},{key:"resetStateWithCurrentLivePiece",value:function(){this.clearMatrix()}},{key:"resetStateWithState",value:function(t){this.clearMatrix();var e,i=this.mMatrixMinos.length;for(e=0;i>e;e++)this.mMatrixMinos[e]=t.mMatrixMinos[e];for(i=this.mMatrixMinosBitGrid.length,e=0;i>e;e++)this.mMatrixMinosBitGrid[e]=t.mMatrixMinosBitGrid[e];this.mLivePieceTypeId=t.mLivePieceTypeId,this.mLivePieceStartingX=t.mLivePieceStartingX,this.mLivePieceStartingY=t.mLivePieceStartingY,this.mLivePieceStartingFacing=t.mLivePieceStartingFacing,this.mLivePieceStartingTransformId=t.mLivePieceStartingTransformId,this.mLivePieceCurrentX=t.mLivePieceCurrentX,this.mLivePieceCurrentY=t.mLivePieceCurrentY,this.mLivePieceCurrentFacing=t.mLivePieceCurrentFacing,this.mLivePieceCurrentTransformId=t.mLivePieceCurrentTransformId}},{key:"setMino",value:function(t,i,n,s,r,o,a){var h=0;h=b.setValueInPackedBits(1,h,e.kMinoValueMask_exists,e.kMinoValueBitShift_exists),h=b.setValueInPackedBits(t,h,e.kMinoValueMask_typeId,e.kMinoValueBitShift_typeId),h=b.setValueInPackedBits(s,h,e.kMinoValueMask_stuckDirections,e.kMinoValueBitShift_stuckDirections),r&&(h=b.setValueInPackedBits(1,h,e.kMinoValueMask_isStickyActive,e.kMinoValueBitShift_isStickyActive)),o&&(h=b.setValueInPackedBits(1,h,e.kMinoValueMask_isGravitic,e.kMinoValueBitShift_isGravitic)),a&&(h=b.setValueInPackedBits(1,h,e.kMinoValueMask_isClearable,e.kMinoValueBitShift_isClearable));var l=b.computeGridIndex(i,n,this.mMatrixWidth);this.mMatrixMinos[l]=h,this.mMatrixMinosBitGrid[n]=this.mMatrixMinosBitGrid[n]|1<<i}},{key:"getCurrentControlAction",value:function(){return this.mCurrentControlAction}},{key:"setCurrentControlAction",value:function(t){this.mCurrentControlAction=t}},{key:"getLivePieceTypeId",value:function(){return this.mLivePieceTypeId}},{key:"getLivePieceStartingTransform",value:function(){return this.mLivePieceStartingTransformId}},{key:"setLivePieceCurrentTransform",value:function(t){this.mLivePieceCurrentX=this.mPieceData.computeXFromTransformId(t),this.mLivePieceCurrentY=this.mPieceData.computeYFromTransformId(t),this.mLivePieceCurrentFacing=b.computeFacingFromTransformId(t),this.mLivePieceCurrentTransformId=t}},{key:"getLivePieceCurrentX",value:function(){return this.mLivePieceCurrentX}},{key:"getLivePieceCurrentY",value:function(){return this.mLivePieceCurrentY}},{key:"getLivePieceCurrentFacing",value:function(){return this.mLivePieceCurrentFacing}},{key:"getLivePieceCurrentTransform",value:function(){return this.mLivePieceCurrentTransformId}},{key:"getTransformForControlAction",value:function(t,e){var i=this.mPieceData.getPiece(this.mLivePieceTypeId,t);if(!i)return b.kInvalidTransformId;var n=null;switch(e){case b.kControlAction_moveLeft:if(n=this.mPieceData.getPiece(this.mLivePieceTypeId,i.mPerTransformActionToTransformIds[b.kTransformAction_moveLeft]),!this.doesPieceCollide(n))return n.mTransformId;break;case b.kControlAction_moveRight:if(n=this.mPieceData.getPiece(this.mLivePieceTypeId,i.mPerTransformActionToTransformIds[b.kControlAction_moveRight]),!this.doesPieceCollide(n))return n.mTransformId;break;case b.kControlAction_rotateCW:case b.kControlAction_rotateCCW:case b.kControlAction_superRotateCW:case b.kControlAction_superRotateCCW:var s=0,r=-1;switch(e){case b.kControlAction_rotateCW:s=b.kTransformAction_rotateCWPoint1,r=b.kTransformAction_rotateCWPoint1;break;case b.kControlAction_rotateCCW:s=b.kTransformAction_rotateCCWPoint1,r=b.kTransformAction_rotateCCWPoint1;break;case b.kControlAction_superRotateCW:s=b.kTransformAction_rotateCWPoint1,r=s+i.mPieceDefinition.getNumRotationPointSets()-1;break;case b.kControlAction_superRotateCCW:s=b.kTransformAction_rotateCCWPoint1,r=s+i.mPieceDefinition.getNumRotationPointSets()-1}for(var o=s;r>=o;o++)if(n=this.mPieceData.getPiece(this.mLivePieceTypeId,i.mPerTransformActionToTransformIds[o]),!this.doesPieceCollide(n))return n.mTransformId;break;case b.kControlAction_hardDrop:for(n=i;n&&!this.doesPieceTouchBelow(n);)n=this.mPieceData.getPiece(this.mLivePieceTypeId,n.mPerTransformActionToTransformIds[b.kTransformAction_moveDown]);if(!this.doesPieceCollide(n))return n.mTransformId}return b.kInvalidTransformId}},{key:"getTransformActionForControlAction",value:function(t,e,i){var n=this.mPieceData.getPiece(this.mLivePieceTypeId,t);if(!n)return b.kInvalidTransformId;var s,r=0,o=-1;switch(i){case b.kControlAction_moveLeft:r=b.kTransformAction_moveLeft,o=b.kTransformAction_moveLeft;break;case b.kControlAction_moveRight:r=b.kTransformAction_moveRight,o=b.kTransformAction_moveRight;break;case b.kControlAction_rotateCW:r=b.kTransformAction_rotateCWPoint1,o=b.kTransformAction_rotateCWPoint1;break;case b.kControlAction_rotateCCW:r=b.kTransformAction_rotateCCWPoint1,o=b.kTransformAction_rotateCCWPoint1;break;case b.kControlAction_superRotateCW:r=b.kTransformAction_rotateCWPoint1,o=b.kTransformAction_rotateCWPoint5;break;case b.kControlAction_superRotateCCW:r=b.kTransformAction_rotateCCWPoint1,o=b.kTransformAction_rotateCCWPoint5;break;case b.kControlAction_hardDrop:return b.kTransformAction_hardDrop}for(s=r;o>=s;s++)if(e==n.mPerTransformActionToTransformIds[s])return s;for(s=r;o>=s;s++)if(this.mPieceData.areTransformsEquivalent(this.mLivePieceTypeId,e,n.mPerTransformActionToTransformIds[s]))return s;return b.kTransformAction_invalid}},{key:"getTransformAction",value:function(t,e){var i=this.mPieceData.getPiece(this.mLivePieceTypeId,t);if(!i)return b.kInvalidTransformId;var n;for(n=0;n<b.kNumTransformActionsForPieceData;n++)if(e==i.mPerTransformActionToTransformIds[n])return n;for(n=0;n<b.kNumTransformActionsForPieceData;n++)if(this.mPieceData.areTransformsEquivalent(this.mLivePieceTypeId,e,i.mPerTransformActionToTransformIds[n]))return n;
return b.kTransformAction_invalid}},{key:"generateActionTransformPathWithActions",value:function(t,e,i){i&&(i.length=0);var n=t,s=this.mPieceData.getPiece(this.mLivePieceTypeId,n);if(!s)return b.kInvalidTransformId;for(var r,o=e.length,a=0;o>a;a++){if(r=e[a],r<b.kTransformAction_hardDrop)n=s.mPerTransformActionToTransformIds[r];else{if(r!=b.kTransformAction_hardDrop)return b.kInvalidTransformId;for(;!this.doesPieceTouchBelow(s);)if(n=s.mPerTransformActionToTransformIds[b.kTransformAction_moveDown],s=this.mPieceData.getPiece(this.mLivePieceTypeId,n),!s)return i&&(i.length=0),b.kInvalidTransformId}if(s=this.mPieceData.getPiece(this.mLivePieceTypeId,n),!s)return i&&(i.length=0),b.kInvalidTransformId;if(this.doesPieceCollide(s))return i&&(i.length=0),b.kInvalidTransformId;i&&(i.push(r),i.push(n))}return n}},{key:"doesPieceTouchBelow",value:function(t){if(t){if(0==t.mMinMinoY)return!0;var e=this.mPieceData.getPiece(this.mLivePieceTypeId,t.mPerTransformActionToTransformIds[b.kTransformAction_moveDown]);return this.doesPieceCollide(e)}return!1}},{key:"doesPieceCollide",value:function(t){if(!t)return!0;for(var e=0;e<t.mNumMinos;e++)if(0!=this.mMatrixMinos[t.mMinosXY[e]])return!0;return!1}},{key:"getEndingRotationPointForPath",value:function(t){for(var e,i,n,s=b.kInvalidTransformId,r=0,o=t.length,a=~~(o/2),h=0;a>h;h++){switch(e=t[2*h],i=t[2*h+1],e){case b.kTransformAction_rotateCWPoint1:case b.kTransformAction_rotateCWPoint2:case b.kTransformAction_rotateCWPoint3:case b.kTransformAction_rotateCWPoint4:case b.kTransformAction_rotateCWPoint5:case b.kTransformAction_rotateCCWPoint1:case b.kTransformAction_rotateCCWPoint2:case b.kTransformAction_rotateCCWPoint3:case b.kTransformAction_rotateCCWPoint4:case b.kTransformAction_rotateCCWPoint5:n=b.getRotationPointForTransformAction(e),5==r?1!=n&&(r=n):r=n;break;default:this.mPieceData.areTransformsEquivalent(this.mLivePieceTypeId,s,i)||(r=0)}s=i}return r}},{key:"getSoftDropStepsForPath",value:function(t,e,i){var n,s,r=this.mPieceData.getPiece(this.mLivePieceTypeId,e);r?(n=r.mMinMinoY,s=r.mY):(n=this.mMatrixHeight,s=this.mMatrixHeight),s>i&&(s=i);for(var o,a=0,h=t.length,l=~~(h/2),c=0;l>c;c++)if(o=t[2*c],o==b.kTransformAction_moveDown){var u=t[2*c+1];r=this.mPieceData.getPiece(this.mLivePieceTypeId,u),r&&r.mMinMinoY<n&&r.mY<s&&a++;var d=this.mPieceData.computeYFromTransformId(u);s>d&&(s=d)}return a}},{key:"getHardDropStepsForPath",value:function(t,e){var i,n=this.mPieceData.getPiece(this.mLivePieceTypeId,e);i=n?n.mY:this.mMatrixHeight;for(var s,r=t.length,o=~~(r/2),a=o-1;a>=0;a--)if(s=t[2*a],s==b.kTransformAction_hardDrop){var h=t[2*a-1],l=this.mPieceData.computeYFromTransformId(h);l>i&&(l=i);var c=t[2*a+1],u=this.mPieceData.computeYFromTransformId(c);return l-u}return 0}},{key:"clearMatrix",value:function(){var t,e=this.mMatrixMinos.length;for(t=0;e>t;t++)this.mMatrixMinos[t]=0;for(e=this.mMatrixMinosBitGrid.length,t=0;e>t;t++)this.mMatrixMinosBitGrid[t]=this.mMatrixMinosBitGridEmptyRow}},{key:"destroy",value:function(){this.isDestroyed()||(this.mIsDestroyed=!0)}}]),e}();r.kMinoValueNumBits_exists=1,r.kMinoValueNumBits_typeId=8,r.kMinoValueNumBits_stuckDirections=8,r.kMinoValueNumBits_isStickyActive=1,r.kMinoValueNumBits_isGravitic=1,r.kMinoValueNumBits_isClearable=1,r.kMinoValueBitShift_exists=0,r.kMinoValueBitShift_typeId=1,r.kMinoValueBitShift_stuckDirections=9,r.kMinoValueBitShift_isStickyActive=17,r.kMinoValueBitShift_isGravitic=18,r.kMinoValueBitShift_isClearable=19,r.kMinoValueMask_exists=1,r.kMinoValueMask_typeId=510,r.kMinoValueMask_stuckDirections=130560,r.kMinoValueMask_isStickyActive=131072,r.kMinoValueMask_isGravitic=262144,r.kMinoValueMask_isClearable=524288;var o=n.TetAIMinoDefinition=function x(){t(this,x),this.mX=0,this.mY=0,this.mStickyBits=0},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=n.TetAIPiece=function(){function e(i,n,s,r,o,a){t(this,e),this.mMinosXY=new Array(e.kMaxMinosPerPiece),this.mMinosBitGrid=new Array(e.kMinosBitGridHeight),this.mPerTransformActionToTransformIds=new Array(e.kNumActions),this.mEquivalentTransformIds=new Array(e.kMaxNumEquivalentTransformIds),this.mPieceDefinition=i,this.mMatrixWidth=r,this.mX=n,this.mY=s,this.mFacing=a,this.mTransformId=b.computeTransformId(n,s,r,o,a),this.mNumMinos=0,this.mMinMinoX=1e6,this.mMaxMinoX=-1e6,this.mMinMinoY=1e6,this.mMaxMinoY=-1e6;var h=0;for(h=0;h<e.kMaxMinosPerPiece;h++)this.mMinosXY[h]=0;for(h=0;h<e.kMinosBitGridHeight;h++)this.mMinosBitGrid[h]=0;for(h=0;h<b.kNumTransformActionsForPieceData;h++)this.mPerTransformActionToTransformIds[h]=b.kInvalidTransformId;for(h=0;h<e.kMaxNumEquivalentTransformIds;h++)this.mEquivalentTransformIds[h]=b.kInvalidTransformId;if(this.mNumEquivalentTransformIds=0,i){var l,c=i.getNumMinos();for(h=0;c>h;h++){l=i.getMino(h);var u=0,d=0,A=l.mStickyBits;switch(a){case b.kFacing_N:u=l.mX,d=l.mY;break;case b.kFacing_E:u=l.mY,d=-l.mX,A=b.rotateDirections90(A,!0);break;case b.kFacing_S:u=-l.mX,d=-l.mY,A=b.rotateDirections90(A,!0),A=b.rotateDirections90(A,!0);break;case b.kFacing_W:u=-l.mY,d=l.mX,A=b.rotateDirections90(A,!0),A=b.rotateDirections90(A,!0),A=b.rotateDirections90(A,!0)}this.addMino(n+u,s+d,A)}}}return s(e,[{key:"addEquivalentTransformId",value:function(t){this.isEquivalentTransformId(t)||this.mNumEquivalentTransformIds>=e.kMaxNumEquivalentTransformIds||(this.mEquivalentTransformIds[this.mNumEquivalentTransformIds]=t,this.mNumEquivalentTransformIds++)}},{key:"isEquivalentTransformId",value:function(t){for(var e=0;e<this.mNumEquivalentTransformIds;e++)if(this.mEquivalentTransformIds[e]==t)return!0;return!1}},{key:"getMinoXInPiece",value:function(t){return this.getMinoYInMatrix(t)-this.mX}},{key:"getMinoYInPiece",value:function(t){return this.getMinoXInMatrix(t)-this.mY}},{key:"getMinoXInMatrix",value:function(t){return t>=0&&t<mNumMinos?b.computeXFromGridIndex(this.mMinosXY[t],this.mMatrixWidth):0}},{key:"getMinoYInMatrix",value:function(t){return t>=0&&t<mNumMinos?b.computeYFromGridIndex(this.mMinosXY[t],this.mMatrixWidth):0}},{key:"addMino",value:function(t,i,n){this.mNumMinos>=e.kMaxMinosPerPiece||(this.mMinosXY[this.mNumMinos]=b.computeGridIndex(t,i,this.mMatrixWidth),this.mMinosBitGrid[i-this.mY+e.kMinosBitGridYOffset]|=1<<t,this.mMinMinoX=b.minInt(this.mMinMinoX,t),this.mMaxMinoX=b.maxInt(this.mMaxMinoX,t),this.mMinMinoY=b.minInt(this.mMinMinoY,i),this.mMaxMinoY=b.maxInt(this.mMaxMinoY,i),this.mNumMinos++)}}]),e}();a.kMaxMinosPerPiece=4,a.kMinosBitGridHeight=5,a.kMinosBitGridYOffset=2,a.kNumActions=14,a.kMaxNumEquivalentTransformIds=3;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=n.TetAIPieceData=function(){function e(i,n){t(this,e),this.mPieceDefinitions=new Array,this.mPiecesArrays=new Map,this.mIsDestroyed=!1,this.mMatrixWidth=i,this.mMatrixHeight=n,this.mMinTransformId=0,this.mMaxTransformId=0,this.mCachedPiecesArray=null,this.mCachedPiecesArrayPieceTypeId=0}return s(e,null,[{key:"canGetSharedStandardPieceData",value:function(){return e.sSharedStandardPieceDataState!=e.kSharedStandardPieceDataState_processing}},{key:"getSharedStandardPieceData",value:function(t,i){return!e.sSharedStandardPieceData||e.sSharedStandardPieceDataMatrixWidth==t&&e.sSharedStandardPieceDataMatrixHeight==i||e.destroySharedStandardPieceData(),e.sSharedStandardPieceData||(e.sSharedStandardPieceDataState=e.kSharedStandardPieceDataState_processing,e.sSharedStandardPieceData=new e(t,i),e.sSharedStandardPieceDataMatrixWidth=t,e.sSharedStandardPieceDataMatrixHeight=i,e.sSharedStandardPieceData.addStandardPieceDefinitions(),e.sSharedStandardPieceData.processPieceDefinitions(),e.sSharedStandardPieceDataState=e.kSharedStandardPieceDataState_ready),e.sSharedStandardPieceData}},{key:"destroySharedStandardPieceData",value:function(){e.sSharedStandardPieceData&&(e.sSharedStandardPieceData.destroy(),e.sSharedStandardPieceData&&(e.sSharedStandardPieceData=null),e.sSharedStandardPieceDataMatrixWidth=0,e.sSharedStandardPieceDataMatrixHeight=0,e.sSharedStandardPieceDataState=e.kSharedStandardPieceDataState_null)}}]),s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"addStandardPieceDefinitions",value:function(){this.addPieceDefinition("I",b.kPieceType_I),this.addPieceDefinitionMino(b.kPieceType_I,0,0),this.addPieceDefinitionMino(b.kPieceType_I,1,0),this.addPieceDefinitionMino(b.kPieceType_I,2,0),this.addPieceDefinitionMino(b.kPieceType_I,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_I,0,0,-1,0,-1,1,0,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_I,-1,0,0,0,1,1,0,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_I,2,0,0,0,-2,1,0,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_I,-1,0,0,1,1,0,0,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_I,2,0,0,-2,-2,0,0,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_I,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_I,b.kRotationalSymmetryType_180,1,0),this.addPieceDefinition("J",b.kPieceType_J),this.addPieceDefinitionMino(b.kPieceType_J,0,0),this.addPieceDefinitionMino(b.kPieceType_J,-1,0),this.addPieceDefinitionMino(b.kPieceType_J,1,0),this.addPieceDefinitionMino(b.kPieceType_J,-1,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_J,0,0,0,0,0,0,0,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_J,0,0,1,0,0,0,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_J,0,0,1,-1,0,0,-1,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_J,0,0,0,2,0,0,0,2),this.addPieceDefinitionRotationPointSet(b.kPieceType_J,0,0,1,2,0,0,-1,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_J,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_J,b.kRotationalSymmetryType_none,0,0),this.addPieceDefinition("L",b.kPieceType_L),this.addPieceDefinitionMino(b.kPieceType_L,0,0),this.addPieceDefinitionMino(b.kPieceType_L,1,0),this.addPieceDefinitionMino(b.kPieceType_L,-1,0),this.addPieceDefinitionMino(b.kPieceType_L,1,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_L,0,0,0,0,0,0,0,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_L,0,0,1,0,0,0,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_L,0,0,1,-1,0,0,-1,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_L,0,0,0,2,0,0,0,2),this.addPieceDefinitionRotationPointSet(b.kPieceType_L,0,0,1,2,0,0,-1,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_L,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_L,b.kRotationalSymmetryType_none,0,0),this.addPieceDefinition("O",b.kPieceType_O),this.addPieceDefinitionMino(b.kPieceType_O,0,0),this.addPieceDefinitionMino(b.kPieceType_O,1,0),this.addPieceDefinitionMino(b.kPieceType_O,0,1),this.addPieceDefinitionMino(b.kPieceType_O,1,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_O,0,0,0,-1,-1,-1,-1,0),this.setPieceDefinitionGenerationOffset(b.kPieceType_O,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_O,b.kRotationalSymmetryType_90,0,1),this.addPieceDefinition("S",b.kPieceType_S),this.addPieceDefinitionMino(b.kPieceType_S,0,0),this.addPieceDefinitionMino(b.kPieceType_S,0,1),this.addPieceDefinitionMino(b.kPieceType_S,-1,0),this.addPieceDefinitionMino(b.kPieceType_S,1,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_S,0,0,0,0,0,0,0,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_S,0,0,1,0,0,0,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_S,0,0,1,-1,0,0,-1,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_S,0,0,0,2,0,0,0,2),this.addPieceDefinitionRotationPointSet(b.kPieceType_S,0,0,1,2,0,0,-1,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_S,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_S,b.kRotationalSymmetryType_180,0,1),this.addPieceDefinition("T",b.kPieceType_T),this.addPieceDefinitionMino(b.kPieceType_T,0,0),this.addPieceDefinitionMino(b.kPieceType_T,0,1),this.addPieceDefinitionMino(b.kPieceType_T,-1,0),this.addPieceDefinitionMino(b.kPieceType_T,1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_T,0,0,0,0,0,0,0,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_T,0,0,1,0,0,0,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_T,0,0,1,-1,0,0,-1,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_T,0,0,0,2,0,0,0,2),this.addPieceDefinitionRotationPointSet(b.kPieceType_T,0,0,1,2,0,0,-1,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_T,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_T,b.kRotationalSymmetryType_none,0,0),this.addPieceDefinition("Z",b.kPieceType_Z),this.addPieceDefinitionMino(b.kPieceType_Z,0,0),this.addPieceDefinitionMino(b.kPieceType_Z,0,1),this.addPieceDefinitionMino(b.kPieceType_Z,1,0),this.addPieceDefinitionMino(b.kPieceType_Z,-1,1),this.addPieceDefinitionRotationPointSet(b.kPieceType_Z,0,0,0,0,0,0,0,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_Z,0,0,1,0,0,0,-1,0),this.addPieceDefinitionRotationPointSet(b.kPieceType_Z,0,0,1,-1,0,0,-1,-1),this.addPieceDefinitionRotationPointSet(b.kPieceType_Z,0,0,0,2,0,0,0,2),this.addPieceDefinitionRotationPointSet(b.kPieceType_Z,0,0,1,2,0,0,-1,2),this.setPieceDefinitionGenerationOffset(b.kPieceType_Z,0,0),this.setPieceDefinitionRotationalSymmetry(b.kPieceType_Z,b.kRotationalSymmetryType_180,0,1)}},{key:"addPieceDefinition",value:function(t,e){if(!this.getPieceDefinition(e)){var i=new l(t,e);this.mPieceDefinitions.push(i)}}},{key:"addPieceDefinitionMino",value:function(t,e,i){var n=this.getPieceDefinition(t);n.addMino(e,i)}},{key:"addPieceDefinitionRotationPointSet",value:function(t,e,i,n,s,r,o,a,h){var l=this.getPieceDefinition(t);l.addRotationPointSet(e,i,n,s,r,o,a,h)}},{key:"setPieceDefinitionGenerationOffset",value:function(t,e,i){var n=this.getPieceDefinition(t);n.setGenerationOffset(e,i)}},{key:"setPieceDefinitionRotationalSymmetry",value:function(t,e,i,n){var s=this.getPieceDefinition(t);s.setRotationalSymmetry(e,i,n)}},{key:"processPieceDefinitions",value:function(){this.mMinTransformId=this.computeTransformId(0,0,b.kFacing_N),this.mMaxTransformId=this.computeTransformId(this.mMatrixWidth-1,this.mMatrixHeight-1,b.kFacing_W),this.destroyPiecesArrays();for(var t,e=this.mPieceDefinitions.length,i=0;e>i;i++){t=this.mPieceDefinitions[i];var n=t.getTypeId(),s=new Array;for(s.length=0;s.length<this.mMaxTransformId+1;)s.push(null);this.mPiecesArrays.set(n,s);var r,o,h,l=null,c=t.getNumRotationPointSets();for(r=0;r<this.mMatrixWidth;r++)for(o=0;o<this.mMatrixHeight;o++)for(h=b.kFacing_N;h<=b.kFacing_W;h++)t.doesFitInMatrix(r,o,h,this.mMatrixWidth,this.mMatrixHeight)&&(l=new a(t,r,o,this.mMatrixWidth,0,h),s[l.mTransformId]=l);for(r=0;r<this.mMatrixWidth;r++)for(o=0;o<this.mMatrixHeight;o++)for(h=b.kFacing_N;h<=b.kFacing_W;h++){var u=this.computeTransformId(r,o,h);if(l=this.getPiece(n,u)){for(var d=r,A=o,p=h,m=0,f=0;f<b.kNumTransformActionsForPieceData;f++){switch(f){case b.kTransformAction_none:d=r,A=o,p=h;break;case b.kTransformAction_moveLeft:d=r-1,A=o,p=h;break;case b.kTransformAction_moveRight:d=r+1,A=o,p=h;break;case b.kTransformAction_moveDown:d=r,A=o-1,p=h;break;case b.kTransformAction_rotateCWPoint1:case b.kTransformAction_rotateCWPoint2:case b.kTransformAction_rotateCWPoint3:case b.kTransformAction_rotateCWPoint4:case b.kTransformAction_rotateCWPoint5:if(m=f-b.kTransformAction_rotateCWPoint1,m>=c)continue;p=b.rotateFacing90(h,!0),d=r+t.getRotationPointSet(m).getXOffsetForRotation(h,p),A=o+t.getRotationPointSet(m).getYOffsetForRotation(h,p);break;case b.kTransformAction_rotateCCWPoint1:case b.kTransformAction_rotateCCWPoint2:case b.kTransformAction_rotateCCWPoint3:case b.kTransformAction_rotateCCWPoint4:case b.kTransformAction_rotateCCWPoint5:if(m=f-b.kTransformAction_rotateCCWPoint1,m>=c)continue;p=b.rotateFacing90(h,!1),d=r+t.getRotationPointSet(m).getXOffsetForRotation(h,p),A=o+t.getRotationPointSet(m).getYOffsetForRotation(h,p)}if(t.doesFitInMatrix(d,A,p,this.mMatrixWidth,this.mMatrixHeight)){var g=this.computeTransformId(d,A,p),_=this.getPiece(n,g);_&&(l.mPerTransformActionToTransformIds[f]=g)}}var y=t.mRotationalSymmetryType;if(y==b.kRotationalSymmetryType_180||y==b.kRotationalSymmetryType_90){var v,T,w,x,C,S,P=h,I=t.mRotationalSymmetryXOffset,M=t.mRotationalSymmetryYOffset;if(y==b.kRotationalSymmetryType_180)P=b.rotateFacing90(P,!0),P=b.rotateFacing90(P,!0),v=b.getPointXForFacingRotation(I,M,b.kFacing_N,P),T=b.getPointYForFacingRotation(I,M,b.kFacing_N,P),w=r-v,x=o-T,this.isCellInsideMatrix(w,x)&&(C=this.computeTransformId(w,x,P),S=this.getPiece(n,C),S&&l.addEquivalentTransformId(C));else{v=b.getPointXForFacingRotation(I,M,b.kFacing_N,h),T=b.getPointYForFacingRotation(I,M,b.kFacing_N,h),w=r+v,x=o+T,P=b.rotateFacing90(P,!0);for(var k,B,D,E=0;3>E;E++)this.isCellInsideMatrix(w,x)&&(C=this.computeTransformId(w,x,P),S=this.getPiece(n,C),S&&l.addEquivalentTransformId(C)),k=P,P=b.rotateFacing90(P,!0),B=v,D=T,v=b.getPointXForFacingRotation(B,D,k,P),T=b.getPointYForFacingRotation(B,D,k,P),w+=v,x+=T}}}}}}},{key:"getMaxNumTransforms",value:function(){return this.mMaxTransformId+1}},{key:"isTransformValid",value:function(t,e){return this.getPiece(t,e)}},{key:"areTransformsEquivalent",value:function(t,e,i){if(e==i)return!0;var n=this.getPiece(t,e);return n?n.isEquivalentTransformId(i):!1}},{key:"getPiece",value:function(t,i){return i==b.kInvalidTransformId?null:i<this.mMinTransformId?null:i>this.mMaxTransformId?null:this==e.sSharedStandardPieceData?this.mPiecesArrays.get(t)[i]:(this.mCachedPiecesArray&&this.mCachedPiecesArrayPieceTypeId==t||(this.mCachedPiecesArray=this.mPiecesArrays.get(t),this.mCachedPiecesArrayPieceTypeId=t),this.mCachedPiecesArray[i])}},{key:"getNameForPieceTypeId",value:function(t){var e=this.getPieceDefinition(t);return e.getTypeName()}},{key:"getMaxFacingForPieceTypeId",value:function(t){var e=this.getPieceDefinition(t);switch(e.getRotationalSymmetryType()){case b.kRotationalSymmetryType_none:return b.kFacing_W;case b.kRotationalSymmetryType_90:return b.kFacing_N;default:return b.kFacing_W}}},{key:"computeTransformId",value:function(t,e,i){return b.computeTransformId(t,e,this.mMatrixWidth,0,i)}},{key:"computeXFromTransformId",value:function(t){return b.computeXFromTransformId(t,this.mMatrixWidth,0)}},{key:"computeYFromTransformId",value:function(t){return b.computeYFromTransformId(t,this.mMatrixWidth,0)}},{key:"getPieceDefinition",value:function(t){for(var e,i=this.mPieceDefinitions.length,n=0;i>n;n++)if(e=this.mPieceDefinitions[n],e.getTypeId()==t)return e;return null}},{key:"isCellInsideMatrix",value:function(t,e){return 0>t?!1:t>=this.mMatrixWidth?!1:0>e?!1:e>=this.mMatrixHeight?!1:!0}},{key:"destroyPiecesArrays",value:function(){for(var t,e=this.mPieceDefinitions.length,i=0;e>i;i++){t=this.mPieceDefinitions[i];var n=this.mPiecesArrays.get(t.getTypeId());if(n){for(var s=n.length,r=null,o=0;s>o;o++)r=n[o],r&&(r=null);n&&(n=null),this.mPiecesArrays.set(t.getTypeId(),null)}}}},{key:"destroyPieceDefinitions",value:function(){for(var t,e=this.mPieceDefinitions.length,i=0;e>i;i++)t=this.mPieceDefinitions[i],t.destroy(),t&&(t=null);this.mPieceDefinitions.length=0}},{key:"destroy",value:function(){this.isDestroyed()||(this.destroyPiecesArrays(),this.destroyPieceDefinitions(),this.mIsDestroyed=!0)}}]),e}();h.kSharedStandardPieceDataState_null=0,h.kSharedStandardPieceDataState_processing=1,h.kSharedStandardPieceDataState_ready=2;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=n.TetAIPieceDefinition=function(){function e(i,n){t(this,e),this.mMinos=new Array,this.mRotationPointSets=new Array,this.mIsDestroyed=!1,this.mTypeName=i,this.mTypeId=n,this.mMinMinoX=1e6,this.mMaxMinoX=-1e6,this.mMinMinoY=1e6,this.mMaxMinoY=-1e6,this.mGenerationOffsetX=0,this.mGenerationOffsetY=0,this.mRotationalSymmetryType=b.kRotationalSymmetryType_none,this.mRotationalSymmetryXOffset=0,this.mRotationalSymmetryYOffset=0}return s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"getTypeName",value:function(){return this.mTypeName}},{key:"getTypeId",value:function(){return this.mTypeId}},{key:"addMino",value:function(t,e){var i=new o;i.mX=t,i.mY=e,this.mMinos.push(i),t<this.mMinMinoX&&(this.mMinMinoX=t),t>this.mMaxMinoX&&(this.mMaxMinoX=t),e<this.mMinMinoY&&(this.mMinMinoY=e),e>this.mMaxMinoY&&(this.mMaxMinoY=e),this.recalculateStickyBits()}},{key:"getNumMinos",value:function(){return this.mMinos.length}},{key:"getMino",value:function(t){return this.mMinos[t]}},{key:"addRotationPointSet",value:function(t,e,i,n,s,r,o,a){var h=new c;h.setPoints(t,e,i,n,s,r,o,a),this.mRotationPointSets.push(h)}},{key:"getNumRotationPointSets",value:function(){return this.mRotationPointSets.length}},{key:"getRotationPointSet",value:function(t){return this.mRotationPointSets[t]}},{key:"getGenerationOffsetX",value:function(){return this.mGenerationOffsetX}},{key:"getGenerationOffsetY",value:function(){return this.mGenerationOffsetY}},{key:"setGenerationOffset",value:function(t,e){this.mGenerationOffsetX=t,this.mGenerationOffsetY=e}},{key:"getRotationalSymmetryType",value:function(){return this.mRotationalSymmetryType}},{key:"getRotationalSymmetryXOffset",value:function(){return this.mRotationalSymmetryXOffset}},{key:"getRotationalSymmetryYOffset",value:function(){return this.mRotationalSymmetryYOffset}},{key:"setRotationalSymmetry",value:function(t,e,i){this.mRotationalSymmetryType=t,this.mRotationalSymmetryXOffset=e,this.mRotationalSymmetryYOffset=i}},{key:"doesFitInMatrix",value:function(t,e,i,n,s){var r=0,o=0,a=0,h=0;switch(i){case b.kFacing_N:r=t+this.mMinMinoX,o=t+this.mMaxMinoX,a=e+this.mMinMinoY,h=e+this.mMaxMinoY;break;case b.kFacing_E:r=t+this.mMinMinoY,o=t+this.mMaxMinoY,a=e+-this.mMaxMinoX,h=e+-this.mMinMinoX;break;case b.kFacing_S:r=t+-this.mMaxMinoX,o=t+-this.mMinMinoX,a=e+-this.mMaxMinoY,h=e+-this.mMinMinoY;break;case b.kFacing_W:r=t+-this.mMaxMinoY,o=t+-this.mMinMinoY,a=e+this.mMinMinoX,h=e+this.mMaxMinoX}return 0>r?!1:o>=n?!1:0>a?!1:h>=s?!1:!0}},{key:"recalculateStickyBits",value:function(){var t,e,i,n=this.getNumMinos();for(i=0;n>i;i++)t=this.getMino(i),t.mStickyBits=0;for(i=0;n>i;i++){t=this.getMino(i);for(var s=i+1;n>s;s++)e=this.getMino(s),e.mX-t.mX==0&&e.mY-t.mY==1&&(t.mStickyBits|=b.kDirection_N,e.mStickyBits|=b.kDirection_S),e.mX-t.mX==1&&e.mY-t.mY==1&&(t.mStickyBits|=b.kDirection_NE,e.mStickyBits|=b.kDirection_SW),e.mX-t.mX==1&&e.mY-t.mY==0&&(t.mStickyBits|=b.kDirection_E,e.mStickyBits|=b.kDirection_W),e.mX-t.mX==1&&e.mY-t.mY==-1&&(t.mStickyBits|=b.kDirection_SE,e.mStickyBits|=b.kDirection_NW),e.mX-t.mX==0&&e.mY-t.mY==-1&&(t.mStickyBits|=b.kDirection_S,e.mStickyBits|=b.kDirection_N),e.mX-t.mX==-1&&e.mY-t.mY==-1&&(t.mStickyBits|=b.kDirection_SW,e.mStickyBits|=b.kDirection_NE),e.mX-t.mX==-1&&e.mY-t.mY==0&&(t.mStickyBits|=b.kDirection_W,e.mStickyBits|=b.kDirection_E),e.mX-t.mX==-1&&e.mY-t.mY==1&&(t.mStickyBits|=b.kDirection_NW,e.mStickyBits|=b.kDirection_SE)}}},{key:"destroy",value:function(){if(!this.isDestroyed()){var t;for(t=0;t<this.mMinos.length;t++){var e=this.mMinos[t];e&&(e=null)}for(t=0;t<this.mRotationPointSets.length;t++){var i=this.mRotationPointSets[t];i&&(i=null)}this.mIsDestroyed=!0}}}]),e}(),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=n.TetAIRotationPointSet=function(){function e(){t(this,e),this.setPoints(0,0,0,0,0,0,0,0)}return s(e,[{key:"setPoints",value:function(t,e,i,n,s,r,o,a){this.mNorthX=t,this.mNorthY=e,this.mEastX=i,this.mEastY=n,this.mSouthX=s,this.mSouthY=r,this.mWestX=o,this.mWestY=a}},{key:"getXOffsetForFacing",value:function(t){switch(t){case b.kFacing_N:return this.mNorthX;case b.kFacing_E:return this.mEastX;case b.kFacing_S:return this.mSouthX;case b.kFacing_W:return this.mWestX;default:return 0}}},{key:"getYOffsetForFacing",value:function(t){switch(t){case b.kFacing_N:return this.mNorthY;case b.kFacing_E:return this.mEastY;case b.kFacing_S:return this.mSouthY;case b.kFacing_W:return this.mWestY;default:return 0}}},{key:"getXOffsetForRotation",value:function(t,e){return this.getXOffsetForFacing(t)-this.getXOffsetForFacing(e)}},{key:"getYOffsetForRotation",value:function(t,e){return this.getYOffsetForFacing(t)-this.getYOffsetForFacing(e)}}]),e}(),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function C(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:C(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},d=n.TetAITargetFinder=function(n){function o(i,n,s,r){t(this,o);var a=e(this,Object.getPrototypeOf(o).call(this,i,n,s));a.mPerCellInfo=new Array,a.mPerTransformInfo=new Array,a.mTargetTransforms=new Array,a.mReachableTransforms=new Array,a.mPerCellTargetTransforms=new Array,a.mPerCellReachableTransforms=new Array,a.mPerTransformPaths=new Array,a.mPerTransformEvaluationScore=new Array,a.mScratchMatrixCellIndexStack=new Array,a.mScratchTransformStack=new Array,a.mScratchActionStack=new Array,a.mScratchPerTransformActionStacks=new Array,a.mScratchPath=new Array,a.mTargetsRequireTouchDown=r,a.mMatrixMinosBitGridISlotRightRow=a.mMatrixMinosBitGridFullRow&~(1<<n-1),a.mMatrixMinosBitGridISlotLeftRow=-2&a.mMatrixMinosBitGridFullRow,a.mMatrixMinosBitGridISlotRightEdgeRow=1<<n-2,a.mMatrixMinosBitGridISlotRightEdgeRowMask=1<<n-2|1<<n-1,a.mMatrixMinosBitGridISlotLeftEdgeRow=2,a.mMatrixMinosBitGridISlotLeftEdgeRowMask=3,a.mMaxTargetFacing=0;var h=a.mMatrixWidth*a.mMatrixHeight;for(a.mPerCellInfo.length=0;a.mPerCellInfo.length<h;)a.mPerCellInfo.push(0);var l=i.getMaxNumTransforms();for(a.mPerTransformInfo.length=0;a.mPerTransformInfo.length<l;)a.mPerTransformInfo.push(0);for(a.mPerCellTargetTransforms.length=0;a.mPerCellTargetTransforms.length<h;)a.mPerCellTargetTransforms.push(null);for(a.mPerCellReachableTransforms.length=0;a.mPerCellReachableTransforms.length<h;)a.mPerCellReachableTransforms.push(null);var c,u=null;for(c=0;h>c;c++)u=new Array,a.mPerCellTargetTransforms[c]=u,u=new Array,a.mPerCellReachableTransforms[c]=u;for(a.mPerTransformPaths.length=0;a.mPerTransformPaths.length<l;)a.mPerTransformPaths.push(null);for(var d=0;s>d;d++)for(var A=0;n>A;A++)for(var p=b.kFacing_N;p<=b.kFacing_W;p++){var m=new Array;a.mPerTransformPaths[a.mPieceData.computeTransformId(A,d,p)]=m}for(a.mPerTransformEvaluationScore.length=0;a.mPerTransformEvaluationScore.length<l;)a.mPerTransformEvaluationScore.push(0);for(a.mScratchMatrixCellIndexStack.length=0;a.mScratchMatrixCellIndexStack.length<h;)a.mScratchMatrixCellIndexStack.push(0);for(a.mScratchMatrixCellIndexStackTop=-1,a.mScratchTransformStack.length=0;a.mScratchTransformStack.length<l;)a.mScratchTransformStack.push(0);for(a.mScratchActionStack.length=0;a.mScratchActionStack.length<l;)a.mScratchActionStack.push(0);for(a.mScratchTransformStackTop=-1,a.mScratchPerTransformActionStacks.length=0;a.mScratchPerTransformActionStacks.length<l;)a.mScratchPerTransformActionStacks.push(null);for(c=0;l>c;c++){var f=new Array;a.mScratchPerTransformActionStacks[c]=f}return a}return i(o,n),s(o,[{key:"startStateEvaluation",value:function(t){this.resetStateWithState(t),this.mMaxTargetFacing=this.mPieceData.getMaxFacingForPieceTypeId(this.mLivePieceTypeId),this.mTargetTransforms.length=0,this.mReachableTransforms.length=0;var e=null,i=this.mMatrixWidth*this.mMatrixHeight,n=0;for(n=0;i>n;n++)this.mPerCellInfo[n]=0,e=this.mPerCellTargetTransforms[n],e.length=0,e=this.mPerCellReachableTransforms[n],e.length=0;for(var s=0,r=0;r<this.mMatrixHeight;r++)for(var a=0;a<this.mMatrixWidth;a++)for(var h=b.kFacing_N;h<=b.kFacing_W;h++)s=this.mPieceData.computeTransformId(a,r,h),this.mPerTransformInfo[s]=0,e=this.mPerTransformPaths[s],e.length=0;this.mReachableTransformsAreClean=!0;for(var l=0;l<this.mPerTransformEvaluationScore.length;l++)this.mPerTransformEvaluationScore[l]=o.kMinTransformEvaluationScore}},{key:"processStateEvaluation",value:function(){var t=this.processFindTargetTransforms();return t}},{key:"isCellInsideMatrix",value:function(t,e){return 0>t?!1:t>=this.mMatrixWidth?!1:0>e?!1:e>=this.mMatrixHeight?!1:!0}},{key:"doesCellCollide",value:function(t,e){return this.isCellInsideMatrix(t,e)?0!=this.mMatrixMinos[b.computeGridIndex(t,e,this.mMatrixWidth)]?!0:!1:!0}},{key:"doesTransformTouchBelow",value:function(t,e,i){return e>0?this.doesTransformCollide(this.mPieceData.computeTransformId(t,e-1,i)):!0}},{key:"doesTransformCollide",value:function(t){if(0!=(this.mPerTransformInfo[t]&o.kTransformInfo_didCheckDoesCollide))return 0!=(this.mPerTransformInfo[t]&o.kTransformInfo_doesCollide);this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_didCheckDoesCollide;var e=this.mPieceData.getPiece(this.mLivePieceTypeId,t);return e?this.doesPieceCollide(e)?(this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_doesCollide,!0):!1:(this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_doesCollide,!0)}},{key:"getNumTransformsForCell",value:function(t,e){if(!this.isCellInsideMatrix(t,e))return 0;if(0==(this.mPerCellInfo[b.computeGridIndex(t,e,this.mMatrixWidth)]&o.kCellInfo_hasTargetTransforms))return 0;var i=this.getReachableTransformsForCell(t,e);return i?i.length:0}},{key:"getBestTransformForCell",value:function(t,e,i,n){if(!this.isCellInsideMatrix(t,e))return b.kInvalidTransformId;if(0==(this.mPerCellInfo[b.computeGridIndex(t,e,this.mMatrixWidth)]&o.kCellInfo_hasTargetTransforms))return b.kInvalidTransformId;var s=this.getReachableTransformsForCell(t,e),r=s?s.length:0;return r>0?(i=n?b.clampInt(i,0,r-1):b.loopInt(i,0,r-1),s[i]):b.kInvalidTransformId}},{key:"getBestTransformForCellColumn",value:function(t,e,i,n,s){if(!this.isCellInsideMatrix(t,e))return b.kInvalidTransformId;for(var r,a,h=b.kInvalidTransformId,l=o.kMinTransformEvaluationScore-1,c=0,u=i?0:b.minInt(this.getHighestSurfaceYInColumn(t),e);u<this.mMatrixHeight;)0!=(this.mPerCellInfo[b.computeGridIndex(t,u,this.mMatrixWidth)]&o.kCellInfo_hasTargetTransforms)&&(r=this.getBestTransformForCell(t,u,0,!0),r!=b.kInvalidTransformId&&(a=this.mPerTransformEvaluationScore[r],a>l&&(h=r,l=a,c=u))),u++;return n>0?this.getBestTransformForCell(t,c,n,s):h}},{key:"getBestTransformForCellColumns",value:function(t,e,i,n,s,r){if(!this.isCellInsideMatrix(t,i))return b.kInvalidTransformId;for(var o,a=e>=0?1:-1,h=a>0?this.mMatrixWidth:-1,l=t;l!=h;l+=a)if(o=this.getBestTransformForCellColumn(l,i,n,s,r),o!=b.kInvalidTransformId)return o;return b.kInvalidTransformId}},{key:"getBestActionsForTransform",value:function(t,e,i,n){if(e.length=0,t==b.kInvalidTransformId)return!1;var s,r;if(this.mPieceData.isTransformValid(this.mLivePieceTypeId,t)){if(0!=(this.mPerTransformInfo[t]&o.kTransformInfo_didCheckIsReachable)){if(0==(this.mPerTransformInfo[t]&o.kTransformInfo_isReachable))return!1}else if(!this.isTransformReachable(t))return!1;var a,h,l=this.mPerTransformPaths[t],c=~~(l.length/2);if((i||n)&&c>2){var u,d;if(this.mScratchPath.length=0,i)for(s=0;c>s;s++){var A=!1;if(a=l[2*s],h=l[2*s+1],c-s>=3)switch(a){case b.kTransformAction_rotateCWPoint1:case b.kTransformAction_rotateCCWPoint1:l[2*(s+1)]==a&&l[2*(s+2)]==a&&(a=a==b.kTransformAction_rotateCWPoint1?b.kTransformAction_rotateCCWPoint1:b.kTransformAction_rotateCWPoint1,this.mScratchPath.push(a),s+=2,A=!0)}if(!A){for(r=s+1;c>r;r++){if(d=l[2*r+1],d==h){this.mScratchPath.push(a),
s=r,A=!0;break}if(r>s+1&&(u=this.getMoveAction(h,d),u!=b.kTransformAction_invalid)){this.mScratchPath.push(a),this.mScratchPath.push(u),s=r,A=!0;break}}A||this.mScratchPath.push(a)}}else for(s=0;c>s;s++)a=l[2*s],h=l[2*s+1],this.mScratchPath.push(a);if(n&&this.mScratchPath[this.mScratchPath.length-1]==b.kTransformAction_moveDown){for(;this.mScratchPath[this.mScratchPath.length-1]==b.kTransformAction_moveDown;)this.mScratchPath.pop();a=b.kTransformAction_hardDrop,this.mScratchPath.push(a)}var p=this.mScratchPath.length;for(s=0;p>s;s++)a=this.mScratchPath[s],e.push(a)}else for(s=0;c>s;s++)a=l[2*s],e.push(a)}if(e.length>0)return!0;var m=this.mPieceData.areTransformsEquivalent(this.mLivePieceTypeId,this.mLivePieceStartingTransformId,t);return m}},{key:"getMaxReachableYForColumn",value:function(t,e){for(var i=-1,n=null,s=0;e>=s;s++)n=this.getReachableTransformsForCell(t,s),n&&n.length>0&&(i=s);return i}},{key:"resetReachableTransforms",value:function(t,e,i){var n=this.mPieceData.computeTransformId(t,e,i);if(this.mLivePieceStartingTransformId!=n&&(this.mLivePieceStartingX=t,this.mLivePieceStartingY=e,this.mLivePieceStartingFacing=i,this.mLivePieceStartingTransformId=n,!this.mReachableTransformsAreClean)){var s=null,r=0,a=this.mMatrixWidth*this.mMatrixHeight;for(r=0;a>r;r++)0!=(this.mPerCellInfo[r]&o.kCellInfo_hasTargetTransforms)&&(this.mPerCellInfo[r]=this.mPerCellInfo[r]&~(o.kCellInfo_didCheckReachableTransforms|o.kCellInfo_hasReachableTransforms),s=this.mPerCellReachableTransforms[r],s.length=0);for(a=this.mReachableTransforms.length,r=0;a>r;r++)n=this.mReachableTransforms[r],this.mPerTransformInfo[n]=this.mPerTransformInfo[n]&~(o.kTransformInfo_isCheckingIsReachable|o.kTransformInfo_didCheckIsReachable|o.kTransformInfo_isReachable);this.mReachableTransforms.length=0,this.mReachableTransformsAreClean=!0}}},{key:"startFindTargetTransforms",value:function(){}},{key:"processFindTargetTransforms",value:function(){var t=0,e=0,i=0,n=0,s=b.computeGridIndex(this.mLivePieceStartingX,this.mLivePieceStartingY,this.mMatrixWidth);for(this.mScratchMatrixCellIndexStackTop=-1,this.mScratchMatrixCellIndexStack[++this.mScratchMatrixCellIndexStackTop]=s;this.mScratchMatrixCellIndexStackTop>=0;)if(s=this.mScratchMatrixCellIndexStack[this.mScratchMatrixCellIndexStackTop--],this.mPerCellInfo[s]=this.mPerCellInfo[s]|o.kCellInfo_didCheckTargetTransforms,0==this.mMatrixMinos[s]){t=b.computeXFromGridIndex(s,this.mMatrixWidth),e=b.computeYFromGridIndex(s,this.mMatrixWidth),e<this.mMatrixHeight-1&&(n=b.computeGridIndex(t,e+1,this.mMatrixWidth),0==(this.mPerCellInfo[n]&o.kCellInfo_didCheckTargetTransforms)&&(this.mScratchMatrixCellIndexStack[++this.mScratchMatrixCellIndexStackTop]=n)),t<this.mMatrixWidth-1&&(n=b.computeGridIndex(t+1,e,this.mMatrixWidth),0==(this.mPerCellInfo[n]&o.kCellInfo_didCheckTargetTransforms)&&(this.mScratchMatrixCellIndexStack[++this.mScratchMatrixCellIndexStackTop]=n)),e>0&&(n=b.computeGridIndex(t,e-1,this.mMatrixWidth),0==(this.mPerCellInfo[n]&o.kCellInfo_didCheckTargetTransforms)&&(this.mScratchMatrixCellIndexStack[++this.mScratchMatrixCellIndexStackTop]=n)),t>0&&(n=b.computeGridIndex(t-1,e,this.mMatrixWidth),0==(this.mPerCellInfo[n]&o.kCellInfo_didCheckTargetTransforms)&&(this.mScratchMatrixCellIndexStack[++this.mScratchMatrixCellIndexStackTop]=n));for(var r=b.kFacing_N;r<=b.kFacing_W;r++){if(i=this.mPieceData.computeTransformId(t,e,r),0==(this.mPerTransformInfo[i]&o.kTransformInfo_didCheckIsTarget)&&r<=this.mMaxTargetFacing&&(!this.mTargetsRequireTouchDown||this.doesTransformTouchBelow(t,e,r))&&!this.doesTransformCollide(i)){this.mPerTransformInfo[i]=this.mPerTransformInfo[i]|o.kTransformInfo_isTarget,this.mTargetTransforms.push(i);for(var a=this.mPieceData.getPiece(this.mLivePieceTypeId,i),h=0,l=null,c=0;c<a.mNumMinos;c++){h=a.mMinosXY[c],this.mPerCellInfo[h]=this.mPerCellInfo[h]|o.kCellInfo_hasTargetTransforms,l=this.mPerCellTargetTransforms[h];for(var u=l.length,d=0;u>d;d++)if(l[d]==i){i=b.kInvalidTransformId;break}i!=b.kInvalidTransformId&&l.push(i)}}this.mPerTransformInfo[i]=this.mPerTransformInfo[i]|o.kTransformInfo_didCheckIsTarget}}var A=!0;return A}},{key:"getReachableTransformsForCell",value:function(t,e){if(this.doesCellCollide(t,e))return null;var i=b.computeGridIndex(t,e,this.mMatrixWidth);if(0!=(this.mPerCellInfo[i]&o.kCellInfo_didCheckTargetTransforms)&&0==(this.mPerCellInfo[i]&o.kCellInfo_hasTargetTransforms))return null;var n=this.mPerCellReachableTransforms[i];if(0!=(this.mPerCellInfo[i]&o.kCellInfo_didCheckReachableTransforms))return n;for(var s,r=this.mPerCellTargetTransforms[i],a=r.length,h=0;a>h;h++)s=r[h],this.isTransformReachable(s)&&(n.push(s),this.mPerCellInfo[i]=this.mPerCellInfo[i]|o.kCellInfo_hasReachableTransforms);var l=n.length;return l>0&&this.sortTransformsByEvaluationScore(n,0,l-1),this.mPerCellInfo[i]=this.mPerCellInfo[i]|o.kCellInfo_didCheckReachableTransforms,n}},{key:"isTransformReachable",value:function(t){if(0!=(this.mPerTransformInfo[t]&o.kTransformInfo_didCheckIsReachable))return 0!=(this.mPerTransformInfo[t]&o.kTransformInfo_isReachable);var e,i,n=0;if(0!=(this.mPerTransformInfo[t]&o.kTransformInfo_didCheckIsTarget)){if(0==(this.mPerTransformInfo[t]&o.kTransformInfo_isTarget))return this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_didCheckIsReachable,!1;for(e=this.mPieceData.getPiece(this.mLivePieceTypeId,t),i=0;i<e.mNumEquivalentTransformIds;i++)if(n=e.mEquivalentTransformIds[i],this.mPieceData.isTransformValid(this.mLivePieceTypeId,n)&&0!=(this.mPerTransformInfo[n]&o.kTransformInfo_didCheckIsReachable)&&0!=(this.mPerTransformInfo[n]&o.kTransformInfo_isReachable))return this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_didCheckIsReachable,!1}for(var s=0;s<this.mMatrixHeight;s++)for(var r=0;r<this.mMatrixWidth;r++)for(var a=b.kFacing_N;a<=b.kFacing_W;a++)n=this.mPieceData.computeTransformId(r,s,a),this.mPerTransformInfo[n]=this.mPerTransformInfo[n]&~o.kTransformInfo_isCheckingIsReachable;var h,l=!1,c=0,u=null,d=null;for(this.mScratchTransformStackTop=-1,this.mScratchTransformStack[++this.mScratchTransformStackTop]=this.mLivePieceStartingTransformId,this.mScratchActionStack[this.mScratchTransformStackTop]=b.kTransformAction_none,u=this.mScratchPerTransformActionStacks[this.mScratchTransformStackTop],this.pushActionsForTarget(this.mLivePieceStartingTransformId,t,u);this.mScratchTransformStackTop>=0;)if(n=this.mScratchTransformStack[this.mScratchTransformStackTop],this.mPerTransformInfo[n]=this.mPerTransformInfo[n]|o.kTransformInfo_isCheckingIsReachable,n==t){for(l=!0,this.mPerTransformInfo[n]=this.mPerTransformInfo[n]|o.kTransformInfo_isReachable,this.mReachableTransforms.push(t),d=this.mPerTransformPaths[n],d.length=0,i=0;i<=this.mScratchTransformStackTop;i++)d.push(this.mScratchActionStack[i]),d.push(this.mScratchTransformStack[i]);this.mScratchTransformStackTop=-1}else e=this.mPieceData.getPiece(this.mLivePieceTypeId,n),u=this.mScratchPerTransformActionStacks[this.mScratchTransformStackTop],u.length>0?(h=u[u.length-1],u.pop(),c=e.mPerTransformActionToTransformIds[h],this.mPieceData.isTransformValid(this.mLivePieceTypeId,c)&&(this.mScratchTransformStack[++this.mScratchTransformStackTop]=c,this.mScratchActionStack[this.mScratchTransformStackTop]=h,u=this.mScratchPerTransformActionStacks[this.mScratchTransformStackTop],this.pushActionsForTarget(c,t,u))):this.mScratchTransformStackTop--;return this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_didCheckIsReachable,this.mReachableTransformsAreClean=!1,l}},{key:"pushActionsForTarget",value:function(t,e,i){i.length=0;var n=this.mPieceData.getPiece(this.mLivePieceTypeId,t),s=this.mPieceData.computeXFromTransformId(t),r=b.computeFacingFromTransformId(t),o=this.mPieceData.computeXFromTransformId(e),a=b.computeFacingFromTransformId(e);r==a?(this.pushRotationActions(n,r,a,i),this.pushMoveActions(n,s,o,i)):(this.pushMoveActions(n,s,o,i),this.pushRotationActions(n,r,a,i))}},{key:"pushMoveActions",value:function(t,e,i,n){i>e?(this.pushActionIfIsValid(t,b.kTransformAction_moveDown,n),this.pushActionIfIsValid(t,b.kTransformAction_moveLeft,n),this.pushActionIfIsValid(t,b.kTransformAction_moveRight,n)):e>i?(this.pushActionIfIsValid(t,b.kTransformAction_moveDown,n),this.pushActionIfIsValid(t,b.kTransformAction_moveRight,n),this.pushActionIfIsValid(t,b.kTransformAction_moveLeft,n)):(this.pushActionIfIsValid(t,b.kTransformAction_moveLeft,n),this.pushActionIfIsValid(t,b.kTransformAction_moveRight,n),this.pushActionIfIsValid(t,b.kTransformAction_moveDown,n))}},{key:"pushRotationActions",value:function(t,e,i,n){b.isFacingRotationClockwise(e,i)?(this.pushActionIfIsValid(t,this.findFirstValidRotationAction(t,!1),n),this.pushActionIfIsValid(t,this.findFirstValidRotationAction(t,!0),n)):(this.pushActionIfIsValid(t,this.findFirstValidRotationAction(t,!0),n),this.pushActionIfIsValid(t,this.findFirstValidRotationAction(t,!1),n))}},{key:"findFirstValidRotationAction",value:function(t,e){var i,n,s;if(e){for(n=b.kTransformAction_rotateCWPoint1+t.mPieceDefinition.getNumRotationPointSets()-1,i=b.kTransformAction_rotateCWPoint1;n>=i;i++)if(s=t.mPerTransformActionToTransformIds[i],this.mPieceData.isTransformValid(this.mLivePieceTypeId,s)&&!this.doesTransformCollide(s))return i}else for(n=b.kTransformAction_rotateCCWPoint1+t.mPieceDefinition.getNumRotationPointSets()-1,i=b.kTransformAction_rotateCCWPoint1;n>=i;i++)if(s=t.mPerTransformActionToTransformIds[i],this.mPieceData.isTransformValid(this.mLivePieceTypeId,s)&&!this.doesTransformCollide(s))return i;return b.kTransformAction_invalid}},{key:"pushActionIfIsValid",value:function(t,e,i){if(e!=b.kTransformAction_invalid){var n=t.mPerTransformActionToTransformIds[e];this.mPieceData.isTransformValid(this.mLivePieceTypeId,n)&&0==(this.mPerTransformInfo[n]&o.kTransformInfo_isCheckingIsReachable)&&!this.doesTransformCollide(n)&&i.push(e)}}},{key:"sortTransformsByEvaluationScore",value:function(t,e,i){for(var n,s=e,r=i,o=this.getTransformEvaluationScore(t[~~((e+i)/2)]);r>=s;){for(;r>=s&&this.getTransformEvaluationScore(t[s])>o;)s++;for(;r>=s&&this.getTransformEvaluationScore(t[r])<o;)r--;r>=s&&(n=t[s],t[s]=t[r],t[r]=n,s++,r--)}r>e&&this.sortTransformsByEvaluationScore(t,e,r),i>s&&this.sortTransformsByEvaluationScore(t,s,i)}},{key:"getTransformEvaluationScore",value:function(t){if(0!=(this.mPerTransformInfo[t]&o.kTransformInfo_didEvaluationScore))return this.mPerTransformEvaluationScore[t];var e=0,i=this.mPieceData.getPiece(this.mLivePieceTypeId,t),n=this.getNumCompleteLinesForPiece(i);n>0&&(e+=100,e+=20*n);var s=this.getNumTouchingSurfacesForPiece(i);s>0&&(e+=10*s),this.canPieceSlide(i)||(e+=10);var r=this.getCoveredWallsForPiece(i);switch(r>0&&(e+=-100,e+=-10*r),i.mFacing){case b.kFacing_N:case b.kFacing_S:e+=0}var a=this.getISlotBuildsForPiece(i,!1);a>0&&(0==n&&(e+=100),e+=20*a);var h=0;return 3>n&&(h=this.getISlotBreaksForPiece(i,!0),h>0&&(e+=-100)),e-=0*i.mMaxMinoY,this.mPerTransformInfo[t]=this.mPerTransformInfo[t]|o.kTransformInfo_didEvaluationScore,this.mPerTransformEvaluationScore[t]=e,e}},{key:"getNumCompleteLinesForPiece",value:function(t){for(var e,i=0,n=t.mMinMinoY;n<=t.mMaxMinoY;n++)e=n-t.mY+a.kMinosBitGridYOffset,(this.mMatrixMinosBitGrid[n]|t.mMinosBitGrid[e])==this.mMatrixMinosBitGridFullRow&&i++;return i}},{key:"getNumTouchingSurfacesForPiece",value:function(t){for(var e,i,n,s=0,r=t.mNumMinos,o=0;r>o;o++)e=t.mMinosXY[o],i=e%this.mMatrixWidth,n=~~(e/this.mMatrixWidth),this.doesCellCollide(i,n-1)&&s++;return s}},{key:"canPieceSlide",value:function(t){for(var e,i,n,s=!1,r=!1,o=t.mNumMinos,a=0;o>a;a++)if(e=t.mMinosXY[a],i=e%this.mMatrixWidth,n=~~(e/this.mMatrixWidth),this.doesCellCollide(i+1,n)&&(s=!0),this.doesCellCollide(i-1,n)&&(r=!0),s&&r)return!1;return!0}},{key:"getCoveredWallsForPiece",value:function(t){var e,i,n,s,o=0,a=t.mNumMinos;for(e=0;a>e;e++)i=t.mMinosXY[e],this.mMatrixMinos[i]=this.mMatrixMinos[i]|r.kMinoValueMask_exists;for(e=0;a>e;e++)i=t.mMinosXY[e],n=i%this.mMatrixWidth,s=~~(i/this.mMatrixWidth),s--,this.doesCellCollide(n,s)||(this.doesCellCollide(n-1,s)&&o++,this.doesCellCollide(n+1,s)&&o++);for(e=0;a>e;e++)i=t.mMinosXY[e],this.mMatrixMinos[i]=this.mMatrixMinos[i]&~r.kMinoValueMask_exists;return o}},{key:"getISlotBreaksForPiece",value:function(t,e){var i=this.getISlotType(t);if(i==o.kISlotType_none)return 0;for(var n,s,r,h=0,l=t.mPieceDefinition.getTypeId()==b.kPieceType_I&&(t.mFacing==b.kFacing_N||t.mFacing==b.kFacing_S),c=t.mMinMinoY;c<=t.mMaxMinoY;c++)if(r=c-t.mY+a.kMinosBitGridYOffset,n=this.mMatrixMinosBitGrid[c],s=c>0?this.mMatrixMinosBitGrid[c-1]:this.mMatrixMinosBitGridFullRow,c>t.mMinMinoY&&(s|=t.mMinosBitGrid[r-1]),this.isRowISlot(n,e,i,s)){if(l&&c==t.mMaxMinoY)return 0;(n|t.mMinosBitGrid[r])==this.mMatrixMinosBitGridFullRow&&h++}return h}},{key:"getISlotBuildsForPiece",value:function(t,e){var i=this.getISlotType(t);if(i==o.kISlotType_none)return 0;for(var n,s,r,h=0,l=t.mMinMinoY;l<=t.mMaxMinoY;l++)r=l-t.mY+a.kMinosBitGridYOffset,n=this.mMatrixMinosBitGrid[l]|t.mMinosBitGrid[r],s=l>0?this.mMatrixMinosBitGrid[l-1]:this.mMatrixMinosBitGridFullRow,l>t.mMinMinoY&&(s|=t.mMinosBitGrid[r-1]),this.isRowISlot(n,e,i,s)&&h++;return h}},{key:"getISlotType",value:function(t){return t.mMaxMinoX>=this.mMatrixWidth-2?o.kISlotType_right:t.mMinMinoX<=1?o.kISlotType_left:o.kISlotType_none}},{key:"isRowISlot",value:function(t,e,i,n){switch(i){case o.kISlotType_right:return n!=this.mMatrixMinosBitGridFullRow&&n!=this.mMatrixMinosBitGridISlotRightRow&&0==(n&1<<this.mMatrixWidth-1)?!1:e?(t&this.mMatrixMinosBitGridISlotRightEdgeRowMask)==this.mMatrixMinosBitGridISlotRightEdgeRow:t==this.mMatrixMinosBitGridISlotRightRow;case o.kISlotType_left:return n!=this.mMatrixMinosBitGridFullRow&&n!=this.mMatrixMinosBitGridISlotLeftRow&&0==(1&n)?!1:e?(t&this.mMatrixMinosBitGridISlotLeftEdgeRowMask)==this.mMatrixMinosBitGridISlotLeftEdgeRow:t==this.mMatrixMinosBitGridISlotLeftRow}return!1}},{key:"getMoveAction",value:function(t,e){if(b.computeFacingFromTransformId(t)!=b.computeFacingFromTransformId(e))return b.kTransformAction_invalid;var i=this.mPieceData.getPiece(this.mLivePieceTypeId,t);if(i.mPerTransformActionToTransformIds[b.kTransformAction_moveDown]==e)return b.kTransformAction_moveDown;if(i.mPerTransformActionToTransformIds[b.kTransformAction_moveRight]==e)return b.kTransformAction_moveRight;if(i.mPerTransformActionToTransformIds[b.kTransformAction_moveLeft]==e)return b.kTransformAction_moveLeft;var n=i.mPerTransformActionToTransformIds[b.kTransformAction_moveDown];return i=this.mPieceData.getPiece(this.mLivePieceTypeId,n),i&&this.mPieceData.areTransformsEquivalent(this.mLivePieceTypeId,n,e)?b.kTransformAction_moveDown:b.kTransformAction_invalid}},{key:"getHighestSurfaceYInColumn",value:function(t){for(var e=1<<t,i=this.mMatrixHeight-1;i>=0;i--)if(0!=(this.mMatrixMinosBitGrid[i]&e))return i+1;return 0}},{key:"destroy",value:function(){if(!this.isDestroyed()){var t=this.mMatrixWidth*this.mMatrixHeight,e=0,i=null;for(e=0;t>e;e++)i=this.mPerCellTargetTransforms[e],i&&(i=null),i=this.mPerCellReachableTransforms[e],i&&(i=null);var n=this.mPieceData.getMaxNumTransforms();for(e=0;n>e;e++)i=this.mPerTransformPaths[e],i&&(i=null),i=this.mScratchPerTransformActionStacks[e],i&&(i=null);u(Object.getPrototypeOf(o.prototype),"destroy",this).call(this)}}}]),o}(r);d.kCellInfo_didCheckTargetTransforms=2,d.kCellInfo_hasTargetTransforms=4,d.kCellInfo_didCheckReachableTransforms=8,d.kCellInfo_hasReachableTransforms=16,d.kTransformInfo_didCheckIsTarget=2,d.kTransformInfo_isTarget=4,d.kTransformInfo_isCheckingIsReachable=8,d.kTransformInfo_didCheckIsReachable=16,d.kTransformInfo_isReachable=32,d.kTransformInfo_didCheckDoesCollide=64,d.kTransformInfo_doesCollide=128,d.kTransformInfo_didEvaluationScore=256,d.kMinTransformEvaluationScore=-1e6,d.kISlotType_none=0,d.kISlotType_right=1,d.kISlotType_left=2;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),A=n.TetSmartControlController=function(){function e(i,n,s,r){t(this,e),this.mInputMgrs=new Array,this.mPieceData=r,this.mMatrixWidth=i,this.mMatrixHeight=n,this.mMatrixVisibleHeight=s,this.mDirectInputMgr=null,this.mSmartInputMgr=null,this.mGestureInputMgr=null,this.mEnableAutomaticInputTypeSwitching=!0,this.mActiveInputMgr=null,this.mIsLivePieceControllable=!1,this.mIsSoftDropOn=!1,this.mIsDestroyed=!1}return s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"enableInputType",value:function(t){if(!this.getInputMgr(t))switch(t){case e.kInputType_direct:this.mDirectInputMgr=new f(this,this.mPieceData,this.mMatrixWidth,this.mMatrixHeight,this.mMatrixVisibleHeight),this.mInputMgrs.push(this.mDirectInputMgr);break;case e.kInputType_smart:this.mSmartInputMgr=new _(this,this.mPieceData,this.mMatrixWidth,this.mMatrixHeight,this.mMatrixVisibleHeight),this.mInputMgrs.push(this.mSmartInputMgr);break;case e.kInputType_gesture:this.mGestureInputMgr=new g(this,this.mPieceData,this.mMatrixWidth,this.mMatrixHeight,this.mMatrixVisibleHeight),this.mInputMgrs.push(this.mGestureInputMgr)}}},{key:"getActiveInputType",value:function(){return this.mActiveInputMgr?this.mActiveInputMgr.getInputType():0}},{key:"setActiveInputType",value:function(t){this.setActiveInputMgr(this.getInputMgr(t))}},{key:"setEnableAutomaticInputTypeSwitching",value:function(t){this.mEnableAutomaticInputTypeSwitching=t}},{key:"getDirectInputMgr",value:function(){return this.mDirectInputMgr}},{key:"getSmartInputMgr",value:function(){return this.mSmartInputMgr}},{key:"getGestureInputMgr",value:function(){return this.mGestureInputMgr}},{key:"processTime",value:function(){this.mActiveInputMgr&&this.mActiveInputMgr.processTime()}},{key:"handleInputPositionChanged",value:function(t,e,i){if(!this.TetSmartControlController_isSmartControlActive())return!1;t=this.transformInputIdForActiveInputMgr(t),this.updateActiveInputMgr(t);var n=this.getInputMgrForInputId(t);if(n){var s=this._getGameState().getLivePieceCurrentTransform();return n.handleInputPositionChanged(t,e,i),s!=this._getGameState().getLivePieceCurrentTransform()}return!1}},{key:"handleInputIsOn",value:function(t,e,i){if(!this.TetSmartControlController_isSmartControlActive())return!1;t=this.transformInputIdForActiveInputMgr(t),this.updateActiveInputMgr(t);var n=this.getInputMgrForInputId(t);if(n){var s=this._getGameState().getLivePieceCurrentTransform();return n.handleInputIsOn(t,e,i),s!=this._getGameState().getLivePieceCurrentTransform()}return!1}},{key:"handleInputIsOff",value:function(t,e,i){if(!this.TetSmartControlController_isSmartControlActive())return!1;t=this.transformInputIdForActiveInputMgr(t),this.updateActiveInputMgr(t);var n=this.getInputMgrForInputId(t);if(n){var s=this._getGameState().getLivePieceCurrentTransform();return n.handleInputIsOff(t,e,i),s!=this._getGameState().getLivePieceCurrentTransform()}return!1}},{key:"handleInputOnIsCancelled",value:function(t){if(this.TetSmartControlController_isSmartControlActive()){t=this.transformInputIdForActiveInputMgr(t),this.updateActiveInputMgr(t);var e=this.getInputMgrForInputId(t);e&&e.handleInputOnIsCancelled(t)}}},{key:"isInputOn",value:function(t){var e=this.getInputMgrForInputId(t);return e?e.isInputOn(t):!1}},{key:"startEvaluationForNewLivePiece",value:function(){for(var t=this.mInputMgrs.length,e=0;t>e;e++){var i=this.mInputMgrs[e];i.startEvaluationForNewLivePiece()}}},{key:"processEvaluationForNewLivePiece",value:function(){for(var t=!0,e=this.mInputMgrs.length,i=0;e>i;i++){var n=this.mInputMgrs[i];n.processEvaluationForNewLivePiece()||(t=!1)}return t}},{key:"handleLivePieceDidActivate",value:function(){this.mIsLivePieceControllable=!0;for(var t=this.mInputMgrs.length,e=0;t>e;e++){var i=this.mInputMgrs[e];i.handleLivePieceDidActivate()}}},{key:"handleLivePieceDidTouchDown",value:function(){for(var t=this.mInputMgrs.length,e=0;t>e;e++){var i=this.mInputMgrs[e];i.handleLivePieceDidTouchDown()}}},{key:"handleLivePieceDidDeactivate",value:function(){this.mIsLivePieceControllable=!1;for(var t=this.mInputMgrs.length,e=0;t>e;e++){var i=this.mInputMgrs[e];i.handleLivePieceDidDeactivate()}}},{key:"isSoftDropOn",value:function(){return this.mIsSoftDropOn}},{key:"_getGameState",value:function(){return this.TetSmartControlController_getGameState()}},{key:"_getTimeMSEC",value:function(){return 2147483647&this.TetSmartControlController_getTimeMSEC()}},{key:"_getTimeSEC_FXPT",value:function(){return~~(b.FXPTFromInt(this._getTimeMSEC())/1e3)}},{key:"_isSmartControlActive",value:function(){return this.TetSmartControlController_isSmartControlActive()}},{key:"_performControlAction",value:function(t,e,i){switch(t){case b.kControlAction_moveTarget:if(!this._isLivePieceControllable())return;break;case b.kControlAction_selectTarget:if(!this._isLivePieceControllable())return;this.mIsLivePieceControllable=!1;break;case b.kControlAction_startSoftDrop:if(this.mIsSoftDropOn)return;this.mIsSoftDropOn=!0;break;case b.kControlAction_stopSoftDrop:if(!this.mIsSoftDropOn)return;this.mIsSoftDropOn=!1;break;default:t==b.kControlAction_hardDrop&&this._isLivePieceControllable()&&(this.mIsLivePieceControllable=!1)}this.TetSmartControlController_performControlAction(t,e,i)}},{key:"_isLivePieceControllable",value:function(){return this.mIsLivePieceControllable&&this.TetSmartControlController_isSmartControlActive()}},{key:"getInputMgr",value:function(t){switch(t){case f.kInputType:return this.mDirectInputMgr;case _.kInputType:return this.mSmartInputMgr;case g.kInputType:return this.mGestureInputMgr;default:return null}}},{key:"getInputMgrForInputId",value:function(t){var e=m.getInputTypeFromInputId(t);return this.getInputMgr(e)}},{key:"setActiveInputMgr",value:function(t){t&&this.mActiveInputMgr!=t&&(this.mActiveInputMgr&&this.mActiveInputMgr.setIsActive(!1),this.mActiveInputMgr=t,this.mActiveInputMgr.setIsActive(!0))}},{key:"updateActiveInputMgr",value:function(t){if(this.mEnableAutomaticInputTypeSwitching){var e=this.getInputMgrForInputId(t);e&&this.mActiveInputMgr!=e&&this.setActiveInputMgr(e)}}},{key:"transformInputIdForActiveInputMgr",value:function(t){if(this.mActiveInputMgr)switch(this.mActiveInputMgr.getInputType()){case f.kInputType:break;case _.kInputType:switch(t){case f.kInputId_hardDrop:return _.kInputId_selectTarget;case f.kInputId_hold:return _.kInputId_hold}break;case g.kInputType:switch(t){case f.kInputId_hold:return g.kInputId_hold}}return t}},{key:"destroy",value:function(){this.isDestroyed()||(this.mInputMgrs.length=0,this.mSmartInputMgr&&(this.mSmartInputMgr.destroy(),this.mSmartInputMgr&&(this.mSmartInputMgr=null)),this.mDirectInputMgr&&(this.mDirectInputMgr.destroy(),this.mDirectInputMgr&&(this.mDirectInputMgr=null)),this.mGestureInputMgr&&(this.mGestureInputMgr.destroy(),this.mGestureInputMgr&&(this.mGestureInputMgr=null)),this.mIsDestroyed=!0)}},{key:"TetSmartControlController_getGameState",value:function(){return null}},{key:"TetSmartControlController_getTimeMSEC",value:function(){return 0}},{key:"TetSmartControlController_isSmartControlActive",value:function(){return!1}},{key:"TetSmartControlController_performControlAction",value:function(t,e,i){}}]),e}();A.kInputType_direct=1,A.kInputType_smart=2,A.kInputType_gesture=3,A.kFullCellSize_FXPT=1e3,A.kHalfCellSize_FXPT=500;var p=n.TetSmartControlInput=function S(e){t(this,S),this.mInputId=e,this.mIsOn=!1,this.mX_FXPT=0,this.mY_FXPT=0},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),m=n.TetSmartControlInputMgr=function(){function e(i,n,s,r,o,a,h){t(this,e),this.mInputs=new Array,this.mIsDestroyed=!1,this.mInputType=i,this.mNumInputs=n;for(var l=0;n>l;l++){var c=e.getInputId(i,l),u=new p(c);this.mInputs.push(u)}this.mController=s,this.mPieceData=r,this.mMatrixWidth=o,this.mMatrixHeight=a,this.mMatrixVisibleHeight=h,this.mIsActive=!1,this.mDidProcessEvaluationForNewLivePiece=!1}return s(e,null,[{key:"getInputId",value:function(t,e){return t<<8|e+1}},{key:"getInputTypeFromInputId",value:function(t){return t>>>8&255}},{key:"getInputIndexFromInputId",value:function(t){return(255&t)-1}}]),s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"getInputType",value:function(){return this.mInputType}},{key:"isActive",value:function(){return this.mIsActive}},{key:"setIsActive",value:function(t){this.mIsActive=t,this.TetSmartControlInputMgr_setIsActive(t)}},{key:"processTime",value:function(){this.TetSmartControlInputMgr_processTime()}},{key:"handleInputPositionChanged",value:function(t,e,i){var n=this.getInput(t);n&&(n.mX_FXPT=e,n.mY_FXPT=i,this.mIsActive&&this.TetSmartControlInputMgr_handleInputPositionChanged(n))}},{key:"handleInputIsOn",value:function(t,e,i){var n=this.getInput(t);n&&(n.mIsOn||(n.mIsOn=!0,n.mX_FXPT=e,n.mY_FXPT=i,this.mIsActive&&this.TetSmartControlInputMgr_handleInputIsOn(n)))}},{key:"handleInputIsOff",value:function(t,e,i){var n=this.getInput(t);n&&n.mIsOn&&(n.mIsOn=!1,n.mX_FXPT=e,n.mY_FXPT=i,this.mIsActive&&this.TetSmartControlInputMgr_handleInputIsOff(n))}},{key:"handleInputOnIsCancelled",value:function(t){var e=this.getInput(t);e&&e.mIsOn&&(e.mIsOn=!1,this.mIsActive&&this.TetSmartControlInputMgr_handleInputOnIsCancelled(e))}},{key:"isInputOn",value:function(t){var e=this.getInput(t);return e?e.mIsOn:!1}},{key:"startEvaluationForNewLivePiece",value:function(){this.mDidProcessEvaluationForNewLivePiece=!1,this.TetSmartControlInputMgr_startEvaluationForNewLivePiece()}},{key:"processEvaluationForNewLivePiece",value:function(){return this.mDidProcessEvaluationForNewLivePiece||(this.mDidProcessEvaluationForNewLivePiece=this.TetSmartControlInputMgr_processEvaluationForNewLivePiece()),this.mDidProcessEvaluationForNewLivePiece}},{key:"handleLivePieceDidActivate",value:function(){this.TetSmartControlInputMgr_handleLivePieceDidActivate()}},{key:"handleLivePieceDidTouchDown",value:function(){this.TetSmartControlInputMgr_handleLivePieceDidTouchDown()}},{key:"handleLivePieceDidDeactivate",value:function(){this.TetSmartControlInputMgr_handleLivePieceDidDeactivate()}},{key:"getInput",value:function(t){var i=e.getInputIndexFromInputId(t);return i>=0&&i<this.mNumInputs?this.mInputs[i]:null}},{key:"getController",value:function(){return this.mController}},{key:"getPieceData",value:function(){return this.mPieceData}},{key:"getMatrixWidth",value:function(){return this.mMatrixWidth}},{key:"getMatrixHeight",value:function(){return this.mMatrixHeight}},{key:"getMatrixVisibleHeight",value:function(){return this.mMatrixVisibleHeight}},{key:"isLivePieceControllable",value:function(){return this.mIsActive&&this.mController._isLivePieceControllable()}},{key:"destroy",value:function(){if(!this.isDestroyed()){for(var t=0;t<this.mNumInputs;t++){var e=this.mInputs[t];e&&(e=null)}this.mIsDestroyed=!0}}},{key:"TetSmartControlInputMgr_setIsActive",value:function(t){}},{key:"TetSmartControlInputMgr_processTime",value:function(){}},{key:"TetSmartControlInputMgr_handleInputPositionChanged",value:function(t){}},{key:"TetSmartControlInputMgr_handleInputIsOn",value:function(t){}},{key:"TetSmartControlInputMgr_handleInputIsOff",value:function(t){}},{key:"TetSmartControlInputMgr_handleInputOnIsCancelled",value:function(t){}},{key:"TetSmartControlInputMgr_startEvaluationForNewLivePiece",value:function(){}},{key:"TetSmartControlInputMgr_processEvaluationForNewLivePiece",value:function(){return!0}},{key:"TetSmartControlInputMgr_handleLivePieceDidActivate",value:function(){}},{key:"TetSmartControlInputMgr_handleLivePieceDidTouchDown",value:function(){}},{key:"TetSmartControlInputMgr_handleLivePieceDidDeactivate",value:function(){}}]),e}(),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function P(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:P(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},f=n.TetSmartControlDirectInputMgr=function(n){function r(i,n,s,o,a){return t(this,r),e(this,Object.getPrototypeOf(r).call(this,r.kInputType,r.kNumInputIds,i,n,s,o,a))}return i(r,n),s(r,[{key:"destroy",value:function(){this.isDestroyed()||u(Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"TetSmartControlInputMgr_setIsActive",value:function(t){t&&this.getController()._performControlAction(b.kControlAction_updateGhost,null,null)}},{key:"TetSmartControlInputMgr_processTime",value:function(){}},{key:"TetSmartControlInputMgr_handleInputPositionChanged",value:function(t){}},{key:"TetSmartControlInputMgr_handleInputIsOn",value:function(t){switch(t.mInputId){case r.kInputId_moveLeft:this.getController()._performControlAction(b.kControlAction_moveLeft,null,null),t.mIsOn=!1;break;case r.kInputId_moveRight:this.getController()._performControlAction(b.kControlAction_moveRight,null,null),t.mIsOn=!1;break;case r.kInputId_rotateCW:this.getController()._performControlAction(b.kControlAction_superRotateCW,null,null);break;case r.kInputId_rotateCCW:this.getController()._performControlAction(b.kControlAction_superRotateCCW,null,null);break;case r.kInputId_softDrop:this.getController()._performControlAction(b.kControlAction_startSoftDrop,null,null);break;case r.kInputId_hardDrop:this.getController()._performControlAction(b.kControlAction_hardDrop,null,null);break;case r.kInputId_hold:this.getController()._performControlAction(b.kControlAction_hold,null,null)}}},{key:"TetSmartControlInputMgr_handleInputIsOff",value:function(t){switch(t.mInputId){case r.kInputId_softDrop:this.getController()._performControlAction(b.kControlAction_stopSoftDrop,null,null)}}},{key:"TetSmartControlInputMgr_handleInputOnIsCancelled",value:function(t){switch(t.mInputId){case r.kInputId_softDrop:this.getController()._performControlAction(b.kControlAction_stopSoftDrop,null,null)}}},{key:"TetSmartControlInputMgr_startEvaluationForNewLivePiece",value:function(){}},{key:"TetSmartControlInputMgr_processEvaluationForNewLivePiece",value:function(){return!0}},{key:"TetSmartControlInputMgr_handleLivePieceDidActivate",value:function(){}},{key:"TetSmartControlInputMgr_handleLivePieceDidDeactivate",value:function(){}}]),r}(m);f.kInputType=1,f.kInputId_moveLeft=257,f.kInputId_moveRight=258,f.kInputId_rotateCW=259,f.kInputId_rotateCCW=260,f.kInputId_softDrop=261,f.kInputId_hardDrop=262,f.kInputId_hold=263,f.kNumInputIds=7;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function I(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:I(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},g=n.TetSmartControlGestureInputMgr=function(n){function r(i,n,s,o,a){t(this,r);var h=e(this,Object.getPrototypeOf(r).call(this,r.kInputType,r.kNumInputIds,i,n,s,o,a));return h.mMaxRotationTapDistance_FXPT=1399,h.mEnableCCWRotation=!0,h.mMoveLRDragDistance_FXPT=1400,h.mMinSoftDropDragDistanceY_FXPT=2e3,h.mMinSoftDropDragVelocityY_FXPT=4e3,h.mMinStopSoftDropDragDistanceY_FXPT=1e3,h.mMinStopSoftDropDragVelocityY_FXPT=1e3,h.mMinHardDropDragDistanceY_FXPT=1500,h.mMinHardDropDragVelocityY_FXPT=8e3,h.mMinHoldDragDistanceY_FXPT=1500,h.mMinHoldDragVelocityY_FXPT=8e3,h.mVelocitySmoothingWeight_FXPT=900,h.mMatrixCenterX_FXPT=~~(b.FXPTFromInt(s)/2),h.mPointerDownX_FXPT=0,h.mPointerDownY_FXPT=0,h.mPointerDragPrevX_FXPT=0,h.mPointerDragPrevY_FXPT=0,
h.mPrevVelocityProcessTimeSEC_FXPT=0,h.mAvailableVelocityProcessTimeSEC_FXPT=0,h.mPointerFrameVelocityX_FXPT=0,h.mPointerFrameVelocityY_FXPT=0,h.mPointerSmoothedVelocityX_FXPT=0,h.mPointerSmoothedVelocityY_FXPT=0,h.mCurrentMoveLRDragDistanceX_FXPT=0,h.mWasPrevRotationCCW=!1,h.mIsRotationTapValid=!1,h.mIsSoftDropInputOn=!1,h}return i(r,n),s(r,[{key:"resetPointerTracking",value:function(t){b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::resetPointerTracking");var e=this.getInput(r.kInputId_pointer);this.mPointerDownX_FXPT=e.mX_FXPT,this.mPointerDownY_FXPT=e.mY_FXPT,this.mPointerDragPrevX_FXPT=e.mX_FXPT,this.mPointerDragPrevY_FXPT=e.mY_FXPT,this.mPrevVelocityProcessTimeSEC_FXPT=this.getController()._getTimeSEC_FXPT(),this.mAvailableVelocityProcessTimeSEC_FXPT=0,this.mPointerFrameVelocityX_FXPT=0,this.mPointerFrameVelocityY_FXPT=0,this.mPointerSmoothedVelocityX_FXPT=0,this.mPointerSmoothedVelocityY_FXPT=0,this.mCurrentMoveLRDragDistanceX_FXPT=0,this.mIsRotationTapValid=t}},{key:"updateVelocities",value:function(){var t=this.getController()._getTimeSEC_FXPT(),e=t-this.mPrevVelocityProcessTimeSEC_FXPT;if(this.mPrevVelocityProcessTimeSEC_FXPT=t,e>0){this.mAvailableVelocityProcessTimeSEC_FXPT+=e;var i=this.getInput(r.kInputId_pointer);this.mPointerFrameVelocityX_FXPT=b.FXPTDivideXX(i.mX_FXPT-this.mPointerDragPrevX_FXPT,e),this.mPointerFrameVelocityY_FXPT=b.FXPTDivideXX(i.mY_FXPT-this.mPointerDragPrevY_FXPT,e);for(var n=10;this.mAvailableVelocityProcessTimeSEC_FXPT>n;)this.mPointerSmoothedVelocityX_FXPT=b.FXPTSmoothXXX(this.mPointerSmoothedVelocityX_FXPT,this.mPointerFrameVelocityX_FXPT,this.mVelocitySmoothingWeight_FXPT),this.mPointerSmoothedVelocityY_FXPT=b.FXPTSmoothXXX(this.mPointerSmoothedVelocityY_FXPT,this.mPointerFrameVelocityY_FXPT,this.mVelocitySmoothingWeight_FXPT),this.mAvailableVelocityProcessTimeSEC_FXPT-=n}}},{key:"updateMoveLeftRight",value:function(){this.getInput(r.kInputId_pointer).mIsOn&&(this.mCurrentMoveLRDragDistanceX_FXPT>=0?this.mCurrentMoveLRDragDistanceX_FXPT:-this.mCurrentMoveLRDragDistanceX_FXPT)>=this.mMoveLRDragDistance_FXPT&&(this.mCurrentMoveLRDragDistanceX_FXPT>0?(b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::updateMoveLeftRight: MOVE RIGHT"),this.getController()._performControlAction(b.kControlAction_moveRight,null,null),this.mCurrentMoveLRDragDistanceX_FXPT-=this.mMoveLRDragDistance_FXPT):(b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::updateMoveLeftRight: MOVE LEFT"),this.getController()._performControlAction(b.kControlAction_moveLeft,null,null),this.mCurrentMoveLRDragDistanceX_FXPT+=this.mMoveLRDragDistance_FXPT))}},{key:"isVerticalDragValid",value:function(t,e,i,n,s){return(e>=0?e:-e)>(t>=0?t:-t)&&(n>=0?n:-n)>=s&&(e>=0?e:-e)>=i}},{key:"startSoftDrop",value:function(){this.isActive()&&(this.mIsSoftDropInputOn=!0,this.getController().isSoftDropOn()||this.getController()._performControlAction(b.kControlAction_startSoftDrop,null,null))}},{key:"suspendSoftDrop",value:function(){this.isActive()&&this.getController().isSoftDropOn()&&this.getController()._performControlAction(b.kControlAction_stopSoftDrop,null,null)}},{key:"stopSoftDrop",value:function(){this.isActive()&&(this.mIsSoftDropInputOn=!1,this.getController().isSoftDropOn()&&this.getController()._performControlAction(b.kControlAction_stopSoftDrop,null,null))}},{key:"checkSoftDrop",value:function(){this.isActive()&&(this.getInput(r.kInputId_pointer).mIsOn?this.mIsSoftDropInputOn&&this.startSoftDrop():this.stopSoftDrop())}},{key:"performHold",value:function(){this.isActive()&&this.getController()._performControlAction(b.kControlAction_hold,null,null)}},{key:"destroy",value:function(){this.isDestroyed()||u(Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"TetSmartControlInputMgr_setIsActive",value:function(t){t&&this.getController()._performControlAction(b.kControlAction_updateGhost,null,null)}},{key:"TetSmartControlInputMgr_processTime",value:function(){this.updateVelocities(),this.updateMoveLeftRight()}},{key:"TetSmartControlInputMgr_handleInputPositionChanged",value:function(t){switch(t.mInputId){case r.kInputId_pointer:if(!t.mIsOn)return;if(this.updateVelocities(),this.mIsRotationTapValid&&(this.mIsRotationTapValid=(t.mX_FXPT-this.mPointerDownX_FXPT>=0?t.mX_FXPT-this.mPointerDownX_FXPT:-(t.mX_FXPT-this.mPointerDownX_FXPT))<=this.mMaxRotationTapDistance_FXPT&&(t.mY_FXPT-this.mPointerDownY_FXPT>=0?t.mY_FXPT-this.mPointerDownY_FXPT:-(t.mY_FXPT-this.mPointerDownY_FXPT))<=this.mMaxRotationTapDistance_FXPT),(this.mPointerSmoothedVelocityX_FXPT>=0?this.mPointerSmoothedVelocityX_FXPT:-this.mPointerSmoothedVelocityX_FXPT)>(this.mPointerSmoothedVelocityY_FXPT>=0?this.mPointerSmoothedVelocityY_FXPT:-this.mPointerSmoothedVelocityY_FXPT)){var e=t.mX_FXPT-this.mPointerDragPrevX_FXPT;this.mCurrentMoveLRDragDistanceX_FXPT+=e,b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::TetSmartControlInputMgr_handleInputPositionChanged: x="+t.mX_FXPT/b.kFXPTScale+" dx-abs="+(t.mX_FXPT-this.mPointerDownX_FXPT)/b.kFXPTScale+" dx-rel="+e/b.kFXPTScale+" currentMoveLRDragDistanceX= "+this.mCurrentMoveLRDragDistanceX_FXPT/b.kFXPTScale),this.updateMoveLeftRight()}else b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::TetSmartControlInputMgr_handleInputPositionChanged: x="+t.mX_FXPT/b.kFXPTScale+" dx-abs="+(t.mX_FXPT-this.mPointerDownX_FXPT)/b.kFXPTScale);this.mPointerSmoothedVelocityY_FXPT<0?!this.getController().isSoftDropOn()&&this.isVerticalDragValid(this.mPointerSmoothedVelocityX_FXPT,this.mPointerSmoothedVelocityY_FXPT,this.mMinSoftDropDragVelocityY_FXPT,t.mY_FXPT-this.mPointerDownY_FXPT,this.mMinSoftDropDragDistanceY_FXPT)&&(this.mCurrentMoveLRDragDistanceX_FXPT=0,this.startSoftDrop()):this.mPointerSmoothedVelocityY_FXPT>0&&this.getController().isSoftDropOn()&&this.isVerticalDragValid(this.mPointerSmoothedVelocityX_FXPT,this.mPointerSmoothedVelocityY_FXPT,this.mMinStopSoftDropDragVelocityY_FXPT,t.mY_FXPT-this.mPointerDownY_FXPT,this.mMinStopSoftDropDragDistanceY_FXPT)&&(this.mCurrentMoveLRDragDistanceX_FXPT=0,this.stopSoftDrop()),this.mPointerDragPrevX_FXPT=t.mX_FXPT,this.mPointerDragPrevY_FXPT=t.mY_FXPT;break;case r.kInputId_hold:}}},{key:"TetSmartControlInputMgr_handleInputIsOn",value:function(t){switch(t.mInputId){case r.kInputId_pointer:b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::TetSmartControlInputMgr_handleInputIsOn: x="+t.mX_FXPT/b.kFXPTScale),this.resetPointerTracking(!0);break;case r.kInputId_hold:this.performHold()}}},{key:"TetSmartControlInputMgr_handleInputIsOff",value:function(t){switch(t.mInputId){case r.kInputId_pointer:if(b.sIsDebugModeOn&&console.log("TetSmartControlGestureInputMgr::TetSmartControlInputMgr_handleInputIsOff: x="+t.mX_FXPT/b.kFXPTScale+" dx="+(t.mX_FXPT-this.mPointerDownX_FXPT)/b.kFXPTScale),this.stopSoftDrop(),(t.mX_FXPT-this.mPointerDownX_FXPT>=0?t.mX_FXPT-this.mPointerDownX_FXPT:-(t.mX_FXPT-this.mPointerDownX_FXPT))<=this.mMaxRotationTapDistance_FXPT&&(t.mY_FXPT-this.mPointerDownY_FXPT>=0?t.mY_FXPT-this.mPointerDownY_FXPT:-(t.mY_FXPT-this.mPointerDownY_FXPT))<=this.mMaxRotationTapDistance_FXPT){if(this.mIsRotationTapValid)if(this.mEnableCCWRotation){var e=this.mMatrixCenterX_FXPT;this.mWasPrevRotationCCW||(e-=A.kFullCellSize_FXPT),t.mX_FXPT>=e?(this.getController()._performControlAction(b.kControlAction_superRotateCW,null,null),this.mWasPrevRotationCCW=!1):(this.getController()._performControlAction(b.kControlAction_superRotateCCW,null,null),this.mWasPrevRotationCCW=!0)}else this.getController()._performControlAction(b.kControlAction_superRotateCW,null,null),this.mWasPrevRotationCCW=!1}else this.mPointerSmoothedVelocityY_FXPT>0&&this.isVerticalDragValid(this.mPointerSmoothedVelocityX_FXPT,this.mPointerSmoothedVelocityY_FXPT,this.mMinHoldDragVelocityY_FXPT,t.mY_FXPT-this.mPointerDownY_FXPT,this.mMinHoldDragDistanceY_FXPT)?this.performHold():this.mPointerSmoothedVelocityY_FXPT<0&&this.isVerticalDragValid(this.mPointerSmoothedVelocityX_FXPT,this.mPointerSmoothedVelocityY_FXPT,this.mMinHardDropDragVelocityY_FXPT,t.mY_FXPT-this.mPointerDownY_FXPT,this.mMinHardDropDragDistanceY_FXPT)&&this.getController()._performControlAction(b.kControlAction_hardDrop,null,null);this.mIsRotationTapValid=!1;break;case r.kInputId_hold:}}},{key:"TetSmartControlInputMgr_handleInputOnIsCancelled",value:function(t){switch(t.mInputId){case r.kInputId_pointer:this.stopSoftDrop(),this.mIsRotationTapValid=!1;break;case r.kInputId_hold:}}},{key:"TetSmartControlInputMgr_startEvaluationForNewLivePiece",value:function(){}},{key:"TetSmartControlInputMgr_processEvaluationForNewLivePiece",value:function(){return!0}},{key:"TetSmartControlInputMgr_handleLivePieceDidActivate",value:function(){this.mWasPrevRotationCCW=!1,this.checkSoftDrop()}},{key:"TetSmartControlInputMgr_handleLivePieceDidTouchDown",value:function(){this.suspendSoftDrop()}},{key:"TetSmartControlInputMgr_handleLivePieceDidDeactivate",value:function(){this.resetPointerTracking(!1)}}]),r}(m);g.kInputType=3,g.kInputId_pointer=769,g.kInputId_hold=770,g.kNumInputIds=2;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function M(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:M(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},_=n.TetSmartControlSmartInputMgr=function(n){function r(i,n,s,o,a){t(this,r);var h=e(this,Object.getPrototypeOf(r).call(this,r.kInputType,r.kNumInputIds,i,n,s,o,a));return h.mActionsToTarget=new Array,h.mActionsToLivePiece=new Array,h.mCellTrackingInset_FXPT=100,h.mSearchCellForTarget=!0,h.mSearchColumnForTarget=!0,h.mUpdateTargetWhilePointerInputIsOff=!0,h.mForceValidTarget=!1,h.mPointerSelectTargetMatrixBufferX=1e3,h.mPointerSelectTargetMatrixBufferY=1e3,h.mSelectTargetAtPointerInputOn=!0,h.mPieceDeactivationByNonSelectCancelsPointerOn=!0,h.mPointerSmoothingWeight_FXPT=0,h.mDoSmoothingWhilePointerInputIsOff=!1,h.mRestrictReachableTransforms=!1,h.mEnablePathToTargetHardDrop=!0,h.mOptimizePathToTarget=!0,h.mTargetFinder=new d(n,s,o,!0),h.mTargetPathFinder=h.mTargetFinder,h.mLivePiecePathFinder=new d(n,s,o,!1),h.mPrevPointerSmoothingProcessTimeSEC_FXPT=0,h.mAvailablePointerSmoothingProcessTimeSEC_FXPT=0,h.resetPointerPosition(),h.mLivePieceTransform=b.kInvalidTransformId,h.mTargetTransform=b.kInvalidTransformId,h.mDidSelectTarget=!1,h.mIgnoreNextSelectViaPointerOff=!1,h.mDidFirstLivePieceActivate=!1,h.mTransformIndexFromBest=0,h.mResetPointerPositionAtNextPieceActivation=!1,h}return i(r,n),s(r,[{key:"setParameter_restrictReachableTransforms",value:function(t){this.mRestrictReachableTransforms=t,t&&this.mTargetPathFinder==this.mTargetFinder&&(this.mTargetPathFinder=new d(this.getPieceData(),this.getMatrixWidth(),this.getMatrixHeight(),!0))}},{key:"resetPointerPosition",value:function(){var t=this.getInput(r.kInputId_pointer);t.mX_FXPT=~~((this.getMatrixWidth()-1)/2)*b.kFXPTScale,t.mY_FXPT=-1,this.mTargetCellX_FXPT=t.mX_FXPT,this.mTargetCellY_FXPT=t.mY_FXPT,this.mIsTargetCellValid=!1,this.mSmoothedPointerInputX_FXPT=t.mX_FXPT}},{key:"updatePointerSmoothing",value:function(){if(this.mPointerSmoothingWeight_FXPT>0){var t=this.getInput(r.kInputId_pointer);if(t.mIsOn||this.mDoSmoothingWhilePointerInputIsOff){var e=this.getController()._getTimeSEC_FXPT(),i=e-this.mPrevPointerSmoothingProcessTimeSEC_FXPT;if(this.mPrevPointerSmoothingProcessTimeSEC_FXPT=e,i>0){this.mAvailablePointerSmoothingProcessTimeSEC_FXPT+=i;for(var n=10;this.mAvailablePointerSmoothingProcessTimeSEC_FXPT>n;)this.mSmoothedPointerInputX_FXPT=b.FXPTSmoothXXX(this.mSmoothedPointerInputX_FXPT,t.mX_FXPT,this.mPointerSmoothingWeight_FXPT),this.mAvailablePointerSmoothingProcessTimeSEC_FXPT-=n;this.mSmoothedPointerInputX_FXPT!=t.mX_FXPT&&this.TetSmartControlInputMgr_handleInputPositionChanged(t)}}else this.mSmoothedPointerInputX_FXPT=t.mX_FXPT}}},{key:"updateLivePieceTransform",value:function(){var t=this.getController()._getGameState(),e=t.getLivePieceCurrentTransform();return e!=this.mLivePieceTransform&&(this.mLivePieceTransform=e,this.mRestrictReachableTransforms)?(this.mTargetFinder.resetReachableTransforms(t.getLivePieceCurrentX(),t.getLivePieceCurrentY(),t.getLivePieceCurrentFacing()),!0):!1}},{key:"updateTargetCell",value:function(t,e,i,n){var s=this.getInput(r.kInputId_pointer);if(this.mUpdateTargetWhilePointerInputIsOff||s.mIsOn||i){if(this.mTargetTransform!=b.kInvalidTransformId&&this.mCellTrackingInset_FXPT>0){var o=~~(t/b.kFXPTScale)*b.kFXPTScale,a=~~(e/b.kFXPTScale)*b.kFXPTScale;(t-this.mTargetCellX_FXPT>=0?t-this.mTargetCellX_FXPT:-(t-this.mTargetCellX_FXPT))<A.kHalfCellSize_FXPT&&(t<o+this.mCellTrackingInset_FXPT||t>o+A.kFullCellSize_FXPT-this.mCellTrackingInset_FXPT)&&(t=this.mTargetCellX_FXPT),(e-this.mTargetCellY_FXPT>=0?e-this.mTargetCellY_FXPT:-(e-this.mTargetCellY_FXPT))<A.kHalfCellSize_FXPT&&(e<a+this.mCellTrackingInset_FXPT||e>a+A.kFullCellSize_FXPT-this.mCellTrackingInset_FXPT)&&(e=this.mTargetCellY_FXPT)}var h=~~(this.mTargetCellX_FXPT/b.kFXPTScale),l=~~(this.mTargetCellY_FXPT/b.kFXPTScale);this.mTargetCellX_FXPT=b.clampInt(t,0,(this.getMatrixWidth()-1)*b.kFXPTScale),this.mTargetCellY_FXPT=b.clampInt(e,0,(this.getMatrixVisibleHeight()-1)*b.kFXPTScale);var c=this.mIsTargetCellValid;if(this.mIsTargetCellValid=this.mUpdateTargetWhilePointerInputIsOff||s.mIsOn,!this.isLivePieceControllable())return;var u=~~(this.mTargetCellX_FXPT/b.kFXPTScale),d=~~(this.mTargetCellY_FXPT/b.kFXPTScale);if(c&&!i&&u==h&&d==l)return;var p=b.kInvalidTransformId;if(this.mSearchCellForTarget&&(p=this.mTargetFinder.getBestTransformForCell(u,d,this.mTransformIndexFromBest,!1)),p==b.kInvalidTransformId&&this.mSearchColumnForTarget&&(p=this.mTargetFinder.getBestTransformForCellColumn(u,d,!0,this.mTransformIndexFromBest,!1)),n&&this.getPieceData().areTransformsEquivalent(this.getController()._getGameState().getLivePieceTypeId(),this.mTargetTransform,p))return;this.setTargetTransform(p,i)}else{if(this.mIsTargetCellValid=!1,!this.isLivePieceControllable())return;if(n&&this.mTargetTransform==b.kInvalidTransformId)return;this.setTargetTransform(b.kInvalidTransformId,!0)}}},{key:"setTargetTransform",value:function(t,e){if(this.isLivePieceControllable()){var i=this.mTargetFinder.getLivePieceCurrentTransform();i!=b.kInvalidTransformId&&t==b.kInvalidTransformId&&(this.mForceValidTarget&&this.mTargetTransform==b.kInvalidTransformId?t=this.mTargetFinder.getTransformForControlAction(i,b.kControlAction_hardDrop):this.mRestrictReachableTransforms&&(t=this.mTargetTransform));var n=t!=this.mTargetTransform||e;this.mTargetTransform=t;var s,r;if(n)if(this.mTargetTransform!=b.kInvalidTransformId){var o=this.getPieceData().computeXFromTransformId(this.mTargetTransform),a=this.getPieceData().computeYFromTransformId(this.mTargetTransform),h=b.computeFacingFromTransformId(this.mTargetTransform);this.mTargetPathFinder.getBestActionsForTransform(this.mTargetTransform,this.mActionsToTarget,this.mOptimizePathToTarget,this.mEnablePathToTargetHardDrop);var l=this.getController()._getGameState().getLivePieceCurrentY();if(r=this.getPieceData().computeTransformId(o,l,h),this.mTargetPathFinder.doesTransformCollide(r))for(l++;a>=l&&(r=this.getPieceData().computeTransformId(o,l,h),this.mTargetPathFinder.doesTransformCollide(r));)l++,r=b.kInvalidTransformId;r==b.kInvalidTransformId||this.mLivePiecePathFinder.getBestActionsForTransform(r,this.mActionsToLivePiece,!0,!1)||(r=this.getPieceData().computeTransformId(o,l,b.rotateFacing180(h,!0)),this.mLivePiecePathFinder.getBestActionsForTransform(r,this.mActionsToLivePiece,!0,!1)||(r=b.kInvalidTransformId)),r==b.kInvalidTransformId&&(r=this.getController()._getGameState().getLivePieceCurrentTransform(),this.mLivePiecePathFinder.getBestActionsForTransform(r,this.mActionsToLivePiece,!0,!1)||(r=b.kInvalidTransformId)),r==b.kInvalidTransformId&&(this.mActionsToLivePiece.length=0,s=b.kTransformAction_none,this.mActionsToLivePiece.push(s)),this.getController()._performControlAction(b.kControlAction_moveTarget,this.mActionsToLivePiece,this.mActionsToTarget),this.updateLivePieceTransform()}else this.mActionsToTarget.length=0,s=b.kTransformAction_invalidateTarget,this.mActionsToTarget.push(s),r=this.getController()._getGameState().getLivePieceCurrentTransform(),this.mLivePiecePathFinder.getBestActionsForTransform(r,this.mActionsToLivePiece,!0,!1)||(this.mActionsToLivePiece.length=0,s=b.kTransformAction_none,this.mActionsToLivePiece.push(s)),this.getController()._performControlAction(b.kControlAction_moveTarget,this.mActionsToLivePiece,this.mActionsToTarget),this.updateLivePieceTransform()}}},{key:"selectTarget",value:function(){this.isLivePieceControllable()&&this.mTargetTransform!=b.kInvalidTransformId&&(this.mDidSelectTarget=!0,this.getController()._performControlAction(b.kControlAction_selectTarget,null,null))}},{key:"isPointInsideMatrixBuffer",value:function(t,e){return t<-this.mPointerSelectTargetMatrixBufferX*b.kFXPTScale?!1:t>(this.getMatrixWidth()+this.mPointerSelectTargetMatrixBufferX)*b.kFXPTScale?!1:e<-this.mPointerSelectTargetMatrixBufferY*b.kFXPTScale?!1:e>(this.getMatrixVisibleHeight()+this.mPointerSelectTargetMatrixBufferY)*b.kFXPTScale?!1:!0}},{key:"destroy",value:function(){this.isDestroyed()||(this.mTargetFinder&&(this.mTargetPathFinder==this.mTargetFinder&&(this.mTargetPathFinder=null),this.mTargetFinder.destroy(),this.mTargetFinder&&(this.mTargetFinder=null)),this.mTargetPathFinder&&(this.mTargetPathFinder.destroy(),this.mTargetPathFinder&&(this.mTargetPathFinder=null)),this.mLivePiecePathFinder&&(this.mLivePiecePathFinder.destroy(),this.mLivePiecePathFinder&&(this.mLivePiecePathFinder=null)),u(Object.getPrototypeOf(r.prototype),"destroy",this).call(this))}},{key:"TetSmartControlInputMgr_setIsActive",value:function(t){t&&(this.updateLivePieceTransform(),this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!0))}},{key:"TetSmartControlInputMgr_processTime",value:function(){this.updatePointerSmoothing(),this.updateLivePieceTransform()&&this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!0)}},{key:"TetSmartControlInputMgr_handleInputPositionChanged",value:function(t){switch(t.mInputId){case r.kInputId_pointer:0==this.mPointerSmoothingWeight_FXPT&&(this.mSmoothedPointerInputX_FXPT=t.mX_FXPT),this.updateTargetCell(this.mSmoothedPointerInputX_FXPT,t.mY_FXPT,!1,!1),this.mResetPointerPositionAtNextPieceActivation=!1;break;case kInputId_moveTargetLeft:break;case kInputId_moveTargetRight:break;case kInputId_cycleTarget:break;case kInputId_selectTarget:break;case kInputId_hold:}}},{key:"TetSmartControlInputMgr_handleInputIsOn",value:function(t){var e,i;switch(t.mInputId){case r.kInputId_pointer:this.mPrevPointerSmoothingProcessTimeSEC_FXPT=this.getController()._getTimeSEC_FXPT(),this.mAvailablePointerSmoothingProcessTimeSEC_FXPT=0,this.mSmoothedPointerInputX_FXPT=t.mX_FXPT,this.mTransformIndexFromBest=0,this.updateTargetCell(t.mX_FXPT,t.mY_FXPT,!0,!1),this.isPointInsideMatrixBuffer(t.mX_FXPT,t.mY_FXPT)&&this.mSelectTargetAtPointerInputOn&&this.selectTarget();break;case kInputId_moveTargetLeft:case kInputId_moveTargetRight:switch(this.mTransformIndexFromBest=0,this.mTargetCellY_FXPT=-1,e=this.getController()._getGameState().getLivePieceTypeId(),i=this.mTargetTransform,t.mInputId){case kInputId_moveTargetLeft:for(;this.mTargetCellX_FXPT>0&&this.getPieceData().areTransformsEquivalent(e,this.mTargetTransform,i);)this.mTargetCellX_FXPT-=b.kFXPTOne,this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!0);break;case kInputId_moveTargetRight:for(var n=b.FXPTFromInt(this.getMatrixWidth()-1)-1;this.mTargetCellX_FXPT<n&&this.getPieceData().areTransformsEquivalent(e,this.mTargetTransform,i);)this.mTargetCellX_FXPT+=b.kFXPTOne,this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!0)}t.mIsOn=!1,t.mX_FXPT=this.mTargetCellX_FXPT,t.mY_FXPT=this.mTargetCellY_FXPT,this.mResetPointerPositionAtNextPieceActivation=!0;break;case kInputId_cycleTarget:this.mTransformIndexFromBest++,this.mTransformIndexFromBest>=100&&(this.mTransformIndexFromBest=0),this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!0);break;case kInputId_selectTarget:this.selectTarget();break;case kInputId_hold:this.getController()._performControlAction(b.kControlAction_hold,null,null)}}},{key:"TetSmartControlInputMgr_handleInputIsOff",value:function(t){switch(t.mInputId){case r.kInputId_pointer:this.mSmoothedPointerInputX_FXPT=t.mX_FXPT,this.mTransformIndexFromBest=0,this.updateTargetCell(t.mX_FXPT,t.mY_FXPT,!0,!1),!this.isPointInsideMatrixBuffer(t.mX_FXPT,t.mY_FXPT)||this.mSelectTargetAtPointerInputOn||this.mIgnoreNextSelectViaPointerOff||this.selectTarget(),this.mUpdateTargetWhilePointerInputIsOff||this.resetPointerPosition(),this.mIgnoreNextSelectViaPointerOff=!1;break;case kInputId_moveTargetLeft:break;case kInputId_moveTargetRight:break;case kInputId_cycleTarget:break;case kInputId_selectTarget:break;case kInputId_hold:}}},{key:"TetSmartControlInputMgr_handleInputOnIsCancelled",value:function(t){switch(t.mInputId){case r.kInputId_pointer:this.mSmoothedPointerInputX_FXPT=t.mX_FXPT,this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,!0,!1),this.mIgnoreNextSelectViaPointerOff=!1;break;case kInputId_moveTargetLeft:break;case kInputId_moveTargetRight:break;case kInputId_cycleTarget:break;case kInputId_selectTarget:break;case kInputId_hold:}}},{key:"TetSmartControlInputMgr_startEvaluationForNewLivePiece",value:function(){this.mActionsToTarget.length=0,this.mActionsToLivePiece.length=0,this.mTargetFinder&&this.mTargetFinder.startStateEvaluation(this.getController()._getGameState()),this.mTargetPathFinder&&this.mTargetPathFinder!=this.mTargetFinder&&this.mTargetPathFinder.startStateEvaluation(this.getController()._getGameState()),this.mLivePiecePathFinder&&this.mLivePiecePathFinder.startStateEvaluation(this.getController()._getGameState())}},{key:"TetSmartControlInputMgr_processEvaluationForNewLivePiece",value:function(){var t=!0;return t&&this.mTargetFinder&&(t=this.mTargetFinder.processStateEvaluation()),t&&this.mTargetPathFinder&&this.mTargetPathFinder!=this.mTargetFinder&&(t=this.mTargetPathFinder.processStateEvaluation()),t&&this.mLivePiecePathFinder&&(t=this.mLivePiecePathFinder.processStateEvaluation()),t&&this.isLivePieceControllable()&&this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,this.mIsTargetCellValid,!1),t}},{key:"TetSmartControlInputMgr_handleLivePieceDidActivate",value:function(){var t=this.mResetPointerPositionAtNextPieceActivation;if(this.mDidFirstLivePieceActivate||(this.mDidFirstLivePieceActivate=!0,this.mUpdateTargetWhilePointerInputIsOff&&(t=!0)),t&&(this.resetPointerPosition(),this.mResetPointerPositionAtNextPieceActivation=!1),this.mLivePieceTransform=this.getController()._getGameState().getLivePieceCurrentTransform(),this.mTransformIndexFromBest=0,this.mTargetTransform=b.kInvalidTransformId,this.mDidSelectTarget=!1,this.isLivePieceControllable()){var e=this.mIsTargetCellValid;this.updateTargetCell(this.mTargetCellX_FXPT,this.mTargetCellY_FXPT,this.mIsTargetCellValid,!1),this.mIsTargetCellValid=e}}},{key:"TetSmartControlInputMgr_handleLivePieceDidDeactivate",value:function(){var t=this.getInput(r.kInputId_pointer);this.mIgnoreNextSelectViaPointerOff=this.mPieceDeactivationByNonSelectCancelsPointerOn&&t.mIsOn&&!this.mDidSelectTarget&&this.getController()._getGameState().getCurrentControlAction()!=b.kControlAction_hold,this.mDidSelectTarget=!1}}]),r}(m);_.kInputType=2,_.kInputId_pointer=513,_.kInputId_moveTargetLeft=514,_.kInputId_moveTargetRight=515,_.kInputId_cycleTarget=516,_.kInputId_selectTarget=517,_.kInputId_hold=518,_.kNumInputIds=6;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),y=n.TetSmartControlModel=function(){function e(i,n,s){t(this,e),this.mActionTransformPathToTarget=new Array,this.mIsDestroyed=!1,this.mLivePieceStartingYOffset=2,this.mLockLivePieceAtTarget=!0,this.mSnapToTargetOnTouchDownFallSpeedMSEC=20,this.mSmartPlacementsAllowedBeforeLock=30,this.mDirectPlacementsAllowedBeforeLock=15,this.mAllowDirectRotationalHovering=!1,this.mAllowInfiniteHold=!1,this.mEnablePathToTarget=!1,this.mMatrixWidth=i,this.mMatrixHeight=n,this.mPieceData=s,this.mIsLivePieceActive=!1,this.mIsLivePieceControllable=!1,this.mCanHoldLivePiece=!0,this.mIsSoftDropOn=!1,this.mIsActive=!0,this.mControlMode=e.kControlMode_direct,this.mGameState=new r(s,i,n),this.mLowestLivePieceY=1e6,this.mLowestRowTouchedByLivePiece=1e6,this.mIsLivePieceTouchingDown=!1,this.mTargetTransform=b.kInvalidTransformId,this.mSmartPlacementsRemainingBeforeLock=0,this.mDirectPlacementsRemainingBeforeLock=0,this.mActionTransformPathToTarget.length=0,this.mDidMatrixChangeSinceLastSetTransforms=!1,this.mDidPlayerActivelySelectTarget=!1,this.mCurrentLivePiecePathStep=-1,this.mEndingRotationPointForPiece=0,this.mSoftDropStepsForPiece=0,this.mHardDropStepsForPiece=0}return s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"getPieceData",value:function(){return this.mPieceData}},{key:"captureStateForNewLivePiece",value:function(t,e,i,n){this.mGameState.resetStateWithLivePiece(t,e,i+this.mLivePieceStartingYOffset,n),this.TetSmartControlModel_captureMatrix(),this.mDidMatrixChangeSinceLastSetTransforms=!0}},{key:"captureStateForCurrentLivePiece",value:function(){this.mGameState.resetStateWithCurrentLivePiece(),this.TetSmartControlModel_captureMatrix(),this.mDidMatrixChangeSinceLastSetTransforms=!0}},{key:"setCurrentStateMatrixMino",value:function(t,e,i){this.mGameState.setMino(t,e,i,2147483647,!1,!0,!0)}},{key:"getGameState",value:function(){return this.updateGameStateLivePieceCurrentTransform(),this.mGameState}},{key:"handleLivePieceDidActivate",value:function(){this.mIsLivePieceActive=!0,this.mIsLivePieceControllable=!0,this.mLowestLivePieceY=1e6,this.mLowestRowTouchedByLivePiece=1e6,this.mIsLivePieceTouchingDown=!1,this.mSmartPlacementsRemainingBeforeLock=this.mSmartPlacementsAllowedBeforeLock,this.mDirectPlacementsRemainingBeforeLock=this.mDirectPlacementsAllowedBeforeLock,this.mTargetTransform=b.kInvalidTransformId,this.mActionTransformPathToTarget.length=0,this.mDidPlayerActivelySelectTarget=!1,this.mCurrentLivePiecePathStep=-1,this.mEndingRotationPointForPiece=0,this.mSoftDropStepsForPiece=0,this.mHardDropStepsForPiece=0,this.mGameState.setCurrentControlAction(b.kControlAction_none),this.updateGameStateLivePieceCurrentTransform(),this.mIsActive&&(this.updateDirectModeGhostPiece(),this.updateLowestRowReachedByLivePiece(),this.mGameState.doesPieceTouchBelow(this.getCurrentLivePiece())&&this.handleLivePieceDidTouchDown())}},{key:"handleLivePieceDidFall",value:function(){this.isLivePieceControllable()&&(this.updateGameStateLivePieceCurrentTransform(),this.mEndingRotationPointForPiece=0,this.isSoftDropOnAndValid()&&!this.isControlModeSmart()&&this.mSoftDropStepsForPiece++,this.updateDirectModeGhostPiece(),this.updateLowestRowReachedByLivePiece())}},{key:"handleLivePieceDidTouchDown",value:function(){this.isLivePieceControllable()&&(this.mIsLivePieceTouchingDown||(this.updateGameStateLivePieceCurrentTransform(),this.trySnapToTarget(),this._handleLivePieceDidTouchDown()))}},{key:"handleLivePieceWillLockDown",value:function(){this.isLivePieceControllable()&&(this.updateGameStateLivePieceCurrentTransform(),this.isControlModeSmart()&&this.mLockLivePieceAtTarget&&this.mTargetTransform!=b.kInvalidTransformId&&this.selectTarget(!1,!1,!1),this.mIsLivePieceActive=!1,this.mIsLivePieceControllable=!1)}},{key:"handleLivePieceDidDeactivate",value:function(){this.mIsLivePieceActive=!1,this.mCanHoldLivePiece=!0}},{key:"performControlAction",value:function(t,i,n){var s=0;switch(this.mGameState.setCurrentControlAction(t),t){case b.kControlAction_moveLeft:case b.kControlAction_moveRight:case b.kControlAction_rotateCW:case b.kControlAction_rotateCCW:case b.kControlAction_superRotateCW:case b.kControlAction_superRotateCCW:case b.kControlAction_startSoftDrop:case b.kControlAction_stopSoftDrop:case b.kControlAction_hardDrop:case b.kControlAction_updateGhost:switch(this.setControlMode(e.kControlMode_direct),t){case b.kControlAction_updateGhost:if(this.isLivePieceControllable()){var r=this.getCurrentLivePieceTransform();r!=b.kInvalidTransformId&&this.setTransforms(r,this.mGameState.getTransformForControlAction(r,b.kControlAction_hardDrop),b.kControlAction_none,0)}break;case b.kControlAction_startSoftDrop:!this.mIsSoftDropOn&&this.TetSmartControlModel_performControlAction(b.kControlAction_startSoftDrop)?this.mIsSoftDropOn=!0:this.TetSmartControlModel_controlActionFailed(b.kControlAction_startSoftDrop);break;case b.kControlAction_stopSoftDrop:this.mIsSoftDropOn&&this.TetSmartControlModel_performControlAction(b.kControlAction_stopSoftDrop)?this.mIsSoftDropOn=!1:this.TetSmartControlModel_controlActionFailed(b.kControlAction_stopSoftDrop);break;default:if(this.isLivePieceControllable())if(this.TetSmartControlModel_performControlAction(t))this.updateGameStateLivePieceCurrentTransform();else{var o,a=this.getCurrentLivePieceTransform();switch(t){case b.kControlAction_moveLeft:case b.kControlAction_moveRight:case b.kControlAction_rotateCW:case b.kControlAction_rotateCCW:case b.kControlAction_superRotateCW:case b.kControlAction_superRotateCCW:switch(t){case b.kControlAction_superRotateCW:case b.kControlAction_superRotateCCW:if(!this.mAllowDirectRotationalHovering&&this.mDirectPlacementsRemainingBeforeLock<=0)switch(t){case b.kControlAction_superRotateCW:t=b.kControlAction_rotateCW;break;case b.kControlAction_superRotateCCW:t=b.kControlAction_rotateCCW}}if(s=this.mGameState.getTransformForControlAction(a,t),s!=b.kInvalidTransformId){var h=this.mGameState.getTransformActionForControlAction(a,s,t),l=b.getControlActionInfoForTransformAction(h);o=this.mGameState.getTransformForControlAction(s,b.kControlAction_hardDrop),this.setTransforms(s,o,t,l)}else this.TetSmartControlModel_controlActionFailed(t);break;case b.kControlAction_hardDrop:o=this.mGameState.getTransformForControlAction(a,b.kControlAction_hardDrop),this.mHardDropStepsForPiece=this.mPieceData.computeYFromTransformId(a)-this.mPieceData.computeYFromTransformId(o),this.setTransforms(a,o,b.kControlAction_none,0),this.selectTarget(!0,!1,!0);break;default:this.TetSmartControlModel_controlActionFailed(t)}}else this.TetSmartControlModel_controlActionFailed(t)}break;case b.kControlAction_moveTarget:case b.kControlAction_moveTargetLeft:case b.kControlAction_moveTargetRight:case b.kControlAction_cycleTarget:case b.kControlAction_moveToTarget:case b.kControlAction_selectTarget:switch(this.setControlMode(e.kControlMode_smart),t){case b.kControlAction_moveTarget:s=this.mGameState.generateActionTransformPathWithActions(this.mGameState.getLivePieceStartingTransform(),i,null);var c=this.mGameState.generateActionTransformPathWithActions(this.mGameState.getLivePieceStartingTransform(),n,this.mActionTransformPathToTarget);this.setTransforms(s,c,b.kControlAction_moveTarget,0);break;case b.kControlAction_moveTargetLeft:break;case b.kControlAction_moveTargetRight:break;case b.kControlAction_cycleTarget:break;case b.kControlAction_moveToTarget:break;case b.kControlAction_selectTarget:this.selectTarget(!0,this.mEnablePathToTarget,!0)}break;case b.kControlAction_hold:this.isLivePieceControllable()&&this.mCanHoldLivePiece&&this.TetSmartControlModel_performControlAction(b.kControlAction_hold)?this.mAllowInfiniteHold||(this.mCanHoldLivePiece=!1):this.TetSmartControlModel_controlActionFailed(b.kControlAction_hold)}this.mGameState.setCurrentControlAction(b.kControlAction_none)}},{key:"isControllingLivePiecePathToTarget",
value:function(){return this.isLivePieceActive()&&this.mCurrentLivePiecePathStep>=0}},{key:"processLivePiecePathToTarget",value:function(){if(this.isLivePieceActive()&&!(this.mCurrentLivePiecePathStep<0)){var t=this.mActionTransformPathToTarget.length/2;if(this.mCurrentLivePiecePathStep<t){var e=this.mActionTransformPathToTarget[2*this.mCurrentLivePiecePathStep],i=this.mActionTransformPathToTarget[2*this.mCurrentLivePiecePathStep+1];this.setLivePieceTransform(i,b.getControlActionForTransformAction(e),b.getControlActionInfoForTransformAction(e)),this.mCurrentLivePiecePathStep++}this.mCurrentLivePiecePathStep>=t&&(this.TetSmartControlModel_lockLivePiece(),this.mCurrentLivePiecePathStep=-1)}}},{key:"getEndingRotationPointForPiece",value:function(){return this.mEndingRotationPointForPiece}},{key:"isSoftDropOnAndValid",value:function(){return this.isLivePieceControllable()&&this.mIsSoftDropOn&&this.TetSmartControlModel_getLivePieceY()<=this.mLowestLivePieceY}},{key:"getSoftDropStepsForPiece",value:function(){return this.mSoftDropStepsForPiece}},{key:"getHardDropStepsForPiece",value:function(){return this.mHardDropStepsForPiece}},{key:"didPlayerActivelySelectTarget",value:function(){return this.mDidPlayerActivelySelectTarget}},{key:"suspendActivity",value:function(){this.mIsActive&&(this.mIsActive=!1,this.mTargetTransform=b.kInvalidTransformId)}},{key:"resumeActivity",value:function(){this.mIsActive||(this.mIsActive=!0,this.mTargetTransform=b.kInvalidTransformId,this.updateLowestRowReachedByLivePiece())}},{key:"isActive",value:function(){return this.mIsActive}},{key:"setControlMode",value:function(t){this.mControlMode!=t&&(this.mIsSoftDropOn&&(this.TetSmartControlModel_performControlAction(b.kControlAction_stopSoftDrop),this.mIsSoftDropOn=!1),this.mControlMode=t,this.mActionTransformPathToTarget.length=0,this.mEndingRotationPointForPiece=0)}},{key:"isControlModeSmart",value:function(){return this.mControlMode==e.kControlMode_smart}},{key:"isLivePieceActive",value:function(){return this.mIsActive&&this.mIsLivePieceActive}},{key:"isLivePieceControllable",value:function(){return this.mIsActive&&this.mIsLivePieceActive&&this.mIsLivePieceControllable}},{key:"getCurrentLivePiece",value:function(){return this.isLivePieceActive()?this.mPieceData.getPiece(this.mGameState.getLivePieceTypeId(),this.getCurrentLivePieceTransform()):null}},{key:"getCurrentLivePieceTransform",value:function(){return this.mPieceData.computeTransformId(this.TetSmartControlModel_getLivePieceX(),this.TetSmartControlModel_getLivePieceY(),this.TetSmartControlModel_getLivePieceFacing())}},{key:"getCurrentLivePieceBottomRow",value:function(){var t=this.getCurrentLivePiece();return t?t.mMinMinoY:-1}},{key:"updateGameStateLivePieceCurrentTransform",value:function(){this.isLivePieceActive()&&this.mGameState.setLivePieceCurrentTransform(this.getCurrentLivePieceTransform())}},{key:"updateLowestRowReachedByLivePiece",value:function(){if(this.isLivePieceControllable()){var t=this.TetSmartControlModel_getLivePieceY();t<this.mLowestLivePieceY&&(this.mLowestLivePieceY=t);var e=this.getCurrentLivePieceBottomRow();e<this.mLowestRowTouchedByLivePiece&&(this.mLowestRowTouchedByLivePiece=e,this.mSmartPlacementsRemainingBeforeLock=this.mSmartPlacementsAllowedBeforeLock,this.mDirectPlacementsRemainingBeforeLock=this.mDirectPlacementsAllowedBeforeLock)}}},{key:"_handleLivePieceDidTouchDown",value:function(){if(this.isLivePieceControllable()&&!this.mIsLivePieceTouchingDown){this.mIsLivePieceTouchingDown=!0;var t;t=this.isControlModeSmart()?this.mSmartPlacementsRemainingBeforeLock:this.mDirectPlacementsRemainingBeforeLock,t>0?this.TetSmartControlModel_startLockTimer():(this.mIsLivePieceControllable=!1,this.TetSmartControlModel_lockLivePiece())}}},{key:"trySnapToTarget",value:function(){if(!this.isControlModeSmart())return!1;var t=this.getCurrentLivePiece();return this.TetSmartControlModel_getNormalFallSpeedMSEC()<=this.mSnapToTargetOnTouchDownFallSpeedMSEC&&this.mGameState.doesPieceTouchBelow(t)&&!this.mPieceData.areTransformsEquivalent(this.mGameState.getLivePieceTypeId(),t.mTransformId,this.mTargetTransform)?(this.setLivePieceTransform(this.mTargetTransform,b.kControlAction_moveToTarget,0),!0):!1}},{key:"setLivePieceTransform",value:function(t,e,i){if(t!=this.getCurrentLivePieceTransform()){var n=this.mPieceData.computeXFromTransformId(t),s=this.mPieceData.computeYFromTransformId(t),r=b.computeFacingFromTransformId(t);this.TetSmartControlModel_setLivePieceTransform(n,s,r,e,i),this.updateGameStateLivePieceCurrentTransform()}}},{key:"setTransforms",value:function(t,e,i,n){if(this.updateGameStateLivePieceCurrentTransform(),this.mTargetTransform=e,e!=b.kInvalidTransformId){this.TetSmartControlModel_setGhostPieceIsValid(!0);var s=this.mPieceData.computeXFromTransformId(e),r=this.mPieceData.computeYFromTransformId(e),o=b.computeFacingFromTransformId(e);this.TetSmartControlModel_setGhostPieceTransform(s,r,o)}else this.TetSmartControlModel_setGhostPieceIsValid(!1);if(t!=b.kInvalidTransformId){var a=this.getCurrentLivePieceTransform();if(a!=t||this.mDidMatrixChangeSinceLastSetTransforms){this.mDidMatrixChangeSinceLastSetTransforms=!1,this.setLivePieceTransform(t,i,n);var h=this.getCurrentLivePieceTransform();if(h!=a){var l=this.mGameState.getLivePieceTypeId(),c=this.mPieceData.getPiece(l,h);switch(this.trySnapToTarget()&&(h=this.getCurrentLivePieceTransform(),c=this.mPieceData.getPiece(l,h)),i){case b.kControlAction_rotateCW:case b.kControlAction_rotateCCW:case b.kControlAction_superRotateCW:case b.kControlAction_superRotateCCW:var u=n;5==this.mEndingRotationPointForPiece?1!=u&&(this.mEndingRotationPointForPiece=u):this.mEndingRotationPointForPiece=u;break;default:this.getPieceData().areTransformsEquivalent(this.mGameState.getLivePieceTypeId(),h,a)||(this.mEndingRotationPointForPiece=0)}this.isControlModeSmart()?this.mSmartPlacementsRemainingBeforeLock--:this.mDirectPlacementsRemainingBeforeLock--,this.updateLowestRowReachedByLivePiece(),this.mGameState.doesPieceTouchBelow(c)?(this.mIsLivePieceTouchingDown=!1,this._handleLivePieceDidTouchDown()):this.mIsLivePieceTouchingDown&&(this.mIsLivePieceTouchingDown=!1,this.TetSmartControlModel_cancelLockTimer(),this.TetSmartControlModel_restartLivePieceFalling(this.mIsSoftDropOn))}}}this.updateGameStateLivePieceCurrentTransform()}},{key:"selectTarget",value:function(t,e,i){if(this.isLivePieceControllable()){this.updateGameStateLivePieceCurrentTransform(),this.mIsLivePieceControllable=!1,this.mCurrentLivePiecePathStep=-1,this.mDidPlayerActivelySelectTarget=t,this.TetSmartControlModel_stopLivePieceFalling(),this.TetSmartControlModel_setGhostPieceIsValid(!1);var n,s=0;if(n=this.isControlModeSmart()?b.kControlAction_selectTarget:b.kControlAction_hardDrop,this.mTargetTransform!=b.kInvalidTransformId){if(this.isControlModeSmart()){this.mEndingRotationPointForPiece=this.mGameState.getEndingRotationPointForPath(this.mActionTransformPathToTarget);var r=this.getCurrentLivePieceTransform();this.mSoftDropStepsForPiece=this.mGameState.getSoftDropStepsForPath(this.mActionTransformPathToTarget,r,this.mLowestLivePieceY),this.mHardDropStepsForPiece=this.mGameState.getHardDropStepsForPath(this.mActionTransformPathToTarget,r)}e?(this.mCurrentLivePiecePathStep=0,this.TetSmartControlModel_startedControllingLivePieceToTarget(),this.processLivePiecePathToTarget()):(this.setLivePieceTransform(this.mTargetTransform,n,s),i&&this.TetSmartControlModel_lockLivePiece())}else{this.mHardDropStepsForPiece=0;for(var o=this.getCurrentLivePiece();o&&!this.mGameState.doesPieceTouchBelow(o);)o=this.mPieceData.getPiece(this.mGameState.getLivePieceTypeId(),o.mPerTransformActionToTransformIds[b.kTransformAction_moveDown]),this.mHardDropStepsForPiece++;this.setLivePieceTransform(o.mTransformId,n,s),i&&this.TetSmartControlModel_lockLivePiece()}}}},{key:"updateDirectModeGhostPiece",value:function(){this.mControlMode==e.kControlMode_direct&&this.performControlAction(b.kControlAction_updateGhost,null,null)}},{key:"destroy",value:function(){this.isDestroyed()||(this.mGameState.destroy(),this.mGameState&&(this.mGameState=null),this.mIsDestroyed=!0)}},{key:"TetSmartControlModel_captureMatrix",value:function(){}},{key:"TetSmartControlModel_getLivePieceX",value:function(){return 0}},{key:"TetSmartControlModel_getLivePieceY",value:function(){return 0}},{key:"TetSmartControlModel_getLivePieceFacing",value:function(){return 0}},{key:"TetSmartControlModel_getNormalFallSpeedMSEC",value:function(){return 0}},{key:"TetSmartControlModel_setLivePieceTransform",value:function(t,e,i,n,s){}},{key:"TetSmartControlModel_performControlAction",value:function(t){return!1}},{key:"TetSmartControlModel_controlActionFailed",value:function(t){}},{key:"TetSmartControlModel_setGhostPieceTransform",value:function(t,e,i){}},{key:"TetSmartControlModel_setGhostPieceIsValid",value:function(t){}},{key:"TetSmartControlModel_stopLivePieceFalling",value:function(){}},{key:"TetSmartControlModel_restartLivePieceFalling",value:function(t){}},{key:"TetSmartControlModel_cancelLockTimer",value:function(){}},{key:"TetSmartControlModel_startLockTimer",value:function(){}},{key:"TetSmartControlModel_lockLivePiece",value:function(){}},{key:"TetSmartControlModel_startedControllingLivePieceToTarget",value:function(){}}]),e}();y.kControlMode_smart=1,y.kControlMode_direct=2;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function k(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:k(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},v=n.TetSCIController=function(n){function r(i,n,s,o,a){t(this,r);var h=e(this,Object.getPrototypeOf(r).call(this,n,s,o,a));return h.mInterface=i,h.mModel=null,h}return i(r,n),s(r,[{key:"setModel",value:function(t){this.mModel=t}},{key:"destroy",value:function(){this.isDestroyed()||u(Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"TetSmartControlController_getGameState",value:function(){return this.mModel.getGameState()}},{key:"TetSmartControlController_getTimeMSEC",value:function(){return this.mInterface.TetSmartControlInterface_getTimeMSEC()}},{key:"TetSmartControlController_isSmartControlActive",value:function(){return this.mModel.isActive()}},{key:"TetSmartControlController_performControlAction",value:function(t,e,i){this.mModel.performControlAction(t,e,i)}}]),r}(A),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function B(t,e,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:B(s,e,i)}if("value"in n)return n.value;var r=n.get;if(void 0!==r)return r.call(i)},T=n.TetSCIModel=function(n){function r(i,n,s,o){t(this,r);var a=e(this,Object.getPrototypeOf(r).call(this,n,s,o));return a.mInterface=i,a}return i(r,n),s(r,[{key:"destroy",value:function(){this.isDestroyed()||u(Object.getPrototypeOf(r.prototype),"destroy",this).call(this)}},{key:"TetSmartControlModel_captureMatrix",value:function(){this.mInterface.TetSmartControlInterface_captureMatrix()}},{key:"TetSmartControlModel_getLivePieceX",value:function(){return this.mInterface.TetSmartControlInterface_getLivePieceX()}},{key:"TetSmartControlModel_getLivePieceY",value:function(){return this.mInterface.TetSmartControlInterface_getLivePieceY()}},{key:"TetSmartControlModel_getLivePieceFacing",value:function(){return this.mInterface.TetSmartControlInterface_getLivePieceFacing()}},{key:"TetSmartControlModel_getNormalFallSpeedMSEC",value:function(){return this.mInterface.TetSmartControlInterface_getNormalFallSpeedMSEC()}},{key:"TetSmartControlModel_setLivePieceTransform",value:function(t,e,i,n,s){this.mInterface.TetSmartControlInterface_setLivePieceTransform(t,e,i,n,s)}},{key:"TetSmartControlModel_performControlAction",value:function(t){return this.mInterface.TetSmartControlInterface_performControlAction(t)}},{key:"TetSmartControlModel_controlActionFailed",value:function(t){this.mInterface.TetSmartControlInterface_controlActionFailed(t)}},{key:"TetSmartControlModel_setGhostPieceTransform",value:function(t,e,i){this.mInterface.TetSmartControlInterface_setGhostPieceTransform(t,e,i)}},{key:"TetSmartControlModel_setGhostPieceIsValid",value:function(t){this.mInterface.TetSmartControlInterface_setGhostPieceIsValid(t)}},{key:"TetSmartControlModel_stopLivePieceFalling",value:function(){this.mInterface.TetSmartControlInterface_stopLivePieceFalling()}},{key:"TetSmartControlModel_restartLivePieceFalling",value:function(t){this.mInterface.TetSmartControlInterface_restartLivePieceFalling(t)}},{key:"TetSmartControlModel_cancelLockTimer",value:function(){this.mInterface.TetSmartControlInterface_cancelLockTimer()}},{key:"TetSmartControlModel_startLockTimer",value:function(){this.mInterface.TetSmartControlInterface_startLockTimer()}},{key:"TetSmartControlModel_lockLivePiece",value:function(){this.mInterface.TetSmartControlInterface_lockLivePiece()}},{key:"TetSmartControlModel_startedControllingLivePieceToTarget",value:function(){this.mInterface.TetSmartControlInterface_startedControllingLivePieceToTarget()}}]),r}(y),s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),b=n.TetAIUtils=function(){function e(){t(this,e)}return s(e,null,[{key:"computeTransformId",value:function(t,i,n,s,r){var o=0;if(0>t)return e.kInvalidTransformId;if(t>=n)return e.kInvalidTransformId;if(0>i)return e.kInvalidTransformId;var a=e.computeGridIndex(t+s,i+s,n+2*s);return o=e.setValueInPackedBits(a,o,e.kTransformIdBitMask_xy,e.kTransformIdBitShift_xy),o=e.setValueInPackedBits(r,o,e.kTransformIdBitMask_facing,e.kTransformIdBitShift_facing)}},{key:"computeXFromTransformId",value:function(t,i,n){return t!=e.kInvalidTransformId?e.computeXFromGridIndex(e.getValueFromPackedBits(t,e.kTransformIdBitMask_xy,e.kTransformIdBitShift_xy),i+2*n)-n:0}},{key:"computeYFromTransformId",value:function(t,i,n){return t!=e.kInvalidTransformId?e.computeYFromGridIndex(e.getValueFromPackedBits(t,e.kTransformIdBitMask_xy,e.kTransformIdBitShift_xy),i+2*n)-n:0}},{key:"computeFacingFromTransformId",value:function(t){return t!=e.kInvalidTransformId?e.getValueFromPackedBits(t,e.kTransformIdBitMask_facing,e.kTransformIdBitShift_facing):0}},{key:"areTransformsXYEqual",value:function(t,i,n,s){return e.computeXFromTransformId(t,n,s)==e.computeXFromTransformId(i,n,s)&&e.computeYFromTransformId(t,n,s)==e.computeYFromTransformId(i,n,s)}},{key:"rotateDirections90",value:function(t,e){return t&=255,e?255&(t<<2|t>>>6):255&(t>>>2|t<<6)}},{key:"rotateFacing90",value:function(t,i){return e.loopClampedInt(t+(i?1:-1),e.kFacing_N,e.kFacing_W)}},{key:"rotateFacing180",value:function(t,i){return e.rotateFacing90(e.rotateFacing90(t,i),i)}},{key:"isFacingRotationClockwise",value:function(t,e){return e>t?3>e-t:t>e?t-e==3:!1}},{key:"getPointXForFacingRotation",value:function(t,i,n,s){var r=t,o=i;switch(n){case e.kFacing_N:case e.kFacing_E:case e.kFacing_S:case e.kFacing_W:switch(s){case e.kFacing_N:case e.kFacing_E:case e.kFacing_S:case e.kFacing_W:for(var a,h;n!=s;)a=r,h=o,r=h,o=-a,n=e.rotateFacing90(n,!0)}}return r}},{key:"getPointYForFacingRotation",value:function(t,i,n,s){var r=t,o=i;switch(n){case e.kFacing_N:case e.kFacing_E:case e.kFacing_S:case e.kFacing_W:switch(s){case e.kFacing_N:case e.kFacing_E:case e.kFacing_S:case e.kFacing_W:for(var a,h;n!=s;)a=r,h=o,r=h,o=-a,n=e.rotateFacing90(n,!0)}}return o}},{key:"getRotationPointForTransformAction",value:function(t){switch(t){case e.kTransformAction_rotateCWPoint1:case e.kTransformAction_rotateCWPoint2:case e.kTransformAction_rotateCWPoint3:case e.kTransformAction_rotateCWPoint4:case e.kTransformAction_rotateCWPoint5:return t-e.kTransformAction_rotateCWPoint1+1;case e.kTransformAction_rotateCCWPoint1:case e.kTransformAction_rotateCCWPoint2:case e.kTransformAction_rotateCCWPoint3:case e.kTransformAction_rotateCCWPoint4:case e.kTransformAction_rotateCCWPoint5:return t-e.kTransformAction_rotateCCWPoint1+1;default:return 0}}},{key:"getControlActionForTransformAction",value:function(t){switch(t){case e.kTransformAction_moveLeft:return e.kControlAction_moveLeft;case e.kTransformAction_moveRight:return e.kControlAction_moveRight;case e.kTransformAction_rotateCWPoint1:case e.kTransformAction_rotateCWPoint2:case e.kTransformAction_rotateCWPoint3:case e.kTransformAction_rotateCWPoint4:case e.kTransformAction_rotateCWPoint5:return e.kControlAction_superRotateCW;case e.kTransformAction_rotateCCWPoint1:case e.kTransformAction_rotateCCWPoint2:case e.kTransformAction_rotateCCWPoint3:case e.kTransformAction_rotateCCWPoint4:case e.kTransformAction_rotateCCWPoint5:return e.kControlAction_superRotateCCW;case e.kTransformAction_hardDrop:return e.kControlAction_hardDrop;case e.kTransformAction_followTarget:return e.kControlAction_moveTarget;case e.kTransformAction_lockAtTarget:return e.kControlAction_selectTarget;default:return e.kControlAction_none}}},{key:"getControlActionInfoForTransformAction",value:function(t){switch(t){case e.kTransformAction_rotateCWPoint1:case e.kTransformAction_rotateCWPoint2:case e.kTransformAction_rotateCWPoint3:case e.kTransformAction_rotateCWPoint4:case e.kTransformAction_rotateCWPoint5:return t-e.kTransformAction_rotateCWPoint1+1;case e.kTransformAction_rotateCCWPoint1:case e.kTransformAction_rotateCCWPoint2:case e.kTransformAction_rotateCCWPoint3:case e.kTransformAction_rotateCCWPoint4:case e.kTransformAction_rotateCCWPoint5:return t-e.kTransformAction_rotateCCWPoint1+1;default:return 0}}},{key:"minInt",value:function(t,e){return e>t?t:e}},{key:"maxInt",value:function(t,e){return t>e?t:e}},{key:"clampInt",value:function(t,e,i){return i>e?e>t?e:t>i?i:t:i>t?i:t>e?e:t}},{key:"loopInt",value:function(t,e,i){if(e==i)return e;var n,s;i>e?(n=e,s=i):(n=i,s=e);var r,o=s-n+1;return n>t?(r=s-t,s-(r-~~(r/o)*o)):t>s?(r=t-n,n+(r-~~(r/o)*o)):t}},{key:"loopClampedInt",value:function(t,e,i){if(e==i)return t;var n,s;return i>e?(n=e,s=i):(n=i,s=e),n>t?s:t>s?n:t}},{key:"sign",value:function(t){return 0>t?-1:1}},{key:"FXPTFromInt",value:function(t){return t*e.kFXPTScale}},{key:"FXPTMultiplyXX",value:function(t,i){return~~(t*i/e.kFXPTScale)}},{key:"FXPTDivideXX",value:function(t,i){return~~(t*e.kFXPTScale/i)}},{key:"FXPTSmoothXXX",value:function(t,i,n){return 0>=n?i:n>=e.kFXPTOne?t:e.FXPTMultiplyXX(t,n)+e.FXPTMultiplyXX(i,e.kFXPTOne-n)}},{key:"computeGridIndex",value:function(t,e,i){return e*i+t}},{key:"computeXFromGridIndex",value:function(t,e){return t%e}},{key:"computeYFromGridIndex",value:function(t,e){return~~(t/e)}},{key:"computeGridBit",value:function(t,i,n){return 1<<e.computeGridIndex(t,i,n)}},{key:"getValueFromPackedBits",value:function(t,e,i){return(t&e)>>>i}},{key:"setValueInPackedBits",value:function(t,e,i,n){return e&~i|t<<n&i}}]),e}();b.kPieceType_I=1,b.kPieceType_J=2,b.kPieceType_L=3,b.kPieceType_O=4,b.kPieceType_S=5,b.kPieceType_T=6,b.kPieceType_Z=7,b.kTransformIdNumBits_facing=2,b.kTransformIdNumBits_xy=16,b.kTransformIdBitShift_facing=0,b.kTransformIdBitShift_xy=2,b.kTransformIdBitMask_facing=3,b.kTransformIdBitMask_xy=262140,b.kInvalidTransformId=-1,b.kRotationalSymmetryType_none=0,b.kRotationalSymmetryType_90=90,b.kRotationalSymmetryType_180=180,b.kDirection_N=1,b.kDirection_NE=2,b.kDirection_E=4,b.kDirection_SE=8,b.kDirection_S=16,b.kDirection_SW=32,b.kDirection_W=64,b.kDirection_NW=128,b.kFacing_N=0,b.kFacing_E=1,b.kFacing_S=2,b.kFacing_W=3,b.kNumFacings=4,b.kTransformAction_invalid=-1,b.kTransformAction_none=0,b.kTransformAction_moveLeft=1,b.kTransformAction_moveRight=2,b.kTransformAction_moveDown=3,b.kTransformAction_rotateCWPoint1=4,b.kTransformAction_rotateCWPoint2=5,b.kTransformAction_rotateCWPoint3=6,b.kTransformAction_rotateCWPoint4=7,b.kTransformAction_rotateCWPoint5=8,b.kTransformAction_rotateCCWPoint1=9,b.kTransformAction_rotateCCWPoint2=10,b.kTransformAction_rotateCCWPoint3=11,b.kTransformAction_rotateCCWPoint4=12,b.kTransformAction_rotateCCWPoint5=13,b.kTransformAction_hardDrop=14,b.kTransformAction_followTarget=15,b.kTransformAction_lockAtTarget=16,b.kTransformAction_invalidateTarget=17,b.kNumTransformActionsForPieceData=14,b.kControlAction_none=0,b.kControlAction_moveLeft=1,b.kControlAction_moveRight=2,b.kControlAction_rotateCW=3,b.kControlAction_rotateCCW=4,b.kControlAction_superRotateCW=5,b.kControlAction_superRotateCCW=6,b.kControlAction_startSoftDrop=7,b.kControlAction_stopSoftDrop=8,b.kControlAction_hardDrop=9,b.kControlAction_hold=10,b.kControlAction_updateGhost=11,b.kControlAction_moveTarget=12,b.kControlAction_moveTargetLeft=13,b.kControlAction_moveTargetRight=14,b.kControlAction_cycleTarget=15,b.kControlAction_moveToTarget=16,b.kControlAction_selectTarget=17,b.kFXPTScale=1e3,b.kFXPTOne=1e3,b.sIsDebugModeOn=!1;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),w=n.TetSmartControlInterface=function(){function e(i,n,s,r){t(this,e),this.mIsDestroyed=!1;var o;r?(o=h.getSharedStandardPieceData(i,n),this.mPieceData=null):(this.mPieceData=new h(i,n),o=this.mPieceData),this.mModel=new T(this,i,n,o),this.mController=new v(this,i,n,s,o),this.mController.setModel(this.mModel)}return s(e,[{key:"isDestroyed",value:function(){return this.mIsDestroyed}},{key:"enableInputType",value:function(t){this.mController.enableInputType(t)}},{key:"getActiveInputType",value:function(){return this.mController.getActiveInputType()}},{key:"setActiveInputType",value:function(t){this.mController.setActiveInputType(t)}},{key:"setEnableAutomaticInputTypeSwitching",value:function(t){this.mController.setEnableAutomaticInputTypeSwitching(t)}},{key:"setDirectInputParameter_placementsAllowedBeforeLock",value:function(t){this.mModel.mDirectPlacementsAllowedBeforeLock=t}},{key:"setSmartInputParameter_cellTrackingInset_FXPT",value:function(t){this.mController.getSmartInputMgr().mCellTrackingInset_FXPT=t}},{key:"setSmartInputParameter_restrictReachableTransforms",value:function(t){this.mController.getSmartInputMgr().setParameter_restrictReachableTransforms(t)}},{key:"setSmartInputParameter_searchCellForTarget",value:function(t){this.mController.getSmartInputMgr().mSearchCellForTarget=t}},{key:"setSmartInputParameter_searchColumnForTarget",value:function(t){this.mController.getSmartInputMgr().mSearchColumnForTarget=t}},{key:"setSmartInputParameter_livePieceStartingYOffset",value:function(t){this.mModel.mLivePieceStartingYOffset=t}},{key:"setSmartInputParameter_lockLivePieceAtTarget",value:function(t){this.mModel.mLockLivePieceAtTarget=t}},{key:"setSmartInputParameter_snapToTargetOnTouchDownFallSpeedMSEC",value:function(t){this.mModel.mSnapToTargetOnTouchDownFallSpeedMSEC=t}},{key:"setSmartInputParameter_updateTargetWhilePointerInputIsOff",value:function(t){this.mController.getSmartInputMgr().mUpdateTargetWhilePointerInputIsOff=t}},{key:"setSmartInputParameter_selectTargetAtPointerInputOn",value:function(t){this.mController.getSmartInputMgr().mSelectTargetAtPointerInputOn=t}},{key:"setSmartInputParameter_pointerSelectTargetMatrixBufferX",value:function(t){this.mController.getSmartInputMgr().mPointerSelectTargetMatrixBufferX=t}},{key:"setSmartInputParameter_pointerSelectTargetMatrixBufferY",value:function(t){this.mController.getSmartInputMgr().mPointerSelectTargetMatrixBufferY=t}},{key:"setSmartInputParameter_pointerSmoothingWeight_FXPT",value:function(t){this.mController.getSmartInputMgr().mPointerSmoothingWeight_FXPT=t}},{key:"setSmartInputParameter_smartPlacementsAllowedBeforeLock",value:function(t){this.mModel.mSmartPlacementsAllowedBeforeLock=t}},{key:"setSmartInputParameter_forceValidTarget",value:function(t){this.mController.getSmartInputMgr().mForceValidTarget=t}},{key:"setGestureInputParameter_maxRotationTapDistance_FXPT",value:function(t){this.mController.getGestureInputMgr().mMaxRotationTapDistance_FXPT=t}},{key:"setGestureInputParameter_enableCCWRotation",value:function(t){this.mController.getGestureInputMgr().mEnableCCWRotation=t}},{key:"setGestureInputParameter_moveLRDragDistanceX_FXPT",value:function(t){this.mController.getGestureInputMgr().mMoveLRDragDistance_FXPT=t}},{key:"setGestureInputParameter_minSoftDropDragDistance_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinStopSoftDropDragDistanceY_FXPT=t}},{key:"setGestureInputParameter_minSoftDropDragVelocityY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinSoftDropDragVelocityY_FXPT=t}},{key:"setGestureInputParameter_minStopSoftDropDragDistanceY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinStopSoftDropDragDistanceY_FXPT=t}},{key:"setGestureInputParameter_minStopSoftDropDragVelocityY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinStopSoftDropDragVelocityY_FXPT=t}},{key:"setGestureInputParameter_minHardDropDragDistanceY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinHardDropDragDistanceY_FXPT=t}},{key:"setGestureInputParameter_minHardDropDragVelocityY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinHardDropDragVelocityY_FXPT=t}},{key:"setGestureInputParameter_minHoldDragDistanceY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinHoldDragDistanceY_FXPT=t}},{key:"setGestureInputParameter_minHoldDragVelocityY_FXPT",value:function(t){this.mController.getGestureInputMgr().mMinHoldDragVelocityY_FXPT=t}},{key:"addStandardPieceDefinitions",value:function(){this.mPieceData&&this.mPieceData.addStandardPieceDefinitions()}},{key:"addPieceDefinition",value:function(t,e){this.mPieceData&&this.mPieceData.addPieceDefinition(t,e)}},{key:"addPieceDefinitionMino",value:function(t,e,i){this.mPieceData&&this.mPieceData.addPieceDefinitionMino(t,e,i)}},{key:"addPieceDefinitionRotationPointSet",value:function(t,e,i,n,s,r,o,a,h){this.mPieceData&&this.mPieceData.addPieceDefinitionRotationPointSet(t,e,i,n,s,r,o,a,h)}},{key:"setPieceDefinitionGenerationOffset",value:function(t,e,i){this.mPieceData&&this.mPieceData.setPieceDefinitionGenerationOffset(t,e,i)}},{key:"setPieceDefinitionRotationalSymmetry",value:function(t,e,i,n){this.mPieceData&&this.mPieceData.setPieceDefinitionRotationalSymmetry(t,e,i,n)}},{key:"processPieceDefinitions",value:function(){this.mPieceData&&this.mPieceData.processPieceDefinitions()}},{key:"processTime",value:function(){this.mController.processTime()}},{key:"performEvaluationForNewLivePiece",value:function(t,e,i,n){for(this.mModel.captureStateForNewLivePiece(t,e,i,n),this.mController.startEvaluationForNewLivePiece();!this.mController.processEvaluationForNewLivePiece(););}},{key:"updateEvaluationForCurrentLivePiece",value:function(){for(this.mModel.captureStateForCurrentLivePiece(),this.mController.startEvaluationForNewLivePiece();!this.mController.processEvaluationForNewLivePiece(););}},{key:"setCurrentStateMatrixMino",value:function(t,e,i){this.mModel.setCurrentStateMatrixMino(t,e,i)}},{key:"handleInputPositionChanged",value:function(t,e,i){return this.mController.handleInputPositionChanged(t,e,i)}},{key:"handleInputIsOn",value:function(t,e,i){return this.mController.handleInputIsOn(t,e,i)}},{key:"handleInputIsOff",value:function(t,e,i){return this.mController.handleInputIsOff(t,e,i)}},{key:"handleInputOnIsCancelled",value:function(t){this.mController.handleInputOnIsCancelled(t)}},{key:"isInputOn",value:function(t){return this.mController.isInputOn(t)}},{key:"isSoftDropOn",value:function(){return this.mController.isSoftDropOn()}},{key:"didPlayerActivelySelectTarget",value:function(){return this.mModel.didPlayerActivelySelectTarget()}},{key:"handleLivePieceDidActivate",value:function(){this.mModel.handleLivePieceDidActivate(),this.mController.handleLivePieceDidActivate()}},{key:"handleLivePieceDidFall",value:function(){this.mModel.handleLivePieceDidFall()}},{key:"handleLivePieceDidTouchDown",value:function(){this.mModel.handleLivePieceDidTouchDown(),this.mController.handleLivePieceDidTouchDown()}},{key:"handleLivePieceWillLockDown",value:function(){this.mModel.handleLivePieceWillLockDown()}},{key:"handleLivePieceDidDeactivate",value:function(){this.mModel.handleLivePieceDidDeactivate(),this.mController.handleLivePieceDidDeactivate()}},{key:"getEndingRotationPointForPiece",value:function(){return this.mModel.getEndingRotationPointForPiece()}},{key:"isSoftDropOnAndValid",value:function(){return this.mModel.isSoftDropOnAndValid()}},{key:"getSoftDropStepsForPiece",value:function(){return this.mModel.getSoftDropStepsForPiece()}},{key:"getHardDropStepsForPiece",value:function(){return this.mModel.getHardDropStepsForPiece()}},{key:"suspendActivity",value:function(){this.mModel.suspendActivity()}},{key:"resumeActivity",value:function(){this.mModel.resumeActivity()}},{key:"isActive",value:function(){return this.mModel.isActive()}},{key:"getMatrixWidth",value:function(){return this.mModel.getGameState().getMatrixWidth()}},{key:"getMatrixHeight",value:function(){return this.mModel.getGameState().getMatrixHeight()}},{key:"getModel",value:function(){return this.mModel}},{key:"getController",value:function(){return this.mController}},{key:"destroy",value:function(){this.isDestroyed()||(this.mController.destroy(),this.mController&&(this.mController=null),this.mModel.destroy(),this.mModel&&(this.mModel=null),this.mPieceData&&(this.mPieceData.destroy(),this.mPieceData&&(this.mPieceData=null)),this.mIsDestroyed=!0)}},{key:"TetSmartControlInterface_captureMatrix",value:function(){}},{key:"TetSmartControlInterface_getTimeMSEC",value:function(){return 0}},{key:"TetSmartControlInterface_setLivePieceTransform",value:function(t,e,i,n,s){}},{key:"TetSmartControlInterface_performControlAction",value:function(t){return!1}},{key:"TetSmartControlInterface_controlActionFailed",value:function(t){}},{key:"TetSmartControlInterface_getLivePieceX",value:function(){return 0}},{key:"TetSmartControlInterface_getLivePieceY",value:function(){return 0}},{key:"TetSmartControlInterface_getLivePieceFacing",value:function(){return 0}},{key:"TetSmartControlInterface_setGhostPieceTransform",value:function(t,e,i){}},{key:"TetSmartControlInterface_setGhostPieceIsValid",value:function(t){}},{key:"TetSmartControlInterface_getNormalFallSpeedMSEC",value:function(){return 1e3}},{key:"TetSmartControlInterface_stopLivePieceFalling",value:function(){}},{key:"TetSmartControlInterface_restartLivePieceFalling",value:function(t){}},{key:"TetSmartControlInterface_cancelLockTimer",value:function(){}},{key:"TetSmartControlInterface_startLockTimer",value:function(){}},{key:"TetSmartControlInterface_lockLivePiece",value:function(){}},{key:"TetSmartControlInterface_startedControllingLivePieceToTarget",value:function(){}}]),e}();return w.kInputType_direct=1,w.kInputType_smart=2,w.kInputType_gesture=3,w.kDirectInputId_moveLeft=257,w.kDirectInputId_moveRight=258,w.kDirectInputId_rotateCW=259,w.kDirectInputId_rotateCCW=260,w.kDirectInputId_softDrop=261,w.kDirectInputId_hardDrop=262,w.kDirectInputId_hold=263,w.kSmartInputId_pointer=513,w.kSmartInputId_moveTargetLeft=514,w.kSmartInputId_moveTargetRight=515,w.kSmartInputId_cycleTarget=516,w.kSmartInputId_selectTarget=517,w.kSmartInputId_hold=518,w.kGestureInputId_pointer=769,w.kGestureInputId_hold=770,w.kSmartControlVersionNumber="206.04-debug-01",n}),define("gameplay/input/TetriminoTypeConverter",["enums/TetriminoType","gameplay/input/TetSmartControlJS"],function(t,e){function i(){}var n=e.TetAIUtils;
return i.fromSmartControl=function(e){switch(e){case n.kPieceType_O:return t.O;case n.kPieceType_Z:return t.Z;case n.kPieceType_J:return t.J;case n.kPieceType_L:return t.L;case n.kPieceType_S:return t.S;case n.kPieceType_T:return t.T;case n.kPieceType_I:return t.I}},i.fromTetriminoType=function(e){switch(e){case t.O:return n.kPieceType_O;case t.Z:return n.kPieceType_Z;case t.J:return n.kPieceType_J;case t.L:return n.kPieceType_L;case t.S:return n.kPieceType_S;case t.T:return n.kPieceType_T;case t.I:return n.kPieceType_I}},i}),define("gameplay/input/OrientationConverter",["enums/Orientation","gameplay/input/TetSmartControlJS"],function(t,e){function i(){}var n=e.TetAIUtils;return i.fromSmartControl=function(e){switch(e){case n.kFacing_N:return t.NORTH;case n.kFacing_S:return t.SOUTH;case n.kFacing_E:return t.EAST;case n.kFacing_W:return t.WEST}},i.fromOrientation=function(e){switch(e){case t.NORTH:return n.kFacing_N;case t.SOUTH:return n.kFacing_S;case t.EAST:return n.kFacing_E;case t.WEST:return n.kFacing_W}},i}),define("gameplay/input/SmartControls",["bottom_line","phaser","gameplay/input/TetSmartControlJS","gameplay/input/TetriminoTypeConverter","gameplay/input/OrientationConverter","gt/utils/device","enums/TetriminoType","enums/Orientation","enums/Rotation","enums/Direction","data/ControlScheme","enums/TutorialType"],function(t,e,i,n,s,r,o,a,h,l,c,u){function d(matrixConfig,matrixConverter,matrixController,gameInfoPublisher,matrixView,matrixModel,forcedMove,phaserEvents,controlScheme,soundManager,gameVarManager){this._matrixConfig=matrixConfig,this._matrixConverter=matrixConverter,this._matrixController=matrixController,this._gameInfoPublisher=gameInfoPublisher,this._matrixView=matrixView,this._matrixModel=matrixModel,this._forcedMove=forcedMove,this._phaserEvents=phaserEvents,this._controlScheme=controlScheme,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._tetriminoController=null,this._currentTetrimino=null,this._screenButtons=null,this._inputAllowed=!0,this._createSignals(),d._super.constructor.call(this,this._matrixConfig.COLS,this._matrixConfig.ROWS,this._matrixConfig.PLAYABLE_ROWS_COUNT,!0),this.enableInputType(A.kInputType_smart),this.enableInputType(A.kInputType_gesture),this._currentPointer=A.kSmartInputId_pointer,this._currentSwipeAction=d.INVALID_SWIPE_ID,this._startDateTime=Date.now(),this._gameInfoPublisher.subscribe("levelStart",this._addEvents,this),this._gameInfoPublisher.subscribe("gameEnded",this._removeEvents,this)}var A=i.TetSmartControlInterface,p=i.TetAIUtils;return t.inherit(d,A),d.INVALID_SWIPE_ID=-1,d.prototype.activateSmart=function(){this.setActiveInputType(A.kInputType_smart),this._currentPointer=A.kSmartInputId_pointer},d.prototype.activateSwipe=function(){this.setActiveInputType(A.kInputType_gesture),this._currentPointer=A.kGestureInputId_pointer},d.prototype.start=function(){this.activateSmart(),this._currentSwipeAction=d.INVALID_SWIPE_ID,r.desktop?(this.setSmartInputParameter_updateTargetWhilePointerInputIsOff(!0),this.setSmartInputParameter_selectTargetAtPointerInputOn(!0)):(this.setSmartInputParameter_updateTargetWhilePointerInputIsOff(!1),this.setSmartInputParameter_selectTargetAtPointerInputOn(!1)),this.setGestureInputParameter_moveLRDragDistanceX_FXPT(1200),this.setSmartInputParameter_pointerSelectTargetMatrixBufferX(1200),this.setGestureInputParameter_minSoftDropDragVelocityY_FXPT(8e3),this.setGestureInputParameter_minHardDropDragVelocityY_FXPT(14e3),this.pause(),this._phaserEvents.updateEvent.add(this._update,this)},d.prototype.stop=function(){this._phaserEvents.updateEvent.remove(this._update,this)},d.prototype.setTetriminoController=function(tetriminoController){this._tetriminoController=tetriminoController},d.prototype.newTetriminoSpawned=function(t,e,i){this._currentSwipeAction=d.INVALID_SWIPE_ID,this._currentTetrimino=t;var r=s.fromOrientation(this._currentTetrimino.orientation),o=n.fromTetriminoType(this._currentTetrimino.tetriminoType);this.performEvaluationForNewLivePiece(o,i,e,r),this.handleLivePieceDidActivate()},d.prototype.tetriminoFall=function(){this.handleLivePieceDidFall()},d.prototype.tetriminoTouchDown=function(){this.handleLivePieceDidTouchDown()},d.prototype.tetriminoLockedDown=function(){this.handleLivePieceWillLockDown()},d.prototype.tetriminoDeactivate=function(){this.handleLivePieceDidDeactivate()},d.prototype.resume=function(){this.paused=!1,this.usingKeyboard||this.resumeActivity()},d.prototype.pause=function(){this.paused=!0,this.suspendActivity()},d.prototype.startedUsingKeyboard=function(){this.usingKeyboard=!0,this.suspendActivity()},d.prototype.startedUsingMouse=function(){this.usingKeyboard=!1,this.paused||this.resumeActivity()},d.prototype.isSmartControlActive=function(){return this.isActive()},d.prototype.tetriminoDeactivate=function(){this.handleLivePieceDidDeactivate()},d.prototype.pointerMoved=function(t){if(!this.paused){this._controlScheme[c.CURRENT_SCHEME_KEY]!==c.SWIPE&&(this._controlScheme[c.CURRENT_SCHEME_KEY]=c.SMART),this.startedUsingMouse();var e=this._getMatrixCoordinates(t);this._controlScheme[c.CURRENT_SCHEME_KEY]===c.SWIPE?(e=this._matrixConverter.swipeCoordinates(t.x,t.y),this.handleInputPositionChanged(this._currentPointer,Math.round(e.col*p.kFXPTScale),Math.round(e.row*p.kFXPTScale))):this.handleInputPositionChanged(this._currentPointer,e.col*p.kFXPTScale,e.row*p.kFXPTScale)}},d.prototype.pointerDown=function(t){if(this._currentSwipeAction=d.INVALID_SWIPE_ID,!this.paused){for(var e in this._screenButtons){var i=this._screenButtons[e];if(t.x>i.global.x-i.dimensions.width/2&&t.x<i.global.x+i.dimensions.width/2&&t.y>i.global.y-i.dimensions.height/2&&t.y<i.global.y+i.dimensions.height/2)return void console.log("Clicked on button "+e+", don't do smart stuff")}if(!r.desktop||this._forcedMove.isMoveLegal(this._tetriminoController.ghostTetrimino,!0)||this.getActiveInputType()===A.kInputType_gesture){var n=this._getMatrixCoordinates(t);this.handleInputIsOn(this._currentPointer,n.col*p.kFXPTScale,n.row*p.kFXPTScale)}}},d.prototype.pointerUp=function(t){if(!this.paused){if(r.portable&&!this._forcedMove.isMoveLegal(this._tetriminoController.ghostTetrimino,!0)&&this.getActiveInputType()!==A.kInputType_gesture)return void this.pointerCancelled();var e=this._getMatrixCoordinates(t);this.handleInputIsOff(this._currentPointer,e.col*p.kFXPTScale,e.row*p.kFXPTScale)}},d.prototype.pointerCancelled=function(){this.paused||this.handleInputOnIsCancelled(this._currentPointer)},d.prototype.setFallSpeed=function(t){this._fallSpeed=t},d.prototype.translateFromSmart=function(t){if(this._currentTetrimino.tetriminoType===o.I)switch(t.orientation){case a.NORTH:break;case a.WEST:t.y++;break;case a.SOUTH:t.x--,t.y++;break;case a.EAST:t.x--}else if(this._currentTetrimino.tetriminoType===o.O)switch(t.orientation){case a.NORTH:break;case a.WEST:t.x--;break;case a.SOUTH:t.x--,t.y--;break;case a.EAST:t.y--}},d.prototype.translateToSmart=function(t){if(this._currentTetrimino.tetriminoType===o.I)switch(t.orientation){case a.NORTH:break;case a.WEST:t.y--;break;case a.SOUTH:t.x++,t.y--;break;case a.EAST:t.x++}else if(this._currentTetrimino.tetriminoType===o.O)switch(t.orientation){case a.NORTH:break;case a.WEST:t.x++;break;case a.SOUTH:t.x++,t.y++;break;case a.EAST:t.y++}},d.prototype.smartControlsEndedWithRotation=function(){return this.getEndingRotationPointForPiece()},d.prototype.setScreenButtons=function(t){this._screenButtons=t},d.prototype.getCurrentPointer=function(){return this._currentPointer},d.prototype._tetriminoSpawnComplete=function(){r.portable&&this.getActiveInputType()===A.kInputType_smart?this._gameInfoPublisher.publish("ghostPieceVisibilityChanged",!1):this._gameInfoPublisher.publish("ghostPieceVisibilityChanged",!0)},d.prototype._shouldClampInput=function(){return this.getActiveInputType()!==A.kInputType_gesture},d.prototype._getMatrixCoordinates=function(t){var e=this._shouldClampInput();this._controlScheme[c.CURRENT_SCHEME_KEY]==c.SWIPE&&(e=!1);var i;return i=this._matrixConverter.screenToMatrixCoordinate(t.x,t.y,e)},d.prototype._performSwipeTransform=function(t,e,i){switch(t){case p.kControlAction_superRotateCW:case p.kControlAction_rotateCW:this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_rotation_sfx),this.smartControlsTransform.dispatch(i.x,i.y,i.orientation);break;case p.kControlAction_superRotateCCW:case p.kControlAction_rotateCCW:this._soundManager.effect(this._gameVarManager.audioConstants.tetrimino_rotation_sfx),this.smartControlsTransform.dispatch(i.x,i.y,i.orientation);break;case p.kControlAction_moveLeft:this._tetriminoController.moveTetrimino(l.LEFT);break;case p.kControlAction_moveRight:this._tetriminoController.moveTetrimino(l.RIGHT);break;case p.kControlAction_hardDrop:if(this._inputAllowed){var n=this.getHardDropStepsForPiece();this._gameInfoPublisher.publish("smartControlDrop",n,0)}break;case p.kControlAction_startSoftDrop:case p.kControlAction_stopSoftDrop:case p.kControlAction_hold:}this._currentSwipeAction=t},d.prototype._performSmartTransform=function(t,e,i){if(this.smartControlsTransform.dispatch(i.x,i.y,i.orientation),t===p.kControlAction_selectTarget&&this._inputAllowed){var n=this.getHardDropStepsForPiece(),s=this.getSoftDropStepsForPiece();this._gameInfoPublisher.publish("smartControlDrop",n,s),this.onLoseControl.dispatch()}},d.prototype._setTutorialInputActive=function(t,e){t==u.HOLD?this._inputAllowed=e.tutorialInputActive:this._inputAllowed=!0},d.prototype._logMinoState=function(){for(var t=this.getModel().getPieceData(),e=this.getModel().getGameState(),i=t.getPiece(e.getLivePieceTypeId(),e.getLivePieceCurrentTransform()),n="Mino: ",s=0;4>s;s++){var r=i.mMinosXY[s],o=r%10,a=~~(r/10);n+="("+o+", "+a+") - "}console.log(n)},d.prototype._getSoftDropVelocity=function(){var t=4e3,e=1e9;return this._forcedMove.moveGhostMinosCleared?t:e},d.prototype._getHardDropVelocity=function(){var t=8e3,e=1e9,i=this._tetriminoController&&this._tetriminoController.ghostTetrimino&&this._forcedMove.isMoveLegal(this._tetriminoController.ghostTetrimino,!0);return i?t:e},d.prototype._update=function(){this.getModel().mAllowDirectRotationalHovering=this._tetriminoController.isFallingLocked(),this.setGestureInputParameter_minSoftDropDragVelocityY_FXPT(this._getSoftDropVelocity()),this.setGestureInputParameter_minHardDropDragVelocityY_FXPT(this._getHardDropVelocity()),this.processTime()},d.prototype._createSignals=function(){this.onLoseControl=new e.Signal,this.smartControlsTransform=new e.Signal,this.onTetriminoLocked=new e.Signal,this.startSoftDropSignal=new e.Signal,this.endSoftDropSignal=new e.Signal,this.holdSignal=new e.Signal},d.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("gamePaused",this.pause,this),this._gameInfoPublisher.subscribe("gameResumed",this.resume,this),this._gameInfoPublisher.subscribe("newTetriminoSpawned",this.newTetriminoSpawned,this),this._gameInfoPublisher.subscribe("tetriminoDeactivate",this.tetriminoDeactivate,this),this._gameInfoPublisher.subscribe("fallSpeedChanged",this.setFallSpeed,this),this._gameInfoPublisher.subscribe("countdownFinished",this.resume,this),this._gameInfoPublisher.subscribe("tetriminoFell",this.tetriminoFall,this),this._gameInfoPublisher.subscribe("tetriminoTouchDown",this.tetriminoTouchDown,this),this._gameInfoPublisher.subscribe("tetriminoSpawnComplete",this._tetriminoSpawnComplete,this),this._gameInfoPublisher.subscribe("tutorialStarted",this._setTutorialInputActive,this),this._gameInfoPublisher.subscribe("tutorialFinished",this._setTutorialInputActive,this),this._controlScheme[c.CURRENT_SCHEME_KEY]===c.SWIPE&&(this._gameInfoPublisher.subscribe("deactivateSwipe",this.pause,this),this._gameInfoPublisher.subscribe("tetriminoSpawnComplete",this.resume,this))},d.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("gamePaused",this.pause,this),this._gameInfoPublisher.unsubscribe("gameResumed",this.resume,this),this._gameInfoPublisher.unsubscribe("newTetriminoSpawned",this.newTetriminoSpawned,this),this._gameInfoPublisher.unsubscribe("tetriminoDeactivate",this.tetriminoDeactivate,this),this._gameInfoPublisher.unsubscribe("fallSpeedChanged",this.setFallSpeed,this),this._gameInfoPublisher.unsubscribe("countdownFinished",this.resume,this),this._gameInfoPublisher.unsubscribe("tetriminoFell",this.tetriminoFall,this),this._gameInfoPublisher.unsubscribe("tetriminoTouchDown",this.tetriminoTouchDown,this),this._gameInfoPublisher.unsubscribe("tetriminoSpawnComplete",this._tetriminoSpawnComplete,this),this._gameInfoPublisher.unsubscribe("tutorialStarted",this._setTutorialInputActive,this),this._gameInfoPublisher.unsubscribe("tutorialFinished",this._setTutorialInputActive,this),this._controlScheme[c.CURRENT_SCHEME_KEY]===c.SWIPE&&(this._gameInfoPublisher.unsubscribe("deactivateSwipe",this.pause,this),this._gameInfoPublisher.unsubscribe("tetriminoSpawnComplete",this.resume,this))},d.prototype.TetSmartControlInterface_resetForNewGame=function(){d._super.TetSmartControlInterface_resetForNewGame.call(this)},d.prototype.TetSmartControlInterface_setLivePieceTransform=function(t,e,i,n,r){if(n===p.kControlAction_moveToTarget)return!1;var o=s.fromSmartControl(i),a={x:t,y:e,orientation:o};return this.translateFromSmart(a),this.getActiveInputType()===A.kInputType_gesture?this._performSwipeTransform(n,r,a):this.getActiveInputType()===A.kInputType_smart&&this._performSmartTransform(n,r,a),!0},d.prototype.TetSmartControlInterface_performControlAction=function(t){switch(t){case p.kControlAction_superRotateCW:case p.kControlAction_superRotateCCW:case p.kControlAction_moveLeft:case p.kControlAction_moveRight:case p.kControlAction_hardDrop:return!1;case p.kControlAction_startSoftDrop:this.startSoftDropSignal.dispatch();break;case p.kControlAction_stopSoftDrop:this.endSoftDropSignal.dispatch();break;case p.kControlAction_hold:this.holdSignal.dispatch()}return!0},d.prototype.TetSmartControlInterface_controlActionFailed=function(t){switch(console.warn("Control action failed: "+t),t){case 1:this._soundManager.effect(this._gameVarManager.audioConstants.movement_failure_sfx);break;case 2:this._soundManager.effect(this._gameVarManager.audioConstants.movement_failure_sfx);break;case 3:this._soundManager.effect(this._gameVarManager.audioConstants.rotation_failure_sfx);break;case 4:this._soundManager.effect(this._gameVarManager.audioConstants.rotation_failure_sfx);break;case 5:this._soundManager.effect(this._gameVarManager.audioConstants.rotation_failure_sfx);break;case 6:this._soundManager.effect(this._gameVarManager.audioConstants.rotation_failure_sfx)}},d.prototype.TetSmartControlInterface_getLivePieceX=function(){var t={x:this._currentTetrimino.col,y:this._currentTetrimino.row,orientation:this._currentTetrimino.orientation};return this.translateToSmart(t),t.x},d.prototype.TetSmartControlInterface_getLivePieceY=function(){var t={x:this._currentTetrimino.col,y:this._currentTetrimino.row,orientation:this._currentTetrimino.orientation};return this.translateToSmart(t),t.y},d.prototype.TetSmartControlInterface_getLivePieceFacing=function(){return s.fromOrientation(this._currentTetrimino.orientation)},d.prototype.TetSmartControlInterface_setGhostPieceTransform=function(t,e,i){var n=s.fromSmartControl(i),r={x:t,y:e,orientation:n};this.translateFromSmart(r),this._gameInfoPublisher.publish("ghostPieceTransformChanged",this._currentTetrimino.tetriminoType,r.x,r.y,n)},d.prototype.TetSmartControlInterface_setGhostPieceIsValid=function(t){this._gameInfoPublisher.publish("ghostPieceVisibilityChanged",t)},d.prototype.TetSmartControlInterface_canLivePieceFall=function(){return console.log("Not Implemented: canLivePieceFall"),!0},d.prototype.TetSmartControlInterface_getNormalFallSpeedMSEC=function(){return this._fallSpeed},d.prototype.TetSmartControlInterface_stopLivePieceFalling=function(){console.warn("Not Implemented: Stop live piece falling"),d._super.TetSmartControlInterface_stopLivePieceFalling.call(this)},d.prototype.TetSmartControlInterface_restartLivePieceFalling=function(){console.warn("Not Implemented: Restart live piece falling"),d._super.TetSmartControlInterface_restartLivePieceFalling.call(this)},d.prototype.TetSmartControlInterface_cancelLockTimer=function(){console.warn("Not Implemented: Cancel the lockdown timer"),d._super.TetSmartControlInterface_cancelLockTimer.call(this)},d.prototype.TetSmartControlInterface_startLockTimer=function(){console.warn("Not Implemented: Start lock down timer"),d._super.TetSmartControlInterface_startLockTimer.call(this)},d.prototype.TetSmartControlInterface_lockLivePiece=function(){this.onTetriminoLocked.dispatch(),d._super.TetSmartControlInterface_lockLivePiece.call(this)},d.prototype.TetSmartControlInterface_getTimeMSEC=function(){return Date.now()-this._startDateTime},d.prototype.TetSmartControlInterface_captureMatrix=function(){for(var t=this._currentTetrimino.getMinos(),e=0;e<this._matrixConfig.COLS;e++)for(var i=0;i<this._matrixConfig.PLAYABLE_ROWS_COUNT;i++){var s=this._matrixController.getMatrixCell(i,e),r=s.getPrisoner();if(r&&-1==t.indexOf(r)){var o=n.fromTetriminoType(r.tetriminoType);this.setCurrentStateMatrixMino(o,e,i)}}},d}),define("gui/SpineUtil",[],function(){var t=function(spineAnimationFactory){this._spineAnimationFactory=spineAnimationFactory};return t.prototype.replacePlaceholder=function(t,e){var entity=this._spineAnimationFactory.construct(e);return t.parent.add(entity),entity.x=t.x,entity.y=t.y,entity},t.prototype.createAnimation=function(t,e){var entity=this._spineAnimationFactory.construct(t);return e.add(entity),entity},t}),define("utils/ScreenShaker",["gt/utils/device"],function(t){function e(phaserEvents,game,viewportManager){this._game=game,this._viewportManager=viewportManager,this._cameraShake=!1,this._currentShakeTime=0,this._maxShakeTime=0,this._shakeWorldMax=0,this._viewportX=0,this._viewportY=0,phaserEvents.updateEvent.add(this._update,this)}return e.prototype.activate=function(e,i){this._cameraShake&&this._reset(),this._shakeWorldMax=e||.5*this._viewportManager.scale,this._maxShakeTime=i||300,this._viewportX=this._viewportManager.view.x,this._viewportY=this._viewportManager.view.y,this._cameraShake=!0,t.mobile&&navigator.vibrate&&window.navigator.vibrate(this._maxShakeTime)},e.prototype._reset=function(){this._cameraShake=!1,this._currentShakeTime=0,this._viewportManager.view.x=this._viewportX,this._viewportManager.view.y=this._viewportY},e.prototype._update=function(){if(this._cameraShake){this._currentShakeTime+=this._game.time.elapsed;var t=this._maxShakeTime/this._currentShakeTime*this._shakeWorldMax,e=this._game.rnd.integerInRange(-t,t),i=this._game.rnd.integerInRange(-t,t);this._viewportManager.view.x=this._viewportX+e,this._viewportManager.view.y=this._viewportY+i,this._currentShakeTime>=this._maxShakeTime&&this._reset()}},e}),define("utils/CustomTimer",[],function(){function t(){this._startTime=0,this._endTime=0}return t.prototype.startTime=function(){return this._startTime=Date.now(),this.endTime&&(this.endTime=0),this._startTime},t.prototype.stopTime=function(){return this._stopTime=Date.now(),this._stopTime},t.prototype._getDelta=function(){return this._stopTime-this._startTime},Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this._getDelta()}}),t.prototype.currentElapsedTime=function(){return Date.now-this._startTime},t}),define("gameplay/LineClearCounter",[],function(){function t(matrixRowMatcher,gameStateManager,gameInfoPublisher){this._gameInfoPublisher=gameInfoPublisher,this._addSignals(matrixRowMatcher,gameStateManager),this._resetCounter()}return t.prototype._resetCounter=function(){this._counter=0,this._gameInfoPublisher.publish("linesClearedChanged",this._counter)},t.prototype._countLines=function(t){this._counter+=t,this._gameInfoPublisher.publish("linesClearedChanged",this._counter)},t.prototype.getClearedLinesCount=function(){return this._counter},t.prototype._addSignals=function(matrixRowMatcher,gameStateManager){matrixRowMatcher.clearedRowsSignal.add(this._countLines,this),gameStateManager.gameStartSignal.add(this._resetCounter,this)},t}),define("gameplay/matrix/MatrixAnimator",["phaser","enums/Direction","gt/utils/device"],function(t,e,i){function n(screenShaker,spineUtil,matrixConfig,matrixModel,soundManager,gameVarManager,gameInfoPublisher,game){this._screenShaker=screenShaker,this._spineUtil=spineUtil,this._matrixConfig=matrixConfig,this._matrixModel=matrixModel,this._soundManager=soundManager,this._gameVarManager=gameVarManager,this._gameInfoPublisher=gameInfoPublisher,this._game=game,this._matrixX=0,this._matrixY=0,this._notificationsEnabled=!0,this._bgmCanPlay=!0,this._scorePopup=null,this._scoreTween=null}return n.SCORE_TWEEN_TIME=250,n.SCORE_DELAY=250,n.prototype.initAnimator=function(t,e,i,n,s){this._matrixX=i,this._matrixY=n,this._scorePopup=s,this._setupAnimations(t,e),this._setupScoreTween()},n.prototype.playAnimationAt=function(t,e,i,n,s,r){n=n||0,e=e||0,i=i||0;var o=this._animations[t];return o||console.error("No animation by that name loaded."),this._startAnimation(o,t,e,i,n),o.onComplete.addOnce(function(){s&&r&&s.call(r)},r),o},n.prototype.stopAnimation=function(t){var e=this._animations[t];e.stopAnimation()},n.prototype.playRowRemoverAnimation=function(t,e,i,n){n=n||1;for(var s=null,r=4,o=this._matrixConfig.COLS/2-.5;i.length>=r;){this._screenShaker.activate();var a="rowRemoveTetris";s=this._animations[a],this._matrixModel.isFlipped?this._startAnimation(s,a,o,this._matrixConfig.STARTING_ROW_INDEX-i[2],n):this._startAnimation(s,a,o,i[2]-.5,n),i=i.slice(r)}for(var h=0;h<i.length;h++){var l=i[h];s=this._rowRemoveAnimations[h],this._matrixModel.isFlipped?this._startAnimation(s,"rowRemove",o,this._matrixConfig.STARTING_ROW_INDEX-l,n):this._startAnimation(s,"rowRemove",o,l,n)}return s.onComplete.addOnce(function(){t.call(e)},e),s},n.prototype.playNotificationAnimation=function(t){if(this._notificationsEnabled){var e=this._animations.gameplayNotifications;this._startAnimation(e,t,this._matrixConfig.HALF_COLS-.5,this._matrixConfig.PLAYABLE_ROWS_COUNT-4)}},n.prototype.playLastHurrahAnimation=function(){this.playAnimationAt("lastHurrah",this._matrixConfig.HALF_COLS-.5,.5*this._matrixConfig.PLAYABLE_ROWS_COUNT)},n.prototype.playCountDownAnimation=function(t,e){this._gameInfoPublisher.publish("setButtonsEnabled",!1);var i=this._animations.countdown,n=this._matrixConfig.HALF_COLS-.5,s=this._matrixConfig.PLAYABLE_ROWS_COUNT-8,r=1;this._startAnimation(i,"countdown_123",n,s,r),console.log("play countdown animation"),this._soundManager.effect(this._gameVarManager.audioConstants.countdown_sfx),i.onComplete.addOnce(function(){this._playGoAnimation(t,e,i,n,s,r),this._bgmCanPlay&&this._soundManager.music(this._gameVarManager.audioConstants.ingame_bgm,null,!0)},this)},n.prototype.showScorePopup=function(t,e,i){var n=0,s=0;this._notificationsEnabled&&(this._scorePopup.text=i.toString(),this._matrixModel.isFlipped?(n=this._matrixX+t*this._matrixConfig.TILE_WIDTH,s=this._matrixY-(this._matrixConfig.ROWS/2-1-e)*this._matrixConfig.TILE_HEIGHT):(n=this._matrixX+t*this._matrixConfig.TILE_WIDTH,s=this._matrixY-e*this._matrixConfig.TILE_HEIGHT),this._scorePopup.alpha=1,this._scorePopup.x=n,this._scorePopup.y=s,this._scoreTween.start())},n.prototype._setupAnimations=function(t,e){this._rowRemoveAnimations=[],this._rowRemoveAnimations.push(this._spineUtil.createAnimation("rowRemove01",t)),this._rowRemoveAnimations.push(this._spineUtil.createAnimation("rowRemove02",t)),this._rowRemoveAnimations.push(this._spineUtil.createAnimation("rowRemove01",t)),this._rowRemoveAnimations.forEach(function(t){t.visible=!1},this),this._animations={},this._animations.rowRemoveTetris=this._spineUtil.createAnimation("rowRemoveTetris",t),this._animations.fastDropParticles=this._spineUtil.createAnimation("fastDropParticles",t),this._animations.fastDropTrail=this._spineUtil.createAnimation("fastDropTrail",e),this._animations.lastHurrah=this._spineUtil.createAnimation("lastHurrah",t),this._animations.gameplayNotifications=this._spineUtil.createAnimation("gameplayNotifications",t),this._animations.countdown=this._spineUtil.createAnimation("countdown",t);for(var i in this._animations)this._animations.hasOwnProperty(i)&&(this._animations[i].visible=!1)},n.prototype._setupScoreTween=function(){this._scoreTween=this._game.add.tween(this._scorePopup);var e=1*this._matrixConfig.TILE_HEIGHT;this._scoreTween.to({alpha:0,y:"-"+e},n.SCORE_TWEEN_TIME,t.Easing.Quadratic.Out,!1,n.SCORE_DELAY),this._scorePopup.alpha=0},n.prototype._playGoAnimation=function(t,e,i,n,s,r){this._startAnimation(i,"countdown_GO",n,s,r),i.onComplete.addOnce(function(){t&&e&&t.call(e),this._gameInfoPublisher.publish("countdownFinished"),this._gameInfoPublisher.publish("setButtonsEnabled",!0)},this)},n.prototype._startAnimation=function(t,e,i,n,s){t.stopAnimation(),t.onComplete.removeAll(),this._prepareAnimation(t,i,n,s),t.startAnimation(e),t.onComplete.addOnce(function(){t.visible=!1})},n.prototype._prepareAnimation=function(t,e,i,n){n=n||1,e=e||0,i=i||0;var s=e*this._matrixConfig.TILE_WIDTH,r=i*this._matrixConfig.TILE_HEIGHT;t.x=this._matrixX+s*this._matrixConfig.SCALE,t.y=this._matrixY-r*this._matrixConfig.SCALE,t.scale.x=this._matrixConfig.SCALE,t.scale.y=this._matrixConfig.SCALE,t.visible=!0,t.animationSpeed=n},n.prototype._enableNotifications=function(t){this._notificationsEnabled=t},n.prototype._enableBgm=function(){this._bgmCanPlay=!0},n.prototype._disableBgm=function(){this._bgmCanPlay=!1},n.prototype.addEvents=function(){this._gameInfoPublisher.subscribe("marathonNotificationsOn",this._enableNotifications,this),this._gameInfoPublisher.subscribe("gameStarted",this._enableBgm,this),this._gameInfoPublisher.subscribe("lastHurrahTriggered",this._disableBgm,this),this._gameInfoPublisher.subscribe("gamePaused",function(){this.stopAnimation("countdown"),this._soundManager.stop(this._gameVarManager.audioConstants.countdown_sfx)},this)},n.prototype.removeEvents=function(){this._gameInfoPublisher.unsubscribe("marathonNotificationsOn",this._enableNotifications,this),this._gameInfoPublisher.unsubscribe("gameStarted",this._enableBgm,this),this._gameInfoPublisher.unsubscribe("lastHurrahTriggered",this._disableBgm,this),this._gameInfoPublisher.unsubscribe("gamePaused",function(){this.stopAnimation("countdown"),this._soundManager.stop(this._gameVarManager.audioConstants.countdown_sfx)},this)},n}),define("gameplay/tutorial/ForcedMove",[],function(){function t(matrixModel,gameInfoPublisher){this._matrixModel=matrixModel,this._gameInfoPublisher=gameInfoPublisher,this._moveGhostMinosCleared=!1}return t.prototype.isMoveLegal=function(t,e){if(e=e||!1,!t)return!1;if(this._moveGhostMinosCleared)return!0;var i=this._isMoveMatching(t);i&&!e&&this._clearMoveGhostMinos();var n=this._hasLevelMoveGhostMinos();return n?i:(this._moveGhostMinosCleared=!0,!0)},t.prototype.cleanUp=function(){this._moveGhostMinosCleared=!1},t.prototype._hasLevelMoveGhostMinos=function(){for(var t=this._matrixModel.moveGhostMatrix,e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++){var n=t[e][i].getPrisoner();if(n)return!0}return!1},t.prototype._getMoveGhostMinos=function(){for(var t=[],e=this._matrixModel.moveGhostMatrix,i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++){var s=e[i][n].getPrisoner();s&&t.push(s)}return t},t.prototype._isMoveMatching=function(t){for(var e=t.getMinos(),i=this._getMoveGhostMinos(),n=i.length,s=0,r=0;r<e.length;r++)for(var o=e[r],a=0;a<i.length;a++){var h=o.getPosition(),l=i[a],c=l.getPosition();h.x===c.x&&h.y===c.y&&s++}var u=n===s;return u},t.prototype._clearMoveGhostMinos=function(){for(var t=this._getMoveGhostMinos(),e=0;e<t.length;e++){var i=t[e];i.destroyTutorialAnimation(),i.matrixCell.destroyContents()}},Object.defineProperty(t.prototype,"moveGhostMinosCleared",{get:function(){var t=this._moveGhostMinosCleared;return t||(t=!this._hasLevelMoveGhostMinos()),t}}),t}),define("gui/GameUIController",["enums/UIPanelType","gt/utils/StringUtil","gt/utils/device"],function(t,e,i){function n(gameInfoPublisher,tetrisInput,scoreManager,levelManager,gameVarManager,progressBarController,neededLineClearsToWin,smartControls,game){this._gameInfoPublisher=gameInfoPublisher,this._tetrisInput=tetrisInput,this._scoreManager=scoreManager,this._levelManager=levelManager,this._gameVarManager=gameVarManager,this._progressBarController=progressBarController,this._neededLineClearsToWin=neededLineClearsToWin,this._smartControls=smartControls,this._game=game,this._view=null,this._levelData=null,this._paused=!1,this._unformattedLineClearText="{0}/{1}",this._gameInfoPublisher.subscribe("levelStart",this._resetScore,this)}return n.prototype.init=function(t){this._view=t,this._smartControls.setScreenButtons(this._view.buttons),this._gameInfoPublisher.subscribe("scoreChanged",this._scoreChanged,this),this._gameInfoPublisher.subscribe("marathonLevelChanged",this._marathonLevelChanged,this),this._gameInfoPublisher.subscribe("linesClearedChanged",this._linesClearedChanged,this),this._gameInfoPublisher.subscribe("gameResumed",this._gameResumed,this),this._gameInfoPublisher.subscribe("gamePaused",this._gamePaused,this),this._gameInfoPublisher.subscribe("setButtonsEnabled",this._setButtonsEnabled,this)},n.prototype.activate=function(t){var e=this._gameVarManager.levelMap[t];this._setLevelText(t),this._levelManager.getLevelData(e,t,this._levelDataChanged,this)},n.prototype.deActivate=function(){},n.prototype._gameResumed=function(){this._view.paused=!1,this._view.labels.lines.visible=!0,this._view.labels.level.visible=!0,this._view.labels.score.visible=!0},n.prototype._gamePaused=function(){this._view.paused=!0,this._view.labels.lines.visible=!1,this._view.labels.level.visible=!1,this._view.labels.score.visible=!1},n.prototype._scoreChanged=function(t){this._view.labels.score.text=t},n.prototype._marathonLevelChanged=function(t){var e=this._gameVarManager.constants.marathonMaxLevel;t>e&&(t=e),this._view.labels.level.text=t},n.prototype._linesClearedChanged=function(t){this._view.labels.lines.text=t},n.prototype._levelDataChanged=function(t){this._levelData=t;var e=this._scoreManager.isMarathon(t);e||this._activateGameModePanels(t),this._view.labels.levelTxt.visible=!e,this._view.labels.speedlevelTxt.visible=e},n.prototype._activateGameModePanels=function(e){var i=[],n=e.loseConditions,s=t.TIME;n.forEach(function(t){t.type==s&&i.push(s)},this);var r=[t.GRAVITY,t.HOURGLASS,t.JUNKSPAWN],o=e.gameModes;r.forEach(function(t){var e=o.indexOf(t),n=e>-1;n&&i.push(t)},this),this._view.showPanels(i)},n.prototype._setLevelText=function(t){this._view.labels.level.text=t},n.prototype._positionProgressBar=function(){var t=this._view.placeHolders,e=t.progressbarBottom,i=this._view.groups.pgBar;i.x=e.x,i.y=e.y,this._view.groups.lines.visible=!0},n.prototype._setButtonsEnabled=function(t){for(var e in this._view.buttons)this._view.buttons[e].button.input.enabled=t},n.prototype._resetScore=function(){this._view.labels.score.text=0},n}),define("gameplay/MarathonProgress",[],function(){var t=function(gameInfoPublisher){this._gameInfoPublisher=gameInfoPublisher,this._levelAchieved=1,this._linesCleared=0,this._gameInfoPublisher.subscribe("marathonLevelChanged",this._levelChanged,this),this._gameInfoPublisher.subscribe("linesClearedChanged",this._linesClearedChanged,this)};return t.prototype._levelChanged=function(t){this._levelAchieved=t},t.prototype.getAchievedLevel=function(){return this._levelAchieved},t.prototype._linesClearedChanged=function(t){this._linesCleared=t},t.prototype.getAchievedLinesCleared=function(){return this._linesCleared},t}),define("gt/utils/FullscreenUtil",["gt/utils/device"],function(t){var e=function(viewportManager,gameConfig){this._viewportManager=viewportManager,this._gameConfig=gameConfig,this._fullscreenOnButton=null,this._fullscreenOffButton=null,this._context=null};return e.prototype._isFullscreenSupported=function(){var e=this._gameConfig.fullscreenEnabled,i=t.desktop;return e&&i?!0:!1},e.prototype._setupEventListeners=function(){
this._viewportManager.screenChangedEvent.add(this._onScreenChanged,this)},e.prototype._setupCallbacks=function(){this._fullscreenOnButton.setCallback(this._context._fullscreenUtil._viewportManager.toggleFullscreen,this._context),this._fullscreenOffButton.setCallback(this._context._fullscreenUtil._viewportManager.toggleFullscreen,this._context)},e.prototype._setupVisibility=function(){this._fullscreenOnButton.setVisible(!0),this._fullscreenOffButton.setVisible(!1)},e.prototype._disableFullscreen=function(){this._fullscreenOnButton.setVisible(!1),this._fullscreenOffButton.setVisible(!1)},e.prototype._onScreenChanged=function(t){this._fullscreenOnButton.setVisible(!t),this._fullscreenOffButton.setVisible(t)},e.prototype.setup=function(t,e,i,n){this._fullscreenOnButton=t,this._fullscreenOffButton=e,this._context=i,this._isFullscreenSupported()?(this._setupEventListeners(),this._setupCallbacks(),this._setupVisibility()):(this._disableFullscreen(),n&&n.call(this._context))},e.prototype.cleanUp=function(){this._fullscreenOnButton.removeCallback(),this._fullscreenOffButton.removeCallback(),this._fullscreenOnButton=null,this._fullscreenOffButton=null,this._viewportManager.screenChangedEvent.remove(this._onScreenChanged,this)},e}),define("gameplay/matrix/MatrixGlowAnimator",[],function(){function t(matrixConfig,gameInfoPublisher,spineUtil,sceneManager){this._matrixConfig=matrixConfig,this._gameInfoPublisher=gameInfoPublisher,this._spineUtil=spineUtil,this._sceneManager=sceneManager,this._animation=null}return t.GLOW_ANIM_NAME="gridGlow",t.prototype.startUp=function(){this._addEvents()},t.prototype.cleanUp=function(){this._animation&&(this._animation.destroy(),this._animation=null),this._removeEvents()},t.prototype._createAnimation=function(){var e=this._sceneManager.getScene("game"),i=e.components.gameCp,n=i.placeHolders.matrixGlow;this._animation=this._spineUtil.createAnimation(t.GLOW_ANIM_NAME,n),this._animation.visible=!1,this._animation.scale.x=this._matrixConfig.SCALE,this._animation.scale.y=this._matrixConfig.SCALE},t.prototype._startGlow=function(){this._animation||this._createAnimation(),this._animation.startAnimation(t.GLOW_ANIM_NAME,!1,!0,!1),this._animation.visible=!0},t.prototype._stopGlow=function(){this._animation&&(this._animation.stopAnimation(),this._animation.visible=!1)},t.prototype._resumeAnimation=function(){this._animation&&this._animation.resumeAnimation()},t.prototype._pauseAnimation=function(){this._animation&&this._animation.pauseAnimation()},t.prototype._addEvents=function(){this._gameInfoPublisher.subscribe("timeChangedGlowStart",this._startGlow,this),this._gameInfoPublisher.subscribe("gamePaused",this._pauseAnimation,this),this._gameInfoPublisher.subscribe("gameResumed",this._resumeAnimation,this),this._gameInfoPublisher.subscribe("levelEnded",this._stopGlow,this)},t.prototype._removeEvents=function(){this._gameInfoPublisher.unsubscribe("timeChangedGlowStart",this._startGlow,this),this._gameInfoPublisher.unsubscribe("gamePaused",this._pauseAnimation,this),this._gameInfoPublisher.unsubscribe("gameResumed",this._resumeAnimation,this),this._gameInfoPublisher.unsubscribe("levelEnded",this._stopGlow,this)},t}),define("gameplay/GravityModeMinoHandler",["enums/TetriminoType"],function(t){function e(tetriminoFactory){this._tetriminoFactory=tetriminoFactory}return e.prototype.reconstructTetrimino=function(e,i){var n=e.tetriminoType;switch(n){case t.J:e=this._constructReplacement(e,t.L,"type_j.png",i);break;case t.L:e=this._constructReplacement(e,t.J,"type_l.png",i);break;case t.Z:e=this._constructReplacement(e,t.S,"type_z.png",i);break;case t.S:e=this._constructReplacement(e,t.Z,"type_s.png",i)}return e},e.prototype._updateMinoSprites=function(t,e,i){if(!i)for(var n=t.getMinos(),s=0;s<n.length;s++)n[s].setOriginalImageName(n[s].frameName),n[s].didSpriteChangeInGravity=!0,n[s].setImage(e)},e.prototype._constructReplacement=function(t,e,i,n){return n||t.destroyMinos(),t=this._tetriminoFactory.construct(e,!1),this._updateMinoSprites(t,i,n),t},e}),define("utils/AdTech",["phaser","gt/utils/device"],function(t,e){function i(game,gameConfig,platform){this._game=game,this._gameConfig=gameConfig,this._platform=platform,window.addEventListener("message",function(t){this.receiveAdTechMessage(t)}.bind(this),!1)}return i.prototype._getAdDescriptor=function(){return e.desktop?{frameClass:"adFrameDesktop",adClass:"adtech",width:640,height:480,zoneId:this._gameConfig.adtechZones.desktop}:{frameClass:"adFrameMobile",adClass:"adtechMobile",width:320,height:250,zoneId:this._gameConfig.adtechZones.mobile}},i.prototype.playAdTechVideo=function(t,i){e.desktop||(this._game.paused=!0),this._videoCallback=t,this._videoContext=i;var n=this._getAdDescriptor(),s=Math.floor(1e9*Math.random());this._overlay=document.createElement("div"),this._overlay.className="adOverlay";var r=document.createElement("div");r.className="adBg";var o=document.createElement("div");o.className=n.frameClass,this._iframe=document.createElement("iframe"),this._iframe.src="http://media.oadts.com/www/delivery/afv.php?zoneid="+n.zoneId+"&cb="+s,this._iframe.frameborder="0",this._iframe.scrolling="no",this._iframe.width=n.width,this._iframe.height=n.height,this._iframe.className=n.adClass,this._overlay.appendChild(r),this._overlay.appendChild(o),this._overlay.appendChild(this._iframe),document.body.appendChild(this._overlay)},i.prototype.completeAdTechVideo=function(t){e.desktop||(this._game.paused=!1),this._overlay&&(document.body.removeChild(this._overlay),this._overlay=null),this._platform.resetAdTimer(),this._videoCallback.call(this._videoContext,t)},i.prototype.receiveAdTechMessage=function(t){if("http://media.oadts.com"===t.origin&&this._overlay)switch(console.log(t),t.data){case"videoStart":break;case"noVideo":case"NoVideo":document.body.removeChild(this._overlay),this._overlay=null,this.completeAdTechVideo(!0);break;case"videoEnds":case"videoComplete":this.completeAdTechVideo(!0)}},i}),define("modules/TetrisGame",["soma","gt/constants/ConsoleCSS","gt/extras/PartialInjectionFactory","gt/patterns/messaging/Publisher","configs/MatrixConfig","configs/TetriminosConfig","factories/PhaserGroupFactory","factories/PhaserSpriteFactory","factories/MatrixFactory","factories/TetriminoFactory","factories/MinoFactory","factories/ConditionFactory","factories/GameModeFactory","core/LevelManager","core/LevelParser","gameplay/game/GameManager","gameplay/game/GameStateManager","gameplay/game/GameCheats","gameplay/game/LastHurrah","gameplay/conditions/ConditionManager","gameplay/conditions/ClearLines","gameplay/conditions/LockOut","gameplay/conditions/TopOut","gameplay/conditions/BlockOut","gameplay/input/TetrisInput","gameplay/RotationController","gameplay/TetriminoController","gameplay/game_modes/GameMode","gameplay/matrix/MatrixController","gameplay/matrix/MatrixView","gameplay/matrix/MatrixModel","gameplay/matrix/MatrixRowMatcher","gameplay/matrix/MatrixGravity","gameplay/matrix/MatrixGravityTweener","gameplay/matrix/MatrixConverter","gameplay/tetrimino_queue/TetriminoQueueController","gameplay/tetrimino_queue/TetriminoQueueView","gameplay/tetrimino_queue/TetriminoQueueModel","gameplay/tetrimino_holder/TetriminoHolderController","gameplay/tetrimino_holder/TetriminoHolderView","gameplay/tetrimino_holder/TetriminoHolderModel","core/Entity","entities/Tetrimino","entities/Mino","entities/MatrixCell","gameplay/game/ScoreManager","gameplay/conditions/Marathon","gameplay/input/SmartControls","gui/SpineUtil","utils/ScreenShaker","utils/CustomTimer","gameplay/LineClearCounter","gameplay/matrix/MatrixAnimator","gt/pooling/Pool","gameplay/tutorial/ForcedMove","gui/GameUIController","data/ControlScheme","gameplay/MarathonProgress","gt/utils/FullscreenUtil","gameplay/matrix/MatrixGlowAnimator","gameplay/GravityModeMinoHandler","utils/AdTech"],function(t,e,i,n,s,r,o,a,h,l,c,u,d,A,p,m,f,g,_,y,v,T,b,w,x,C,S,P,I,M,k,B,D,E,O,L,F,R,G,N,U,X,H,j,W,Q,Y,V,z,K,J,Z,q,$,tt,et,it,nt,st,rt,ot,at){var ht=function(injector,sceneManager,gameInfoPublisher){this._injector=injector,this._sceneManager=sceneManager,this._gameInfoPublisher=gameInfoPublisher};return ht.prototype.run=function(t,i){console.log("%c [DI module] %c TetrisGame ",e.MODULE_TAG,e.MODULE_TEXT),this.createPartialInjectionFactories(),this.mapClassesAndValues(),this._sceneManager.createScenes(),this._gameInfoPublisher.publish("loadProgressed",100),this._gameInfoPublisher.publish("tetrisGameReady"),t.call(i)},ht.prototype.createPartialInjectionFactories=function(){var matrixCellFactory=new i(this._injector,W);this._injector.mapValue("matrixCellFactory",matrixCellFactory)},ht.prototype.mapClassesAndValues=function(){this._injector.mapClass("matrixConfig",s,t.SINGLETON),this._injector.mapClass("tetriminoConfig",r,t.SINGLETON),this._injector.mapClass("phaserGroupFactory",o,t.SINGLETON),this._injector.mapClass("phaserSpriteFactory",a,t.SINGLETON),this._injector.mapClass("matrixFactory",h,t.SINGLETON),this._injector.mapClass("tetriminoFactory",l,t.SINGLETON),this._injector.mapClass("minoFactory",c,t.SINGLETON),this._injector.mapClass("conditionFactory",u,t.SINGLETON),this._injector.mapClass("gameModeFactory",d,t.SINGLETON),this._injector.mapClass("levelManager",A,t.SINGLETON),this._injector.mapClass("levelParser",p,t.SINGLETON),this._injector.mapClass("gameManager",m,t.SINGLETON),this._injector.mapClass("gameStateManager",f,t.SINGLETON),this._injector.mapClass("gameCheats",g,t.SINGLETON),this._injector.mapClass("lastHurrah",_,t.SINGLETON),this._injector.mapClass("conditionManager",y,t.SINGLETON),this._injector.mapClass("tetrisInput",x,t.SINGLETON),this._injector.mapClass("tetriminoController",S,t.SINGLETON),this._injector.mapClass("rotationController",C,t.SINGLETON),this._injector.mapClass("matrixController",I,t.SINGLETON),this._injector.mapClass("matrixView",M,t.SINGLETON),this._injector.mapClass("matrixModel",k,t.SINGLETON),this._injector.mapClass("matrixRowMatcher",B,t.SINGLETON),this._injector.mapClass("matrixGravity",D,t.SINGLETON),this._injector.mapClass("matrixGravityTweener",E,t.SINGLETON),this._injector.mapClass("matrixConverter",O,t.SINGLETON),this._injector.mapClass("tetriminoQueueController",L,t.SINGLETON),this._injector.mapClass("tetriminoQueueView",F,t.SINGLETON),this._injector.mapClass("tetriminoQueueModel",R,t.SINGLETON),this._injector.mapClass("scoreManager",Q,t.SINGLETON),this._injector.mapClass("smartControls",V,t.SINGLETON),this._injector.mapClass("gameMode",P,t.SINGLETON),this._injector.mapClass("clearLines",v,t.SINGLETON),this._injector.mapClass("marathon",Y,t.SINGLETON),this._injector.mapClass("lockOut",T,t.SINGLETON),this._injector.mapClass("topOut",b,t.SINGLETON),this._injector.mapClass("blockOut",w,t.SINGLETON),this._injector.mapClass("tetriminoHolderController",G,t.SINGLETON),this._injector.mapClass("tetriminoHolderView",N,t.SINGLETON),this._injector.mapClass("tetriminoHolderModel",U,t.SINGLETON),this._injector.mapClass("spineUtil",z,t.SINGLETON),this._injector.mapClass("marathonProgress",nt),this._injector.mapClass("lineClearCounter",Z,t.SINGLETON),this._injector.mapClass("gameUIController",et),this._injector.mapClass("entity",X),this._injector.mapClass("publisher",n),this._injector.mapClass("screenShaker",K,t.SINGLETON),this._injector.mapClass("customTimer",J),this._injector.mapClass("matrixAnimator",q,t.SINGLETON),this._injector.mapClass("forcedMove",tt,t.SINGLETON),this._injector.mapClass("pool",$),this._injector.mapClass("controlScheme",it,t.SINGLETON),this._injector.mapClass("fullscreenUtil",st),this._injector.mapClass("matrixGlowAnimator",rt),this._injector.mapClass("gravityModeMinoHandler",ot),this._injector.mapClass("adTech",at)},ht}),define("modules/TetrisLegal",["soma","gt/constants/ConsoleCSS"],function(t,e){function i(){this._callback=null,this._context=null}return i.prototype.run=function(t,i){console.log("%c [DI module] %c TetrisLegal ",e.MODULE_TAG,e.MODULE_TEXT),this._callback=t,this._context=i,document.getElementById("loading").style.display="none",this._injectLegalScreen()},i.prototype._injectLegalScreen=function(){var t=document.createElement("div");t.id="legal";var e=document.createElement("div");e.id="legal-image",t.appendChild(e);var i=document.createElement("div");i.id="legal-text",i.innerHTML+="Tetris ® & © 1985~2019 Tetris Holding.<br>",i.innerHTML+="Tetris logos, Tetris theme song and Tetriminos are trademarks of Tetris Holding.<br>",i.innerHTML+="The Tetris trade dress is owned by Tetris Holding.<br>",i.innerHTML+="Licensed to The Tetris Company.<br>",i.innerHTML+="Tetris Game Design by Alexey Pajitnov.<br>",i.innerHTML+="All Rights Reserved.<br>",t.appendChild(i),document.body.appendChild(t),this.addPrefixedEventListener(t,"AnimationEnd",function(){this._endAnimation()}.bind(this),!1)},i.prototype.addPrefixedEventListener=function(t,e,i){for(var n=["webkit","moz","MS","o",""],s=0;s<n.length;s++)n[s]||(e=e.toLowerCase()),t.addEventListener(n[s]+e,i,!1)},i.prototype._endAnimation=function(){var t=document.getElementById("legal");document.body.removeChild(t),this._callback.call(this._context)},i}),function(t){function e(t,e){function n(t){return this&&this.constructor===n?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=e,void(t&&i.call(this,t))):new n(t)}return e||y(t,"size",{get:f}),t.constructor=n,n.prototype=t,n}function i(t){this.add?t.forEach(this.add,this):t.forEach(function(t){this.set(t[0],t[1])},this)}function n(t){return this.has(t)&&(this._keys.splice(_,1),this._values.splice(_,1),this._itp.forEach(function(t){_<t[0]&&t[0]--})),_>-1}function s(t){return this.has(t)?this._values[_]:void 0}function r(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!=e||0===e)for(_=t.length;_--&&!v(t[_],e););else _=t.indexOf(e);return _>-1}function o(t){return r.call(this,this._values,t)}function a(t){return r.call(this,this._keys,t)}function h(t,e){return this.has(t)?this._values[_]=e:this._values[this._keys.push(t)-1]=e,this}function l(t){return this.has(t)||this._values.push(t),this}function c(){(this._keys||0).length=this._values.length=0}function u(){return m(this._itp,this._keys)}function d(){return m(this._itp,this._values)}function A(){return m(this._itp,this._keys,this._values)}function p(){return m(this._itp,this._values,this._values)}function m(t,e,i){var n=[0],s=!1;return t.push(n),{next:function(){var r,o=n[0];return!s&&o<e.length?(r=i?[e[o],i[o]]:e[o],n[0]++):(s=!0,t.splice(t.indexOf(n),1)),{done:s,value:r}}}}function f(){return this._values.length}function g(t,e){for(var i=this.entries();;){var n=i.next();if(n.done)break;t.call(e,n.value[1],n.value[0],this)}}var _,y=Object.defineProperty,v=function(t,e){return isNaN(t)?isNaN(e):t===e};"undefined"==typeof WeakMap&&(t.WeakMap=e({"delete":n,clear:c,get:s,has:a,set:h},!0)),"undefined"!=typeof Map&&"function"==typeof(new Map).values&&(new Map).values().next||(t.Map=e({"delete":n,has:a,get:s,set:h,keys:u,values:d,entries:A,forEach:g,clear:c})),"undefined"!=typeof Set&&"function"==typeof(new Set).values&&(new Set).values().next||(t.Set=e({has:o,add:l,"delete":n,clear:c,keys:d,values:d,entries:p,forEach:g})),"undefined"==typeof WeakSet&&(t.WeakSet=e({"delete":n,add:l,clear:c,has:o},!0))}("undefined"!=typeof exports&&"undefined"!=typeof global?global:window),define("collections",function(){}),define("polyfill/Map",["collections"],function(t){return window.Map||t.Map}),define("gt/modules/DomainLocking",[],function(){var t=function(gameConfig){this._gameConfig=gameConfig};return t.prototype.run=function(t,e){this._isDomainAllowed()?t.call(e):console.warn("You are trying to access the game from the wrong domain! "+location.href)},t.prototype._isDomainAllowed=function(){var t=this._gameConfig.allowedDomains,e=!1,i=location.href;if(i=i.replace("http://",""),t)for(var n=0;n<t.length;n++)-1!=i.indexOf(t[n])&&(e=!0);else console.warn("Allowed domains not defined in GameConfig!");return e},t}),requirejs.config({baseUrl:"./src/",paths:{soma:"../lib/gt/lib/soma/soma",modernizr:"../lib/gt/lib/modernizr/Modernizr",pixi:"../lib/gt/lib/phaser/pixi",phaser:"../lib/gt/lib/phaser/phaser-no-libs",spine:"../lib/gt/lib/phaser/src/pixi/extras/Spine",fontloader:"../lib/gt/lib/fontloader/FontLoader",async:"../bower_components/async/lib/async",promise:"../bower_components/es6-promise/promise",collections:"polyfill/es6-collections",uaparser:"../bower_components/ua-parser-js/dist/ua-parser.min",uuid:"../bower_components/node-uuid/uuid",bottom_line:"../bower_components/bottom_line/dist/bottom_line",gt:"../lib/gt/src"},shim:{phaser:{exports:"Phaser"}},waitSeconds:66}),require(["bottom_line","pixi","modernizr","gt/utils/device","gt/utils/browser","gt/utils/device.info","gt/utils/polyfills","gt/utils/dom"],function(){require(["spine"],function(){require(["gt/tweaks/Pixi/Sprite","gt/tweaks/Pixi/Graphics","gt/tweaks/Pixi/WebGLRenderer","gt/tweaks/Pixi/Texture","gt/tweaks/Pixi/Spine","gt/tweaks/Pixi/SpineAnimationState"],function(){require(["gt/tweaks/Phaser/Loader","gt/tweaks/Phaser/Group","gt/tweaks/Phaser/Easing","gt/tweaks/Phaser/Pointer","gt/tweaks/Phaser/ScaleManager","gt/tweaks/Phaser/Canvas","gt/tweaks/Phaser/BitmapText","gt/tweaks/Phaser/Tween","gt/tweaks/Phaser/Label","gt/tweaks/Phaser/Cache"],function(){require(["factories/GameObjects"],function(){require(["gt/rendering/filters/Blur","gt/rendering/filters/Glow"],function(){require(["soma","gt/modules/BootSetup","gt/modules/GeoLocking","gt/modules/PasswordProtect","gt/modules/PhaserSetup","gt/modules/FactorySetup","gt/modules/ShowFPSCounter","gt/modules/PublisherSetup","gt/modules/SystemsSetup","gt/modules/StartLoader","gt/modules/LoadGameAssets","gt/modules/LoaderReady","modules/TetrisGame","modules/TetrisLegal","gt/utils/device","polyfill/Map","gt/modules/DomainLocking"],function(t,e,i,n,s,r,o,a,h,l,c,u,d,A,p,m,f){var g=t.Application.extend({init:function(){window.PhaserGlobal={fakeiOSTouchLock:!0},console.log("EntryPoint.init"),this._modules=[],this._modules.push(e),this._modules.push(A),this._modules.push(s),this._modules.push(r),this._modules.push(a),this._modules.push(h),this._modules.push(l),this._modules.push(c),this._modules.push(u),this._modules.push(d),this.runNextModule()},restartGame:function(){this._modules.splice(0,this._modules.length),this._modules.push(d),this.runNextModule()},runNextModule:function(){var t=this._modules.shift(),instance=this.injector.createInstance(t);instance.run(this.onModuleComplete,this)},onModuleComplete:function(){console.log(" ...completed module."),this._modules.length>0&&this.runNextModule()}});new g})})})})})})}),define("entry",function(){});